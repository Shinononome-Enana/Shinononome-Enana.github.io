
  <!DOCTYPE html>
  <html lang="en"  >
  <head>
  <meta charset="utf-8">
  

  

  

  
  <script>window.icon_font = '4552607_tq6stt6tcg';window.clipboard_tips = {"success":"复制成功(*^▽^*)","fail":"复制失败 (ﾟ⊿ﾟ)ﾂ","copyright":{"enable":false,"count":50,"content":"本文版权：本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！"}};</script>
  
  
  <title>
    用原生opencv代码实现霍夫变换(Tough-Transform) |
    
    ロ　ユイセーの魔法領域
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CUbuntu%20Mono:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_tq6stt6tcg.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  <meta name="description" content="基本要求 Hough transform is a very classic and useful method for the detection of curves or lines. It uses the transformation of two coordinate spaces (the image space and the Hough space) to map curves o">
<meta property="og:type" content="article">
<meta property="og:title" content="用原生opencv代码实现霍夫变换(Tough-Transform)">
<meta property="og:url" content="https://shinononome-enana.github.io/2024/11/10/opencv/index.html">
<meta property="og:site_name" content="ロ　ユイセーの魔法領域">
<meta property="og:description" content="基本要求 Hough transform is a very classic and useful method for the detection of curves or lines. It uses the transformation of two coordinate spaces (the image space and the Hough space) to map curves o">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/zdjCqyXa6QkMBp1.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/J4VF9xdLYpwrayU.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/IBofUtDdhnNelWx.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/PhSj2sOoIez7MfV.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/Ou8HU2AxKkST4bN.png">
<meta property="og:image" content="https://s2.loli.net/2024/11/10/B68dTPnk1OAIpMh.png">
<meta property="article:published_time" content="2024-11-10T13:08:01.000Z">
<meta property="article:modified_time" content="2025-01-03T13:06:36.530Z">
<meta property="article:author" content="ロ　ユイセー(Lu Weicheng)">
<meta property="article:tag" content="CPP">
<meta property="article:tag" content="Tough-Transform">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png">
  
    <link rel="alternate" href="/atom.xml" title="ロ　ユイセーの魔法領域" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  
    
      
<link rel="stylesheet" href="https://npm.webcache.cn/@waline/client@v2/dist/waline.css">

    
  
  
  
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js"></script>

  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.0.1/dist/aos.css">

  
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi">
        <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
          <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="#ff5252" />
          <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
         M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="#ff5252" />
        </svg>
      </div>
      <div class="loading-word">少女祈祷中...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/">Home</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/archives">Archives</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/about">About</a>
      </span>
    
      <span class="main-nav-link-wrap">
        <div class="main-nav-icon icon-taichi"></div>
        <a class="main-nav-link" href="/friend">Friend</a>
      </span>
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
    
      <a id="nav-search-btn" class="nav-icon popup-trigger" title="Search"></a>
    
    
  </nav>
</div>
<header id="header">
  
    
      <img fetchpriority="high" src="/images/banner.webp" alt="用原生opencv代码实现霍夫变换(Tough-Transform)">
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">用原生opencv代码实现霍夫变换(Tough-Transform)</h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content">
          
          <section id="main"><article id="post-opencv" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <a href="/2024/11/10/opencv/" class="article-date-link" data-aos="zoom-in">
    <time datetime="2024-11-10T13:08:01.000Z" itemprop="datePublished">2024-11-10</time>
    <time style="display: none;" id="post-update-time">2025-01-03</time>
  </a>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/LAB-EXERCISE/" data-aos="zoom-in">LAB EXERCISE</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h2 id="基本要求"><a href="#基本要求" class="headerlink" title="基本要求"></a>基本要求</h2><blockquote>
<p>Hough transform is a very classic and useful method for the detection of curves or lines. It uses the transformation of two coordinate spaces (the image space and the Hough space) to map curves or straight lines to points in another coordinate space to vote and form peaks, thus transforming the problem of detecting arbitrary shapes into a statistical peak problem.<br>In this task, you can draw some lines or circles by yourself and use Hough Transform to detect the figure you drew (you can try for lines firstly and then for circles). MUST implement it yourself!</p>
</blockquote>
<h2 id="代码框架"><a href="#代码框架" class="headerlink" title="代码框架"></a>代码框架</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ToughTransform</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">LineDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max , <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="直线检测"><a href="#直线检测" class="headerlink" title="直线检测"></a>直线检测</h2><ul>
<li><strong>void LineDetection(Mat&amp; Image):</strong> 算法主流程。包括将图像转化到二维参数空间(row,theta),对参数空间矩阵进行初次阈值过滤,以及调用ShowParameterSpace和DrawLineDetectedImage方法。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    LineDetection: ShowParameterSpace + DrawLineDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::LineDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[row][theta]</span></span><br><span class="line">    <span class="type">double</span> row_max = <span class="built_in">sqrt</span>(img_width * img_width + img_height * img_height);</span><br><span class="line">    <span class="type">int</span> theta_max = <span class="number">180</span>;   <span class="comment">//theta: step_length = 1</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PatameterSpace</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ImageSize:&quot;</span> &lt;&lt; img_height &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; img_width &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;PatameterSpace:&quot;</span> &lt;&lt; <span class="number">2</span>*row_max &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; <span class="string">&quot; --&gt; &quot;</span> &lt;&lt; <span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)) &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//!!!look through theta, calc row than write into parameter-space!!!</span></span><br><span class="line">                <span class="comment">//遍历theta，计算row，存入参数空间</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt;= theta_max; theta++)&#123;  </span><br><span class="line">                    <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                    <span class="type">double</span> row = x * <span class="built_in">cos</span>(theta_rad) + y * <span class="built_in">sin</span>(theta_rad);</span><br><span class="line">                    <span class="comment">//row可能是负的,row_max作为偏移量. 将偏移量row_max加到row上，转为非负索引</span></span><br><span class="line">                    <span class="comment">//cout &lt;&lt; &quot;row = &quot; &lt;&lt; row &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; row + row_max  &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; ceil(row) + ceil(row_max) &lt;&lt; endl;</span></span><br><span class="line">                    PatameterSpace[<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row) + <span class="built_in">ceil</span>(row_max))][theta]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PS_AfterFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PatameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PatameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PatameterSpace[i][j] &gt;= threshold)</span><br><span class="line">                PS_AfterFilter[i][j] = PatameterSpace[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_AfterFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_AfterFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> second_filter_threshold = <span class="number">500</span>;</span><br><span class="line">    <span class="built_in">DrawLineDetectedImage</span>(Image,PS_AfterFilter,<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),theta_max,second_filter_threshold);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ShowParameterSpace(vector&lt;vector<int>&gt;&amp; PS_AfterFilter, string file_name, int thetaScale)：</strong> 在LineDetection和DrawLineDetectedImage中被调用，可以描绘出二维参数空间PS_AfterFilter(row,theta)的点分布。其中file_name是图片保存地址；thetaScale将theta轴拉伸，以达到更好的可视化效果。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ShowParameterSpace:</span></span><br><span class="line"><span class="comment">        描绘(row,theta)参数空间的图像。此时的参数矩阵PS_AfterFilter只经历了初步的阈值筛选。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">15</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> rows = PS_AfterFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">houghSpaceImage</span><span class="params">(rows, cols, CV_8UC1, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="type">int</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; row : PS_AfterFilter) &#123;</span><br><span class="line">        maxVal = <span class="built_in">max</span>(maxVal, *<span class="built_in">max_element</span>(row.<span class="built_in">begin</span>(), row.<span class="built_in">end</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">            houghSpaceImage.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="built_in">static_cast</span>&lt;uchar&gt;(<span class="number">255.0</span> * PS_AfterFilter[i][j] / maxVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(houghSpaceImage, enlargedHoughSpace, <span class="built_in">Size</span>(cols * thetaScale, rows), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>DrawLineDetectedImage(Mat&amp; Image, vector&lt;vector<int>&gt;&amp; PS_AfterFilter, int row_max, int theta_max , int second_filter_threshold):</strong> 将二维参数空间矩阵PS_AfterFilter进行更深层次的阈值筛选(阈值更大，筛选剩下的点更少)，然后反变换到”x,y直角坐标系”，描绘出检测出的直线。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DrawDetectedImage: </span></span><br><span class="line"><span class="comment">        二次过滤参数空间(row,theta)矩阵，然后在原图image上描绘出直线。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max = <span class="number">180</span>, <span class="type">int</span> second_filter_threshold = <span class="number">100</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">PS_FinalFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                       <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PS_AfterFilter[i][j] &gt;= second_filter_threshold)</span><br><span class="line">                PS_FinalFilter[i][j] = PS_AfterFilter[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_FinalFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_FinalFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> rows = PS_FinalFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; cols; theta++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PS_FinalFilter[row][theta] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">double</span> this_theta_rad = theta * PI / <span class="number">180.0</span>;  </span><br><span class="line">                <span class="type">double</span> this_row = row - row_max;</span><br><span class="line"></span><br><span class="line">                Point pt1, pt2;</span><br><span class="line">                <span class="type">double</span> a = <span class="built_in">cos</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> b = <span class="built_in">sin</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> x0 = a * this_row;</span><br><span class="line">                <span class="type">double</span> y0 = b * this_row;</span><br><span class="line">                pt<span class="number">1.</span>x = <span class="built_in">cvRound</span>(x0 + <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">1.</span>y = <span class="built_in">cvRound</span>(y0 + <span class="number">1000</span> * (a));</span><br><span class="line">                pt<span class="number">2.</span>x = <span class="built_in">cvRound</span>(x0 - <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">2.</span>y = <span class="built_in">cvRound</span>(y0 - <span class="number">1000</span> * (a));</span><br><span class="line"></span><br><span class="line">                <span class="built_in">line</span>(Image, pt1, pt2, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, LINE_AA);</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Lines&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Lines&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/line-result/DetectedLinesImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>调试方法：</strong> 调整阈值second_filter_threshold直到合适。如果阈值太低，描绘的直线就会过多，图上一片混乱；如果阈值太高，则不会有检测结果。</li>
</ul>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>输入测试图片，主函数调用LineDetection(Mat&amp; Image)即可。</p>
<ul>
<li>测试图像如下。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png"/>

<ul>
<li>霍夫变换并初步阈值过滤(threshold&#x3D;10)后，检测出的直线二维参数空间(row,theta)图像。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/zdjCqyXa6QkMBp1.png"/>

<ul>
<li>二次深度阈值过滤(threshold&#x3D;500)后，检测出的直线二维参数空间(row,theta)图像。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/J4VF9xdLYpwrayU.png"/>

<ul>
<li>反变换到直角坐标，原图上描绘出检测到的直线。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/IBofUtDdhnNelWx.png"/>

<hr>
<h2 id="圆检测"><a href="#圆检测" class="headerlink" title="圆检测"></a>圆检测</h2><ul>
<li><strong>CircleDetection(Mat&amp; Image):</strong> 算法主流程。包括将图像转化到三维参数空间(a,b,r)，其中圆心坐标为(a,b)，圆的半径是r。对参数空间矩阵进行初次阈值过滤,以及调用ShowParameterSpace_Circle和DrawCircleDetectedImage方法。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    CircleDetection: ShowParameterSpace_Circle + DrawCircleDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="comment">//在霍夫变换中，我们通过三个参数来描述一个圆：圆心的坐标(a,b)和半径r.</span></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[b][a][r]   b---&gt;height---&gt;y | a---&gt;width---&gt;x</span></span><br><span class="line">    <span class="type">int</span> max_a = img_width;</span><br><span class="line">    <span class="type">int</span> max_b = img_height;</span><br><span class="line">    <span class="type">int</span> max_r = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.5</span>* <span class="built_in">min</span>(max_a,max_b));</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">ParameterSpace</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//遍历r，计算row，存入参数空间: min_r = 20 --&gt; max_r</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> r = <span class="number">20</span>; r &lt;= max_r; r++)&#123;</span><br><span class="line">                    <span class="comment">//遍历每个r情况下的theta(一周)，计算a&amp;b，存入参数空间</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; <span class="number">360</span>; theta++)&#123;</span><br><span class="line">                        <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                        <span class="type">int</span> a = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x - r * <span class="built_in">cos</span>(theta_rad));</span><br><span class="line">                        <span class="type">int</span> b = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y - r * <span class="built_in">sin</span>(theta_rad));</span><br><span class="line">                        <span class="keyword">if</span>(a &gt;= <span class="number">0</span> &amp;&amp; a &lt; max_a &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b &lt; max_b)&#123;</span><br><span class="line">                            ParameterSpace[b][a][r]++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_AfterFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ParameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; ParameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; ParameterSpace[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ParameterSpace[i][j][k] &gt;= threshold)</span><br><span class="line">                    PS_AfterFilter[i][j][k] = ParameterSpace[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_AfterFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_AfterFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> second_filter_threshold = <span class="number">300</span>;</span><br><span class="line">    <span class="built_in">DrawCircleDetectedImage</span>(Image,PS_AfterFilter,max_a,max_b,max_r,second_filter_threshold);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>ShowParameterSpace_Circle(vector&lt;vector&lt;vector<int>&gt;&gt;&amp; PS_AfterFilter, string file_name, int thetaScale)：</strong> 传入三维参数矩阵PS_AfterFilter，描绘图像。其中file_name是图片保存地址；thetaScale将theta轴拉伸，以达到更好的可视化效果。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> height = PS_AfterFilter.<span class="built_in">size</span>();     <span class="comment">//row的范围</span></span><br><span class="line">    <span class="type">int</span> width = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();   <span class="comment">// theta的范围</span></span><br><span class="line">    <span class="type">int</span> num_r = PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">// 半径r的数量</span></span><br><span class="line">    <span class="function">Mat <span class="title">parameter_space_image</span><span class="params">(height, width, CV_8UC1, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> b = <span class="number">0</span>; b &lt; height; b++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">0</span>; a &lt; width; a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; num_r; r++) &#123;</span><br><span class="line">                <span class="type">int</span> accumulator_value = PS_AfterFilter[b][a][r];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 将累积值映射到0-255的范围（可以根据实际情况调整比例）</span></span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">255.0</span> * accumulator_value / <span class="number">255.0</span>); </span><br><span class="line">                parameter_space_image.<span class="built_in">at</span>&lt;uchar&gt;(b, a) = intensity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(parameter_space_image, enlargedHoughSpace, <span class="built_in">Size</span>(width * thetaScale, height), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>DrawCircleDetectedImage(Mat&amp; Image,vector&lt;vector&lt;vector<int>&gt;&gt;&amp; PS_AfterFilter, int max_a, int max_b, int max_r, int second_filter_threshold)：</strong> 传入三维参数空间PS_AfterFilter，利用second_filter_threshold进行二次阈值筛选后，反变换到直角坐标。由于是圆检测，只需要取出圆心(x,y)和半径r的值，然后进行描绘即可。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_FinalFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(PS_AfterFilter[i][j][k] &gt;= second_filter_threshold)</span><br><span class="line">                    PS_FinalFilter[i][j][k] = PS_AfterFilter[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_FinalFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_FinalFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_FinalFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_FinalFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="comment">//draw circle</span></span><br><span class="line">                <span class="keyword">if</span>(PS_FinalFilter[i][j][k] != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="function">Point <span class="title">center</span><span class="params">(j, i)</span></span>;</span><br><span class="line">                    <span class="built_in">circle</span>(Image, center, k, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>);  <span class="comment">//红色圆圈</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/circle-result/DrawCircleDetectedImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>调试方法：</strong> <ul>
<li>调整阈值second_filter_threshold直到合适。如果阈值太低，描绘的圆就会过多，图上一片混乱；如果阈值太高，则不会有检测结果。</li>
<li>调整参数计算时，半径的遍历上下限的r_min和r_max。r_max一般直接取图像height和width中的较小值。r_min如果取0，那么有宽度的直线也会被检测成一长串的迷你圆；r_min取得太小，可能会把交点也检测成小圆。</li>
</ul>
</li>
</ul>
<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p>输入测试图片，主函数调用CircleDetection(Mat&amp; Image)即可。</p>
<ul>
<li>测试图像如下。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png"/>

<ul>
<li>霍夫变换并初步阈值(threshold&#x3D;10)过滤后，检测出的参数空间图像。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/PhSj2sOoIez7MfV.png"/>

<ul>
<li>二次深度阈值过滤(threshold&#x3D;300)后，检测出的圆参数空间图像。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/Ou8HU2AxKkST4bN.png"/>

<ul>
<li>反变换到直角坐标，原图上描绘出检测到的圆。</li>
</ul>
<img src="https://s2.loli.net/2024/11/10/B68dTPnk1OAIpMh.png"/>

<hr>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span>     <span class="comment">// Basic OpenCV structures (cv::Mat)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/videoio.hpp&gt;</span>  <span class="comment">// Video write</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/videoio.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/video.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="number">3.14159265358979323846</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToughTransform</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">LineDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max , <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ShowParameterSpace:</span></span><br><span class="line"><span class="comment">        描绘(row,theta)参数空间的图像。此时的参数矩阵PS_AfterFilter只经历了初步的阈值筛选。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">15</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> rows = PS_AfterFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">houghSpaceImage</span><span class="params">(rows, cols, CV_8UC1, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="type">int</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; row : PS_AfterFilter) &#123;</span><br><span class="line">        maxVal = <span class="built_in">max</span>(maxVal, *<span class="built_in">max_element</span>(row.<span class="built_in">begin</span>(), row.<span class="built_in">end</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">            houghSpaceImage.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="built_in">static_cast</span>&lt;uchar&gt;(<span class="number">255.0</span> * PS_AfterFilter[i][j] / maxVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(houghSpaceImage, enlargedHoughSpace, <span class="built_in">Size</span>(cols * thetaScale, rows), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DrawDetectedImage: </span></span><br><span class="line"><span class="comment">        二次过滤参数空间(row,theta)矩阵，然后在原图image上描绘出直线。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max = <span class="number">180</span>, <span class="type">int</span> second_filter_threshold = <span class="number">100</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">PS_FinalFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                       <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PS_AfterFilter[i][j] &gt;= second_filter_threshold)</span><br><span class="line">                PS_FinalFilter[i][j] = PS_AfterFilter[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_FinalFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_FinalFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> rows = PS_FinalFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; cols; theta++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PS_FinalFilter[row][theta] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">double</span> this_theta_rad = theta * PI / <span class="number">180.0</span>;  </span><br><span class="line">                <span class="type">double</span> this_row = row - row_max;</span><br><span class="line"></span><br><span class="line">                Point pt1, pt2;</span><br><span class="line">                <span class="type">double</span> a = <span class="built_in">cos</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> b = <span class="built_in">sin</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> x0 = a * this_row;</span><br><span class="line">                <span class="type">double</span> y0 = b * this_row;</span><br><span class="line">                pt<span class="number">1.</span>x = <span class="built_in">cvRound</span>(x0 + <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">1.</span>y = <span class="built_in">cvRound</span>(y0 + <span class="number">1000</span> * (a));</span><br><span class="line">                pt<span class="number">2.</span>x = <span class="built_in">cvRound</span>(x0 - <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">2.</span>y = <span class="built_in">cvRound</span>(y0 - <span class="number">1000</span> * (a));</span><br><span class="line"></span><br><span class="line">                <span class="built_in">line</span>(Image, pt1, pt2, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, LINE_AA);</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Lines&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Lines&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/line-result/DetectedLinesImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    LineDetection: ShowParameterSpace + DrawLineDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::LineDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[row][theta]</span></span><br><span class="line">    <span class="type">double</span> row_max = <span class="built_in">sqrt</span>(img_width * img_width + img_height * img_height);</span><br><span class="line">    <span class="type">int</span> theta_max = <span class="number">180</span>;   <span class="comment">//theta: step_length = 1</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PatameterSpace</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ImageSize:&quot;</span> &lt;&lt; img_height &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; img_width &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;PatameterSpace:&quot;</span> &lt;&lt; <span class="number">2</span>*row_max &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; <span class="string">&quot; --&gt; &quot;</span> &lt;&lt; <span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)) &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//!!!look through theta, calc row than write into parameter-space!!!</span></span><br><span class="line">                <span class="comment">//遍历theta，计算row，存入参数空间</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt;= theta_max; theta++)&#123;  </span><br><span class="line">                    <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                    <span class="type">double</span> row = x * <span class="built_in">cos</span>(theta_rad) + y * <span class="built_in">sin</span>(theta_rad);</span><br><span class="line">                    <span class="comment">//row可能是负的,row_max作为偏移量. 将偏移量row_max加到row上，转为非负索引</span></span><br><span class="line">                    <span class="comment">//cout &lt;&lt; &quot;row = &quot; &lt;&lt; row &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; row + row_max  &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; ceil(row) + ceil(row_max) &lt;&lt; endl;</span></span><br><span class="line">                    PatameterSpace[<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row) + <span class="built_in">ceil</span>(row_max))][theta]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PS_AfterFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PatameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PatameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PatameterSpace[i][j] &gt;= threshold)</span><br><span class="line">                PS_AfterFilter[i][j] = PatameterSpace[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_AfterFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_AfterFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> second_filter_threshold = <span class="number">500</span>;</span><br><span class="line">    <span class="built_in">DrawLineDetectedImage</span>(Image,PS_AfterFilter,<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),theta_max,second_filter_threshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> height = PS_AfterFilter.<span class="built_in">size</span>();     <span class="comment">//row的范围</span></span><br><span class="line">    <span class="type">int</span> width = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();   <span class="comment">// theta的范围</span></span><br><span class="line">    <span class="type">int</span> num_r = PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">// 半径r的数量</span></span><br><span class="line">    <span class="function">Mat <span class="title">parameter_space_image</span><span class="params">(height, width, CV_8UC1, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> b = <span class="number">0</span>; b &lt; height; b++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">0</span>; a &lt; width; a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; num_r; r++) &#123;</span><br><span class="line">                <span class="type">int</span> accumulator_value = PS_AfterFilter[b][a][r];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 将累积值映射到0-255的范围（可以根据实际情况调整比例）</span></span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">255.0</span> * accumulator_value / <span class="number">255.0</span>); </span><br><span class="line">                parameter_space_image.<span class="built_in">at</span>&lt;uchar&gt;(b, a) = intensity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(parameter_space_image, enlargedHoughSpace, <span class="built_in">Size</span>(width * thetaScale, height), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_FinalFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(PS_AfterFilter[i][j][k] &gt;= second_filter_threshold)</span><br><span class="line">                    PS_FinalFilter[i][j][k] = PS_AfterFilter[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_FinalFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_FinalFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_FinalFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_FinalFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="comment">//draw circle</span></span><br><span class="line">                <span class="keyword">if</span>(PS_FinalFilter[i][j][k] != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="function">Point <span class="title">center</span><span class="params">(j, i)</span></span>;</span><br><span class="line">                    <span class="built_in">circle</span>(Image, center, k, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>);  <span class="comment">//红色圆圈</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/circle-result/DrawCircleDetectedImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    CircleDetection: ShowParameterSpace_Circle + DrawCircleDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="comment">//在霍夫变换中，我们通过三个参数来描述一个圆：圆心的坐标(a,b)和半径r.</span></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[b][a][r]   b---&gt;height---&gt;y | a---&gt;width---&gt;x</span></span><br><span class="line">    <span class="type">int</span> max_a = img_width;</span><br><span class="line">    <span class="type">int</span> max_b = img_height;</span><br><span class="line">    <span class="type">int</span> max_r = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.5</span>* <span class="built_in">min</span>(max_a,max_b));</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">ParameterSpace</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//遍历r，计算row，存入参数空间: min_r = 20 --&gt; max_r</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> r = <span class="number">20</span>; r &lt;= max_r; r++)&#123;</span><br><span class="line">                    <span class="comment">//遍历每个r情况下的theta(一周)，计算a&amp;b，存入参数空间</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; <span class="number">360</span>; theta++)&#123;</span><br><span class="line">                        <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                        <span class="type">int</span> a = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x - r * <span class="built_in">cos</span>(theta_rad));</span><br><span class="line">                        <span class="type">int</span> b = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y - r * <span class="built_in">sin</span>(theta_rad));</span><br><span class="line">                        <span class="keyword">if</span>(a &gt;= <span class="number">0</span> &amp;&amp; a &lt; max_a &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b &lt; max_b)&#123;</span><br><span class="line">                            ParameterSpace[b][a][r]++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_AfterFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ParameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; ParameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; ParameterSpace[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ParameterSpace[i][j][k] &gt;= threshold)</span><br><span class="line">                    PS_AfterFilter[i][j][k] = ParameterSpace[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_AfterFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_AfterFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> second_filter_threshold = <span class="number">300</span>;</span><br><span class="line">    <span class="built_in">DrawCircleDetectedImage</span>(Image,PS_AfterFilter,max_a,max_b,max_r,second_filter_threshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ToughTransform handle;</span><br><span class="line">    <span class="comment">//Mat img = imread(&quot;source/line.png&quot;);</span></span><br><span class="line">    <span class="comment">//LineDetection(img);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Mat img2 = imread(&quot;source/testline_cross.png&quot;);</span></span><br><span class="line">    <span class="comment">//LineDetection(img2);</span></span><br><span class="line"></span><br><span class="line">    Mat img3 = <span class="built_in">imread</span>(<span class="string">&quot;source/line_circle.png&quot;</span>);</span><br><span class="line">    <span class="comment">//handle.LineDetection(img3);</span></span><br><span class="line">    handle.<span class="built_in">CircleDetection</span>(img3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <blockquote class="article-copyright">
    <p><strong>本文作者：</strong>ロ　ユイセー(Lu Weicheng) @ ロ　ユイセーの魔法領域</p>
    <p><strong>本文链接：</strong><a href="https://shinononome-enana.github.io/2024/11/10/opencv/">https://shinononome-enana.github.io/2024/11/10/opencv/</a></p>
    <p><strong>本文标题：</strong>用原生opencv代码实现霍夫变换(Tough-Transform)</p>
    
    
    <p><strong>本文版权：</strong>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><span class="icon-creative-commons"></span>BY-NC-SA</a> 许可协议。转载请注明出处！</p>
    <span class="icon-creative-commons article-copyright-bg"></span>
  </blockquote>
      
      
        <a data-aos="zoom-in" href="/2024/11/10/opencv/#comments" class="article-comment-link">
          <span class="post-comments-count waline-comment-count" data-path="/2024/11/10/opencv/" itemprop="commentCount"></span>
          Comments
        </a>
      
      
      
      
        <span data-aos="zoom-in" class="article-visitor-link">
          <span class="waline-pageview-count" data-path="/2024/11/10/opencv/">0</span>
          <em class="post-meta-item-text">Readings</em>
        </span>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/CPP/" rel="tag">CPP</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/Tough-Transform/" rel="tag">Tough-Transform</a></li></ul>


    </footer>
  </div>
  
    
  <nav id="article-nav" data-aos="fade-up">
    
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="/covers/naxida.png" data-sizes="auto" alt="关于「させていただきます」的几点理解" class="lazyload">
          
        
        <a href="/2024/11/14/nihongo-itadaku/"></a>
        <div class="article-nav-caption">Newer</div>
        <h3 class="article-nav-title">
          
            关于「させていただきます」的几点理解
          
        </h3>
      </div>
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="/covers/naxida.png" data-sizes="auto" alt="寄存器堆(RegisterFile)的设计和仿真验证" class="lazyload">
        
      
      <a href="/2024/11/03/RegisterFile/"></a>
      <div class="article-nav-caption">Older</div>
      <h3 class="article-nav-title">
        
          寄存器堆(RegisterFile)的设计和仿真验证
        
      </h3>
    </div>
    
  </nav>


  
</article>


  <div id="comments" class="wcomment"></div>





</section>
          
            <aside id="sidebar">
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%A6%81%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">基本要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="toc-number">2.</span> <span class="toc-text">代码框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E7%BA%BF%E6%A3%80%E6%B5%8B"><span class="toc-number">3.</span> <span class="toc-text">直线检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%86%E6%A3%80%E6%B5%8B"><span class="toc-number">4.</span> <span class="toc-text">圆检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">4.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">5.</span> <span class="toc-text">完整代码</span></a></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="ロ　ユイセー(Lu Weicheng)" class="lazyload">
  <div class="sidebar-author-name">ロ　ユイセー(Lu Weicheng)</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    <div class="sidebar-state-number">10</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">7</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-instagram sidebar-social-icon">
      <a href=https://www.instagram.com/shinonome_enana130/ itemprop="url" target="_blank" aria-label="instagram"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/123245199?spm_id_from=333.1007.0.0 itemprop="url" target="_blank" aria-label="bilibili"></a>
    </div>
  
    <div class="icon-steam sidebar-social-icon">
      <a href=https://steamcommunity.com/profiles/76561199078853055/ itemprop="url" target="_blank" aria-label="steam"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="Home"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="Archives"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="About"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="Friend"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>
</div>
      
      
        <div class="sidebar-btn-wrapper" style="position:static">
          <div class="sidebar-toc-btn current"></div>
          <div class="sidebar-common-btn"></div>
        </div>
      
    </div>
  </div>

  
</aside>

          
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      2020-2025
      <span class="footer-info-sep"></span>
      ロ　ユイセー(Lu Weicheng)
    </div>
    
      <div>
        Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        21.7k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        01:36
      </div>
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">Number of visits&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">Number of visitors&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        <div class="sidebar-top">
          <img src="/images/taichi.png" height="50" width="50" alt="backtop" />
          <div class="arrow-up"></div>
        </div>
        <div id="mask"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%A6%81%E6%B1%82"><span class="toc-number">1.</span> <span class="toc-text">基本要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="toc-number">2.</span> <span class="toc-text">代码框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E7%BA%BF%E6%A3%80%E6%B5%8B"><span class="toc-number">3.</span> <span class="toc-text">直线检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%86%E6%A3%80%E6%B5%8B"><span class="toc-number">4.</span> <span class="toc-text">圆检测</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-1"><span class="toc-number">4.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">5.</span> <span class="toc-text">完整代码</span></a></li></ol>
      
  </div>
</div>
</div>
      <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="ロ　ユイセー(Lu Weicheng)" class="lazyload">
  <div class="sidebar-author-name">ロ　ユイセー(Lu Weicheng)</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Posts</div>
    <div class="sidebar-state-number">10</div>
  </div>
  <div class="sidebar-state-category">
    <div>Categories</div>
    <div class="sidebar-state-number">7</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tags</div>
    <div class="sidebar-state-number">7</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-instagram sidebar-social-icon">
      <a href=https://www.instagram.com/shinonome_enana130/ itemprop="url" target="_blank" aria-label="instagram"></a>
    </div>
  
    <div class="icon-bilibili sidebar-social-icon">
      <a href=https://space.bilibili.com/123245199?spm_id_from=333.1007.0.0 itemprop="url" target="_blank" aria-label="bilibili"></a>
    </div>
  
    <div class="icon-steam sidebar-social-icon">
      <a href=https://steamcommunity.com/profiles/76561199078853055/ itemprop="url" target="_blank" aria-label="steam"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/" aria-label="Home"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Home</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/archives" aria-label="Archives"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Archives</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/about" aria-label="About"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">About</div>
    </div>
  
    <div class="sidebar-menu-link-wrap">
      <a class="sidebar-menu-link-dummy" href="/friend" aria-label="Friend"></a>
      <div class="sidebar-menu-icon icon-taichi"></div>
      <div class="sidebar-menu-link">Friend</div>
    </div>
  
</div>
</div>
    
  </div>
  
    <div class="sidebar-btn-wrapper">
      <div class="sidebar-toc-btn current"></div>
      <div class="sidebar-common-btn"></div>
    </div>
  
</nav>

    </div>
    
      <div class="site-search">
        <div class="reimu-popup popup">
          <div class="reimu-search">
            <div class="reimu-search-input-icon"></div>
            <div class="reimu-search-input" id="reimu-search-input"></div>
            <div class="popup-btn-close"></div>
          </div>
          <div class="reimu-results">
            <div id="reimu-stats"></div>
            <div id="reimu-hits"></div>
            <div id="reimu-pagination" class="reimu-pagination"></div>
          </div>
          <img class="reimu-bg" src="/images/reimu.png"/>
        </div>
      </div>
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js"></script>



<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>


<script type="module" data-pjax>
  import PhotoSwipeLightbox from "https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js";
  
  const pswp = () => {
    if (_$$('.article-entry a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-entry',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    if(_$$('.article-gallery a.article-gallery-item').length > 0) {
      new PhotoSwipeLightbox({
        gallery: '.article-gallery',
        children: 'a.article-gallery-item',
        pswpModule: () => import("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js")
      }).init();
    }
    window.lightboxStatus = 'done';
    window.removeEventListener('lightbox:ready', pswp);
  }
  if(window.lightboxStatus === 'ready') {
    pswp()
  } else {
    window.addEventListener('lightbox:ready', pswp);
  }
</script>




  <script data-pjax type="module">
    import { init } from "https://npm.webcache.cn/@waline/client@2.15.8/dist/waline.mjs";
    if(_$('.wcomment')) {
      window.walineInstance = init({
        el: '.wcomment',
        serverURL: 'https://waline-lime-six.vercel.app/',
        lang: 'zh-CN',
        locale: {},
        emoji: ["https://unpkg.com/@waline/emojis@1.2.0/weibo","https://unpkg.com/@waline/emojis@1.2.0/alus","https://unpkg.com/@waline/emojis@1.2.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/qq","https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.2.0/tw-emoji"],
        meta: ["nick","mail"],
        requiredMeta: ["nick","mail"],
        wordLimit: JSON.parse('0'),
        comment: true,
        pageSize: JSON.parse('10'),
        dark: 'html[data-theme="dark"]',
        pageview: JSON.parse('true'),
    });
    }
  </script>











  <script>
    var CONFIG = {
      root: '/',
      algolia: {
        applicationID: "H0ZF9MNC8O",
        apiKey: "4e44841a24c848ab928ba8fd6141217e",
        indexName: "hexo",
        hits: {
          "per_page": parseInt("10")
        },
        labels: {
          "input_placeholder": "搜索.....",
          "hits_empty": "未发现与 「${query}」相关内容",
          "hits_stats": "找到${hits}条结果（用时 ${time} ms）"
        }
      }
    };
  </script>
  
<script src="https://npm.webcache.cn/algoliasearch@4.17.1/dist/algoliasearch-lite.umd.js"></script>

  
<script src="https://npm.webcache.cn/instantsearch.js@4.56.1/dist/instantsearch.production.min.js" defer></script>

  
<script src="/js/algolia_search.js" defer></script>




  
<script src="https://npm.webcache.cn/mouse-firework@0.0.4/dist/index.umd.js"></script>

  <script>
    firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["#ff5252","#ff7c7c","#ffafaf","#ffd0d0"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["#ff0000"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>







  
<script src="https://npm.webcache.cn/quicklink@2.3.0/dist/quicklink.umd.js"></script>

  <script data-pjax>
    quicklink.listen({
      timeout: 3000,
      priority: true,
      ignores: []
    });
  </script>


<div id="lazy-script">
  <div>
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '0.3.0-alpha.1' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>

  <!-- hexo injector body_end start -->
<script src="/js/insert_highlight.js" data-pjax></script>
<!-- hexo injector body_end end --></body>
  </html>

