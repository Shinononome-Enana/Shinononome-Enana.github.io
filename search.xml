<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用PSO-NN解决双螺旋分类TSNP问题</title>
      <link href="/2025/03/14/TSNP%E2%80%94problem/"/>
      <url>/2025/03/14/TSNP%E2%80%94problem/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h2><ul><li>粒子群算法PSO优化神经网络权重和偏置参数，取代传统的梯度下降法。</li><li>神经网络参数矩阵展平，作为PSO算法中粒子的速度参数进行优化。</li></ul><hr><h2 id="Presentation-PPT"><a href="#Presentation-PPT" class="headerlink" title="Presentation PPT"></a>Presentation PPT</h2><img src="https://s2.loli.net/2025/03/14/xUrA3vkNdilZInS.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/teSMvKg3dj8UNIF.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/sa9XOM75ch1CdUH.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/wyUBXdPCYFJ3ghl.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/82K3OxNZv4EGWwT.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/bQyK2iN4dof7uBw.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/qXI9dgYku7SJOvo.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/icXvJuEwTZGRhf6.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/9pZJjm8KFaA6yId.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/3xpPRvLMiAdBmtU.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/JXr5A96s1vQS73P.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/MvYcsQfIduDoaKp.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/mwupfrFZqQRojb9.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/BVajvxYpkUiRNeQ.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/2tkoqziDPLMu8jJ.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/FNuyMpiDnBbtmVs.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/bMNlUrwYEhDZITz.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/2xMOGN7gDcBYVn9.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/FvGP4bkmBWyXALx.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/zrCKM9YQTlWxwIy.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/UagBy2iqkF4WnRo.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/iYLvM9NtpInzbhK.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/7RY3oekWh8Lu6tI.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/AkRmN4W8P7cIqa2.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/fvG1ePdh7iTSYBW.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/9thjGwPWpTxn17u.jpg" width="500" height="500"><img src="https://s2.loli.net/2025/03/14/cKAZG3uinNyvJY1.jpg" width="500" height="500"><hr><h2 id="报告"><a href="#报告" class="headerlink" title="报告"></a>报告</h2><div class="row">    <embed src="https://shinononome-enana.github.io/file/PSO_NN_TNSP.pdf" width="100%" height="550" type="application/pdf"></div><hr><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// data parameter</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> num_spiral_rounds = <span class="number">5</span>;</span><br><span class="line"><span class="comment">// PSO-Parameter</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> w = <span class="number">0.2</span>;    </span><br><span class="line"><span class="type">const</span> <span class="type">double</span> c1 = <span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> c2 = <span class="number">2</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> LR = <span class="number">1.2</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> num_particles = <span class="number">1000</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> max_iterations = <span class="number">10000</span>; </span><br><span class="line"><span class="comment">// NN-Parameter</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M_hidden_nodes = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DataPoint</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; input; <span class="comment">// Position:(x, y)</span></span><br><span class="line">    <span class="type">double</span> label;         <span class="comment">// Lable: 0 / 1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Particle</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; position;  </span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; velocity;  </span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; best_position; </span><br><span class="line">    <span class="type">double</span> best_fitness;     </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GlobalBest</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">double</span>&gt; position; </span><br><span class="line">    <span class="type">double</span> fitness;         </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Tanh_activation_function</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tanh</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Sigmiod_activation_function</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span> / (<span class="number">1.0</span> + <span class="built_in">exp</span>(-x));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">ReLU_activation_function</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">0.0</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">fitness_function</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">double</span>&gt;&amp; position, <span class="type">const</span> vector&lt;DataPoint&gt;&amp; data, <span class="type">int</span> hidden_nodes)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//==================== 2-layer NN dim ====================</span></span><br><span class="line">    <span class="type">int</span> input_dim = <span class="number">2</span>; </span><br><span class="line">    <span class="type">int</span> hidden_dim = hidden_nodes; </span><br><span class="line">    <span class="type">int</span> output_dim = <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== Extract (W,b) from particles&#x27; weight sequence ====================</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">double</span>&gt;&gt; <span class="built_in">input_to_hidden</span>(input_dim, <span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(hidden_dim));</span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_to_output</span><span class="params">(hidden_dim)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_bias</span><span class="params">(hidden_dim)</span></span>;</span><br><span class="line">    <span class="type">double</span> output_bias;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 2*M: W (Input-&gt;Hidden)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_dim; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            input_to_hidden[i][j] = position[idx++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1*M: W (Hidden-&gt;Output)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">        hidden_to_output[j] = position[idx++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1*M: b (Hidden)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">        hidden_bias[j] = position[idx++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1: b(Output)</span></span><br><span class="line">    output_bias = position[idx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== Forward-Propagate: Build up the NN / then get error for PSO to optimize position(W,b) ====================</span></span><br><span class="line">    <span class="type">double</span> error = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">int</span> correct_predictions = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//for every data</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; sample : data) &#123;</span><br><span class="line">        <span class="type">const</span> vector&lt;<span class="type">double</span>&gt;&amp; input = sample.input;</span><br><span class="line">        <span class="type">double</span> true_output = sample.label;</span><br><span class="line">        <span class="comment">//Forward-Propagate: HiddenLayer</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_output</span><span class="params">(hidden_dim, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_dim; i++) &#123;</span><br><span class="line">                <span class="comment">//y = w1*x1 + w2*x2 + b</span></span><br><span class="line">                hidden_output[j] += input[i] * input_to_hidden[i][j];</span><br><span class="line">                <span class="comment">//y = w1*(x1^2+x2^2) + w2*(x1*x2) + b </span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                if(i == 1)</span></span><br><span class="line"><span class="comment">                    hidden_output[j] += input_to_hidden[i-1][j] * (pow(input[i-1],2) + pow(input[i],2)) </span></span><br><span class="line"><span class="comment">                                      + input_to_hidden[i][j] * (input[i-1] * input[i-1]);</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                    continue;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="comment">//y = w1*sinx1 + w2*cosx2 + b </span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                if(i == 1)</span></span><br><span class="line"><span class="comment">                    hidden_output[j] += sin(input[i-1]) * input_to_hidden[i-1][j] + cos(input[i]) * input_to_hidden[i][j];</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                    continue;</span></span><br><span class="line"><span class="comment">                */</span>   </span><br><span class="line">            &#125;</span><br><span class="line">            hidden_output[j] += hidden_bias[j];</span><br><span class="line">            hidden_output[j] = <span class="built_in">Tanh_activation_function</span>(hidden_output[j]);</span><br><span class="line">            <span class="comment">//hidden_output[j] = ReLU_activation_function(hidden_output[j]);</span></span><br><span class="line">            <span class="comment">//hidden_output[j] = Sigmiod_activation_function(hidden_output[j]);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Forward-Propagate: OutputLayer</span></span><br><span class="line">        <span class="type">double</span> output = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            output += hidden_output[j] * hidden_to_output[j];</span><br><span class="line">        &#125;</span><br><span class="line">        output += output_bias;</span><br><span class="line">        output = <span class="built_in">Sigmiod_activation_function</span>(output); </span><br><span class="line">        <span class="comment">//Error Calculation</span></span><br><span class="line">        error += <span class="built_in">pow</span>(output - true_output, <span class="number">2</span>) / data.<span class="built_in">size</span>();</span><br><span class="line">        <span class="comment">// Accuracy calculation</span></span><br><span class="line">        <span class="type">int</span> predicted_label = (output &gt;= <span class="number">0.5</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (predicted_label == true_output) &#123;</span><br><span class="line">            correct_predictions++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> accuracy = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(correct_predictions) / data.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//double E = error + (1-accuracy);</span></span><br><span class="line">    <span class="type">double</span> E = error;</span><br><span class="line">    <span class="keyword">return</span> E;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">GlobalBest <span class="title">pso</span><span class="params">(<span class="type">const</span> vector&lt;DataPoint&gt;&amp; data, <span class="type">int</span> hidden_nodes, <span class="type">int</span> num_particles, <span class="type">int</span> max_iterations)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> dim = <span class="number">2</span> * hidden_nodes + hidden_nodes + hidden_nodes + <span class="number">1</span>;  <span class="comment">// Particle.Position dim: 2*M + 1*M + 1*M + 1;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//==================== Initialization of Particles ====================</span></span><br><span class="line">    random_device rd;</span><br><span class="line">    <span class="function">mt19937 <span class="title">gen</span><span class="params">(rd())</span></span>;</span><br><span class="line">    uniform_real_distribution&lt;&gt; <span class="built_in">dist</span>(<span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;Particle&gt; <span class="title">particles</span><span class="params">(num_particles)</span></span>;</span><br><span class="line">    GlobalBest global_best;</span><br><span class="line">    global_best.fitness = numeric_limits&lt;<span class="type">double</span>&gt;::<span class="built_in">infinity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; particle : particles) &#123;</span><br><span class="line">        particle.position.<span class="built_in">resize</span>(dim);</span><br><span class="line">        particle.velocity.<span class="built_in">resize</span>(dim);</span><br><span class="line">        particle.best_position.<span class="built_in">resize</span>(dim);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dim; i++) &#123;</span><br><span class="line">            particle.position[i] = <span class="built_in">dist</span>(gen);</span><br><span class="line">            particle.velocity[i] = <span class="built_in">dist</span>(gen) * <span class="number">0.1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        particle.best_position = particle.position;</span><br><span class="line">        particle.best_fitness = <span class="built_in">fitness_function</span>(particle.position, data, hidden_nodes);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (particle.best_fitness &lt; global_best.fitness) &#123;</span><br><span class="line">            global_best.position = particle.best_position;</span><br><span class="line">            global_best.fitness = particle.best_fitness;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PSO迭代</span></span><br><span class="line">    <span class="function">ofstream <span class="title">outfile</span><span class="params">(<span class="string">&quot;result/fitness_results_ARM5.txt&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> iter = <span class="number">0</span>; iter &lt; max_iterations; iter++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; particle : particles) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">double</span> fitness = <span class="built_in">fitness_function</span>(particle.position, data, hidden_nodes);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (fitness &lt; particle.best_fitness) &#123;</span><br><span class="line">                particle.best_fitness = fitness;</span><br><span class="line">                particle.best_position = particle.position;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (fitness &lt; global_best.fitness) &#123;</span><br><span class="line">                global_best.fitness = fitness;</span><br><span class="line">                global_best.position = particle.position;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dim; i++) &#123;</span><br><span class="line">                <span class="type">double</span> r1 = <span class="built_in">dist</span>(gen), r2 = <span class="built_in">dist</span>(gen);</span><br><span class="line">                particle.velocity[i] = w * particle.velocity[i] +</span><br><span class="line">                                       c1 * r1 * (particle.best_position[i] - particle.position[i]) +</span><br><span class="line">                                       c2 * r2 * (global_best.position[i] - particle.position[i]);</span><br><span class="line">                particle.position[i] += particle.velocity[i] * LR;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Iteration &quot;</span> &lt;&lt; iter + <span class="number">1</span> &lt;&lt; <span class="string">&quot;: Best Fitness(ErrorRate) = &quot;</span> &lt;&lt; global_best.fitness &lt;&lt; endl;</span><br><span class="line">        outfile &lt;&lt; <span class="string">&quot;Iteration &quot;</span> &lt;&lt; iter + <span class="number">1</span> &lt;&lt; <span class="string">&quot;: Best Fitness(ErrorRate) = &quot;</span> &lt;&lt; global_best.fitness &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    outfile.<span class="built_in">close</span>(); </span><br><span class="line">    <span class="keyword">return</span> global_best;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Two-Nested-Spirals</span></span><br><span class="line"><span class="function">vector&lt;DataPoint&gt; <span class="title">generate_spiral_data</span><span class="params">(<span class="type">int</span> num_points, <span class="type">int</span> num_turns)</span> </span>&#123;</span><br><span class="line">    vector&lt;DataPoint&gt; data;</span><br><span class="line">    <span class="type">double</span> pi = <span class="number">3.141592653589793</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_points; i++) &#123;</span><br><span class="line">        <span class="type">double</span> t = i * pi * num_turns / num_points;</span><br><span class="line">        data.<span class="built_in">push_back</span>(\&#123;\&#123;t * <span class="built_in">cos</span>(t), t * <span class="built_in">sin</span>(t)\&#125;, <span class="number">0.0</span>\&#125;); </span><br><span class="line">        data.<span class="built_in">push_back</span>(\&#123;\&#123;-t * <span class="built_in">cos</span>(t), -t * <span class="built_in">sin</span>(t)\&#125;, <span class="number">1.0</span>\&#125;); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">normalize_data</span><span class="params">(vector&lt;DataPoint&gt;&amp; data, <span class="type">double</span> max_value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; point : data) &#123;</span><br><span class="line">        point.input[<span class="number">0</span>] /= max_value;</span><br><span class="line">        point.input[<span class="number">1</span>] /= max_value; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pair&lt;vector&lt;DataPoint&gt;, vector&lt;DataPoint&gt;&gt; <span class="built_in">split_data_for_validation</span>(<span class="type">const</span> vector&lt;DataPoint&gt;&amp; data, <span class="type">double</span> validation_ratio) &#123;</span><br><span class="line">    <span class="type">int</span> validation_size = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(data.<span class="built_in">size</span>() * validation_ratio);</span><br><span class="line"></span><br><span class="line">    vector&lt;DataPoint&gt; shuffled_data = data;</span><br><span class="line">    random_device rd;</span><br><span class="line">    <span class="function">mt19937 <span class="title">gen</span><span class="params">(rd())</span></span>;</span><br><span class="line">    <span class="built_in">shuffle</span>(shuffled_data.<span class="built_in">begin</span>(), shuffled_data.<span class="built_in">end</span>(), gen);</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;DataPoint&gt; <span class="title">validation_data</span><span class="params">(shuffled_data.begin(), shuffled_data.begin() + validation_size)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;DataPoint&gt; <span class="title">training_data</span><span class="params">(shuffled_data.begin() + validation_size, shuffled_data.end())</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;training_data, validation_data&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">test_model</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">double</span>&gt;&amp; best_position, <span class="type">const</span> vector&lt;DataPoint&gt;&amp; test_data, <span class="type">int</span> hidden_nodes)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> input_dim = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> hidden_dim = hidden_nodes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== Extract (W,b) from the trained weights ====================</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">double</span>&gt;&gt; <span class="built_in">input_to_hidden</span>(input_dim, <span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(hidden_dim));</span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_to_output</span><span class="params">(hidden_dim)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_bias</span><span class="params">(hidden_dim)</span></span>;</span><br><span class="line">    <span class="type">double</span> output_bias;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 2*M: W (Input-&gt;Hidden)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_dim; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            input_to_hidden[i][j] = best_position[idx++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1*M: W (Hidden-&gt;Output)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">        hidden_to_output[j] = best_position[idx++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1*M: b (Hidden)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">        hidden_bias[j] = best_position[idx++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1: b(Output)</span></span><br><span class="line">    output_bias = best_position[idx];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== Forward-Propagate for Testing ====================</span></span><br><span class="line">    <span class="type">int</span> correct_predictions = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; sample : test_data) &#123;</span><br><span class="line">        <span class="type">const</span> vector&lt;<span class="type">double</span>&gt;&amp; input = sample.input;</span><br><span class="line">        <span class="type">double</span> true_output = sample.label;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Forward-Propagate: Hidden Layer </span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">hidden_output</span><span class="params">(hidden_dim, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_dim; i++) &#123;</span><br><span class="line">                <span class="comment">//y = w1*x1 + w2*x2 + b</span></span><br><span class="line">                hidden_output[j] += input[i] * input_to_hidden[i][j];</span><br><span class="line">                <span class="comment">//y = w1*(x1^2+x2^2) + w2*(x1*x2) + b </span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                if(i == 1)</span></span><br><span class="line"><span class="comment">                    hidden_output[j] += input_to_hidden[i-1][j] * (pow(input[i-1],2) + pow(input[i],2)) </span></span><br><span class="line"><span class="comment">                                      + input_to_hidden[i][j] * (input[i-1] * input[i-1]);</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                    continue;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="comment">//y = w1*sinx1 + w2*cosx2 + b </span></span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                if(i == 1)</span></span><br><span class="line"><span class="comment">                    hidden_output[j] += sin(input[i-1]) * input_to_hidden[i-1][j] + cos(input[i]) * input_to_hidden[i][j];</span></span><br><span class="line"><span class="comment">                else</span></span><br><span class="line"><span class="comment">                    continue;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">            &#125;</span><br><span class="line">            hidden_output[j] += hidden_bias[j];</span><br><span class="line">            hidden_output[j] = <span class="built_in">Tanh_activation_function</span>(hidden_output[j]);</span><br><span class="line">            <span class="comment">//hidden_output[j] = ReLU_activation_function(hidden_output[j]);</span></span><br><span class="line">            <span class="comment">//hidden_output[j] = Sigmiod_activation_function(hidden_output[j]);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Forward-Propagate: Output Layer</span></span><br><span class="line">        <span class="type">double</span> output = <span class="number">0.0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; hidden_dim; j++) &#123;</span><br><span class="line">            output += hidden_output[j] * hidden_to_output[j];</span><br><span class="line">        &#125;</span><br><span class="line">        output += output_bias;</span><br><span class="line">        output = <span class="built_in">Sigmiod_activation_function</span>(output); <span class="comment">// Sigmoid activation</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Classify and Count Correct Predictions</span></span><br><span class="line">        <span class="type">int</span> predicted_label = (output &gt;= <span class="number">0.5</span>) ? <span class="number">1</span> : <span class="number">0</span>; <span class="comment">// Sigmoid threshold at 0.5</span></span><br><span class="line">        <span class="keyword">if</span> (predicted_label == true_output) &#123;</span><br><span class="line">            correct_predictions++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================== Calculate Accuracy ====================</span></span><br><span class="line">    <span class="type">double</span> accuracy = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(correct_predictions) / test_data.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">return</span> accuracy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> num_points = <span class="number">100</span> * num_spiral_rounds;  </span><br><span class="line">    vector&lt;DataPoint&gt; data = <span class="built_in">generate_spiral_data</span>(num_points,num_spiral_rounds);</span><br><span class="line">    <span class="built_in">normalize_data</span>(data,<span class="number">30.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> validation_ratio = <span class="number">0.2</span>;</span><br><span class="line">    pair&lt;vector&lt;DataPoint&gt;, vector&lt;DataPoint&gt;&gt; split_result = <span class="built_in">split_data_for_validation</span>(data, validation_ratio);</span><br><span class="line">    vector&lt;DataPoint&gt; train_data = split_result.first;</span><br><span class="line">    vector&lt;DataPoint&gt; validation_data = split_result.second;</span><br><span class="line"></span><br><span class="line">    GlobalBest best_solution = <span class="built_in">pso</span>(train_data, M_hidden_nodes, num_particles, max_iterations);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Best Fitness(Minimum-ErrorRate): &quot;</span> &lt;&lt; best_solution.fitness &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> validation_accuracy = <span class="built_in">test_model</span>(best_solution.position, validation_data, M_hidden_nodes);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Model Accuracy on Validation Data: &quot;</span> &lt;&lt; validation_accuracy * <span class="number">100</span> &lt;&lt; <span class="string">&quot;%&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Course Assignment </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Calculator的Verilog实现与上板验证：SystemLSI Project#1 留档</title>
      <link href="/2025/02/08/slsi-calculator-project/"/>
      <url>/2025/02/08/slsi-calculator-project/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="核心功能与创新功能-PPT"><a href="#核心功能与创新功能-PPT" class="headerlink" title="核心功能与创新功能(PPT)"></a>核心功能与创新功能(PPT)</h2><img src="https://s2.loli.net/2025/02/08/aR86g5AtWCwyTFh.png"><img src="https://s2.loli.net/2025/02/08/6NgzED9rR1wlPMC.png"><img src="https://s2.loli.net/2025/02/08/2PDuycVGMNBTEL5.png"><img src="https://s2.loli.net/2025/02/08/RcveMl6YkDxA4Xj.png"><img src="https://s2.loli.net/2025/02/08/zcvftHCeihZQVrw.png"><hr><h2 id="代码汇总"><a href="#代码汇总" class="headerlink" title="代码汇总"></a>代码汇总</h2><h3 id="板卡顶层模块AP600-v"><a href="#板卡顶层模块AP600-v" class="headerlink" title="板卡顶层模块AP600.v"></a>板卡顶层模块AP600.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AP600: Interface between top-moudule of calculator and FPGA board</span></span><br><span class="line"><span class="keyword">module</span> AP600 (clk, reset, pswA, pswB, pswC, pswD, dipA, dipB,</span><br><span class="line">      hexA, hexB, buzzer, ledA, ledB, ledC, ledD, </span><br><span class="line">             segA, segB, segC, segD, segE, segF, segG, segH) ;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">input</span>      clk, reset;             <span class="comment">// Clock, Reset</span></span><br><span class="line">  <span class="keyword">input</span>[<span class="number">4</span>:<span class="number">0</span>] pswA, pswB, pswC, pswD; <span class="comment">// Push switch</span></span><br><span class="line">  <span class="keyword">input</span>[<span class="number">7</span>:<span class="number">0</span>] dipA, dipB;             <span class="comment">// DIP switch</span></span><br><span class="line">  <span class="keyword">input</span>[<span class="number">3</span>:<span class="number">0</span>] hexA, hexB;             <span class="comment">// Rotary switch</span></span><br><span class="line">  <span class="keyword">output</span>     buzzer;     <span class="comment">// Buzzer</span></span><br><span class="line">  <span class="keyword">output</span>[<span class="number">7</span>:<span class="number">0</span>] ledA, ledB, ledC, ledD;<span class="comment">// LED</span></span><br><span class="line">  <span class="keyword">output</span>[<span class="number">7</span>:<span class="number">0</span>] segA, segB, segC, segD, segE, segF, segG, segH ; <span class="comment">// 7SEG LED</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] ledb,ledc,ledd,lede,ledf,ledg,ledh;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] push;</span><br><span class="line">  <span class="keyword">wire</span> overflow, sign, ce, plus, minus, equal;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for Debug</span></span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">24</span>:<span class="number">0</span>] regb;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">24</span>:<span class="number">0</span>] rega;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] count;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] opr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">0</span>] = pswD[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">1</span>] = pswC[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">2</span>] = pswC[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">3</span>] = pswC[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">4</span>] = pswB[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">5</span>] = pswB[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">6</span>] = pswB[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">7</span>] = pswA[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">8</span>] = pswA[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">assign</span> push[<span class="number">9</span>] = pswA[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">assign</span> plus    = pswD[<span class="number">3</span>];  <span class="comment">//nAk</span></span><br><span class="line">  <span class="keyword">assign</span> minus   = pswC[<span class="number">3</span>];  <span class="comment">//nCk</span></span><br><span class="line">  <span class="keyword">assign</span> mult    = pswB[<span class="number">3</span>];  <span class="comment">//x!</span></span><br><span class="line">  <span class="keyword">assign</span> div     = pswA[<span class="number">3</span>];  <span class="comment">//x^2</span></span><br><span class="line">  <span class="keyword">assign</span> ce      = pswA[<span class="number">4</span>];  </span><br><span class="line">  <span class="keyword">assign</span> equal   = pswD[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">assign</span> switch  = pswC[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">assign</span> inverse = pswD[<span class="number">2</span>];   <span class="comment">//±</span></span><br><span class="line">  <span class="keyword">assign</span> game    = pswD[<span class="number">1</span>];   <span class="comment">//进入井字棋游玩模式</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Output assignment</span></span><br><span class="line">  <span class="keyword">assign</span> buzzer = overflow;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> ledA = &#123;overflow,<span class="number">2&#x27;b00</span>, count[<span class="number">0</span>],count[<span class="number">1</span>], </span><br><span class="line">                 opr, state[<span class="number">0</span>], state[<span class="number">1</span>]&#125;;</span><br><span class="line">  <span class="keyword">assign</span> ledB = &#123;regb[<span class="number">8</span>], <span class="number">7&#x27;b0000000</span>&#125;;</span><br><span class="line">  <span class="keyword">assign</span> ledC = &#123;regb[<span class="number">0</span>],regb[<span class="number">1</span>],regb[<span class="number">2</span>],regb[<span class="number">3</span>],</span><br><span class="line">                 regb[<span class="number">4</span>],regb[<span class="number">5</span>],regb[<span class="number">6</span>],regb[<span class="number">7</span>]&#125;;</span><br><span class="line">  <span class="keyword">assign</span> ledD = &#123;rega[<span class="number">0</span>],rega[<span class="number">1</span>],rega[<span class="number">2</span>],rega[<span class="number">3</span>],</span><br><span class="line">                 rega[<span class="number">4</span>],rega[<span class="number">5</span>],rega[<span class="number">6</span>],<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">                 </span><br><span class="line">  <span class="comment">//H最低位，B最高位!!!  (A符号位)</span></span><br><span class="line">  <span class="keyword">assign</span> segA = &#123;<span class="number">6&#x27;b000000</span>,sign,<span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">  <span class="keyword">assign</span> segB = ledb;</span><br><span class="line">  <span class="keyword">assign</span> segC = ledc;</span><br><span class="line">  <span class="keyword">assign</span> segD = ledd;</span><br><span class="line">  <span class="keyword">assign</span> segE = lede;</span><br><span class="line">  <span class="keyword">assign</span> segF = ledf;</span><br><span class="line">  <span class="keyword">assign</span> segG = ledg;</span><br><span class="line">  <span class="keyword">assign</span> segH = ledh;</span><br><span class="line"></span><br><span class="line">  calctop calctop(clk, reset, push, ce, plus, minus, mult, div, equal, switch, inverse,</span><br><span class="line">               sign, ledh, ledg, ledf, lede, ledd, ledc, ledb, overflow, state, rega, regb,</span><br><span class="line">               count, opr, game);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="运算和显示顶层模块calctop-v"><a href="#运算和显示顶层模块calctop-v" class="headerlink" title="运算和显示顶层模块calctop.v"></a>运算和显示顶层模块calctop.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calctop: Calculator top module</span></span><br><span class="line"><span class="keyword">module</span> calctop(clk, reset, push, ce, plus, minus, mult, div, equal, switch, inverse,</span><br><span class="line">               sign, ledh, ledg, ledf, lede, ledd, ledc, ledb, overflow, state, rega, regb,</span><br><span class="line">               count, opr, game);</span><br><span class="line">               </span><br><span class="line">  <span class="keyword">input</span> plus, minus, equal, ce, reset, clk;</span><br><span class="line">  <span class="comment">//新增按键</span></span><br><span class="line">  <span class="keyword">input</span> mult, div, switch, inverse;</span><br><span class="line">  <span class="keyword">input</span> game;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] push;</span><br><span class="line">  <span class="keyword">output</span> overflow, sign;</span><br><span class="line">  <span class="comment">//output [7:0] ledh, ledl;</span></span><br><span class="line">  <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] ledh, ledg, ledf, lede, ledd, ledc, ledb;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for Debug</span></span><br><span class="line">  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">24</span>:<span class="number">0</span>] regb;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">24</span>:<span class="number">0</span>] rega;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] count;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] opr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> plusout, minusout, equalout, ceout;</span><br><span class="line">  <span class="comment">// 新增按键</span></span><br><span class="line">  <span class="keyword">wire</span> multout, divout;</span><br><span class="line">  <span class="keyword">wire</span> switchout, inverseout;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>] pushout;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">24</span>:<span class="number">0</span>] wout;</span><br><span class="line"></span><br><span class="line">  calc calc(pushout, plusout, minusout, multout, divout, equalout, switchout, inverseout, clk, reset, ceout, </span><br><span class="line">            sign, overflow, wout, state, rega, regb, count, </span><br><span class="line">            opr, gameout);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//binled binled(wout, ledl, ledh);</span></span><br><span class="line">  binled binled(wout, ledh, ledg, ledf, lede, ledd, ledc, ledb);</span><br><span class="line"></span><br><span class="line">  syncro syncroce(ceout, ce, clk, reset);</span><br><span class="line">  syncro syncropuls(plusout, plus, clk, reset);</span><br><span class="line">  syncro syncrominus(minusout, minus, clk, reset);</span><br><span class="line">  syncro syncroequal(equalout, equal, clk, reset);</span><br><span class="line">  <span class="comment">//新增按键</span></span><br><span class="line">  syncro syncromult(multout, mult, clk, reset);</span><br><span class="line">  syncro syncrodiv(divout, div, clk, reset);</span><br><span class="line">  syncro syncroswitch(switchout, switch, clk, reset);</span><br><span class="line">  syncro syncroinverse(inverseout, inverse, clk, reset);</span><br><span class="line">  syncro syncrogame(gameout, game, clk, reset);</span><br><span class="line">  </span><br><span class="line">  syncro10 syncropush(pushout, push, clk, reset);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="核心模块calc-v"><a href="#核心模块calc-v" class="headerlink" title="核心模块calc.v"></a>核心模块calc.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> DECIMAL 0</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> OPE 1</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> HALT 2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> XY 3         </span><span class="comment">//运算x^y</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> DOUBLEJC 4   </span><span class="comment">//运算x!!</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> GCD 5       </span><span class="comment">//最大公因数</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LCM 6       </span><span class="comment">//最小公倍数</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> MatPre 7    </span><span class="comment">//预处理</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> MatPlus 8  </span><span class="comment">//矩阵加</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> MatHLS 9   </span><span class="comment">//行列式的值</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> MatMult 10  </span><span class="comment">//矩阵乘</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Cov1D 11 </span><span class="comment">//1维序列线性卷积</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> P1  12 </span><span class="comment">//玩家一按</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> P2  13 </span><span class="comment">//玩家二按</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Judge 14 </span><span class="comment">//判断输赢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Calc: Calculator main module</span></span><br><span class="line"><span class="keyword">module</span> calc(decimal, plus, minus, mult, div, equal, switch, inverse, clk, reset, </span><br><span class="line">            ce, sign, overflow, out, state, REGA, REGB, count, opr, game);</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] decimal;</span><br><span class="line">  <span class="keyword">input</span> clk, ce, reset, plus, minus, equal;</span><br><span class="line">  <span class="keyword">input</span> mult,div;</span><br><span class="line">  <span class="keyword">input</span> switch, inverse;</span><br><span class="line">  <span class="keyword">input</span> game;</span><br><span class="line">  <span class="keyword">output</span> sign, overflow;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">24</span>:<span class="number">0</span>] out;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for Debugging</span></span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] state;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">24</span>:<span class="number">0</span>] REGB;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">24</span>:<span class="number">0</span>] REGA;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] count;   <span class="comment">//0-7bit</span></span><br><span class="line">  <span class="comment">//output add_or_sub;</span></span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] opr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d;</span><br><span class="line">  <span class="comment">//wire [8:0] alu_out;</span></span><br><span class="line">  <span class="keyword">reg</span>  [<span class="number">3</span>:<span class="number">0</span>] state;</span><br><span class="line">  <span class="comment">//七位数:-9999999~9999999//</span></span><br><span class="line">  <span class="keyword">reg</span>  [<span class="number">24</span>:<span class="number">0</span>] REGB;   <span class="comment">//七位数最多9999999=24bit ，开设25bit寄存器，最高位是负数指示位//</span></span><br><span class="line">  <span class="keyword">reg</span>  [<span class="number">24</span>:<span class="number">0</span>] REGA;   </span><br><span class="line">  <span class="keyword">reg</span>  [<span class="number">3</span>:<span class="number">0</span>] count;</span><br><span class="line">  <span class="comment">//reg        add_or_sub ;</span></span><br><span class="line">  <span class="keyword">reg</span>  [<span class="number">3</span>:<span class="number">0</span>] opr;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> [<span class="number">3</span>:<span class="number">0</span>] dectobin;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] in;</span><br><span class="line">    <span class="keyword">if</span>(in[<span class="number">9</span>])</span><br><span class="line">     dectobin = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">8</span>])</span><br><span class="line">     dectobin = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">7</span>])</span><br><span class="line">     dectobin = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">6</span>])</span><br><span class="line">     dectobin = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">5</span>])</span><br><span class="line">     dectobin = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">4</span>])</span><br><span class="line">     dectobin = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">3</span>])</span><br><span class="line">     dectobin = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">2</span>])</span><br><span class="line">     dectobin = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">1</span>])</span><br><span class="line">     dectobin = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(in[<span class="number">0</span>])</span><br><span class="line">     dectobin = <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> d=dectobin(decimal);</span><br><span class="line"></span><br><span class="line"><span class="comment">//阶乘表JC_MAP</span></span><br><span class="line"><span class="keyword">wire</span>[<span class="number">24</span>:<span class="number">0</span>] JC_MAP[<span class="number">10</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">0</span>] = <span class="number">25&#x27;d1</span>;          <span class="comment">// 0! = 1</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">1</span>] = <span class="number">25&#x27;d1</span>;          <span class="comment">// 1! = 1</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">2</span>] = <span class="number">25&#x27;d2</span>;          <span class="comment">// 2! = 2</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">3</span>] = <span class="number">25&#x27;d6</span>;          <span class="comment">// 3! = 6</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">4</span>] = <span class="number">25&#x27;d24</span>;         <span class="comment">// 4! = 24</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">5</span>] = <span class="number">25&#x27;d120</span>;        <span class="comment">// 5! = 120</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">6</span>] = <span class="number">25&#x27;d720</span>;        <span class="comment">// 6! = 720</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">7</span>] = <span class="number">25&#x27;d5040</span>;       <span class="comment">// 7! = 5040</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">8</span>] = <span class="number">25&#x27;d40320</span>;      <span class="comment">// 8! = 40320</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">9</span>] = <span class="number">25&#x27;d362880</span>;     <span class="comment">// 9! = 362880</span></span><br><span class="line"><span class="keyword">assign</span> JC_MAP[<span class="number">10</span>] = <span class="number">25&#x27;d3628800</span>;   <span class="comment">// 10! = 3628800</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] s_cnt;   <span class="comment">//switch按下计数</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">24</span>:<span class="number">0</span>] x,y;</span><br><span class="line"><span class="keyword">reg</span>[<span class="number">24</span>:<span class="number">0</span>] a,b;</span><br><span class="line"><span class="keyword">reg</span>  BranchFSM_running;   <span class="comment">//正在运算旁支FSM：XY</span></span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">integer</span> DOUBLE_JC_MAX = <span class="number">16</span>;</span><br><span class="line"><span class="keyword">integer</span> XY_MAX = <span class="number">10</span>;   <span class="comment">//x^y中y的最大值</span></span><br><span class="line"><span class="comment">//矩阵运算</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] Mat_weishu;</span><br><span class="line"><span class="keyword">reg</span>      over;</span><br><span class="line"><span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] Mnumber6A,Mnumber5A,Mnumber4A,Mnumber3A,Mnumber2A,Mnumber1A;   <span class="comment">//矩阵A</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] Mnumber6B,Mnumber5B,Mnumber4B,Mnumber3B,Mnumber2B,Mnumber1B;   <span class="comment">//矩阵B</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] Mnumber7R,Mnumber6R,Mnumber5R,Mnumber4R,Mnumber3R,Mnumber2R,Mnumber1R;   <span class="comment">//结果矩阵R</span></span><br><span class="line"><span class="comment">//井字棋</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] L_1,M_1,H_1;   <span class="comment">//玩家一的三行输入情况[H,M,L]</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">2</span>:<span class="number">0</span>] L_2,M_2,H_2;   <span class="comment">//玩家二的三行输入情况</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] Pcnt;      <span class="comment">//玩家步数计数</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] winner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span>(!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         REGA &lt;= <span class="number">0</span>; REGB &lt;= <span class="number">0</span>; count &lt;= <span class="number">0</span>;   </span><br><span class="line">         x &lt;= <span class="number">0</span>; y &lt;= <span class="number">0</span>; a &lt;= <span class="number">0</span>; b &lt;= <span class="number">0</span>;</span><br><span class="line">         BranchFSM_running &lt;= <span class="number">0</span>;</span><br><span class="line">         Mat_weishu &lt;= <span class="number">0</span>;  </span><br><span class="line">         over &lt;= <span class="number">0</span>;</span><br><span class="line">         Mnumber6A &lt;= <span class="number">0</span>; Mnumber5A&lt;= <span class="number">0</span>; Mnumber4A&lt;= <span class="number">0</span>; Mnumber3A&lt;= <span class="number">0</span>; Mnumber2A&lt;= <span class="number">0</span>; Mnumber1A&lt;= <span class="number">0</span>; </span><br><span class="line">         Mnumber6B &lt;= <span class="number">0</span>; Mnumber5B&lt;= <span class="number">0</span>; Mnumber4B&lt;= <span class="number">0</span>; Mnumber3B&lt;= <span class="number">0</span>; Mnumber2B&lt;= <span class="number">0</span>; Mnumber1B&lt;= <span class="number">0</span>; </span><br><span class="line">         Mnumber7R &lt;= <span class="number">0</span>; Mnumber6R &lt;= <span class="number">0</span>; Mnumber5R&lt;= <span class="number">0</span>; Mnumber4R&lt;= <span class="number">0</span>; Mnumber3R&lt;= <span class="number">0</span>; Mnumber2R&lt;= <span class="number">0</span>; Mnumber1R&lt;= <span class="number">0</span>;</span><br><span class="line">         L_1 &lt;= <span class="number">0</span>;  M_1 &lt;= <span class="number">0</span>;  H_1 &lt;= <span class="number">0</span>;</span><br><span class="line">         L_2 &lt;= <span class="number">0</span>;  M_2 &lt;= <span class="number">0</span>;  H_2 &lt;= <span class="number">0</span>;</span><br><span class="line">         Pcnt &lt;= <span class="number">0</span>;</span><br><span class="line">         winner &lt;= <span class="number">0</span>;</span><br><span class="line">         opr &lt;= <span class="number">0</span>;</span><br><span class="line">         s_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">         state&lt;= `DECIMAL;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">         `DECIMAL :</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">             <span class="comment">//switch计数:0 -&gt; 1 -&gt; 2</span></span><br><span class="line">             s_cnt &lt;= (switch==<span class="number">1</span>) ? (s_cnt+<span class="number">1</span>) : s_cnt;</span><br><span class="line">                </span><br><span class="line">             <span class="keyword">if</span>((decimal != <span class="number">0</span>) &amp;&amp; (count &lt; <span class="number">7</span>))    <span class="comment">//修改位数</span></span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">                 count &lt;= count + <span class="number">1</span>;</span><br><span class="line">                 REGA &lt;= REGA * <span class="number">10</span> + d;</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span>(ce)</span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">                 REGA &lt;= <span class="number">0</span>; </span><br><span class="line">                 count &lt;= <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span>(inverse)   <span class="comment">//±</span></span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">                 REGA &lt;= ~REGA + <span class="number">1</span>;</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span> (game)  <span class="keyword">begin</span>   <span class="comment">//按下game按键</span></span><br><span class="line">                 state &lt;= `P1;</span><br><span class="line">                 REGA &lt;= <span class="number">1234321</span>;</span><br><span class="line">                 REGB &lt;= <span class="number">1234321</span>;</span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">             <span class="comment">//A: 7  8  9  /   CE</span></span><br><span class="line">             <span class="comment">//B: 4  5  6  *   C</span></span><br><span class="line">             <span class="comment">//C: 1  2  3  -   S</span></span><br><span class="line">             <span class="comment">//D: 0    ±  +   =      switch=0  4  8</span></span><br><span class="line">             <span class="comment">//-----------------------------</span></span><br><span class="line">             <span class="comment">//A: 7  8  9  x^2   CE</span></span><br><span class="line">             <span class="comment">//B: 4  5  6  x!    C</span></span><br><span class="line">             <span class="comment">//C: 1  2  3  mCn   S</span></span><br><span class="line">             <span class="comment">//D: 0    ±  mAn   =    switch=1  5  9</span></span><br><span class="line">             <span class="comment">//-----------------------------</span></span><br><span class="line">             <span class="comment">//A: 7  8  9  x^y   CE</span></span><br><span class="line">             <span class="comment">//B: 4  5  6  x!!   C</span></span><br><span class="line">             <span class="comment">//C: 1  2  3  GCD   S</span></span><br><span class="line">             <span class="comment">//D: 0    ±  LCM   =    switch=2  6  10</span></span><br><span class="line">             <span class="comment">//-----------------------------</span></span><br><span class="line">             <span class="comment">//A: 7  8  9  Mat+   CE</span></span><br><span class="line">             <span class="comment">//B: 4  5  6  |Mat|  C</span></span><br><span class="line">             <span class="comment">//C: 1  2  3  Mat*   S</span></span><br><span class="line">             <span class="comment">//D: 0    ± 1D-cov  =   switch=3  7  11</span></span><br><span class="line">             <span class="comment">//-----------------------------                         </span></span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">if</span>(plus || minus || mult || div || equal)  </span><br><span class="line">               <span class="keyword">begin</span> </span><br><span class="line">                   <span class="keyword">if</span>(s_cnt == <span class="number">0</span> || s_cnt % <span class="number">4</span> == <span class="number">0</span>) <span class="keyword">begin</span>  </span><br><span class="line">                        <span class="keyword">case</span>(opr)</span><br><span class="line">                        <span class="number">4&#x27;b0000</span>: REGB &lt;= REGB + REGA;</span><br><span class="line">                        <span class="number">4&#x27;b0001</span>: REGB &lt;= REGB - REGA;</span><br><span class="line">                        <span class="number">4&#x27;b0010</span>: REGB &lt;= REGB * REGA;</span><br><span class="line">                        <span class="number">4&#x27;b0011</span>: REGB &lt;= REGB / REGA;</span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span>(plus)         opr &lt;= <span class="number">4&#x27;b0000</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(minus)   opr &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(mult)    opr &lt;= <span class="number">4&#x27;b0010</span>;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(div)     opr &lt;= <span class="number">4&#x27;b0011</span>;</span><br><span class="line">                        <span class="keyword">else</span>             opr &lt;= opr;</span><br><span class="line">                   <span class="keyword">end</span>  <span class="comment">//</span></span><br><span class="line">                   <span class="keyword">else</span> <span class="keyword">if</span>(s_cnt % <span class="number">4</span> == <span class="number">1</span>) <span class="keyword">begin</span>  </span><br><span class="line">                        <span class="keyword">case</span>(opr)</span><br><span class="line">                        <span class="number">4&#x27;b0000</span>: REGB &lt;= REGB + REGA;</span><br><span class="line">                        <span class="number">4&#x27;b0001</span>: REGB &lt;= JC_MAP[REGB] / JC_MAP[REGB - REGA];                   <span class="comment">//nAk: n个里选择k个  n!/(n-k)!</span></span><br><span class="line">                        <span class="number">4&#x27;b0010</span>: REGB &lt;= JC_MAP[REGB] / (JC_MAP[REGA] * JC_MAP[REGB - REGA]);    <span class="comment">//nCk</span></span><br><span class="line">                        <span class="number">4&#x27;b0011</span>: REGB &lt;= JC_MAP[REGB];  </span><br><span class="line">                        <span class="number">4&#x27;b0100</span>: REGB &lt;= REGB * REGB;</span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span>(plus)         opr &lt;= <span class="number">4&#x27;b0001</span>;   <span class="comment">//nAk   </span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(minus)   opr &lt;= <span class="number">4&#x27;b0010</span>;   <span class="comment">//nCk </span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(mult)    opr &lt;= <span class="number">4&#x27;b0011</span>;   <span class="comment">//x!   </span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(div)     opr &lt;= <span class="number">4&#x27;b0100</span>;   <span class="comment">//x^2 </span></span><br><span class="line">                        <span class="keyword">else</span>             opr &lt;= opr;</span><br><span class="line">                   <span class="keyword">end</span>              </span><br><span class="line">                   <span class="keyword">else</span> <span class="keyword">if</span>(s_cnt % <span class="number">4</span> == <span class="number">2</span>) <span class="keyword">begin</span> </span><br><span class="line">                        <span class="keyword">case</span>(opr)</span><br><span class="line">                        <span class="number">4&#x27;b0000</span>: REGB &lt;= REGB + REGA;</span><br><span class="line">                        <span class="number">4&#x27;b0100</span>: <span class="keyword">begin</span>  <span class="comment">//x^y</span></span><br><span class="line">                                x &lt;= REGB;</span><br><span class="line">                                y &lt;= REGA;</span><br><span class="line">                                state &lt;= `XY;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0011</span>: <span class="keyword">begin</span>   <span class="comment">//x!!  输入必须按两次一样的数， 比如5!!就要按5!!5</span></span><br><span class="line">                                x &lt;= REGB; </span><br><span class="line">                                y &lt;= REGB; </span><br><span class="line">                                state &lt;= `DOUBLEJC;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0010</span>: <span class="keyword">begin</span>   <span class="comment">//GCD辗转相除法: x=max(REGA,REGB),y=min(REGA,REGB), (x,y)&lt;-(y,x % y)</span></span><br><span class="line">                                x &lt;= (REGA &gt; REGB) ? REGA : REGB;</span><br><span class="line">                                y &lt;= (REGA &lt; REGB) ? REGA : REGB;</span><br><span class="line">                                state &lt;= `GCD;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0001</span>: <span class="keyword">begin</span>  <span class="comment">//LCM = (a * b) /GCD</span></span><br><span class="line">                                x &lt;= (REGA &gt; REGB) ? REGA : REGB;</span><br><span class="line">                                y &lt;= (REGA &lt; REGB) ? REGA : REGB;</span><br><span class="line">                                state &lt;= `LCM;            </span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span>(plus)         opr &lt;= <span class="number">4&#x27;b0001</span>;    <span class="comment">//LCM</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(minus)   opr &lt;= <span class="number">4&#x27;b0010</span>;    <span class="comment">//GCD</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(mult)    opr &lt;= <span class="number">4&#x27;b0011</span>;    <span class="comment">//x!!</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(div)     opr &lt;= <span class="number">4&#x27;b0100</span>;    <span class="comment">//x^y</span></span><br><span class="line">                        <span class="keyword">else</span>             opr &lt;= opr;</span><br><span class="line">                   <span class="keyword">end</span></span><br><span class="line">                   <span class="keyword">else</span> <span class="keyword">if</span>(s_cnt % <span class="number">4</span> == <span class="number">3</span>)  <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">case</span>(opr)</span><br><span class="line">                        <span class="number">4&#x27;b0000</span>: REGB &lt;= REGB + REGA;</span><br><span class="line">                        <span class="comment">//支持的矩阵大小： 1*2  2*2  3*2</span></span><br><span class="line">                        <span class="comment">//逐行展平：比如矩阵[ [2,3,1] ; [1,4,8] ]即输入231148</span></span><br><span class="line">                        <span class="comment">//首先前往MatPre状态预处理，然后分别前往MatPlus,MatMult和hls</span></span><br><span class="line">                        <span class="number">4&#x27;b0001</span>: <span class="keyword">begin</span>  <span class="comment">//一维离散序列线性卷积</span></span><br><span class="line">                            <span class="comment">//state &lt;= `Cov1D;                 </span></span><br><span class="line">                            state &lt;= `MatPre;             </span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0010</span>: <span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//state &lt;= `MatMult;</span></span><br><span class="line">                            state &lt;= `MatPre;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0011</span>: <span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//state &lt;= `MatHLS;</span></span><br><span class="line">                            state &lt;= `MatPre;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="number">4&#x27;b0100</span>: <span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//state &lt;= `MatPlus;</span></span><br><span class="line">                            state &lt;= `MatPre;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line">                   </span><br><span class="line">                        <span class="keyword">if</span>(plus)         opr &lt;= <span class="number">4&#x27;b0001</span>;    <span class="comment">//1D-cov</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(minus)   opr &lt;= <span class="number">4&#x27;b0010</span>;    <span class="comment">//Mat*</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(mult)    opr &lt;= <span class="number">4&#x27;b0011</span>;    <span class="comment">//|Mat|</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(div)     opr &lt;= <span class="number">4&#x27;b0100</span>;    <span class="comment">//Mat+</span></span><br><span class="line">                        <span class="keyword">else</span>             opr &lt;= opr;</span><br><span class="line">                   <span class="keyword">end</span></span><br><span class="line">                       </span><br><span class="line">                                   </span><br><span class="line">                   <span class="keyword">if</span>(BranchFSM_running == <span class="number">0</span>)  <span class="keyword">begin</span>  <span class="comment">//!!!!!!!!!!!!!!!!!!!!!!!!!</span></span><br><span class="line">                        state &lt;= `OPE;</span><br><span class="line">                        REGA &lt;= <span class="number">0</span>;</span><br><span class="line">                   <span class="keyword">end</span></span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">         `OPE:  <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (((REGB[<span class="number">24</span>]==<span class="number">1</span>)&amp;&amp;(REGB&lt;<span class="number">16777216</span>))    <span class="comment">//最大负数：1+ 24个0 是能表示的最大负数</span></span><br><span class="line">                || ((REGB[<span class="number">24</span>]==<span class="number">0</span>)&amp;&amp;(REGB&gt;<span class="number">9999999</span>)))</span><br><span class="line">               state&lt;=`HALT;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(inverse)</span><br><span class="line">                REGB &lt;= ~REGB + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(decimal) <span class="keyword">begin</span></span><br><span class="line">                REGA &lt;= d;   <span class="comment">//新输入</span></span><br><span class="line">                count &lt;= <span class="number">1</span>;</span><br><span class="line">                state &lt;= `DECIMAL;</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">               </span><br><span class="line">            <span class="keyword">if</span>(s_cnt % <span class="number">4</span> == <span class="number">2</span> || s_cnt % <span class="number">4</span> == <span class="number">3</span>)    <span class="comment">//正在执行DECIMAL-&gt;XY/lcm/gcd/Mat的旁支FSM，运算未结束时暂时不要跳转到OPE!!!!!!!!!</span></span><br><span class="line">                BranchFSM_running &lt;= <span class="number">1</span>;  </span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">         `HALT:</span><br><span class="line">            <span class="keyword">if</span>(ce) <span class="keyword">begin</span></span><br><span class="line">                REGA &lt;= <span class="number">0</span>; </span><br><span class="line">                REGB &lt;= <span class="number">0</span>;</span><br><span class="line">                opr &lt;= <span class="number">0</span>;</span><br><span class="line">                count &lt;= <span class="number">0</span>;</span><br><span class="line">                state &lt;= `DECIMAL;</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">//旁支FSM：负责运算X^Y,x!!,GCD,LCM ----------------------------------------------------------------------------------------------------</span></span><br><span class="line">          `XY: <span class="keyword">begin</span></span><br><span class="line">                y &lt;= y - <span class="number">1</span>;</span><br><span class="line">                REGB &lt;= (y == <span class="number">1</span>) ? REGB : REGB * x;               </span><br><span class="line">                state &lt;= (y == <span class="number">1</span>) ? `OPE : `XY;</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">          `DOUBLEJC: <span class="keyword">begin</span></span><br><span class="line">                y &lt;= y - <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span>(y == REGB) <span class="comment">//第一次</span></span><br><span class="line">                    REGB &lt;= REGB;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    REGB &lt;= (y &lt;= <span class="number">1</span>) ? REGB : REGB * y;</span><br><span class="line">       </span><br><span class="line">                state &lt;= (y &lt;= <span class="number">1</span>) ? `OPE : `DOUBLEJC;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `GCD:  <span class="keyword">begin</span>     <span class="comment">//GCD辗转相除法: x=max(REGA,REGB),y=min(REGA,REGB), (x,y)&lt;-(y,x % y)</span></span><br><span class="line">                <span class="keyword">if</span>(x % y == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= y;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    x &lt;= y;</span><br><span class="line">                    y &lt;= x % y;</span><br><span class="line">                    state &lt;= `GCD;</span><br><span class="line">                <span class="keyword">end</span>            </span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `LCM: <span class="keyword">begin</span>    <span class="comment">//LCM = (a * b) /GCD</span></span><br><span class="line">                <span class="keyword">if</span>(x % y == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= (REGA * REGB) / y;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    x &lt;= y;</span><br><span class="line">                    y &lt;= x % y;</span><br><span class="line">                    state &lt;= `LCM;</span><br><span class="line">                <span class="keyword">end</span>            </span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          <span class="comment">//矩阵操作----------------------------------</span></span><br><span class="line">          `MatPre: <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">//检测位数 </span></span><br><span class="line">                <span class="keyword">if</span>(REGB&gt; <span class="number">99999</span>) <span class="keyword">begin</span>    <span class="comment">//六位数：2*3</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">6</span>;                   </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(REGB &gt; <span class="number">9999</span> &amp;&amp; REGB &lt; <span class="number">100000</span>) <span class="keyword">begin</span> <span class="comment">//五位数：2*3，最高位补零</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">5</span>;                   </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(REGB &gt; <span class="number">999</span> &amp;&amp; REGB &lt; <span class="number">10000</span>) <span class="keyword">begin</span> <span class="comment">//四位数： 2*2</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">4</span>;                   </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(REGB &gt; <span class="number">99</span> &amp;&amp; REGB &lt; <span class="number">1000</span>)  <span class="keyword">begin</span>  <span class="comment">//三位数： 2*2, 最高位补零</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(REGB &gt;<span class="number">9</span> &amp;&amp; REGB &lt; <span class="number">100</span>) <span class="keyword">begin</span>  <span class="comment">//二位数：1*2</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">2</span>;                    </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(REGB &gt;=<span class="number">0</span> &amp;&amp; REGB &lt; <span class="number">10</span>) <span class="keyword">begin</span> <span class="comment">//一位数： 1*2 ，最高位补0</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">1</span>;                   </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    Mat_weishu &lt;= <span class="number">0</span>;    </span><br><span class="line">                <span class="keyword">end</span>  </span><br><span class="line">                <span class="comment">//分割数字</span></span><br><span class="line">                Mnumber6B &lt;= REGB / <span class="number">100000</span>;</span><br><span class="line">                Mnumber6A &lt;= REGA / <span class="number">100000</span>;</span><br><span class="line">                Mnumber5B &lt;= (REGB % <span class="number">100000</span>) / <span class="number">10000</span>;</span><br><span class="line">                Mnumber5A &lt;= (REGA % <span class="number">100000</span>) / <span class="number">10000</span>;</span><br><span class="line">                Mnumber4B &lt;= (REGB % <span class="number">10000</span>) / <span class="number">1000</span>;</span><br><span class="line">                Mnumber4A &lt;= (REGA % <span class="number">10000</span>) / <span class="number">1000</span>;</span><br><span class="line">                Mnumber3B &lt;= (REGB % <span class="number">1000</span>) / <span class="number">100</span>;</span><br><span class="line">                Mnumber3A &lt;= (REGA % <span class="number">1000</span>) / <span class="number">100</span>;</span><br><span class="line">                Mnumber2B &lt;= (REGB % <span class="number">100</span>) / <span class="number">10</span>;</span><br><span class="line">                Mnumber2A &lt;= (REGA % <span class="number">100</span>) / <span class="number">10</span>;</span><br><span class="line">                Mnumber1B &lt;= (REGB % <span class="number">10</span>) / <span class="number">1</span>;</span><br><span class="line">                Mnumber1A &lt;= (REGA % <span class="number">10</span>) / <span class="number">1</span>;</span><br><span class="line">                <span class="comment">//预处理结束，进入对应运算FSM</span></span><br><span class="line">                <span class="keyword">case</span>(opr)</span><br><span class="line">                <span class="number">4&#x27;b0001</span>:   state &lt;= `Cov1D;</span><br><span class="line">                <span class="number">4&#x27;b0010</span>:   state &lt;= `MatMult;</span><br><span class="line">                <span class="number">4&#x27;b0011</span>:   state &lt;= `MatHLS;</span><br><span class="line">                <span class="number">4&#x27;b0100</span>:   state &lt;= `MatPlus;</span><br><span class="line">                <span class="keyword">endcase</span>      </span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">          `MatPlus: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span>(Mat_weishu)</span><br><span class="line">                <span class="number">6</span>: <span class="keyword">begin</span>    <span class="comment">//M2*3</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2A + Mnumber2B;</span><br><span class="line">                    Mnumber3R &lt;= Mnumber3A + Mnumber3B;</span><br><span class="line">                    Mnumber4R &lt;= Mnumber4A + Mnumber4B;</span><br><span class="line">                    Mnumber5R &lt;= Mnumber5A + Mnumber5B;</span><br><span class="line">                    Mnumber6R &lt;= Mnumber6A + Mnumber6B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">5</span>: <span class="keyword">begin</span></span><br><span class="line">                   <span class="comment">//最高位补0，但不用写</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2A + Mnumber2B;</span><br><span class="line">                    Mnumber3R &lt;= Mnumber3A + Mnumber3B;</span><br><span class="line">                    Mnumber4R &lt;= Mnumber4A + Mnumber4B;</span><br><span class="line">                    Mnumber5R &lt;= Mnumber5A + Mnumber5B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">4</span>: <span class="keyword">begin</span>   <span class="comment">//M2*2</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2A + Mnumber2B;</span><br><span class="line">                    Mnumber3R &lt;= Mnumber3A + Mnumber3B;</span><br><span class="line">                    Mnumber4R &lt;= Mnumber4A + Mnumber4B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">3</span>: <span class="keyword">begin</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2A + Mnumber2B;</span><br><span class="line">                    Mnumber3R &lt;= Mnumber3A + Mnumber3B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">2</span>: <span class="keyword">begin</span>   <span class="comment">//M1*2</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2A + Mnumber2B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">1</span>: <span class="keyword">begin</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber1A + Mnumber1B;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(over == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= Mnumber6R * <span class="number">100000</span> + Mnumber5R * <span class="number">10000</span> + Mnumber4R * <span class="number">1000</span> + Mnumber3R * <span class="number">100</span> + Mnumber2R * <span class="number">10</span> + Mnumber1R * <span class="number">1</span>;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                    over &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    state &lt;= `MatPlus;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">           `MatHLS: <span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//只有2*2方阵有行列式：|abcd| = ad - bc</span></span><br><span class="line">                <span class="keyword">if</span>(Mat_weishu != <span class="number">4</span> &amp;&amp; Mat_weishu != <span class="number">3</span>) <span class="keyword">begin</span>                    </span><br><span class="line">                    REGB &lt;= <span class="number">9999999</span>;  <span class="comment">//没有逆矩阵显示9999999</span></span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= Mnumber4B * Mnumber1B - Mnumber2B * Mnumber3B;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">          `MatMult: <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">//运算</span></span><br><span class="line">                <span class="comment">//1*2-REGB[a,b] 与 2*1-REGA[c;d] 相乘为 1*1[ac+bd]</span></span><br><span class="line">                <span class="keyword">if</span>(Mat_weishu == <span class="number">2</span>) <span class="keyword">begin</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber2B * Mnumber2A + Mnumber1B * Mnumber1A;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">//REGB &lt;= Mnumber1R;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="comment">//2*2-REGB[[a,b];[c,d]] 与 2*2-REGA[[e,f];[g,h]] 相乘为 2*2[[ae+bg],[af+bh];[ce+dg],[cf+dh]]</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(Mat_weishu == <span class="number">4</span> || Mat_weishu == <span class="number">3</span>) <span class="keyword">begin</span> </span><br><span class="line">                    Mnumber4R &lt;= Mnumber4B * Mnumber4A + Mnumber3B * Mnumber2A;  <span class="comment">//ae+bg</span></span><br><span class="line">                    Mnumber3R &lt;= Mnumber4B * Mnumber3A + Mnumber3B * Mnumber1A;  <span class="comment">//af+bh</span></span><br><span class="line">                    Mnumber2R &lt;= Mnumber2B * Mnumber4A + Mnumber1B * Mnumber2A;  <span class="comment">//ce+dg</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber2B * Mnumber3A + Mnumber1B * Mnumber1A;  <span class="comment">//cf+dh</span></span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">//REGB &lt;= Mnumber4R * 1000 + Mnumber3R * 100 + Mnumber2R * 10 + Mnumber1R * 1;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="comment">//2*3-REGB[[a,b,c];[d,e,f]] 与 3*2-REGA[[g,h];[i,j];[k,l]] 相乘为 2*2[[ag+bi+ck,ah+bj+cl];[dg+ei+fk,dh+ej+fl]]</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(Mat_weishu == <span class="number">6</span> || Mat_weishu == <span class="number">5</span>) <span class="keyword">begin</span></span><br><span class="line">                    Mnumber4R &lt;= Mnumber6B * Mnumber6A + Mnumber5B * Mnumber4A + Mnumber4B * Mnumber2A;  <span class="comment">//ag+bi+ck</span></span><br><span class="line">                    Mnumber3R &lt;= Mnumber6B * Mnumber5A + Mnumber5B * Mnumber3A + Mnumber4B * Mnumber1A;  <span class="comment">//ah+bj+cl</span></span><br><span class="line">                    Mnumber2R &lt;= Mnumber3B * Mnumber6A + Mnumber2B * Mnumber4A + Mnumber1B * Mnumber2B;  <span class="comment">//dg+ei+fk</span></span><br><span class="line">                    Mnumber1R &lt;= Mnumber3B * Mnumber5A + Mnumber2B * Mnumber3A + Mnumber1B * Mnumber1B;  <span class="comment">//dh+ej+fl</span></span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                    <span class="comment">//REGB &lt;= Mnumber4R * 1000 + Mnumber3R * 100 + Mnumber2R * 10 + Mnumber1R * 1;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span>  <span class="comment">//不支持的运算</span></span><br><span class="line">                    REGB &lt;= <span class="number">9999999</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">//结果赋予REGB</span></span><br><span class="line">                <span class="keyword">if</span>(over == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= Mnumber4R * <span class="number">1000</span> + Mnumber3R * <span class="number">100</span> + Mnumber2R * <span class="number">10</span> + Mnumber1R * <span class="number">1</span>;</span><br><span class="line">                    over &lt;= <span class="number">0</span>;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state &lt;= `MatMult;</span><br><span class="line">                <span class="keyword">end</span>               </span><br><span class="line">          <span class="keyword">end</span>         </span><br><span class="line">          </span><br><span class="line">          `Cov1D: <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">//N长序列 和 M长序列 卷积结果是 M+N-1。最高不能超过7，否则无法显示</span></span><br><span class="line">                <span class="comment">//直接规定最大 N=4 * M=4</span></span><br><span class="line">                <span class="keyword">if</span>(Mat_weishu &gt; <span class="number">4</span>)  <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= <span class="number">9999999</span>;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    Mnumber7R &lt;= Mnumber4B * Mnumber1A;</span><br><span class="line">                    Mnumber6R &lt;= Mnumber3B * Mnumber1A + Mnumber4B * Mnumber2A;</span><br><span class="line">                    Mnumber5R &lt;= Mnumber2B * Mnumber1A + Mnumber3B * Mnumber2A + Mnumber4B * Mnumber3A;</span><br><span class="line">                    Mnumber4R &lt;= Mnumber1B * Mnumber1A + Mnumber2B * Mnumber2A + Mnumber3B * Mnumber3A + Mnumber4B * Mnumber4A;</span><br><span class="line">                    Mnumber3R &lt;= Mnumber3B * Mnumber4A + Mnumber2B * Mnumber3A + Mnumber1B * Mnumber2A;</span><br><span class="line">                    Mnumber2R &lt;= Mnumber2B * Mnumber4A + Mnumber1B * Mnumber3A;</span><br><span class="line">                    Mnumber1R &lt;= Mnumber1B * Mnumber4A;</span><br><span class="line">                    over &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(over == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                    REGB &lt;= Mnumber7R * <span class="number">1000000</span> + Mnumber6R * <span class="number">100000</span> + Mnumber5R * <span class="number">10000</span> + Mnumber4R * <span class="number">1000</span> + Mnumber3R * <span class="number">100</span> + Mnumber2R * <span class="number">10</span> + Mnumber1R * <span class="number">1</span>;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">                    state &lt;= `Cov1D;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">//井字棋--------------------------------------------------</span></span><br><span class="line">          `P1: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>((decimal != <span class="number">0</span>))   <span class="keyword">begin</span> <span class="comment">//键入</span></span><br><span class="line">                    H_1[<span class="number">0</span>] &lt;= (d == <span class="number">7</span>) ? (H_1[<span class="number">0</span>]+ <span class="number">1</span>) : H_1[<span class="number">0</span>];</span><br><span class="line">                    H_1[<span class="number">1</span>] &lt;= (d == <span class="number">8</span>) ? (H_1[<span class="number">1</span>]+ <span class="number">1</span>) : H_1[<span class="number">1</span>];</span><br><span class="line">                    H_1[<span class="number">2</span>] &lt;= (d == <span class="number">9</span>) ? (H_1[<span class="number">2</span>]+ <span class="number">1</span>) : H_1[<span class="number">2</span>];</span><br><span class="line">                    M_1[<span class="number">0</span>] &lt;= (d == <span class="number">4</span>) ? (M_1[<span class="number">0</span>]+ <span class="number">1</span>) : M_1[<span class="number">0</span>];</span><br><span class="line">                    M_1[<span class="number">1</span>] &lt;= (d == <span class="number">5</span>) ? (M_1[<span class="number">1</span>]+ <span class="number">1</span>) : M_1[<span class="number">1</span>];</span><br><span class="line">                    M_1[<span class="number">2</span>] &lt;= (d == <span class="number">6</span>) ? (M_1[<span class="number">2</span>]+ <span class="number">1</span>) : M_1[<span class="number">2</span>];</span><br><span class="line">                    L_1[<span class="number">0</span>] &lt;= (d == <span class="number">1</span>) ? (L_1[<span class="number">0</span>]+ <span class="number">1</span>) : L_1[<span class="number">0</span>];</span><br><span class="line">                    L_1[<span class="number">1</span>] &lt;= (d == <span class="number">2</span>) ? (L_1[<span class="number">1</span>]+ <span class="number">1</span>) : L_1[<span class="number">1</span>];</span><br><span class="line">                    L_1[<span class="number">2</span>] &lt;= (d == <span class="number">3</span>) ? (L_1[<span class="number">2</span>]+ <span class="number">1</span>) : L_1[<span class="number">2</span>];</span><br><span class="line">                    Pcnt &lt;= Pcnt + <span class="number">1</span>;</span><br><span class="line">                    state &lt;= `Judge;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state &lt;= `P1;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                REGB &lt;= <span class="number">1110000</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `P2: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>((decimal != <span class="number">0</span>))   <span class="keyword">begin</span> <span class="comment">//键入</span></span><br><span class="line">                    H_2[<span class="number">0</span>] &lt;= (d == <span class="number">7</span>) ? (H_2[<span class="number">0</span>]+<span class="number">1</span>) : H_2[<span class="number">0</span>];</span><br><span class="line">                    H_2[<span class="number">1</span>] &lt;= (d == <span class="number">8</span>) ? (H_2[<span class="number">1</span>]+<span class="number">1</span>) : H_2[<span class="number">1</span>];</span><br><span class="line">                    H_2[<span class="number">2</span>] &lt;= (d == <span class="number">9</span>) ? (H_2[<span class="number">2</span>]+<span class="number">1</span>) : H_2[<span class="number">2</span>];</span><br><span class="line">                    M_2[<span class="number">0</span>] &lt;= (d == <span class="number">4</span>) ? (M_2[<span class="number">0</span>]+<span class="number">1</span>) : M_2[<span class="number">0</span>];</span><br><span class="line">                    M_2[<span class="number">1</span>] &lt;= (d == <span class="number">5</span>) ? (M_2[<span class="number">1</span>]+<span class="number">1</span>) : M_2[<span class="number">1</span>];</span><br><span class="line">                    M_2[<span class="number">2</span>] &lt;= (d == <span class="number">6</span>) ? (M_2[<span class="number">2</span>]+<span class="number">1</span>) : M_2[<span class="number">2</span>];</span><br><span class="line">                    L_2[<span class="number">0</span>] &lt;= (d == <span class="number">1</span>) ? (L_2[<span class="number">0</span>]+<span class="number">1</span>) : L_2[<span class="number">0</span>];</span><br><span class="line">                    L_2[<span class="number">1</span>] &lt;= (d == <span class="number">2</span>) ? (L_2[<span class="number">1</span>]+<span class="number">1</span>) : L_2[<span class="number">1</span>];</span><br><span class="line">                    L_2[<span class="number">2</span>] &lt;= (d == <span class="number">3</span>) ? (L_2[<span class="number">2</span>]+<span class="number">1</span>) : L_2[<span class="number">2</span>];</span><br><span class="line">                    Pcnt &lt;= Pcnt + <span class="number">1</span>;</span><br><span class="line">                    state &lt;= `Judge;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    state &lt;= `P2;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                REGB &lt;= <span class="number">111</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `Judge: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span>( H_1 == <span class="number">3&#x27;b111</span> || M_1 == <span class="number">3&#x27;b111</span> || L_1 == <span class="number">3&#x27;b111</span> ||</span><br><span class="line">                   &#123;H_1[<span class="number">0</span>],M_1[<span class="number">0</span>],L_1[<span class="number">0</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_1[<span class="number">1</span>],M_1[<span class="number">1</span>],L_1[<span class="number">1</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_1[<span class="number">2</span>],M_1[<span class="number">2</span>],L_1[<span class="number">2</span>]&#125; == <span class="number">3&#x27;b111</span> || </span><br><span class="line">                   &#123;H_1[<span class="number">0</span>],M_1[<span class="number">1</span>],L_1[<span class="number">2</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_1[<span class="number">2</span>],M_1[<span class="number">1</span>],L_1[<span class="number">0</span>]&#125; == <span class="number">3&#x27;b111</span> )  <span class="keyword">begin</span></span><br><span class="line">                    winner &lt;= <span class="number">1</span>;   <span class="comment">//玩家一胜利       </span></span><br><span class="line">                    REGB &lt;= <span class="number">1111111</span>;</span><br><span class="line">                    state &lt;= `OPE;            </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>( H_2 == <span class="number">3&#x27;b111</span> || M_2 == <span class="number">3&#x27;b111</span> || L_2 == <span class="number">3&#x27;b111</span> ||</span><br><span class="line">                        &#123;H_2[<span class="number">0</span>],M_2[<span class="number">0</span>],L_2[<span class="number">0</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_2[<span class="number">1</span>],M_2[<span class="number">1</span>],L_2[<span class="number">1</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_2[<span class="number">2</span>],M_2[<span class="number">2</span>],L_2[<span class="number">2</span>]&#125; == <span class="number">3&#x27;b111</span> || </span><br><span class="line">                        &#123;H_2[<span class="number">0</span>],M_2[<span class="number">1</span>],L_2[<span class="number">2</span>]&#125; == <span class="number">3&#x27;b111</span> || &#123;H_2[<span class="number">2</span>],M_2[<span class="number">1</span>],L_2[<span class="number">0</span>]&#125; == <span class="number">3&#x27;b111</span> )  <span class="keyword">begin</span></span><br><span class="line">                    winner &lt;= <span class="number">2</span>;   <span class="comment">//玩家二胜利</span></span><br><span class="line">                    REGB &lt;= <span class="number">2222222</span>;</span><br><span class="line">                    state &lt;= `OPE;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span>  <span class="keyword">begin</span>   <span class="comment">//目前没决出胜负或者平</span></span><br><span class="line">                    <span class="keyword">if</span>(Pcnt == <span class="number">9</span>)  <span class="keyword">begin</span>  <span class="comment">//下完了但是平局</span></span><br><span class="line">                        winner &lt;= <span class="number">0</span>;</span><br><span class="line">                        REGB &lt;= <span class="number">5555555</span>;  </span><br><span class="line">                        state &lt;= `OPE;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span>   <span class="comment">//未决出胜负，继续下</span></span><br><span class="line">                        state &lt;= (Pcnt % <span class="number">2</span> == <span class="number">0</span>) ? `P1 : `P2;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">//More States 》》》</span></span><br><span class="line">          </span><br><span class="line">         <span class="keyword">endcase</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">assign</span> overflow=(state==`HALT)?<span class="number">1</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="comment">//assign sign=(state==`DECIMAL)? 0: ((state==`OPE)?(REGB[24]) :0);</span></span><br><span class="line">  <span class="keyword">assign</span> sign=(state==`DECIMAL)? REGA[<span class="number">24</span>]: ((state==`OPE)?(REGB[<span class="number">24</span>]) :<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">assign</span> out=out_func (state, REGA, REGB);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> [<span class="number">24</span>:<span class="number">0</span>] out_func;</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] s; <span class="keyword">input</span> [<span class="number">24</span>:<span class="number">0</span>] a; <span class="keyword">input</span> [<span class="number">24</span>:<span class="number">0</span>] b;</span><br><span class="line">    <span class="keyword">case</span>(s)</span><br><span class="line">      `DECIMAL :</span><br><span class="line">        out_func = a;</span><br><span class="line"></span><br><span class="line">      `OPE :</span><br><span class="line">        <span class="keyword">if</span>(b[<span class="number">24</span>]==<span class="number">1</span>)    <span class="comment">//负数：检查最高位</span></span><br><span class="line">          out_func = ~b + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          out_func = b;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">  <span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="八段数码管显示顶层模块binled-v"><a href="#八段数码管显示顶层模块binled-v" class="headerlink" title="八段数码管显示顶层模块binled.v"></a>八段数码管显示顶层模块binled.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> binled(in, ledh, ledg, ledf, lede, ledd, ledc, ledb);</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">24</span>:<span class="number">0</span>] in;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] ledh,ledg,ledf,lede,ledd,ledc,ledb;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] outh,outg,outf,oute,outd,outc,outb;</span><br><span class="line"></span><br><span class="line">  bintobcd bintobcd(in,outh,outg,outf,oute,outd,outc,outb);</span><br><span class="line">  ledout ledouth(outh, ledh);</span><br><span class="line">  ledout ledoutg(outg, ledg);</span><br><span class="line">  ledout ledoutf(outf, ledf);</span><br><span class="line">  ledout ledoute(oute, lede);</span><br><span class="line">  ledout ledoutd(outd, ledd);</span><br><span class="line">  ledout ledoutc(outc, ledc);</span><br><span class="line">  ledout ledoutb(outb, ledb);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="二进制转BCD码模块bintobcd-v"><a href="#二进制转BCD码模块bintobcd-v" class="headerlink" title="二进制转BCD码模块bintobcd.v"></a>二进制转BCD码模块bintobcd.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> bintobcd(in,outh,outg,outf,oute,outd,outc,outb) ;</span><br><span class="line">  <span class="keyword">input</span> [<span class="number">24</span>:<span class="number">0</span>] in;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] outh,outg,outf,oute,outd,outc,outb;</span><br><span class="line">  <span class="keyword">wire</span> [<span class="number">24</span>:<span class="number">0</span>] temp1, temp2, temp3, temp4, temp5, temp6, temp7, temp8, temp9, temp10, temp11, temp12,</span><br><span class="line">              temp13, temp14, temp15, temp16, temp17, temp18, temp19, temp20, temp21, temp22, temp23, temp24;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//百万位b</span></span><br><span class="line">    <span class="keyword">assign</span> outb[<span class="number">3</span>] = (in &gt;= <span class="number">8000000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp1 = (in &gt;= <span class="number">8000000</span>) ? in - <span class="number">8000000</span> : in;</span><br><span class="line">    <span class="keyword">assign</span> outb[<span class="number">2</span>] = (temp1 &gt;= <span class="number">4000000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp2 = (temp1 &gt;= <span class="number">4000000</span>) ? temp1 - <span class="number">4000000</span> : temp1;</span><br><span class="line">    <span class="keyword">assign</span> outb[<span class="number">1</span>] = (temp2 &gt;= <span class="number">2000000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp3 = (temp2 &gt;= <span class="number">2000000</span>) ? temp2 - <span class="number">2000000</span> : temp2;</span><br><span class="line">    <span class="keyword">assign</span> outb[<span class="number">0</span>] = (temp3 &gt;= <span class="number">1000000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp4 = (temp3 &gt;= <span class="number">1000000</span>) ? temp3 - <span class="number">1000000</span> : temp3;</span><br><span class="line">    <span class="comment">//十万位c</span></span><br><span class="line">    <span class="keyword">assign</span> outc[<span class="number">3</span>] = (temp4 &gt;= <span class="number">800000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp5 = (temp4 &gt;= <span class="number">800000</span>) ? temp4 - <span class="number">800000</span> : temp4;</span><br><span class="line">    <span class="keyword">assign</span> outc[<span class="number">2</span>] = (temp5 &gt;= <span class="number">400000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp6 = (temp5 &gt;= <span class="number">400000</span>) ? temp5 - <span class="number">400000</span> : temp5;</span><br><span class="line">    <span class="keyword">assign</span> outc[<span class="number">1</span>] = (temp6 &gt;= <span class="number">200000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp7 = (temp6 &gt;= <span class="number">200000</span>) ? temp6 - <span class="number">200000</span> : temp6;</span><br><span class="line">    <span class="keyword">assign</span> outc[<span class="number">0</span>] = (temp7 &gt;= <span class="number">100000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp8 = (temp7 &gt;= <span class="number">100000</span>) ? temp7 - <span class="number">100000</span> : temp7;</span><br><span class="line">    <span class="comment">//万位计算d</span></span><br><span class="line">    <span class="keyword">assign</span> outd[<span class="number">3</span>] = (temp8 &gt;= <span class="number">80000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp9 = (temp8 &gt;= <span class="number">80000</span>) ? temp8 - <span class="number">80000</span> : temp8;</span><br><span class="line">    <span class="keyword">assign</span> outd[<span class="number">2</span>] = (temp9 &gt;= <span class="number">40000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp10 = (temp9 &gt;= <span class="number">40000</span>) ? temp9 - <span class="number">40000</span> : temp9;</span><br><span class="line">    <span class="keyword">assign</span> outd[<span class="number">1</span>] = (temp10 &gt;= <span class="number">20000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp11 = (temp10 &gt;= <span class="number">20000</span>) ? temp10 - <span class="number">20000</span> : temp10;</span><br><span class="line">    <span class="keyword">assign</span> outd[<span class="number">0</span>] = (temp11 &gt;= <span class="number">10000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp12 = (temp11 &gt;= <span class="number">10000</span>) ? temp11 - <span class="number">10000</span> : temp11;</span><br><span class="line">    <span class="comment">// 千位计算e</span></span><br><span class="line">    <span class="keyword">assign</span> oute[<span class="number">3</span>] = (temp12 &gt;= <span class="number">8000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp13 = (temp12 &gt;= <span class="number">8000</span>) ? temp12 - <span class="number">8000</span> : temp12;</span><br><span class="line">    <span class="keyword">assign</span> oute[<span class="number">2</span>] = (temp13 &gt;= <span class="number">4000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp14 = (temp13 &gt;= <span class="number">4000</span>) ? temp13 - <span class="number">4000</span> : temp13;</span><br><span class="line">    <span class="keyword">assign</span> oute[<span class="number">1</span>] = (temp14 &gt;= <span class="number">2000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp15 = (temp14 &gt;= <span class="number">2000</span>) ? temp14 - <span class="number">2000</span> : temp14;</span><br><span class="line">    <span class="keyword">assign</span> oute[<span class="number">0</span>] = (temp15 &gt;= <span class="number">1000</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp16 = (temp15 &gt;= <span class="number">1000</span>) ? temp15 - <span class="number">1000</span> : temp15;</span><br><span class="line">    <span class="comment">// 百位计算f</span></span><br><span class="line">    <span class="keyword">assign</span> outf[<span class="number">3</span>] = (temp16 &gt;= <span class="number">800</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp17 = (temp16 &gt;= <span class="number">800</span>) ? temp16 - <span class="number">800</span> : temp16;</span><br><span class="line">    <span class="keyword">assign</span> outf[<span class="number">2</span>] = (temp17 &gt;= <span class="number">400</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp18 = (temp17 &gt;= <span class="number">400</span>) ? temp17 - <span class="number">400</span> : temp17;</span><br><span class="line">    <span class="keyword">assign</span> outf[<span class="number">1</span>] = (temp18 &gt;= <span class="number">200</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp19 = (temp18 &gt;= <span class="number">200</span>) ? temp18 - <span class="number">200</span> : temp18;</span><br><span class="line">    <span class="keyword">assign</span> outf[<span class="number">0</span>] = (temp19 &gt;= <span class="number">100</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp20 = (temp19 &gt;= <span class="number">100</span>) ? temp19 - <span class="number">100</span> : temp19;</span><br><span class="line">    <span class="comment">// 十位计算g</span></span><br><span class="line">    <span class="keyword">assign</span> outg[<span class="number">3</span>] = (temp20 &gt;= <span class="number">80</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp21 = (temp20 &gt;= <span class="number">80</span>) ? temp20 - <span class="number">80</span> : temp20;</span><br><span class="line">    <span class="keyword">assign</span> outg[<span class="number">2</span>] = (temp21 &gt;= <span class="number">40</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp22 = (temp21 &gt;= <span class="number">40</span>) ? temp21 - <span class="number">40</span> : temp21;</span><br><span class="line">    <span class="keyword">assign</span> outg[<span class="number">1</span>] = (temp22 &gt;= <span class="number">20</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp23 = (temp22 &gt;= <span class="number">20</span>) ? temp22 - <span class="number">20</span> : temp22;</span><br><span class="line">    <span class="keyword">assign</span> outg[<span class="number">0</span>] = (temp23 &gt;= <span class="number">10</span>) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">assign</span> temp24 = (temp23 &gt;= <span class="number">10</span>) ? temp23 - <span class="number">10</span> : temp23;</span><br><span class="line">    <span class="comment">// 个位计算h</span></span><br><span class="line">    <span class="keyword">assign</span> outh = (temp24 &gt;= <span class="number">10</span>) ? temp24 -<span class="number">10</span> : temp24;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="八段数码管显示模块ledout-v"><a href="#八段数码管显示模块ledout-v" class="headerlink" title="八段数码管显示模块ledout.v"></a>八段数码管显示模块ledout.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ledout: Translation from BCD to LED_out</span></span><br><span class="line"><span class="keyword">module</span> ledout(in, out);</span><br><span class="line">  <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] in;</span><br><span class="line">  <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] out;</span><br><span class="line">  <span class="keyword">reg</span>    [<span class="number">7</span>:<span class="number">0</span>] out;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">always</span> @(in)</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">case</span>(in)</span><br><span class="line">        <span class="number">0</span>: out = <span class="number">8&#x27;b11111100</span>;</span><br><span class="line">        <span class="number">1</span>: out = <span class="number">8&#x27;b01100000</span>;</span><br><span class="line">        <span class="number">2</span>: out = <span class="number">8&#x27;b11011010</span>;</span><br><span class="line">        <span class="number">3</span>: out = <span class="number">8&#x27;b11110010</span>;</span><br><span class="line">        <span class="number">4</span>: out = <span class="number">8&#x27;b01100110</span>;</span><br><span class="line">        <span class="number">5</span>: out = <span class="number">8&#x27;b10110110</span>;</span><br><span class="line">        <span class="number">6</span>: out = <span class="number">8&#x27;b10111110</span>;</span><br><span class="line">        <span class="number">7</span>: out = <span class="number">8&#x27;b11100000</span>;</span><br><span class="line">        <span class="number">8</span>: out = <span class="number">8&#x27;b11111110</span>;</span><br><span class="line">        <span class="number">9</span>: out = <span class="number">8&#x27;b11110110</span>;</span><br><span class="line">        <span class="keyword">default</span>: out = <span class="number">8&#x27;bXXXXXXXX</span>;</span><br><span class="line">      <span class="keyword">endcase</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="跨时钟域同步模块-1bit按键交互-syncro-v"><a href="#跨时钟域同步模块-1bit按键交互-syncro-v" class="headerlink" title="跨时钟域同步模块(1bit按键交互)syncro.v"></a>跨时钟域同步模块(1bit按键交互)syncro.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Syncro: Asyncronous to Syncronous (1-bit width)</span></span><br><span class="line"><span class="keyword">module</span> syncro(out, in, clk, reset);</span><br><span class="line">  <span class="keyword">parameter</span> WIDTH = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">input</span>    [WIDTH-<span class="number">1</span>:<span class="number">0</span>] in ;</span><br><span class="line">  <span class="keyword">output</span>   [WIDTH-<span class="number">1</span>:<span class="number">0</span>] out;</span><br><span class="line">  <span class="keyword">input</span>     clk,reset;</span><br><span class="line">  <span class="keyword">reg</span>      [WIDTH-<span class="number">1</span>:<span class="number">0</span>] qO,q1,q2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!reset)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">       qO &lt;= <span class="number">0</span>;</span><br><span class="line">       q1 &lt;= <span class="number">0</span>;</span><br><span class="line">       q2 &lt;= <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">       qO &lt;= ~in;</span><br><span class="line">       q1 &lt;= qO;</span><br><span class="line">       q2 &lt;= q1;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">assign</span> out=q1 &amp; (~q2) ;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="跨时钟域同步模块-10bit按键交互-syncro10-v"><a href="#跨时钟域同步模块-10bit按键交互-syncro10-v" class="headerlink" title="跨时钟域同步模块(10bit按键交互)syncro10.v"></a>跨时钟域同步模块(10bit按键交互)syncro10.v</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Syncro10: Asyncronous to Syncrnous (10-bit width)</span></span><br><span class="line"><span class="keyword">module</span> syncro10(out, in, clk, reset) ;</span><br><span class="line">  <span class="keyword">parameter</span> WIDTH = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">input</span>    [WIDTH-<span class="number">1</span>:<span class="number">0</span>] in;</span><br><span class="line">  <span class="keyword">output</span>   [WIDTH-<span class="number">1</span>:<span class="number">0</span>] out;</span><br><span class="line">  <span class="keyword">input</span>    clk,reset;</span><br><span class="line">  <span class="keyword">reg</span>      [WIDTH-<span class="number">1</span>:<span class="number">0</span>] qO,q1,q2;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!reset)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">       qO &lt;= <span class="number">0</span>;</span><br><span class="line">       q1 &lt;= <span class="number">0</span>;</span><br><span class="line">       q2 &lt;= <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">       qO &lt;= ~in;</span><br><span class="line">       q1 &lt;= qO;</span><br><span class="line">       q2 &lt;= q1;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">assign</span> out=q1 &amp; (~q2) ;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><hr><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>虽然这个项目中我只是完成了较为简单的运算设计，创新点也较为简单（矩阵和井字棋），没有像有些同学写了小数和负数的运算。但是在上板验证阶段，我的代码一次性通过了所有的测试，准确无误；在课上进行presentation时思路也较为清晰，得到了三位学长助教的一致好评，最终也是拿到了30分满分的好成绩。</p>]]></content>
      
      
      <categories>
          
          <category> Course Assignment </category>
          
          <category> System LSI Design </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Verilog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pipline-CPU的Verilog实现与仿真：SystemLSI Project#2 留档</title>
      <link href="/2025/02/08/slsi-pcpu-project/"/>
      <url>/2025/02/08/slsi-pcpu-project/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="教授的6个基础test-pattern仿真测试"><a href="#教授的6个基础test-pattern仿真测试" class="headerlink" title="教授的6个基础test pattern仿真测试"></a>教授的6个基础test pattern仿真测试</h2><ul><li>首先，电脑中必须安装iverilog并配置用户的环境变量。</li><li>将文件夹下的pcpu.v粘贴修改为自己写好的pcpu.v，然后直接运行run.bat即可在cmd终端查看测试结果。</li></ul><p>测试结果如下，测试通过的项目会打上○，未通过则是×。本代码经过测试AC：</p><img src="https://s2.loli.net/2025/02/08/YLmS7u48kRtECi6.png"><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>自己书写的pcpu模块，其管教的顺序必须和测试代码中的保持一致，如果不保持一致必然报错。我之前因为要添加新功能，因此在原有的pcpu模块中添加了一个管教，这导致了所有的测试样例全部不通过！我们打开测试代码，可以看到实例化pcpu的部分如下：</li></ul><img src="https://s2.loli.net/2025/02/08/LxlP7WvJVUeiHst.png"><ul><li>其他注意事项写在代码注释中。</li></ul><hr><h2 id="代码（基础版：能够通过教授所有的test-pattern）"><a href="#代码（基础版：能够通过教授所有的test-pattern）" class="headerlink" title="代码（基础版：能够通过教授所有的test pattern）"></a>代码（基础版：能够通过教授所有的test pattern）</h2><p>基础版，能够通过教授所有的test pattern。但是相对应的，为了满足测试要求，我关闭了特色功能LWC_INTERRUPT和LWC_CALLBACK：代码中本应该作为输入管教的 i_datain_interrupt 被替代为一个恒为0的reg变量，因此状态机也不会跳转到interrupt中，只会在最基础的idle和exe之间跳转，实现最基础的27条指令。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> NOP   5&#x27;b00000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> HALT  5&#x27;b00001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LOAD  5&#x27;b00010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> STORE 5&#x27;b00011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADD   5&#x27;b01000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CMP   5&#x27;b01100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BZ    5&#x27;b11010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BN    5&#x27;b11100</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="comment">// Basic operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUB   5&#x27;b01010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUBC  5&#x27;b10010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADDC  5&#x27;b10001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADDI  5&#x27;b01001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUBI  5&#x27;b01011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LDIH  5&#x27;b10000</span></span><br><span class="line"><span class="comment">// Logical/Shift operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AND   5&#x27;b01101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> OR    5&#x27;b01110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> XOR   5&#x27;b01111</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SLL   5&#x27;b00100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SRL   5&#x27;b00101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SLA   5&#x27;b00110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SRA   5&#x27;b00111</span></span><br><span class="line"><span class="comment">// Control operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> JUMP  5&#x27;b11000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> JMPR  5&#x27;b11001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNZ   5&#x27;b11011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNN   5&#x27;b11101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BC    5&#x27;b11110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNC   5&#x27;b11111 </span></span><br><span class="line"><span class="comment">//** LWC original operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CLEAR       5&#x27;b10011   </span><span class="comment">//clear: clear one data in rg[val3] 【CLEAR null null val3】</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CA          5&#x27;b10100   </span><span class="comment">//CA: celete all data in rg  【no op1op2op3, like NOP &amp; HALT】</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_ENCRYPT     5&#x27;b10101   </span><span class="comment">//encrypt: 数据加密  【LWC_ENCRYPT r1 r2 r3】  秘钥：r3; 源码：r2；加密结果存放在r1，秘钥存放在r1+1.</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_INTERRUPT   5&#x27;b10110   </span><span class="comment">//Interrupt: 中断 (Control operation)  </span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CALLBACK    5&#x27;b10111   </span><span class="comment">//CallBack: 中断回调</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FSM for CPU controler</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> idle 2&#x27;b00</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> exec 2&#x27;b01</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> interrupt 2&#x27;b10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> pcpu (reset, clock, enable, start, i_addr, i_datain, d_addr,</span><br><span class="line">             d_datain, d_dataout, d_we, select_y, y);</span><br><span class="line"></span><br><span class="line"><span class="keyword">input</span> reset, enable, start, clock;   <span class="comment">//由顶层于外部连接，由外部(仿真时)控制</span></span><br><span class="line"><span class="keyword">input</span>  [<span class="number">15</span>:<span class="number">0</span>] i_datain;</span><br><span class="line"><span class="comment">//input  [15:0] i_datain_interrupt;   //仅做基础test pattern测试时，需要关闭interrupt功能。</span></span><br><span class="line"><span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]  i_addr;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]  d_addr;</span><br><span class="line"><span class="keyword">input</span>  [<span class="number">15</span>:<span class="number">0</span>] d_datain;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] d_dataout;</span><br><span class="line"><span class="keyword">output</span> d_we;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for Debug ------------ 只是用y看一下内部各个线上的数据</span></span><br><span class="line"><span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] select_y;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] y; </span><br><span class="line"></span><br><span class="line"><span class="comment">//--2025.2.5:For Basic Tests--//</span></span><br><span class="line"><span class="keyword">reg</span> i_datain_interrupt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Definition of F/Fs</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>]  pc ;                              <span class="comment">//pc:  取指令的指针，指向imem内下一条要执行的指令。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] id_ir, ex_ir, mem_ir, wb_ir;      <span class="comment">//xx_ir: 指令链，不同阶段对指令instruction进行流水线式的存储。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] gr [<span class="number">0</span>:<span class="number">7</span>];                         <span class="comment">//gr: General Register。它是CPU内部的存储器(寄存器堆)。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] reg_A, reg_B, reg_C, reg_C1;      <span class="comment">//reg_X: 数据寄存器，用于CPU内部运算数据的暂存。 [reg_A,reg_B] --&gt; ALU --&gt; [reg_C]</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] smdr, smdr1;                      <span class="comment">//smdr: 直接存储数据</span></span><br><span class="line"><span class="keyword">reg</span> zf, nf, dw;       <span class="comment">//flags:  zf(zero flag);  nf(negative flag);  dw(data write):与d_we相连，是CPU-&gt;dmem写使能。</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="keyword">reg</span> cf;                  <span class="comment">//carry flag: 进位信号</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] pc_interrupt;   <span class="comment">//记录中断前的pc值，中断回调后pc置为 pc_interrupt+1</span></span><br><span class="line"><span class="keyword">reg</span> inter_flag;</span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Definition of temporary variables</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] ALUo;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] y;</span><br><span class="line"><span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] next_state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> i_addr = pc;  <span class="comment">//pc给到i_addr，i_addr输出到imem，取出一条指令</span></span><br><span class="line"><span class="keyword">assign</span> d_we  = dw;</span><br><span class="line"><span class="keyword">assign</span> d_addr = reg_C[<span class="number">7</span>:<span class="number">0</span>];   <span class="comment">//从dmem中取data的地址，地址始终存在reg_C中</span></span><br><span class="line"><span class="keyword">assign</span> d_dataout = smdr1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CPU Control (FSM)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> (!reset)</span><br><span class="line">         state &lt;= `idle;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(state <span class="keyword">or</span> enable <span class="keyword">or</span> start <span class="keyword">or</span> wb_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">case</span> (state)</span><br><span class="line">        `idle : <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b1</span>) &amp;&amp; (start == <span class="number">1&#x27;b1</span>))</span><br><span class="line">                   next_state &lt;= `exec;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                   next_state &lt;= `idle;</span><br><span class="line">        `exec : <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b0</span>) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `HALT))</span><br><span class="line">                   next_state &lt;= `idle;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b0</span>) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_INTERRUPT))</span><br><span class="line">                   next_state &lt;= `interrupt;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                   next_state &lt;= `exec;</span><br><span class="line">        `interrupt: <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CALLBACK)</span><br><span class="line">                        next_state &lt;= `exec;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        next_state &lt;= `interrupt;</span><br><span class="line">      <span class="keyword">endcase</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// IF Block (1st Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         id_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         pc    &lt;= <span class="number">8&#x27;b00000000</span>;</span><br><span class="line">         pc_interrupt &lt;= <span class="number">8&#x27;b00000000</span>;</span><br><span class="line">         inter_flag &lt;= <span class="number">0</span>;</span><br><span class="line"> i_datain_interrupt &lt;= <span class="number">0</span>;   <span class="comment">//for professor&#x27;s test pattern, close INTERRUPT using ‘i_datain_interrupt===0’</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="comment">// id_ir &lt;= i_datain;     //从imem取指令</span></span><br><span class="line">         id_ir &lt;= (state == `interrupt) ? i_datain_interrupt : i_datain;</span><br><span class="line">        <span class="comment">//主要任务：pc指针控制</span></span><br><span class="line">         <span class="keyword">if</span> ( ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>)) ||</span><br><span class="line">              (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) ||</span><br><span class="line">              ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>)) )      </span><br><span class="line">            <span class="comment">//特殊指令跳转： jump to reg_C[7:0]，跳转到ALU运算出来的指令地址。因此必须要根据mem阶段的指令mem_ir判断，否则还没有运算出跳转结果reg_C</span></span><br><span class="line">            pc &lt;= reg_C[<span class="number">7</span>:<span class="number">0</span>];  </span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JUMP)    </span><br><span class="line">            <span class="comment">//JUMP指令跳转: jump to &#123;val2,val3&#125;, 中括号的意思是[7:4]与[3:0]组合为[7:0]</span></span><br><span class="line">            pc &lt;= id_ir[<span class="number">7</span>:<span class="number">0</span>];  </span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]   </span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">         //LOAD需要等一拍： 等待运算完成，ALUo值存入rg后，再取值</span></span><br><span class="line"><span class="comment">         else if ((id_ir[15:11] == `LOAD) &amp;&amp; (i_datain[15:11]!=`JUMP) &amp;&amp; (i_datain[15:11]!=`NOP) &amp;&amp; (i_datain[15:11]!=`HALT) &amp;&amp; (i_datain[15:11]!=`LOAD))</span></span><br><span class="line"><span class="comment">         begin</span></span><br><span class="line"><span class="comment">            if ( (id_ir[10:8] == i_datain[2:0]) &amp;&amp; </span></span><br><span class="line"><span class="comment">                 ((i_datain[15:11]==`ADD) || (i_datain[15:11]==`ADDC) || (i_datain[15:11]==`SUB) || (i_datain[15:11]==`SUBC) || (i_datain[15:11]==`CMP) || </span></span><br><span class="line"><span class="comment">                  (i_datain[15:11]==`AND) || (i_datain[15:11]==`OR) || (i_datain[15:11]==`XOR)) )</span></span><br><span class="line"><span class="comment">            begin   pc &lt;= pc;   id_ir &lt;= 16&#x27;bXXXXXXXXXXXXXXXX;  end</span></span><br><span class="line"><span class="comment">            else if ( (id_ir[10:8] == i_datain[6:4]) &amp;&amp;</span></span><br><span class="line"><span class="comment">                     ((i_datain[15:11]==`STORE)|| </span></span><br><span class="line"><span class="comment">                     (i_datain[15:11]==`CMP)|| (i_datain[15:11]==`ADD) || (i_datain[15:11]==`ADDC) || (i_datain[15:11]==`SUB) || (i_datain[15:11]==`SUBC) ||</span></span><br><span class="line"><span class="comment">                     (i_datain[15:11]==`AND)|| (i_datain[15:11]==`OR) || (i_datain[15:11]==`XOR) ||</span></span><br><span class="line"><span class="comment">                     (i_datain[15:11]==`SLL)|| (i_datain[15:11]==`SRL) || (i_datain[15:11]==`SLA)|| (i_datain[15:11]==`SRA)) )</span></span><br><span class="line"><span class="comment">            begin   pc &lt;= pc;   id_ir &lt;= 16&#x27;bXXXXXXXXXXXXXXXX;  end</span></span><br><span class="line"><span class="comment">            else if ( (id_ir[10:8] == i_datain[10:8]) &amp;&amp; </span></span><br><span class="line"><span class="comment">                      ((i_datain[15:11]==`STORE) || </span></span><br><span class="line"><span class="comment">                      (i_datain[15:11]==`LDIH) || (i_datain[15:11]==`SUBI) || </span></span><br><span class="line"><span class="comment">                      (i_datain[15:11]==`JMPR) || (i_datain[15:11]==`BZ) || (i_datain[15:11]==`BNZ) || (i_datain[15:11]==`BN) || (i_datain[15:11]==`BNN) || (i_datain[15:11]==`BC) || (i_datain[15:11]==`BNC)))</span></span><br><span class="line"><span class="comment">            begin   pc &lt;= pc;   id_ir &lt;= 16&#x27;bXXXXXXXXXXXXXXXX;  end</span></span><br><span class="line"><span class="comment">            else    ;</span></span><br><span class="line"><span class="comment">         end</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         </span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------] </span></span><br><span class="line">         <span class="comment">//interrupt &amp; callback</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_INTERRUPT)  <span class="keyword">begin</span></span><br><span class="line">            pc &lt;= <span class="number">0</span>;                                         <span class="comment">//转到imem_interrupt,从0开始</span></span><br><span class="line">            <span class="keyword">if</span>(inter_flag == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                pc_interrupt &lt;= pc;                           <span class="comment">//记录中断前的pc值</span></span><br><span class="line">                inter_flag &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CALLBACK)  <span class="keyword">begin</span></span><br><span class="line">            pc &lt;= pc_interrupt;                                <span class="comment">//回到imem</span></span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">          <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            pc &lt;= pc + <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`idle)   <span class="comment">//pc停止</span></span><br><span class="line">        pc &lt;= pc;</span><br><span class="line">     <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ID Block (2nd Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         ex_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_A &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_B &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         smdr  &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         ex_ir &lt;= id_ir;   <span class="comment">//ir传递（id -&gt; ex）</span></span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">//The general register clearing operations LWC_CLEAR and LWC_CA are executed </span></span><br><span class="line">         <span class="comment">//directly in the ID stage, no need to wait until the WB</span></span><br><span class="line">         <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CA)   <span class="keyword">begin</span></span><br><span class="line">            gr[<span class="number">0</span>] = <span class="number">16&#x27;b0000000000000000</span>;   </span><br><span class="line">            gr[<span class="number">1</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">2</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">3</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">4</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">5</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">6</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">7</span>] = <span class="number">16&#x27;b0000000000000000</span>;           </span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CLEAR) <span class="keyword">begin</span>  <span class="comment">//clear: clear one data in rg[val3] 【CLEAR null null val3】</span></span><br><span class="line">            gr[id_ir[<span class="number">3</span>:<span class="number">0</span>]] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span>   ;</span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">/******************** </span></span><br><span class="line"><span class="comment">            reg_A 赋予：第一个操作数  ***************************************************************************************************************</span></span><br><span class="line"><span class="comment">         *********************/</span></span><br><span class="line">         <span class="comment">//↓[type:I]  r1  val2  val3 形 </span></span><br><span class="line">         <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">             (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) ||</span><br><span class="line">             (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC)) </span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">           <span class="comment">// hazard 避免</span></span><br><span class="line">                <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))   <span class="comment">//无目的寄存器(operand1 = null)</span></span><br><span class="line">                    reg_A &lt;= ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC)) ? </span><br><span class="line">                              gr[(id_ir[<span class="number">10</span>:<span class="number">8</span>])] : </span><br><span class="line">                              ALUo;</span><br><span class="line"><span class="comment">//reg_A &lt;= ALUo;</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))  </span><br><span class="line">                    reg_A &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))  </span><br><span class="line">                    reg_A &lt;= reg_C1;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    reg_A &lt;= gr[(id_ir[<span class="number">10</span>:<span class="number">8</span>])];   <span class="comment">//取出r1 #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">               </span><br><span class="line">          <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">//↓[type:R]  r1  r2  r3 形 </span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))</span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">           <span class="comment">// hazard 避免</span></span><br><span class="line">                <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= ALUo;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= reg_C1;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">                    reg_A &lt;= gr[(id_ir[<span class="number">6</span>:<span class="number">4</span>])];   <span class="comment">//取出r2 #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>)) ||  </span><br><span class="line">                  ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>))|| ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>))||  </span><br><span class="line">                  ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>))||   </span><br><span class="line">                    mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR)  </span><br><span class="line">            reg_A &lt;= <span class="number">16&#x27;b0000_0000_0000_0000</span>;  </span><br><span class="line">         <span class="keyword">else</span>   ; </span><br><span class="line">        </span><br><span class="line">         <span class="comment">/********************* </span></span><br><span class="line"><span class="comment">            reg_B赋予：第二个操作数***************************************************************************************************************</span></span><br><span class="line"><span class="comment">         ******************** */</span></span><br><span class="line">         <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD)</span><br><span class="line">             reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;   <span class="comment">//r1,r2,val3形：只取val3,需要在前面补12位0 ###########</span></span><br><span class="line">             </span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE)</span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">   reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;   <span class="comment">//r1,r2,val3形：只取val3,需要在前面补12位0 ###########</span></span><br><span class="line">   <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">   <span class="comment">//smdr的赋值也需要：hazard 避免</span></span><br><span class="line">   <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">smdr &lt;= ALUo;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">smdr &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">smdr &lt;= reg_C1;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">smdr  &lt;= gr[id_ir[<span class="number">10</span>:<span class="number">8</span>]];   <span class="comment">//STORE #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA))</span><br><span class="line"> reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;   <span class="comment">//r1,r2,val3形：只取val3,需要在前面补12位0 ###########</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC))              </span><br><span class="line">             reg_B &lt;= &#123;<span class="number">8&#x27;b00000000</span>, id_ir[<span class="number">7</span>:<span class="number">0</span>]&#125;;     <span class="comment">// r1 val2 val3, 取出&#123;val2,val3&#125;的组合,需要在前面补8位0 ###########</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH))   </span><br><span class="line"> reg_B &lt;= &#123;id_ir[<span class="number">7</span>:<span class="number">0</span>], <span class="number">8&#x27;b00000000</span>&#125;;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))   </span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">               <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">               <span class="comment">// hazard 避免</span></span><br><span class="line">               <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= ALUo;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= reg_C1;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// r1 r2 r3，取出r3； #############</span></span><br><span class="line">                    reg_B &lt;= gr[id_ir[<span class="number">2</span>:<span class="number">0</span>]];   </span><br><span class="line">               <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>))||  </span><br><span class="line">      ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>))||  </span><br><span class="line">      ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>))||   </span><br><span class="line">    mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR)  </span><br><span class="line">            reg_B &lt;= <span class="number">16&#x27;b0000_0000_0000_0000</span>;  </span><br><span class="line">         <span class="keyword">else</span>   ;</span><br><span class="line">         </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// EX Block (3rd Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         mem_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_C &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         smdr1 &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         zf &lt;= <span class="number">1&#x27;b0</span> ; </span><br><span class="line">         nf &lt;= <span class="number">1&#x27;b0</span> ; </span><br><span class="line">         dw &lt;= <span class="number">1&#x27;b0</span> ;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         mem_ir &lt;= ex_ir;</span><br><span class="line">         reg_C  &lt;= ALUo;    <span class="comment">//reg_C转存ALUo运算结果</span></span><br><span class="line"> smdr1 &lt;= smdr;</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//flag更新</span></span><br><span class="line">         <span class="keyword">if</span> ((ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">             (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC))  <span class="comment">// || (ex_ir[15:11] == `AND) || (ex_ir[15:11] == `OR) || (ex_ir[15:11] == `XOR) || (ex_ir[15:11] == `SLL) || (ex_ir[15:11] == `SRL) || (ex_ir[15:11] == `SLA) || (ex_ir[15:11] == `SRA)</span></span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">             <span class="keyword">if</span> (ALUo == <span class="number">16&#x27;b0000000000000000</span>)</span><br><span class="line">                zf &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                zf &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">             <span class="keyword">if</span> (ALUo [<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">                nf &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                nf &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">zf &lt;= zf;</span><br><span class="line">nf &lt;= nf;</span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              dw &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">              <span class="comment">//smdr1 &lt;= smdr;</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            dw &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// MEM Block (4th Stege)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         wb_ir  &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_C1 &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state == `interrupt)</span><br><span class="line">       <span class="keyword">begin</span>     </span><br><span class="line">         wb_ir  &lt;= mem_ir;</span><br><span class="line">         <span class="keyword">if</span> (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD)</span><br><span class="line">            <span class="comment">//**** `LOAD回路：从dmem取得的数据在d_datain中，先给到reg_C1,然后转存到cpu内部存储gr。程序运行其他操作时，时再从gr取数据。</span></span><br><span class="line">            <span class="comment">//其实reg_C一直作为dmem的地址索引，但只有LOAD指令时，cpu才会从dmem中取出数据存入regC_1；其余时候reg_C1转存运算结果reg_C。</span></span><br><span class="line">            reg_C1 &lt;= d_datain;      </span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">            reg_C1 &lt;= reg_C;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WB Block (5th Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         gr[<span class="number">0</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">1</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">2</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">3</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">4</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">5</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">6</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">7</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span> (wb_ir[<span class="number">10</span>:<span class="number">8</span>] != <span class="number">3&#x27;b000</span>)</span><br><span class="line">            <span class="keyword">if</span> ((wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))</span><br><span class="line">                    gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]] &lt;= reg_C1;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]] &lt;= gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]];  </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ALU module</span></span><br><span class="line"><span class="keyword">always</span> @(reg_A <span class="keyword">or</span> reg_B <span class="keyword">or</span> ex_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">    <span class="keyword">case</span> (ex_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">     `LOAD   : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `STORE  : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `ADD    : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     `CMP    : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `BZ     : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BN     : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">     <span class="comment">// Basic operations</span></span><br><span class="line">     `ADDC   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B + cf;</span><br><span class="line">     `SUB    : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `SUBC   : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B - cf;</span><br><span class="line">     `ADDI   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     `SUBI   : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `LDIH   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">// Logical/Shift operations</span></span><br><span class="line">     `AND    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &amp; reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `OR     :  <span class="keyword">begin</span>   ALUo &lt;= reg_A | reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `XOR    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A ^ reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `SLL    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>];  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span>  </span><br><span class="line">     `SRL    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>];  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line"> <span class="comment">//[注]老版本iverilog编译器不认识&gt;&gt;&gt;和&lt;&lt;&lt;运算符，必须手动实现算数左右移。 2025.2.7</span></span><br><span class="line">     <span class="comment">//`SLA    :  begin  ALUo &lt;= reg_A &lt;&lt;&lt; reg_B[3:0];  cf &lt;= 1&#x27;b0;  end</span></span><br><span class="line">     <span class="comment">//`SRA    :  begin   ALUo &lt;= reg_A &gt;&gt;&gt; reg_B[3:0];  cf &lt;= 1&#x27;b0;  end</span></span><br><span class="line"> `SLA    :  <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;h8000</span> | (reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);  <span class="comment">//8000 = 1000_0000_0000_0000 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b0</span>)</span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;h7FFF</span> &amp; (reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);  <span class="comment">//7FFF = 0111_1111_1111_1111</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;bx</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> `SRA   :   <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">ALUo &lt;= (&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b1</span>&#125;&#125; &lt;&lt; (<span class="number">16</span> - reg_B[<span class="number">3</span>:<span class="number">0</span>])) | (reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);   <span class="comment">//(&#123;16&#123;1&#x27;b1&#125;&#125; &lt;&lt; (16 - reg_B[3:0]))生成高位全1的掩码</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b0</span>)</span><br><span class="line">ALUo &lt;= reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;bx</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">     `LWC_ENCRYPT:  ALUo &lt;= &#123;reg_A[<span class="number">15</span>:<span class="number">8</span>]^reg_B[<span class="number">7</span>:<span class="number">0</span>], reg_A[<span class="number">7</span>:<span class="number">4</span>]^reg_B[<span class="number">11</span>:<span class="number">8</span>], reg_A[<span class="number">3</span>:<span class="number">0</span>]^reg_B[<span class="number">15</span>:<span class="number">12</span>]&#125;;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Control operations</span></span><br><span class="line">     `JMPR   :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNZ    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNN    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BC     :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNC    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">     <span class="keyword">default</span> : <span class="keyword">begin</span></span><br><span class="line">            ALUo &lt;= ALUo;</span><br><span class="line">            cf &lt;= cf;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Debug</span></span><br><span class="line"><span class="keyword">always</span> @(select_y <span class="keyword">or</span> gr[<span class="number">1</span>] <span class="keyword">or</span> gr[<span class="number">2</span>] <span class="keyword">or</span> gr[<span class="number">3</span>] <span class="keyword">or</span> gr[<span class="number">4</span>] <span class="keyword">or</span> gr[<span class="number">5</span>] <span class="keyword">or</span> gr[<span class="number">6</span>]</span><br><span class="line">         <span class="keyword">or</span> gr[<span class="number">7</span>] <span class="keyword">or</span> reg_A <span class="keyword">or</span> reg_B <span class="keyword">or</span> reg_C <span class="keyword">or</span> reg_C1 <span class="keyword">or</span> smdr <span class="keyword">or</span> id_ir</span><br><span class="line">         <span class="keyword">or</span> dw <span class="keyword">or</span> zf <span class="keyword">or</span> nf <span class="keyword">or</span> pc)</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">case</span> (select_y)</span><br><span class="line">       <span class="number">4&#x27;b0000</span> : y = &#123;<span class="number">3&#x27;b000</span>, dw, <span class="number">2&#x27;b00</span>, zf, nf, pc&#125;;</span><br><span class="line">       <span class="number">4&#x27;b0001</span> : y = gr[<span class="number">1</span>];</span><br><span class="line">       <span class="number">4&#x27;b0010</span> : y = gr[<span class="number">2</span>];</span><br><span class="line">       <span class="number">4&#x27;b0011</span> : y = gr[<span class="number">3</span>];</span><br><span class="line">       <span class="number">4&#x27;b0100</span> : y = gr[<span class="number">4</span>];</span><br><span class="line">       <span class="number">4&#x27;b0101</span> : y = gr[<span class="number">5</span>];</span><br><span class="line">       <span class="number">4&#x27;b0110</span> : y = gr[<span class="number">6</span>];</span><br><span class="line">       <span class="number">4&#x27;b0111</span> : y = gr[<span class="number">7</span>];</span><br><span class="line">       <span class="number">4&#x27;b1000</span> : y = reg_A;</span><br><span class="line">       <span class="number">4&#x27;b1001</span> : y = reg_B;</span><br><span class="line">       <span class="number">4&#x27;b1011</span> : y = reg_C;</span><br><span class="line">       <span class="number">4&#x27;b1100</span> : y = reg_C1;</span><br><span class="line">       <span class="number">4&#x27;b1101</span> : y = smdr;</span><br><span class="line">       <span class="number">4&#x27;b1110</span> : y = id_ir;</span><br><span class="line">       <span class="keyword">default</span> : y = <span class="number">16&#x27;bXXXXXXXXXXXXXXXX</span> ;</span><br><span class="line">     <span class="keyword">endcase</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><hr><h2 id="代码（创新版：可以实现中断和回调）"><a href="#代码（创新版：可以实现中断和回调）" class="headerlink" title="代码（创新版：可以实现中断和回调）"></a>代码（创新版：可以实现中断和回调）</h2><p>中断和回调的实现方法在报告中已经详细说明，这里直接粘贴报告中的文字描述和图片进行解释。</p><img src="https://s2.loli.net/2025/02/08/RBPqUnTdNI4Mzbj.png"><img src="https://s2.loli.net/2025/02/08/Vxslntjry7BGapz.png"><img src="https://s2.loli.net/2025/02/08/K8flRSgxsWIuwNG.png"><img src="https://s2.loli.net/2025/02/08/LbjfucnRyEiJwZ4.png"><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">define</span> NOP   5&#x27;b00000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> HALT  5&#x27;b00001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LOAD  5&#x27;b00010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> STORE 5&#x27;b00011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADD   5&#x27;b01000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CMP   5&#x27;b01100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BZ    5&#x27;b11010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BN    5&#x27;b11100</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="comment">// Basic operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUB   5&#x27;b01010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUBC  5&#x27;b10010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADDC  5&#x27;b10001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ADDI  5&#x27;b01001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SUBI  5&#x27;b01011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LDIH  5&#x27;b10000</span></span><br><span class="line"><span class="comment">// Logical/Shift operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AND   5&#x27;b01101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> OR    5&#x27;b01110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> XOR   5&#x27;b01111</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SLL   5&#x27;b00100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SRL   5&#x27;b00101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SLA   5&#x27;b00110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SRA   5&#x27;b00111</span></span><br><span class="line"><span class="comment">// Control operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> JUMP  5&#x27;b11000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> JMPR  5&#x27;b11001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNZ   5&#x27;b11011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNN   5&#x27;b11101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BC    5&#x27;b11110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BNC   5&#x27;b11111 </span></span><br><span class="line"><span class="comment">//** LWC original operations</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CLEAR       5&#x27;b10011   </span><span class="comment">//clear: clear one data in rg[val3] 【CLEAR null null val3】</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CA          5&#x27;b10100   </span><span class="comment">//CA: celete all data in rg  【no op1op2op3, like NOP &amp; HALT】</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_ENCRYPT     5&#x27;b10101   </span><span class="comment">//encrypt: 数据加密  【LWC_ENCRYPT r1 r2 r3】  秘钥：r3; 源码：r2；加密结果存放在r1，秘钥存放在r1+1.</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_INTERRUPT   5&#x27;b10110   </span><span class="comment">//Interrupt: 中断 (Control operation)  </span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LWC_CALLBACK    5&#x27;b10111   </span><span class="comment">//CallBack: 中断回调</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FSM for CPU controler</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> idle 2&#x27;b00</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> exec 2&#x27;b01</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> interrupt 2&#x27;b10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> pcpu (reset, clock, enable, start, i_addr, i_datain, i_datain_interrupt, d_addr,</span><br><span class="line">             d_datain, d_dataout, d_we, select_y, y);</span><br><span class="line"></span><br><span class="line"><span class="keyword">input</span> reset, clock, enable, start;   <span class="comment">//由顶层于外部连接，由外部(仿真时)控制</span></span><br><span class="line"><span class="keyword">input</span>  [<span class="number">15</span>:<span class="number">0</span>] i_datain;</span><br><span class="line"><span class="keyword">input</span>  [<span class="number">15</span>:<span class="number">0</span>] i_datain_interrupt;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]  i_addr;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]  d_addr;</span><br><span class="line"><span class="keyword">input</span>  [<span class="number">15</span>:<span class="number">0</span>] d_datain;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] d_dataout;</span><br><span class="line"><span class="keyword">output</span> d_we;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for Debug ------------ 只是用y看一下内部各个线上的数据</span></span><br><span class="line"><span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] select_y;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] y; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Definition of F/Fs</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>]  pc ;                              <span class="comment">//pc:  取指令的指针，指向imem内下一条要执行的指令。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] id_ir, ex_ir, mem_ir, wb_ir;      <span class="comment">//xx_ir: 指令链，不同阶段对指令instruction进行流水线式的存储。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] gr [<span class="number">0</span>:<span class="number">7</span>];                         <span class="comment">//gr: General Register。它是CPU内部的存储器(寄存器堆)。</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] reg_A, reg_B, reg_C, reg_C1;      <span class="comment">//reg_X: 数据寄存器，用于CPU内部运算数据的暂存。 [reg_A,reg_B] --&gt; ALU --&gt; [reg_C]</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] smdr, smdr1;                      <span class="comment">//smdr: 直接存储数据</span></span><br><span class="line"><span class="keyword">reg</span> zf, nf, dw;       <span class="comment">//flags:  zf(zero flag);  nf(negative flag);  dw(data write):与d_we相连，是CPU-&gt;dmem写使能。</span></span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="keyword">reg</span> cf;                  <span class="comment">//carry flag: 进位信号</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">7</span>:<span class="number">0</span>] pc_interrupt;   <span class="comment">//记录中断前的pc值，中断回调后pc置为 pc_interrupt+1</span></span><br><span class="line"><span class="keyword">reg</span> inter_flag;</span><br><span class="line"><span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Definition of temporary variables</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] ALUo;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] y;</span><br><span class="line"><span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] next_state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> i_addr = pc;  <span class="comment">//pc给到i_addr，i_addr输出到imem，取出一条指令</span></span><br><span class="line"><span class="keyword">assign</span> d_we  = dw;</span><br><span class="line"><span class="keyword">assign</span> d_addr = reg_C[<span class="number">7</span>:<span class="number">0</span>];   <span class="comment">//从dmem中取data的地址，地址始终存在reg_C中</span></span><br><span class="line"><span class="keyword">assign</span> d_dataout = smdr1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CPU Control (FSM)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> (!reset)</span><br><span class="line">         state &lt;= `idle;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(state <span class="keyword">or</span> enable <span class="keyword">or</span> start <span class="keyword">or</span> wb_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">case</span> (state)</span><br><span class="line">        `idle : <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b1</span>) &amp;&amp; (start == <span class="number">1&#x27;b1</span>))</span><br><span class="line">                   next_state &lt;= `exec;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                   next_state &lt;= `idle;</span><br><span class="line">        `exec : <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b0</span>) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `HALT))</span><br><span class="line">                   next_state &lt;= `idle;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((enable == <span class="number">1&#x27;b0</span>) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_INTERRUPT))</span><br><span class="line">                   next_state &lt;= `interrupt;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                   next_state &lt;= `exec;</span><br><span class="line">         `interrupt: <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CALLBACK)</span><br><span class="line">                        next_state &lt;= `exec;</span><br><span class="line">                     <span class="keyword">else</span></span><br><span class="line">                        next_state &lt;= `interrupt;</span><br><span class="line">      <span class="keyword">endcase</span></span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// IF Block (1st Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         id_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         pc    &lt;= <span class="number">8&#x27;b00000000</span>;</span><br><span class="line">         pc_interrupt &lt;= <span class="number">8&#x27;b00000000</span>;</span><br><span class="line">         inter_flag &lt;= <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="comment">// id_ir &lt;= i_datain;     //从imem取指令</span></span><br><span class="line">         id_ir &lt;= (state == `interrupt) ? i_datain_interrupt : i_datain;</span><br><span class="line">        <span class="comment">//主要任务：pc指针控制</span></span><br><span class="line">         <span class="keyword">if</span> ( ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>)) ||</span><br><span class="line">              (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) ||</span><br><span class="line">              ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>)) )      </span><br><span class="line">            <span class="comment">//特殊指令跳转： jump to reg_C[7:0]，跳转到ALU运算出来的指令地址。</span></span><br><span class="line">            pc &lt;= reg_C[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JUMP)    </span><br><span class="line">            <span class="comment">//JUMP指令跳转: jump to &#123;val2,val3&#125;, 中括号的意思是[7:4]与[3:0]组合为[7:0]</span></span><br><span class="line">            pc &lt;= id_ir[<span class="number">7</span>:<span class="number">0</span>];          </span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------] </span></span><br><span class="line">         <span class="comment">//interrupt &amp; callback</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_INTERRUPT)  <span class="keyword">begin</span></span><br><span class="line">            pc &lt;= <span class="number">0</span>;                                         <span class="comment">//转到imem_interrupt,从0开始</span></span><br><span class="line">            <span class="keyword">if</span>(inter_flag == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                pc_interrupt &lt;= pc;                           <span class="comment">//记录中断前的pc值</span></span><br><span class="line">                inter_flag &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CALLBACK)  <span class="keyword">begin</span></span><br><span class="line">            pc &lt;= pc_interrupt;                                <span class="comment">//回到imem</span></span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">          <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            pc &lt;= pc + <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`idle)   <span class="comment">//pc停止</span></span><br><span class="line">        pc &lt;= pc;</span><br><span class="line">     <span class="keyword">else</span> ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// ID Block (2nd Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         ex_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_A &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_B &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         smdr  &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">         ex_ir &lt;= id_ir;   <span class="comment">//ir传递（id -&gt; ex）</span></span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">//The general register clearing operations LWC_CLEAR and LWC_CA are executed </span></span><br><span class="line">         <span class="comment">//directly in the ID stage, no need to wait until the WB</span></span><br><span class="line">         <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CA)   <span class="keyword">begin</span></span><br><span class="line">            gr[<span class="number">0</span>] = <span class="number">16&#x27;b0000000000000000</span>;   </span><br><span class="line">            gr[<span class="number">1</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">2</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">3</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">4</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">5</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">6</span>] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">            gr[<span class="number">7</span>] = <span class="number">16&#x27;b0000000000000000</span>;           </span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_CLEAR) <span class="keyword">begin</span>  <span class="comment">//clear: clear one data in rg[val3] 【CLEAR null null val3】</span></span><br><span class="line">            gr[id_ir[<span class="number">3</span>:<span class="number">0</span>]] = <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span>   ;</span><br><span class="line">         <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">/******************** </span></span><br><span class="line"><span class="comment">            reg_A 赋予：第一个操作数  ***************************************************************************************************************</span></span><br><span class="line"><span class="comment">         *********************/</span></span><br><span class="line">         <span class="comment">//↓[type:I]  r1  val2  val3 形 </span></span><br><span class="line">         <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">             (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) ||</span><br><span class="line">             (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC)) </span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">           <span class="comment">// hazard 避免</span></span><br><span class="line">                <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))   <span class="comment">//无目的寄存器(operand1 = null)</span></span><br><span class="line">                    reg_A &lt;= ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC)) ? </span><br><span class="line">                              gr[(id_ir[<span class="number">10</span>:<span class="number">8</span>])]: </span><br><span class="line">                              ALUo;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))  </span><br><span class="line">                    reg_A &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))  </span><br><span class="line">                    reg_A &lt;= reg_C1;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    reg_A &lt;= gr[(id_ir[<span class="number">10</span>:<span class="number">8</span>])];   <span class="comment">//取出r1 #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">               </span><br><span class="line">          <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">         <span class="comment">//↓[type:R]  r1  r2  r3 形 </span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))</span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">           <span class="comment">// hazard 避免</span></span><br><span class="line">                <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= ALUo;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">6</span>:<span class="number">4</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_A &lt;= reg_C1;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">                    reg_A &lt;= gr[(id_ir[<span class="number">6</span>:<span class="number">4</span>])];   <span class="comment">//取出r2 #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>)) ||  </span><br><span class="line">                  ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>))|| ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>))||  </span><br><span class="line">                  ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>))||   </span><br><span class="line">                    mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR)  </span><br><span class="line">            reg_A &lt;= <span class="number">16&#x27;b0000_0000_0000_0000</span>;  </span><br><span class="line">         <span class="keyword">else</span>   ; </span><br><span class="line">        </span><br><span class="line">         <span class="comment">/********************* </span></span><br><span class="line"><span class="comment">            reg_B赋予：第二个操作数***************************************************************************************************************</span></span><br><span class="line"><span class="comment">         ******************** */</span></span><br><span class="line">         <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD)</span><br><span class="line">             reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;   <span class="comment">//val3 #############</span></span><br><span class="line">             </span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE)</span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">             reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;  </span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">           <span class="comment">//smdr的赋值也需要：hazard 避免</span></span><br><span class="line">           <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                smdr &lt;= ALUo;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                smdr &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">10</span>:<span class="number">8</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                smdr &lt;= reg_C1;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">                smdr  &lt;= gr[id_ir[<span class="number">10</span>:<span class="number">8</span>]];   <span class="comment">//STORE #############</span></span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA))</span><br><span class="line"> reg_B &lt;= &#123;<span class="number">12&#x27;b000000000000</span>, id_ir[<span class="number">3</span>:<span class="number">0</span>]&#125;;   <span class="comment">//r1,r2,val3形：只取val3,需要在前面补12位0 ###########  </span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) ||</span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC))   </span><br><span class="line">             reg_B &lt;= &#123;<span class="number">8&#x27;b00000000</span>, id_ir[<span class="number">7</span>:<span class="number">0</span>]&#125;;   <span class="comment">// r1 val2 val3, 取出&#123;val2,val3&#125;的组合,需要在前面补8位0 ###########</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH)</span><br><span class="line">             reg_B &lt;= &#123;id_ir[<span class="number">7</span>:<span class="number">0</span>], <span class="number">8&#x27;b00000000</span>&#125;;   <span class="comment">//LDIH较为特殊，取出&#123;val2,val3&#125;的组合后，在后面补8个0 ###########</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || </span><br><span class="line">                  (id_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))   </span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">               <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">               <span class="comment">// hazard 避免</span></span><br><span class="line">               <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == ex_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`LOAD) &amp;&amp; (ex_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= ALUo;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == mem_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (mem_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ? d_datain : reg_C;</span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> ((id_ir[<span class="number">2</span>:<span class="number">0</span>] == wb_ir[<span class="number">10</span>:<span class="number">8</span>]) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`NOP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`CMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`JUMP) &amp;&amp; (wb_ir[<span class="number">15</span>:<span class="number">11</span>]!=`HALT))</span><br><span class="line">                    reg_B &lt;= reg_C1;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// r1 r2 r3，取出r3； #############</span></span><br><span class="line">                    reg_B &lt;= gr[id_ir[<span class="number">2</span>:<span class="number">0</span>]];   </span><br><span class="line">               <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BZ) &amp;&amp; (zf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BN) &amp;&amp; (nf == <span class="number">1&#x27;b1</span>))||  </span><br><span class="line">      ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNZ) &amp;&amp; (zf == <span class="number">1&#x27;b0</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNN) &amp;&amp; (nf == <span class="number">1&#x27;b0</span>))||  </span><br><span class="line">      ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BC) &amp;&amp; (cf == <span class="number">1&#x27;b1</span>)) || ((mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `BNC) &amp;&amp; (cf == <span class="number">1&#x27;b0</span>))||   </span><br><span class="line">    mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `JMPR)  </span><br><span class="line">            reg_B &lt;= <span class="number">16&#x27;b0000_0000_0000_0000</span>;  </span><br><span class="line">         <span class="keyword">else</span>   ;</span><br><span class="line">         </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// EX Block (3rd Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         mem_ir &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_C &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         smdr1 &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         zf &lt;= <span class="number">1&#x27;b0</span> ; </span><br><span class="line">         nf &lt;= <span class="number">1&#x27;b0</span> ; </span><br><span class="line">         dw &lt;= <span class="number">1&#x27;b0</span> ;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         mem_ir &lt;= ex_ir;</span><br><span class="line">         reg_C  &lt;= ALUo;    <span class="comment">//reg_C转存ALUo运算结果</span></span><br><span class="line">         smdr1 &lt;= smdr;</span><br><span class="line">         <span class="comment">//flag更新</span></span><br><span class="line">         <span class="keyword">if</span> ((ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">             (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">             (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA))</span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">             <span class="keyword">if</span> (ALUo == <span class="number">16&#x27;b0000000000000000</span>)</span><br><span class="line">                zf &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                zf &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">             <span class="keyword">if</span> (ALUo [<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">                nf &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                nf &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (ex_ir[<span class="number">15</span>:<span class="number">11</span>] == `STORE)</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              dw &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">              <span class="comment">//smdr1 &lt;= smdr;</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            dw &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// MEM Block (4th Stege)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         wb_ir  &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         reg_C1 &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state == `interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         wb_ir  &lt;= mem_ir;</span><br><span class="line">         <span class="keyword">if</span> (mem_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD)</span><br><span class="line">            <span class="comment">//**** `LOAD回路：从dmem取得的数据在d_datain中，先给到reg_C1,然后转存到cpu内部存储gr。程序运行其他操作时，时再从gr取数据。</span></span><br><span class="line">            <span class="comment">//其实reg_C一直作为dmem的地址索引，但只有LOAD指令时，cpu才会从dmem中取出数据存入regC_1；其余时候reg_C1转存运算结果reg_C。</span></span><br><span class="line">            reg_C1 &lt;= d_datain;      </span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">            reg_C1 &lt;= reg_C;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// WB Block (5th Stage)</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clock <span class="keyword">or</span> <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (!reset)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         gr[<span class="number">0</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">1</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">2</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">3</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">4</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">5</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">6</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">         gr[<span class="number">7</span>] &lt;= <span class="number">16&#x27;b0000000000000000</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span>(state==`exec||state==`interrupt)</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span> (wb_ir[<span class="number">10</span>:<span class="number">8</span>] != <span class="number">3&#x27;b000</span>)</span><br><span class="line">            <span class="keyword">if</span> ((wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LOAD) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDI) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBI) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LDIH) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADD) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `CMP) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `ADDC) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUB) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SUBC) || </span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `AND) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `OR) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `XOR) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLL) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRL) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SLA) || (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `SRA) ||</span><br><span class="line">                (wb_ir[<span class="number">15</span>:<span class="number">11</span>] == `LWC_ENCRYPT))</span><br><span class="line">                    gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]] &lt;= reg_C1;</span><br><span class="line">            <span class="keyword">else</span>  </span><br><span class="line">gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]] &lt;= gr[wb_ir[<span class="number">10</span>:<span class="number">8</span>]];  </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ALU module</span></span><br><span class="line"><span class="keyword">always</span> @(reg_A <span class="keyword">or</span> reg_B <span class="keyword">or</span> ex_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">    <span class="keyword">case</span> (ex_ir[<span class="number">15</span>:<span class="number">11</span>])</span><br><span class="line">     `LOAD   : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `STORE  : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `ADD    : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     `CMP    : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `BZ     : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BN     : ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">     <span class="comment">// Basic operations</span></span><br><span class="line">     `ADDC   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B + cf;</span><br><span class="line">     `SUB    : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `SUBC   : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B - cf;</span><br><span class="line">     `ADDI   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     `SUBI   : &#123;cf,ALUo&#125; &lt;= reg_A - reg_B;</span><br><span class="line">     `LDIH   : &#123;cf,ALUo&#125; &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">// Logical/Shift operations</span></span><br><span class="line">     `AND    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &amp; reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `OR     :  <span class="keyword">begin</span>   ALUo &lt;= reg_A | reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `XOR    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A ^ reg_B;  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `SLL    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>];  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span>  <span class="comment">//reg_B[3:0]存放的是val3，也就是ir[3:0]</span></span><br><span class="line">     `SRL    :  <span class="keyword">begin</span>   ALUo &lt;= reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>];  cf &lt;= <span class="number">1&#x27;b0</span>;     <span class="keyword">end</span></span><br><span class="line">     `SLA    :  <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;h8000</span> | (reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);  <span class="comment">//8000 = 1000_0000_0000_0000 </span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b0</span>)</span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;h7FFF</span> &amp; (reg_A &lt;&lt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);  <span class="comment">//7FFF = 0111_1111_1111_1111</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;bx</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> `SRA   :   <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b1</span>)</span><br><span class="line">ALUo &lt;= (&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b1</span>&#125;&#125; &lt;&lt; (<span class="number">16</span> - reg_B[<span class="number">3</span>:<span class="number">0</span>])) | (reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>]);   <span class="comment">//(&#123;16&#123;1&#x27;b1&#125;&#125; &lt;&lt; (16 - reg_B[3:0]))生成高位全1的掩码</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(reg_A[<span class="number">15</span>] == <span class="number">1&#x27;b0</span>)</span><br><span class="line">ALUo &lt;= reg_A &gt;&gt; reg_B[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">ALUo &lt;= <span class="number">16&#x27;bx</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">     `LWC_ENCRYPT:  ALUo &lt;= &#123;reg_A[<span class="number">15</span>:<span class="number">8</span>]^reg_B[<span class="number">7</span>:<span class="number">0</span>], reg_A[<span class="number">7</span>:<span class="number">4</span>]^reg_B[<span class="number">11</span>:<span class="number">8</span>], reg_A[<span class="number">3</span>:<span class="number">0</span>]^reg_B[<span class="number">15</span>:<span class="number">12</span>]&#125;;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">// Control operations</span></span><br><span class="line">     `JMPR   :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNZ    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNN    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BC     :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     `BNC    :  ALUo &lt;= reg_A + reg_B;</span><br><span class="line">     <span class="comment">//[------------- LUWEICHENG -------------]</span></span><br><span class="line">     <span class="keyword">default</span> : <span class="keyword">begin</span></span><br><span class="line">            ALUo &lt;= ALUo;</span><br><span class="line">            cf &lt;= cf;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Debug</span></span><br><span class="line"><span class="keyword">always</span> @(select_y <span class="keyword">or</span> gr[<span class="number">1</span>] <span class="keyword">or</span> gr[<span class="number">2</span>] <span class="keyword">or</span> gr[<span class="number">3</span>] <span class="keyword">or</span> gr[<span class="number">4</span>] <span class="keyword">or</span> gr[<span class="number">5</span>] <span class="keyword">or</span> gr[<span class="number">6</span>]</span><br><span class="line">         <span class="keyword">or</span> gr[<span class="number">7</span>] <span class="keyword">or</span> reg_A <span class="keyword">or</span> reg_B <span class="keyword">or</span> reg_C <span class="keyword">or</span> reg_C1 <span class="keyword">or</span> smdr <span class="keyword">or</span> id_ir</span><br><span class="line">         <span class="keyword">or</span> dw <span class="keyword">or</span> zf <span class="keyword">or</span> nf <span class="keyword">or</span> pc)</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">case</span> (select_y)</span><br><span class="line">       <span class="number">4&#x27;b0000</span> : y = &#123;<span class="number">3&#x27;b000</span>, dw, <span class="number">2&#x27;b00</span>, zf, nf, pc&#125;;</span><br><span class="line">       <span class="number">4&#x27;b0001</span> : y = gr[<span class="number">1</span>];</span><br><span class="line">       <span class="number">4&#x27;b0010</span> : y = gr[<span class="number">2</span>];</span><br><span class="line">       <span class="number">4&#x27;b0011</span> : y = gr[<span class="number">3</span>];</span><br><span class="line">       <span class="number">4&#x27;b0100</span> : y = gr[<span class="number">4</span>];</span><br><span class="line">       <span class="number">4&#x27;b0101</span> : y = gr[<span class="number">5</span>];</span><br><span class="line">       <span class="number">4&#x27;b0110</span> : y = gr[<span class="number">6</span>];</span><br><span class="line">       <span class="number">4&#x27;b0111</span> : y = gr[<span class="number">7</span>];</span><br><span class="line">       <span class="number">4&#x27;b1000</span> : y = reg_A;</span><br><span class="line">       <span class="number">4&#x27;b1001</span> : y = reg_B;</span><br><span class="line">       <span class="number">4&#x27;b1011</span> : y = reg_C;</span><br><span class="line">       <span class="number">4&#x27;b1100</span> : y = reg_C1;</span><br><span class="line">       <span class="number">4&#x27;b1101</span> : y = smdr;</span><br><span class="line">       <span class="number">4&#x27;b1110</span> : y = id_ir;</span><br><span class="line">       <span class="keyword">default</span> : y = <span class="number">16&#x27;bXXXXXXXXXXXXXXXX</span> ;</span><br><span class="line">     <span class="keyword">endcase</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Course Assignment </category>
          
          <category> System LSI Design </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Verilog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>四国跨年之旅：2024.12.27~2025.1.3</title>
      <link href="/2025/01/03/2025travel/"/>
      <url>/2025/01/03/2025travel/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2024-2025是我来日本留学后的第一个新年(跨年)，正好这会儿学校放冬假，我便计划想去哪里玩一下。一开始本来打算和实验室的其他几位同学去东京跨年，但是我们酒店订太晚了，东京12.31-1.1的跨年夜酒店最便宜的一晚上都要一千五六百RMB,实在是无法接受，于是大家就散了<del>他们去长崎看芙莉莲了</del>……后来舍友曹桑提议去宫岛上玩儿，说是学姐推荐，但找了半天也不知道在哪儿，后来也不知道什么原因我突然说可以去“四国”看看，后来就这么拍定了。</p><img src="https://s2.loli.net/2025/01/03/GVco2yPNCpMe3Dd.png"/><hr><h2 id="启程：新門司-→-徳島-東九フェーリ"><a href="#启程：新門司-→-徳島-東九フェーリ" class="headerlink" title="启程：新門司 → 徳島 (東九フェーリ)"></a>启程：新門司 → 徳島 (東九フェーリ)</h2><p>我和舍友两人一人各背一个双肩包，轻装上阵，12.27从宿舍出发一路赶到北九州市的最北边“新门司港”，乘坐轮渡前往四国，12.28计划到达四国最东边城市“德岛市”。</p><p>门司港是连通九州和中国地区的繁忙港口，而我们要去的新门司港则是稍靠东南方向的一个港口，主要通行九州到四国、东京和北海道的船。当我们坐了一路电车到达新门司港后，发现这里的风景还算不错。</p><img src="https://s2.loli.net/2025/01/03/7EmhlWr5q2TpOPi.jpg" width="600" height="350"/><p>我们乘坐的轮渡虽然叫“東九フェーリ”，但其实是北九州-德岛-东京三个港口之间的航线，因此会在德岛的港口停靠。这样，我们12.28日就能从德岛出发，沿着“土赞线”一路西行，然后北上前往高松市和再北边的几个岛屿（丰岛、直岛和小豆岛）。我们本来还打算从小仓乘坐轮渡前往四国西边的松山市，因为松山离北九州更近一些，这样的话我们可以从松山出发一路北上游玩整个四国北部，但可惜的是年前的二等和一等席全都满席了……我们还考虑过坐新干线，但坐JR并不比轮渡便宜，而且坐电车已经做腻了，坐轮船对于我们而言还是个全新的体验。因此，最后我们还是选择了東九フェーリ。</p><img src="https://s2.loli.net/2025/01/03/y83kT2wWUhCmtYP.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/03/e8L1yaZ2cdsN3QR.jpg" width="600" height="350"/><p>事实证明，我们的选择是正确的，東九フェーリ给我们乘坐的体验相当好。我们订的房间是8人间二等洋式，但因为人少所以我和舍友直接包场！船在航行的过程中能感受到发动机连同整个船体在震动，而且能感受到船的左右晃动，但不影响基本的吃饭和睡觉。東九フェーリ甚至还配备了一个温泉，泡澡的同时可以通过舷窗欣赏海景（虽然晚上看不到什么只能看到远处陆地上的灯光orz）。</p><img src="https://s2.loli.net/2025/01/03/Tbf8DPUVYQW6IJC.jpg" width="600" height="350"/><p>船的露天甲板也是可以上的。我和舍友特意在6:00早起，然后到甲板上去看海上的日出了。虽然甲板上风大了一点，但是这样美妙的日出景色还是让我们在寒风中站了许久。<del>当然也可以在温暖的船舱内一边吃早饭一边看</del></p><img src="https://s2.loli.net/2025/01/03/exBYyW7F5VrNCmA.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/03/BjazSuLbO5yHUcR.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/VbYJ6Am1QtMXB4E.png" width="600" height="350"/><hr><h2 id="12-28：徳島市和美马市"><a href="#12-28：徳島市和美马市" class="headerlink" title="12.28：徳島市和美马市"></a>12.28：徳島市和美马市</h2><p>由于轮渡在早上九点就抵达了，距离我们下午三点check in美马市的民宿还有一段时间，我们就先在JR德岛站边上的德岛公园转了转。</p><img src="https://s2.loli.net/2025/01/04/IH3SoFTsc9itbMP.jpg" width="600" height="350"/><p>这里似乎是德岛市民的健身圣地，公园里有很多在跑步的男女老少（<del>绕公园一圈貌似是5公里，我上能跑两圈</del>）。德岛公园是一个完全开放的公园，严格意义讲也算不上是一个旅游景点，但这里面风景倒是很棒。池塘里有小鸭子，繁茂的花草树木间还有很多鸽子，它们一点也不怕人，除非你要踩到它们它们才肯飞走；虽然已经是冬天了，公园里仍有几棵红叶点缀在翠绿的松树之间，显得格外的好看。</p><img src="https://s2.loli.net/2025/01/04/EvARhjMrN1WkUnQ.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/y2CivXQgjqLNB8G.jpg" width="600" height="350"/><p>随后我们就直接前往美马市的民宿了，我们乘坐的是德岛线前往四国中央的山区里。JR四国非常原始，电车比我想象中的还要老式，站台内居然没有自动检票的改札口，必须人工检票，而且下车时需要在前门给车长检票，和公交车一样！而且听这电车的发动机声音貌似不是电驱动的，而且和公交车一样是常规的柴油发动机！</p><img src="https://s2.loli.net/2025/01/04/A4Rqskluh6ZSnOD.png" width="350" height="150"/><p>四国山脉的壮丽程度远远超过我的预想。电车穿行在山岭里，山间随处可见小小的村落；电车靠近城市后眼界逐渐开阔，此时便能看到远处连绵的山脉了。云雾缭绕在半山腰，靠近山顶的部分便都是积雪了。由于是阴天的缘故，整座山仿佛笼罩着一层薄薄的雾气，加之山间时而显现的村落，便显得格外神秘。</p><img src="https://s2.loli.net/2025/01/04/xVK1lg4ZyaLtCrY.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/8E7lxejAC9QLkDb.jpg" width="600" height="350"/><p>美马市座落在山脉里，这里的居民很少，街道上显得有些破败或者说有点凄凉，<del>但是竟然有麦当劳和帕青哥</del>。街道上虽然有很多来往的车辆，但也大都只是从德岛前往松山途径这里而已，不会停留。吉野川横穿了这座城市。我们的民宿在山上，爬山的时候要经过一个小神社。</p><img src="https://s2.loli.net/2025/01/04/LEfgajRNnwTIzeO.png" width="600" height="350"/><hr><h2 id="12-29-大小步危"><a href="#12-29-大小步危" class="headerlink" title="12.29 大小步危"></a>12.29 大小步危</h2><p>从美马市前往大小步危则需要向西南方向更加深入山脉。首先还是坐JR德岛线到终点站“阿波池田”，这里也是一个小镇，但让人感觉比美马市繁华多了。从站台眺望的风景能同时看到电车和山脉，很美；站台边上还有一个小公园，有种梦核的感觉？</p><img src="https://s2.loli.net/2025/01/04/9IwJthDMP3zG78c.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/mJ7RlzD9i4PT6Zg.jpg" width="600" height="350"/><p>大小步危是大步危和小步危。我们先在大步危坐了游览船，游船行驶在碧清的河道上，两侧则是几千年来冲刷而成的山谷峭壁；两座山之间是不是会出现一座大桥连通，左边山崖上是是盘山公路，右边则是JR山藏线。</p><img src="https://s2.loli.net/2025/01/04/UXo1QSyTih9f5Vt.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/fqXxEobkewP7ISC.png" width="350" height="150"/><br/><img src="https://s2.loli.net/2025/01/04/qKOibJC9cgr2a48.png" width="600" height="350"/><p>后来我们北上徒步到小步危，中途还去吃了个大步危特色そば。我们在大步危泡了温泉，700日元一个人的价格实在是太实惠了。温泉水温暖了早已被寒风冻僵的四肢，在泡温泉的同时还能够欣赏雪山的美景，山间时不时还有电车穿行而过，这样的场景简直美得让人窒息！这样的机会恐怕很难再有了吧……直到天色渐黑，我们才做JR山藏线和琴電（ことでん）从小步危返回阿波池田，随后前往高松市。</p><p>走在昏暗的山间，身边雾气缭绕，我感到整个世界都不真实了，仿佛置身于梦境中，下一秒随时可能会醒来……</p><img src="https://s2.loli.net/2025/01/04/AJTdy1MstvQOkZD.jpg" width="600" height="350"/><hr><h2 id="12-30-高松市"><a href="#12-30-高松市" class="headerlink" title="12.30 高松市"></a>12.30 高松市</h2><p>高松市本来只是作为我们前往小豆岛的一个中继点，但事实上高松给了我很好的印象<del>住了两晚</del>。在休息了一夜后，我们花了一个上午在栗林公園闲逛，栗林公園是高松古代君主模仿苏州园林建造的一个园林，里面的景色非常优美。</p><img src="https://s2.loli.net/2025/01/04/mwz9eHRv42qDXsI.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/RF8iqPSKECtWO6x.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/sbi87yojVrqxJGk.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/Y6PqZkyfueXQmh7.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/ZzhSpl9XPJBt3rk.jpg" width="600" height="350"/><p>高松还有全日本最长的商业街<del>名字忘了</del>，里面非常热闹繁华<del>在里面打了舞萌</del>。我在里面连续吃了两天的松屋猪排饭，便宜量大！</p><img src="https://s2.loli.net/2025/01/04/IGMEy1os9QNTZcr.png" width="350" height="150"/><p>在傍晚时分，我们前往高松港提前打探轮渡的消息，却正巧碰到了港口绝美的夕阳景色！远处的海平线上群山起伏，山后则氤氲着艳丽的红色晚霞，晚霞的红和天空的蓝交融在了一起。港口有正在缓缓驶来的轮船，天空中时不时飞过成群的海鸥……这样的景色是只有通过双眼才能感受到的真实。</p><img src="https://s2.loli.net/2025/01/04/rON1uET3yXbcKqG.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/dlXwZOFCz4RIHyJ.png" width="600" height="350"/><p>在天色完全黑下来之后，我们登上高松的标志性建筑，在顶楼观赏了高松市城区和高松港美丽的夜景。</p><img src="https://s2.loli.net/2025/01/04/AOMCUZYxfqIcTuo.png" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/lNVXD59PAEBHpia.png" width="600" height="350"/><hr><h2 id="12-31-1-1-在小豆岛的跨年之夜"><a href="#12-31-1-1-在小豆岛的跨年之夜" class="headerlink" title="12.31~1.1 在小豆岛的跨年之夜"></a>12.31~1.1 在小豆岛的跨年之夜</h2><p>我们从昨晚的高松港坐高速艇，半小时就到了小豆岛的土庄港。映入眼帘的就是“高木同学”的海报！酒店check in之前我们先在岛上随便逛了逛，去了妖怪博物馆<del>票价2900日元非常昂贵</del>，还去了著名景点天使的散步路。</p><img src="https://s2.loli.net/2025/01/04/STgLfpEnzBekXlH.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/HEh3GsY9bWRpOni.jpg" width="600" height="350"/><p>在跨年的夜晚，岛上几乎所有店全都休业了，即便是还开着的店也需要提前预约。饥肠辘辘的我和舍友在寒风中走了许久，最后还是决定吃便利店了……于是，我们在日本的第一个跨年夜晚餐，便是711大餐orz。虽然有些囧，但这种体验非常奇妙。我们还把电视机打开看了NHK的红白歌会，也算是看日本春晚入乡随俗了。</p><img src="https://s2.loli.net/2025/01/04/zuBnlcNqIat9fkx.png" width="600" height="350"/><p>1.1新年一大早我们便起床去附近的八幡神社，完成新年的第一次参拜（初詣：はつもうで）。奉纳完之后去抽了おみくじ，我只抽到了末吉，神签上告诉我这一年会遇到诸多不顺，但如果努力去做的话仍然可以挽回。它告诫我需要通过自身的努力去达成目标，也算是给了我一些告诫和鼓励。当然这个结果并不是很好<del>但至少不是凶</del>，所以我把这个签系在了神社的树上，希望神明能够助我一臂之力；舍友的运气很好，又一次抽到了大吉。</p><img src="https://s2.loli.net/2025/01/04/te7B5kmIALMFjPX.jpg" width="600" height="350"/><p>后来我们二人租了一个电助力自行车<del>带电的哈啰共享单车</del>沿着海岸线环游了小豆岛。途中正好发现了一座可以攀爬的山，误打误撞地也是完成了新年的第一次登高<del>不知道日本有没有新年登高的习俗</del>。山顶上有一个用木头搭起来的鸟居，里面的巨石叫做“重岩”。从山顶可以俯瞰小豆岛的海景，还能看到海平线远处连绵起伏的山脉，令人心旷神怡。</p><img src="https://s2.loli.net/2025/01/04/UwNGlLHO98MeqKv.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/2eSXYL18oBMigOa.jpg" width="600" height="350"/><p>后来，我们还骑到了一个种着很多棕榈树的沙滩边。这是一个地图上没有标出来的沙滩，几乎没有人造访这里，但是这里的景色意外的好，我们也是在这里停留了许久。</p><img src="https://s2.loli.net/2025/01/04/XPjMwvyEhuBI6eb.jpg" width="600" height="350"/><p>再后来我们路过了“鹿岛明神社”，里面都是来圣地巡礼高木同学的人！这让我决定回家补一补这一部番。</p><img src="https://s2.loli.net/2025/01/04/5WoH6EDjwYirXJC.png" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/x5froYcgQmu6hX9.png" width="600" height="350"/><p>在这之后就没干啥了，吃了个饭继续骑行环游小豆岛，然后回到土庄港坐轮船回到高松。在离开小豆岛之前，我们稍微逛了一下土庄港，发现了著名地标“太阳的礼物”<del>我记得高木同学有一季的海报就是这儿?</del>。</p><img src="https://s2.loli.net/2025/01/04/TN9V8hJOHBYwlAs.jpg" width="600" height="350"/><hr><h2 id="1-2-松山市"><a href="#1-2-松山市" class="headerlink" title="1.2 松山市"></a>1.2 松山市</h2><p>其实一开始我们并没有打算来松山，准备直接从高松飞回北九州。但最后我们还是预定了松山到小仓的フェーリ，打算最后再坐一次船，因此不得不前往四国最西端的松山市了。从高松到松山横跨整个四国，路途极为遥远，但好在我们赶上了两市之间直通的高速巴士。</p><p>在松山休息了一晚后，我们去了最著名景点的松山城，里面是古代四国君主建造的天守阁，地势非常的高，可以俯瞰整个管辖地区。前往松山城可以做单人缆车，我们也体验了一把。由于是新年，这一天松山城里还举办了日本传统的“打年糕”活动，我也是第一次近距离观看，非常热闹有意思。</p><img src="https://s2.loli.net/2025/01/04/gLxsdBzPhtSNTR8.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/W5eqsaucyY7mOf4.jpg" width="600" height="350"/><p>由于松山-小仓フェーリ晚上十一点才发船，为了消磨时间我们还去了很多地方。比如顺路参拜了一下东云神社<del>这里的御朱印免费！</del>，一路向着港口方向暴走，然后顺路逛了逛book-off买了几本漫画，还去了趟电影院<del>最后没看成电影</del>。我们还去了爱媛大学和松山大学，它们是挨在一起的两所大学，不过貌似爱媛大学要比松山大学好得多。</p><img src="https://s2.loli.net/2025/01/04/e2gav9f5Y6oIzDR.jpg" width="600" height="350"/><br/><img src="https://s2.loli.net/2025/01/04/jv3YyVKnU94tGsg.jpg" width="600" height="350"/><hr><h2 id="返程：松山-→-小倉"><a href="#返程：松山-→-小倉" class="headerlink" title="返程：松山 → 小倉"></a>返程：松山 → 小倉</h2><p>返程的フェーリ次日5点就抵达了，因此在船上停留的时间不长，船内体验也完全不如启程时的東九フェーリ<del>船票反而贵了一倍！</del>。</p><hr><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>]]></content>
      
      
      <categories>
          
          <category> Life in Japan </category>
          
      </categories>
      
      
        <tags>
            
            <tag> travel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Opencv图像骨干提取算法的实现和优化 Thinning Algorithm (VSP Project)</title>
      <link href="/2024/12/13/opencv-VSP-thinning/"/>
      <url>/2024/12/13/opencv-VSP-thinning/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="什么是骨干提取（教案）"><a href="#什么是骨干提取（教案）" class="headerlink" title="什么是骨干提取（教案）"></a>什么是骨干提取（教案）</h2><hr><h2 id="代码总体框架"><a href="#代码总体框架" class="headerlink" title="代码总体框架"></a>代码总体框架</h2><ul><li>骨干提取Thinning：<ul><li>骨干提取主函数：SequentialThinning。</li><li>自研骨干提取算法：solve，配合三个检查函数“CheckEdge,CheckConnectivity和CheckEndPoint”。</li><li>Zhang-suen骨干提取算法：zhangsuen_solve，配合两个检查函数“UpDownCheck和LeftRightCheck”。</li></ul></li><li>特征点提取Feature Extraction：<ul><li>FeatureExtraction：配合四个检查函数。新增Check_3BranchPoint和Check_4BranchPoint。</li></ul></li><li>提取后图像优化Optimization：<ul><li>removeLinesUseFeatureExtraction: 利用特征点进行优化，配合ColorPixelDetect。</li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LWCThinning</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function">Mat <span class="title">SequentialThinning</span><span class="params">(Mat&amp; Image, <span class="type">int</span> num_iterations)</span></span>;</span><br><span class="line">        <span class="function">Mat <span class="title">FeatureExtraction</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">        <span class="comment">//Optimization</span></span><br><span class="line">        <span class="function">Mat <span class="title">removeLinesUseFeatureExtraction</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="comment">//VSP-slice based thinning</span></span><br><span class="line">        <span class="function">Mat <span class="title">solve</span><span class="params">(Mat&amp; Image, <span class="type">int</span> iter_time)</span></span>;        </span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">CheckEdge</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">CheckConnectivity</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">CheckEndPoint</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="comment">//zhang-suen algorithm</span></span><br><span class="line">        <span class="function">Mat <span class="title">zhangsuen_solve</span><span class="params">(Mat&amp; Image, <span class="type">int</span> iter_time)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">UpDownCheck</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">LeftRightCheck</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="comment">//Optimization functions</span></span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">ColorPixelDetect</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="comment">//Pixel Analyze</span></span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">Check_3BranchPoint</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">Check_4BranchPoint</span><span class="params">(Mat&amp; image3x3)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="时间复杂度上的考虑"><a href="#时间复杂度上的考虑" class="headerlink" title="时间复杂度上的考虑"></a>时间复杂度上的考虑</h2><p>本代码中除了对原始图像的遍历使用了双重for循环，在其他方法中<strong>对3x3的卷积核进行处理时，均没有使用for循环。</strong>这是出于时间复杂度上的考量。3x3的卷积核很小，一共也才9个元素，如果再用一个常规的双重for循环进行处理，时间复杂度将会增加O(n^2)，与外部遍历结合起来就是O(n^4),处理大图片将会非常缓慢；但相对地，如果将其展开书写，将时间复杂度降低为O(1)的情况下代码也不会变得过于冗杂。</p><hr><h2 id="三次判断"><a href="#三次判断" class="headerlink" title="三次判断"></a>三次判断</h2><p>总体思路：三个check方法返回0或1。在solve()中调用这些check，三次判断全1才会执行像素的删除。</p><ul><li>return 0: 该项check不通过，不可以删除。</li><li>return 1: 该项check通过，可以删除。</li></ul><h3 id="连续性判断-CheckConnectivity"><a href="#连续性判断-CheckConnectivity" class="headerlink" title="连续性判断 CheckConnectivity"></a>连续性判断 CheckConnectivity</h3><p>先说结论：判断中心注目像素周围一圈的八个像素，从一个节点开始顺时针旋转遍历。<strong>如果像素值“从黑转变为白”的次数超过1次，那么就是不连续的。</strong>（另外，前提是周围一圈有两个及以上的黑色像素。如果只有一个黑像素，那么这个中心像素就是端点end-point）</p><p>我们可以通过画图来探索这个规律：</p><img src="https://s2.loli.net/2024/12/13/bJP8qNYZ6Wp4d92.jpg" width="500" height="500"/><img src="https://s2.loli.net/2024/12/13/x9mpz4YWS7hyeJQ.jpg" width="500" height="500"/><ul><li>①很好地展示了斜线连续性被破坏的情况。</li><li>③很好地展示了直线连续性被破坏的情况。</li><li>⑤展示了两条直线交点处连续性被破坏的情况。</li><li>②中即便删除了中心像素，其连续性没有被破坏。</li></ul><p>观察上述所有破快连续性的情况，我们发现他们周围一圈像素从黑变白的转变次数都大于一。(图中红色箭头和数字)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::CheckConnectivity</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">//======== iff time which around 8-pixel transfer from B to W is only 1, then it will have connectivity. ========</span></span><br><span class="line">    <span class="type">int</span> B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="type">int</span> T = <span class="number">0</span>;   <span class="comment">//transfer from B to W </span></span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">255</span>)    T++;    </span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">255</span>)    T++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) == <span class="number">255</span>)    T++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B &gt;= <span class="number">2</span> &amp;&amp; T == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;   <span class="comment">//preserve connectivity</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="端点判断-CheckEndPoint"><a href="#端点判断-CheckEndPoint" class="headerlink" title="端点判断 CheckEndPoint"></a>端点判断 CheckEndPoint</h3><p>不难发现，如果<strong>中心注目像素的周围只存在一个黑色像素，那么它就是端点end-point。</strong>我们不能删除端点像素。</p><img src="https://s2.loli.net/2024/12/13/od4ypr5Fci2E97f.jpg" width="500" height="500"/><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::CheckEndPoint</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">//======== iff around 8-pixel only have one B, then this center pixel is endpoint.========</span></span><br><span class="line">    <span class="type">int</span> B = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">0</span>)  B++;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) == <span class="number">0</span>)  B++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(B == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">//not end point</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="孤立点判断-CheckEdge"><a href="#孤立点判断-CheckEdge" class="headerlink" title="孤立点判断 CheckEdge"></a>孤立点判断 CheckEdge</h3><p>这个是最简单的，只需要查看周围一圈是否有黑色像素即可。它的深层含义是：<strong>画面上孤立的黑色像素点不能删去，因为他完整地表征着一部分的画面信息。</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::CheckEdge</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) == <span class="number">0</span> || image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">0</span> || image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) == <span class="number">0</span> ||   </span><br><span class="line">       image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">0</span> ||                                 image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">0</span> ||</span><br><span class="line">       image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) == <span class="number">0</span> || image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">0</span> || image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) == <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">//boundary have B-pixel</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="slove-主方法-和-SequentialThinning-接口方法"><a href="#slove-主方法-和-SequentialThinning-接口方法" class="headerlink" title="slove()主方法 和 SequentialThinning()接口方法"></a>slove()主方法 和 SequentialThinning()接口方法</h2><ul><li>使用3x3的卷积核遍历原始图像。具体而言，当检测到3x3的中心是黑色像素时，从原图中抽取这个3x3的正方形像素区域构成一个新图像kernel_nowscanning，然后进行三次check。如果check通过，则将中心的黑色像素删除（即变为白色）。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mat <span class="title">LWCThinning::solve</span><span class="params">(Mat&amp; Image, <span class="type">int</span> iter_time)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1</span>; y &lt; img_height<span class="number">-1</span>; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt; img_width<span class="number">-1</span>; x++)&#123;</span><br><span class="line">            Mat kernel_nowscanning = Mat::<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">3</span>,CV_8UC1);   </span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x);     <span class="comment">//center-pixel</span></span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">+1</span>);</span><br><span class="line">            <span class="comment">//if center-pixel is black, go to &#x27;mittsu no check&#x27;, find out whether it can be change to white.</span></span><br><span class="line">            <span class="type">int</span> check1 = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> check2 = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> check3 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                check1 = <span class="built_in">CheckEdge</span>(kernel_nowscanning);</span><br><span class="line">                check2 = <span class="built_in">CheckConnectivity</span>(kernel_nowscanning);</span><br><span class="line">                check3 = <span class="built_in">CheckEndPoint</span>(kernel_nowscanning);</span><br><span class="line">                <span class="comment">//change center-pixel from B to W (in original-image)</span></span><br><span class="line">                <span class="keyword">if</span>(check1 == <span class="number">1</span> &amp;&amp; check2 == <span class="number">1</span> &amp;&amp; check3 == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="comment">//kernel_nowscanning.at&lt;uchar&gt;(1,1) = 255;</span></span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x) = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string file_dic = <span class="string">&quot;result/process_time&quot;</span> + <span class="built_in">to_string</span>(iter_time) + <span class="string">&quot;.png&quot;</span>;</span><br><span class="line">    <span class="built_in">imwrite</span>(file_dic, Image);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Image saved to &quot;</span> &lt;&lt; file_dic &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>SequentialThinning()接口方法可以被用户(主函数)调用，对给定的图样进行N次骨干提取，将结果保存在result路径下。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">LWCThinning::SequentialThinning</span><span class="params">(Mat&amp; Image, <span class="type">int</span> num_iterations)</span></span>&#123;</span><br><span class="line">    Mat processedImage = Image.<span class="built_in">clone</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i &lt; num_iterations; i++)&#123;</span><br><span class="line">        processedImage = <span class="built_in">solve</span>(processedImage, i);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;||||&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;||||&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Final Processed Image&quot;</span>, processedImage);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Processing Completed.&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="初步测试结果"><a href="#初步测试结果" class="headerlink" title="初步测试结果"></a>初步测试结果</h2><h3 id="ABCD英文字符"><a href="#ABCD英文字符" class="headerlink" title="ABCD英文字符"></a>ABCD英文字符</h3><ul><li>字母A：</li></ul><img src="https://s2.loli.net/2024/12/13/8BQLTIqYRg5ou96.png"/><ul><li>字母C：</li></ul><img src="https://s2.loli.net/2024/12/14/sft7ARd8QXDYIoy.png"/><ul><li>字母E：</li></ul><img src="https://s2.loli.net/2024/12/14/Uw3ELfY9BrkQ8qt.png"/><h3 id="复杂的彩色图样"><a href="#复杂的彩色图样" class="headerlink" title="复杂的彩色图样"></a>复杂的彩色图样</h3><p>首先将彩色图片读取为灰度图，然后进行二值化处理，最后再调用SequentialThinning。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//Complex image</span></span><br><span class="line">    Mat image_ena = <span class="built_in">imread</span>(<span class="string">&quot;source/ENANA.png&quot;</span>, IMREAD_GRAYSCALE);</span><br><span class="line">    Mat binary_image;</span><br><span class="line">    <span class="type">double</span> threshold_value = <span class="number">128</span>;</span><br><span class="line">    <span class="built_in">threshold</span>(image_ena, binary_image, threshold_value, <span class="number">255</span>, THRESH_BINARY);</span><br><span class="line"></span><br><span class="line">    LWCThinning handle;</span><br><span class="line">    handle.<span class="built_in">SequentialThinning</span>(binary_image,<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试原图与处理后图像如下：</p><img src="https://s2.loli.net/2024/12/13/pfNk4bBd7oHOeLZ.png"/><ul><li>原图：</li></ul><img src="https://s2.loli.net/2024/12/13/Ft5Z6h7RecyMBqs.jpg"/><ul><li>转化为二值化图像：</li></ul><img src="https://s2.loli.net/2024/12/13/Zvs3K4j7XpMnmTB.png"/><ul><li>我们把处理后的图像放大观察，可以看到骨干提取的一些细节。比如衣服的领带和眼睛等等：</li></ul><img src="https://s2.loli.net/2024/12/13/r8QuoaHwyXfC2li.png"/><hr><h2 id="问题：对于复杂图像，处理后的图像中存在很多垂直水平面的直线（噪声），如何去除？"><a href="#问题：对于复杂图像，处理后的图像中存在很多垂直水平面的直线（噪声），如何去除？" class="headerlink" title="问题：对于复杂图像，处理后的图像中存在很多垂直水平面的直线（噪声），如何去除？"></a>问题：对于复杂图像，处理后的图像中存在很多垂直水平面的直线（噪声），如何去除？</h2><h2 id="优化一：“Zhang-Suen算法”"><a href="#优化一：“Zhang-Suen算法”" class="headerlink" title="优化一：“Zhang-Suen算法”"></a>优化一：“Zhang-Suen算法”</h2><p>问题就出在我们对原始图像的处理顺序上。<strong>我们总是从上往下、从左往右地进行逐行扫描，这种顺序性可能导致水平或垂直方向的像素被优先移除或保留，从而产生水平或垂直的直线。</strong>这直接导致了很多倾斜的骨干被强制地转化为了垂直的直线。</p><p>从上方测试图“字母A”可以看出这种状况，并且在彩色测试图中也很明显能发现许多垂直直线。</p><h3 id="Zhang-Suen算法"><a href="#Zhang-Suen算法" class="headerlink" title="Zhang-Suen算法"></a>Zhang-Suen算法</h3><p>与先前自己实现的算法相比，其实就是check部分的逻辑不同。Zhang-Suen算法会先后进行两次遍历，一次是UpDown一次是LeftRight。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//zhangsuen -----------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::UpDownCheck</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* ---- */</span></span><br><span class="line">    <span class="keyword">if</span>((B &gt;= <span class="number">2</span> &amp;&amp; B &lt;= <span class="number">6</span>) &amp;&amp; T == <span class="number">1</span> &amp;&amp; ((P2*P4*P6 == <span class="number">0</span>) || (P4*P6*P8 == <span class="number">0</span>)))     </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::LeftRightCheck</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* ---- */</span></span><br><span class="line">    <span class="keyword">if</span>((B &gt;= <span class="number">2</span> &amp;&amp; B &lt;= <span class="number">6</span>) &amp;&amp; T == <span class="number">1</span> &amp;&amp; ((P2*P4*P8 == <span class="number">0</span>) || (P2*P6*P8 == <span class="number">0</span>)))     </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">LWCThinning::zhangsuen_solve</span><span class="params">(Mat&amp; Image, <span class="type">int</span> iter_time)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1</span>; y &lt; img_height<span class="number">-1</span>; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt; img_width<span class="number">-1</span>; x++)&#123;</span><br><span class="line">            Mat kernel_nowscanning = Mat::<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">3</span>,CV_8UC1);   </span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x);     <span class="comment">//center-pixel</span></span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">+1</span>);</span><br><span class="line">            <span class="keyword">if</span>(kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> firstcheck = <span class="built_in">UpDownCheck</span>(kernel_nowscanning);</span><br><span class="line">                <span class="keyword">if</span>(firstcheck == <span class="number">1</span>)&#123;</span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x) = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1</span>; y &lt; img_height<span class="number">-1</span>; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt; img_width<span class="number">-1</span>; x++)&#123;</span><br><span class="line">            Mat kernel_nowscanning = Mat::<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">3</span>,CV_8UC1);   </span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x);     <span class="comment">//center-pixel</span></span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">+1</span>);</span><br><span class="line">            <span class="keyword">if</span>(kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> secondcheck = <span class="built_in">LeftRightCheck</span>(kernel_nowscanning);</span><br><span class="line">                <span class="keyword">if</span>(secondcheck == <span class="number">1</span>)&#123;</span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x) = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string file_dic = <span class="string">&quot;result/process_time&quot;</span> + <span class="built_in">to_string</span>(iter_time<span class="number">+1</span>) + <span class="string">&quot;.png&quot;</span>;</span><br><span class="line">    <span class="built_in">imwrite</span>(file_dic, Image);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Image saved to &quot;</span> &lt;&lt; file_dic &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优化结果"><a href="#优化结果" class="headerlink" title="优化结果"></a>优化结果</h3><p>貌似没有解决垂直直线较多的问题…</p><hr><h2 id="优化二：利用“特性点提取”消除直线"><a href="#优化二：利用“特性点提取”消除直线" class="headerlink" title="优化二：利用“特性点提取”消除直线"></a>优化二：利用“特性点提取”消除直线</h2><p>刚刚在做“特征点提取”的工作时，突然来了灵感：<strong>我发现这些多余的直线都是由非特征点组成的，亦或是原理特征点的。</strong>换言之，<strong>我们只要提取了骨架图的特征点，然后去除远离特征点的点即可！</strong></p><h3 id="特征点提取"><a href="#特征点提取" class="headerlink" title="特征点提取"></a>特征点提取</h3><img src="https://s2.loli.net/2024/12/16/dkJEzB2IpyxLZrH.jpg" width="500" height="500"/><p>这是特征点提取后的图片，不同的特征点标上了不同的颜色：</p><ul><li>孤立点 isolated point：红色。</li><li>端点 end point：绿色。</li><li>3分歧点：蓝色。图片中的阶梯状斜线属于这一类。</li><li>4分歧点：黄色。十字路口。</li></ul><img src="https://s2.loli.net/2024/12/16/2x3kpPmacTdHe8E.png"/><p>我们可以放大图片观察一下细节：（由于4分歧点的黄色标注看的不明显，我在边上放了一双眼睛。）</p><img src="https://s2.loli.net/2024/12/16/W7dcQkhTnKeVHqC.png"/><p>特征点提取的核心代码：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::Check_3BranchPoint</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* ----- */</span></span><br><span class="line">    <span class="keyword">if</span>(B &gt;= <span class="number">3</span> &amp;&amp; (T == <span class="number">2</span> || T == <span class="number">3</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::Check_4BranchPoint</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="comment">/* ----- */</span></span><br><span class="line">    <span class="keyword">if</span>(T == <span class="number">4</span> || </span><br><span class="line">      (image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) == <span class="number">0</span> &amp;&amp; image3x<span class="number">3.</span><span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) == <span class="number">0</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">LWCThinning::FeatureExtraction</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Mat rgbImage;   <span class="comment">//After PixelAnalyzing</span></span><br><span class="line">    <span class="built_in">cvtColor</span>(Image, rgbImage, COLOR_GRAY2BGR);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1</span>; y &lt; img_height<span class="number">-1</span>; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt; img_width<span class="number">-1</span>; x++)&#123;</span><br><span class="line">            Mat kernel_nowscanning = Mat::<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">3</span>,CV_8UC1);   </span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">0</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">-1</span>,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x);     <span class="comment">//center-pixel</span></span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">2</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;uchar&gt;(y<span class="number">+1</span>,x<span class="number">+1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> check_iso = <span class="number">0</span>;       <span class="comment">//isolated point</span></span><br><span class="line">            <span class="type">int</span> check_endpoint = <span class="number">0</span>;  <span class="comment">//end point</span></span><br><span class="line">            <span class="type">int</span> check_3branchpoint = <span class="number">0</span>;  <span class="comment">//3branchpoint</span></span><br><span class="line">            <span class="type">int</span> check_4branchpoint = <span class="number">0</span>;  <span class="comment">//4branchpoint</span></span><br><span class="line">            <span class="keyword">if</span>(kernel_nowscanning.<span class="built_in">at</span>&lt;uchar&gt;(<span class="number">1</span>,<span class="number">1</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                check_iso = <span class="built_in">CheckEdge</span>(kernel_nowscanning);</span><br><span class="line">                check_endpoint = <span class="built_in">CheckEndPoint</span>(kernel_nowscanning);</span><br><span class="line">                check_3branchpoint = <span class="built_in">Check_3BranchPoint</span>(kernel_nowscanning);</span><br><span class="line">                check_4branchpoint = <span class="built_in">Check_4BranchPoint</span>(kernel_nowscanning);</span><br><span class="line">                <span class="keyword">if</span>(check_iso == <span class="number">0</span>)&#123;</span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">0</span>] = <span class="number">0</span>;    </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">1</span>] = <span class="number">0</span>;  </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">2</span>] = <span class="number">255</span>;  <span class="comment">//Red</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(check_endpoint == <span class="number">0</span>)&#123;</span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">0</span>] = <span class="number">0</span>;    </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">1</span>] = <span class="number">255</span>;  <span class="comment">//Green</span></span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">2</span>] = <span class="number">0</span>;  </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(check_3branchpoint == <span class="number">1</span>)&#123;</span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">0</span>] = <span class="number">255</span>;  <span class="comment">//Blue</span></span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">1</span>] = <span class="number">0</span>;  </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">2</span>] = <span class="number">0</span>;  </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(check_4branchpoint == <span class="number">1</span>)&#123;</span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">0</span>] = <span class="number">0</span>;  </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">1</span>] = <span class="number">255</span>;  </span><br><span class="line">                    rgbImage.<span class="built_in">at</span>&lt;Vec3b&gt;(y, x)[<span class="number">2</span>] = <span class="number">255</span>;  </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rgbImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="利用“特性点提取”消除直线"><a href="#利用“特性点提取”消除直线" class="headerlink" title="利用“特性点提取”消除直线"></a>利用“特性点提取”消除直线</h3><p>仍然使用3x3的扫描核kernel（中心像素为注目像素），如果kernel内不存在彩色像素，即不存在特征点，那么就删去这个中心像素。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mat <span class="title">LWCThinning::removeLinesUseFeatureExtraction</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> y = <span class="number">1</span>; y &lt; img_height<span class="number">-1</span>; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt; img_width<span class="number">-1</span>; x++)&#123;</span><br><span class="line">            Mat kernel_nowscanning = Mat::<span class="built_in">zeros</span>(<span class="number">3</span>,<span class="number">3</span>,CV_8UC3);   </span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">0</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">-1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">0</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">-1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">0</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">-1</span>,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x);     <span class="comment">//center-pixel</span></span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x<span class="number">+1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">2</span>,<span class="number">0</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">+1</span>,x<span class="number">-1</span>);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">2</span>,<span class="number">1</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">+1</span>,x);</span><br><span class="line">            kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">2</span>,<span class="number">2</span>) = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y<span class="number">+1</span>,x<span class="number">+1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">1</span>)[<span class="number">0</span>] == <span class="number">0</span> &amp;&amp; kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">1</span>)[<span class="number">1</span>] == <span class="number">0</span> &amp;&amp; kernel_nowscanning.<span class="built_in">at</span>&lt;Vec3b&gt;(<span class="number">1</span>,<span class="number">1</span>)[<span class="number">2</span>] == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> is_coloured = <span class="built_in">ColorPixelDetect</span>(kernel_nowscanning);</span><br><span class="line">                <span class="keyword">if</span>(!is_coloured)&#123;</span><br><span class="line">                    <span class="comment">//remove(change to W)</span></span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">                    Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Image;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LWCThinning::ColorPixelDetect</span><span class="params">(Mat&amp; image3x3)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;  </span><br><span class="line">            Vec3b pixel = image3x<span class="number">3.</span><span class="built_in">at</span>&lt;Vec3b&gt;(i, j);</span><br><span class="line">            <span class="type">int</span> B = pixel[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = pixel[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = pixel[<span class="number">2</span>];</span><br><span class="line">            <span class="comment">//have colour</span></span><br><span class="line">            <span class="keyword">if</span> (!((B == <span class="number">255</span> &amp;&amp; G == <span class="number">255</span> &amp;&amp; R == <span class="number">255</span>) || (B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>))) &#123;  </span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="优化结果-1"><a href="#优化结果-1" class="headerlink" title="优化结果"></a>优化结果</h3><h4 id="动漫人物图片：ShinonomeEnana"><a href="#动漫人物图片：ShinonomeEnana" class="headerlink" title="动漫人物图片：ShinonomeEnana"></a>动漫人物图片：ShinonomeEnana</h4><ul><li>原图：</li></ul><img src="https://s2.loli.net/2024/12/18/XNl32ypMYd9gP7s.jpg"/><ul><li>初步骨架提取：</li></ul><img src="https://s2.loli.net/2024/12/18/F9CB5bufxeZYcNI.png"/><ul><li>特征点提取：</li></ul><img src="https://s2.loli.net/2024/12/18/sT7AdPFawf8m4ro.png"/><ul><li>利用特征点去直线：</li></ul><img src="https://s2.loli.net/2024/12/18/i9fBzcWmwqEebhO.png"/><h4 id="环境景色图片：ひびきの南"><a href="#环境景色图片：ひびきの南" class="headerlink" title="环境景色图片：ひびきの南"></a>环境景色图片：ひびきの南</h4><ul><li>原图：</li></ul><img src="https://s2.loli.net/2024/12/18/TRED91LvNKAZwWh.jpg"/><ul><li>初步骨架提取：</li></ul><img src="https://s2.loli.net/2024/12/18/wFKiSWHX79nQNtG.png"/><ul><li>特征点提取：</li></ul><img src="https://s2.loli.net/2024/12/18/oFV19ucJZSjyK8R.png"/><ul><li>利用特征点去直线：</li></ul><img src="https://s2.loli.net/2024/12/18/7iYMDKBCyeFuQ6R.png"/><h4 id="包含大量文字的图片：日本年号对照表"><a href="#包含大量文字的图片：日本年号对照表" class="headerlink" title="包含大量文字的图片：日本年号对照表"></a>包含大量文字的图片：日本年号对照表</h4><ul><li>原图：</li></ul><img src="https://s2.loli.net/2024/12/18/THtpLUYydkmP5oE.jpg"/><ul><li>初步骨架提取：</li></ul><img src="https://s2.loli.net/2024/12/18/6ayND9HbGQCIAtg.png"/><ul><li>特征点提取：</li></ul><img src="https://s2.loli.net/2024/12/18/nCmiPc8FYEzSafL.png"/><p>我们发现对文字进行处理后效果已经很好了，因此无需再继续优化。</p>]]></content>
      
      
      <categories>
          
          <category> LAB EXERCISE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> Tough-Transform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何区分使用「ないで」和「なくて」</title>
      <link href="/2024/11/15/nihongo-nakutenaide/"/>
      <url>/2024/11/15/nihongo-nakutenaide/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题思考"><a href="#问题思考" class="headerlink" title="问题思考"></a>问题思考</h2><p>当我们学习日语接触到“接续”这个概念时，我们会用到<strong>各种词性的テ形</strong>，比如：</p><ul><li>形容词接续形容词(即…又…)： 寂<strong>しくて</strong>辛い &#x2F; きれい<strong>で</strong>明るい</li><li>动词接续动词（先做…后做…）： 学校から帰って(から)勉強します。</li><li>名词接续名词(是…又是…)： 彼は会社員<strong>で</strong>、３人の子供の父親です。</li></ul><p>但不难发现，上述例子中均是正向表达。如果使用“否定”那又将如何表达呢？如果与此同时使用原形，对于初学者来说非常难以在第一时间想到如何表达。前几天，我在和日本人日常交流时，突然遇到了以下几个问题：</p><ul><li><strong>动词否定接续时到底用「ないで」还是「なくて」？</strong></li><li><strong>一类形容词“过去否定”「なかった」如何接续？</strong></li></ul><p>经过我的学习和查阅，现在我可以来解释我提出的这些疑问。</p><hr><h2 id="否定「ない」接续时到底变「ないで」还是「なくて」？"><a href="#否定「ない」接续时到底变「ないで」还是「なくて」？" class="headerlink" title="否定「ない」接续时到底变「ないで」还是「なくて」？"></a>否定「ない」接续时到底变「ないで」还是「なくて」？</h2><p>其实早在N5时期，我们就接触到了很多使用到「ないで」和「なくて」的文法，诸如：</p><ul><li>～しないでください！   请不要做….。</li><li>～しなくてもいいです。　  不做….也可以。</li></ul><p>只不过我们当时没有多去考虑这两个句型中为什么前者用「ないで」后者用「なくて」。</p><h3 id="「ないで」只能动词接，而「なくて」动词名词形容词均可"><a href="#「ないで」只能动词接，而「なくて」动词名词形容词均可" class="headerlink" title="「ないで」只能动词接，而「なくて」动词名词形容词均可"></a>「ないで」只能动词接，而「なくて」动词名词形容词均可</h3><p><strong>在表达否定「ない」的接续(テ形)时，日语中存在「ないで」和「なくて」两种表达。</strong></p><ul><li><p><strong>对于形容词和名词而言，一定有「ない」-&gt; 「なくて」。</strong>如：</p><blockquote><p>暑くない -&gt; 暑くなくて：　この部屋が暑くなくてきれいだと思う。<br>有名じゃない -&gt; 有名じゃなくて：　この町が有名じゃなくて、景色も他の町に比べ物にならない。<br>学生じゃない -&gt; 学生じゃなくて：　彼は学生じゃなくて会社員じゃない。</p></blockquote></li><li><p><strong>对于动词而言，「ない」-&gt; 「なくて」&#x2F;「ないで」均可。</strong>如：</p><blockquote><p>食べない -&gt; 食べなくて：　朝ご飯を食べなくて学校へ行きます。<br>食べない -&gt; 食べないで：　朝ご飯を食べないで学校へ行きます。</p></blockquote></li></ul><p>显然，上面两个句子表达的含义是不一样的，光光是读出来给人的感觉就不一样了。因此，动词「ない」-&gt; 「なくて」或者「ない」-&gt; 「ないで」的含义不同。</p><h3 id="动词「ないで」-「なくて」接续动词的区别：前者状态，后者因果。"><a href="#动词「ないで」-「なくて」接续动词的区别：前者状态，后者因果。" class="headerlink" title="动词「ないで」&#x2F;「なくて」接续动词的区别：前者状态，后者因果。"></a>动词「ないで」&#x2F;「なくて」接续动词的区别：前者状态，后者因果。</h3><ul><li>「ないで」</li></ul><p>从语感上或者说从文法上，<strong>助词「で」给人一种“基于…状态”，“在…状态下”的感觉。</strong>比如我在超市里付钱时，我会说「現金で」表示我要用现金支付，这里的「で」是手段；又比如每次打舞萌都做公交车出勤，我会说「バスで行く」，这里的「で」是交通工具。</p><p>我们迁移到「ないで」上：<strong>我们可以认为「ないで」其实就是简单的「ない」加了一个助词「で」，表示“在没有(做)….的情况下,….”，“在…状态下…”。</strong>我们还可以顺水推舟地发现，「ないで」严格意义上并不是「ない」的テ形，表义的功劳都在助词「で」上。</p><p>在网络上看到一个评论感觉说的相当有道理：<strong>で就是 with, ないで就是without。</strong> 意思和我上面长篇大论表述的如出一辙。</p><blockquote><p>　朝ご飯を食べ<strong>ないで</strong>学校へ行きます。<br>　在没有吃早饭的情况下就直接去了学校。</p></blockquote><p>这个句子里的「朝ご飯を食べないで」就是表达了：其后「学校へ行きます」动作发生的条件&#x2F;状态是「朝ご飯を食べないで」。下面有更多的例句，可以自行体会语感。</p><blockquote><p>　シートベルトをつけないで運転することが危ないです！<br>　在不系安全带的状态下开车是危险的</p></blockquote><blockquote><p>　教科書を見ないで答えてみます。<br>　在不看课本的状态下试着回答一下。</p></blockquote><blockquote><p>　毎日ゲームばっかり勉強しないで、試験に合格するわけがないだろう！<br>　每天只顾玩游戏不学习，不可能通过考试吧！</p></blockquote><ul><li>「なくて」</li></ul><p>前面说「ないで」严格意义上并不是「ない」的テ形，那么「なくて」就是严格意义上「ない」的テ形了。<strong>当前后有因果关系时，会使用到「なくて」。</strong>比如下面这个例句，出自番剧《间谍过家家》里可爱的阿尼亚：</p><blockquote><p>　アニヤ、母いなくて寂しい～<br>　阿尼亚没有妈妈好寂寞~</p></blockquote><p>这里阿尼亚感到寂寞是因为没有妈妈，所以这里有因果关系。如果用「ないで」就变成阿尼亚说自己在没有妈妈的状态下寂寞了，让人感觉怪怪的。还有一些例句：</p><blockquote><p>　お金がなくて旅行できない。<br>　(因为)没钱(所以)没法出去旅游。</p></blockquote><h3 id="「ないで」-「ずに」"><a href="#「ないで」-「ずに」" class="headerlink" title="「ないで」&#x3D;「ずに」"></a>「ないで」&#x3D;「ずに」</h3><p>在N3的语法中我们还学过，<strong>动词否定还有一种形式是以「ず」结尾，即「ないで」&#x3D;「ずに」</strong>。这里的「ずに」明显是与其后接续的另外一个动词有关联性，如：</p><blockquote><p>　遠慮しないでいきましょう！　＝　遠慮せずに行きましょう！<br>　遠慮しなくていきましょう！　×<br>　不用担心，就这样上吧！（碧蓝幻想relink中夏洛特的副本出发语音。）　</p></blockquote><hr><h2 id="一类形容词“过去否定”「なかった」如何接续？"><a href="#一类形容词“过去否定”「なかった」如何接续？" class="headerlink" title="一类形容词“过去否定”「なかった」如何接续？"></a>一类形容词“过去否定”「なかった」如何接续？</h2><p>以「面白い」为例：「面白い」接续变テ形「面白くて」，其一般否定形式「面白くない」接续变テ形「面白くなくて」。那么问题来了，其过去否定形式「面白くなかった」接续怎么变テ形呢？<strong>我想破了脑袋也没想出来「なかった」怎么变テ形，因为「なかった」准确来说已经是一个タ形了。</strong></p><p>其实，<strong>如果真想在「なかった」后面接续，直接分成两个句子并用「が」&#x2F;「けれど」等助词连接即可，不用テ形。</strong> 比如：</p><blockquote><p>　この映画は面白くなかったけど、映像は綺麗だった。<br>　(昨天看的)这部电影不有趣，但画面很漂亮。</p></blockquote><blockquote><p>　昨日のプレゼンは緊張感がなく、あまり印象的ではなかったが、今日のプレゼンはとても説得力があって素晴らしかった。<br>　昨天的演讲没有紧张感，也不是很有印象深刻，但今天的演讲非常有说服力，非常出色。</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>关于「させていただきます」的几点理解</title>
      <link href="/2024/11/14/nihongo-itadaku/"/>
      <url>/2024/11/14/nihongo-itadaku/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题引发"><a href="#问题引发" class="headerlink" title="问题引发"></a>问题引发</h2><p>今天上日语中级会话课的时候，看到了几个用到了敬语「いただく」的句子。</p><blockquote><p>（お店の張り紙）本日は定休日につき、<strong>休ませていただきます。</strong></p></blockquote><blockquote><p>　ー　ぜひ鈴木さんの下でプロジェクトを<strong>担当させていただきたい</strong>と思っておいます。</p></blockquote><p>从一开始学习日语我就比较头疼敬语，尤其是「いただく」这种与其他语法亦有繁多组合的敬语文法（比如可以组合成「させていただいてもいいですか」、「いただきたい」等等），这让我有一丝的畏惧，因此我一直没有理解这一部分。今天正好有兴致研究这一部分，趁此机会或许可以透析一下这个文法。</p><hr><h2 id="「いただきます」是「もらう」的自谦语"><a href="#「いただきます」是「もらう」的自谦语" class="headerlink" title="「いただきます」是「もらう」的自谦语"></a>「いただきます」是「もらう」的自谦语</h2><p>在N4学习“授受关系”时，书上或者老师肯定会提到三个“授受关系”动词的敬语形态。</p><ul><li>あげる：我给别人。　　—&gt;　差し上げます（さしあげます）</li><li>もらう：我&#x2F;别人收到。   —&gt;　頂きます（いただきます）</li><li>くれる：我收到。(私にくれる)   —&gt; くださいます</li></ul><p>虽然是简单的N4语法，也有必要重新说明一下： <strong>「いただきます」是「もらう」的自谦语，表示主语是动作的接收方。</strong> 比如：「彼に手伝ってもらう」表示接收到了他的帮助；「母にパソコンを買ってもらう」表示妈妈帮我买了电脑(我接受到了妈妈买电脑的动作)。</p><p>当然，对于二次元来说「いただきます」可谓是再熟悉不过了，因为日本人吃饭前都会说一句：“いただきます！”，字幕通常把他翻译成：“我开动了！”。<strong>这是因为「いただきます」还是「食べる」和「飲む」的自谦形式。</strong> 我自己说我自己要吃&#x2F;喝了，那按道理就要用谦让语了。至于为什么要在开饭前对着家人或者朋友说敬语，这只能解释为日本人几百年来养成的语言习惯了。不过，「させていただきます」中的「いただきます」是「もらう」的自谦语，并不是「食べる」或者「飲む」的自谦语，因此本博客主要还是讨论前者。</p><hr><h2 id="「させてもらう」-「させていただきます」：请允许我做"><a href="#「させてもらう」-「させていただきます」：请允许我做" class="headerlink" title="「させてもらう」-&gt;「させていただきます」：请允许我做"></a>「させてもらう」-&gt;「させていただきます」：请允许我做</h2><ul><li><strong>「させていただきます」表达一种“征求对方同意”的语义，可以翻译成“请允许我(做)……”，是一个自谦语表达。他的原形是「させてもらう」。</strong></li><li><strong>过去式「させていただきました」并不是为了表示时间上的过去，而是出于礼貌，表示自己已经领受或得到了对方的许可，从而更加尊重对方的心意。</strong>日语中，尤其是敬语表达时，过去式并不一定是指时间上的过去，而更多是表达一种「完了」的状态，以传达谦逊和礼貌。</li></ul><p>如果从文法的角度思考，「させる」是使役形（让…做），其テ形后续接动词 「いただく」。从文法上的理解，「させていただきます」的意思是”让我获得…”，或者说”让我得到做…（的允许）”。如果使用过去式「させていただきした」，难道要理解成过去已经允许我做过某些事？这样理解起来还是有些别扭。</p><p>其实我们没有必要一味追求语法的思考，我认为首先我们需要记住他的意思并记忆一些例句，积累语感。我们从「させてもらう」开始，转变到「させていただきます」。</p><blockquote><p>　紹介させてもらいます。<br>　電話させてもらいました。<br>　食べさせてもらった。</p></blockquote><blockquote><p>　紹介させていただきます。<br>　電話させていただきました。<br>　食べさせていただきました。</p></blockquote><blockquote><p>　请允许我介绍一下。<br>　承蒙您的允许，我给您打电话了。  —&gt;  我给您打电话，打扰您了。<br>　承蒙您的允许，我吃了。   —&gt;  多谢您的款待。</p></blockquote><p>理解了上面几个例句，这时候我们再看第一节中的第一个句子，就非常清晰明了了。</p><blockquote><p>（お店の張り紙）本日は定休日につき、<strong>休ませていただきます。</strong><br>（商店门口的贴纸）今天是休息日，请允许我们今天停业。</p></blockquote><hr><h2 id="诸如「させていただいてもいいですか」的引申"><a href="#诸如「させていただいてもいいですか」的引申" class="headerlink" title="诸如「させていただいてもいいですか」的引申"></a>诸如「させていただいてもいいですか」的引申</h2><p>下面介绍几组基于「させていただきます」的几个引申文法，理解起来也并不困难。但这里肯定不可能总结所有的引申文法，也没有这个必要，只需要理解常见的即可，积累预感。</p><h3 id="第一组：-いいですか"><a href="#第一组：-いいですか" class="headerlink" title="第一组：+いいですか"></a>第一组：+いいですか</h3><p>-　させてもらってもいいですか<br>-　させていただいてもいいですか<br>-　させていただいてもよろしいでしょうか</p><p>上述三个文法在「させていただきます」的基础上接续了「てもいいですか」。<strong>增加「てもいいですか」本质上是表达更加礼貌的一种请求，意思仍然是“请允许我…”</strong>，无需过多揣测其文法逻辑。另外，上述三个文法礼貌程度逐渐增加，这是因为「もらう」变「いただく」、「いいですか」变「よろしいでしょうか」都是更加尊敬的表达。</p><h3 id="第二组：-たい"><a href="#第二组：-たい" class="headerlink" title="第二组：-たい"></a>第二组：-たい</h3><p>-　させていただきたい</p><p>由于文法主体仍然是「させていただきます」，因此「させていただきたい」表达的仍然是一种请求，只不过最后的「たい」表达了 <strong>“我想要做某事”的愿望</strong>。我们甚至可以更加<strong>简单地认为「させていただきたい」就是「～したい」&#x2F;「～することがほしいです」的礼貌自谦形式。</strong></p><p>我们回到问题引发中的句子，发现已经可以理解了。在这里，「担当させていただきたい」表达了说话人对担任项目负责人的强烈愿望，同时使用了非常礼貌和谦逊的语气。通过使用「させていただく」，说话人显得既尊重对方，也表达了对机会的渴望。整体上，这种表达方式在正式场合或职场中非常合适，特别是向上司或领导表达希望得到某项任务或责任的请求时。</p><blockquote><p>ー　ぜひ鈴木さんの下でプロジェクトを<strong>担当させていただきたい</strong>と思っておいます。<br>  —— 我非常希望能够在铃木先生的领导下负责这个项目。</p></blockquote><h3 id="第三组：可能形"><a href="#第三组：可能形" class="headerlink" title="第三组：可能形"></a>第三组：可能形</h3><p>-　させていただけませんか<br>-　させていただけないでょうか</p><p>文法上，「いただけます」是「いただく」的可能形。但 <strong>「させていただけませんか」其实也表示“能不能让我做……”的请求，可以视为「させていただきます」的另一种说法。</strong></p><p><strong>「させていただけないでしょうか」是「させていただけませんか」的稍微更正式或更委婉的说法，意思是几乎相同。</strong>语感上「ないでしょうか」带有更强的请求语气，通常用于非常正式或需要特别委婉表达的场合。</p><hr><h2 id="很好的视频"><a href="#很好的视频" class="headerlink" title="很好的视频"></a>很好的视频</h2><iframe     src="//player.bilibili.com/player.html?isOutside=true&aid=512275586&bvid=BV1Ng41197SN&cid=742559217&p=1"     width="900"     height="550"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     allowfullscreen="true"></iframe>]]></content>
      
      
      <categories>
          
          <category> 日本語 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日本語 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用原生opencv代码实现霍夫变换(Tough-Transform)</title>
      <link href="/2024/11/10/opencv/"/>
      <url>/2024/11/10/opencv/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="基本要求"><a href="#基本要求" class="headerlink" title="基本要求"></a>基本要求</h2><blockquote><p>Hough transform is a very classic and useful method for the detection of curves or lines. It uses the transformation of two coordinate spaces (the image space and the Hough space) to map curves or straight lines to points in another coordinate space to vote and form peaks, thus transforming the problem of detecting arbitrary shapes into a statistical peak problem.<br>In this task, you can draw some lines or circles by yourself and use Hough Transform to detect the figure you drew (you can try for lines firstly and then for circles). MUST implement it yourself!</p></blockquote><h2 id="代码框架"><a href="#代码框架" class="headerlink" title="代码框架"></a>代码框架</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ToughTransform</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">LineDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max , <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="直线检测"><a href="#直线检测" class="headerlink" title="直线检测"></a>直线检测</h2><ul><li><strong>void LineDetection(Mat&amp; Image):</strong> 算法主流程。包括将图像转化到二维参数空间(row,theta),对参数空间矩阵进行初次阈值过滤,以及调用ShowParameterSpace和DrawLineDetectedImage方法。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    LineDetection: ShowParameterSpace + DrawLineDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::LineDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[row][theta]</span></span><br><span class="line">    <span class="type">double</span> row_max = <span class="built_in">sqrt</span>(img_width * img_width + img_height * img_height);</span><br><span class="line">    <span class="type">int</span> theta_max = <span class="number">180</span>;   <span class="comment">//theta: step_length = 1</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PatameterSpace</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ImageSize:&quot;</span> &lt;&lt; img_height &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; img_width &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;PatameterSpace:&quot;</span> &lt;&lt; <span class="number">2</span>*row_max &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; <span class="string">&quot; --&gt; &quot;</span> &lt;&lt; <span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)) &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//!!!look through theta, calc row than write into parameter-space!!!</span></span><br><span class="line">                <span class="comment">//遍历theta，计算row，存入参数空间</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt;= theta_max; theta++)&#123;  </span><br><span class="line">                    <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                    <span class="type">double</span> row = x * <span class="built_in">cos</span>(theta_rad) + y * <span class="built_in">sin</span>(theta_rad);</span><br><span class="line">                    <span class="comment">//row可能是负的,row_max作为偏移量. 将偏移量row_max加到row上，转为非负索引</span></span><br><span class="line">                    <span class="comment">//cout &lt;&lt; &quot;row = &quot; &lt;&lt; row &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; row + row_max  &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; ceil(row) + ceil(row_max) &lt;&lt; endl;</span></span><br><span class="line">                    PatameterSpace[<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row) + <span class="built_in">ceil</span>(row_max))][theta]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PS_AfterFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PatameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PatameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PatameterSpace[i][j] &gt;= threshold)</span><br><span class="line">                PS_AfterFilter[i][j] = PatameterSpace[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_AfterFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_AfterFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> second_filter_threshold = <span class="number">500</span>;</span><br><span class="line">    <span class="built_in">DrawLineDetectedImage</span>(Image,PS_AfterFilter,<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),theta_max,second_filter_threshold);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ShowParameterSpace(vector&lt;vector<int>&gt;&amp; PS_AfterFilter, string file_name, int thetaScale)：</strong> 在LineDetection和DrawLineDetectedImage中被调用，可以描绘出二维参数空间PS_AfterFilter(row,theta)的点分布。其中file_name是图片保存地址；thetaScale将theta轴拉伸，以达到更好的可视化效果。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ShowParameterSpace:</span></span><br><span class="line"><span class="comment">        描绘(row,theta)参数空间的图像。此时的参数矩阵PS_AfterFilter只经历了初步的阈值筛选。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">15</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> rows = PS_AfterFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">houghSpaceImage</span><span class="params">(rows, cols, CV_8UC1, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="type">int</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; row : PS_AfterFilter) &#123;</span><br><span class="line">        maxVal = <span class="built_in">max</span>(maxVal, *<span class="built_in">max_element</span>(row.<span class="built_in">begin</span>(), row.<span class="built_in">end</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">            houghSpaceImage.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="built_in">static_cast</span>&lt;uchar&gt;(<span class="number">255.0</span> * PS_AfterFilter[i][j] / maxVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(houghSpaceImage, enlargedHoughSpace, <span class="built_in">Size</span>(cols * thetaScale, rows), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>DrawLineDetectedImage(Mat&amp; Image, vector&lt;vector<int>&gt;&amp; PS_AfterFilter, int row_max, int theta_max , int second_filter_threshold):</strong> 将二维参数空间矩阵PS_AfterFilter进行更深层次的阈值筛选(阈值更大，筛选剩下的点更少)，然后反变换到”x,y直角坐标系”，描绘出检测出的直线。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DrawDetectedImage: </span></span><br><span class="line"><span class="comment">        二次过滤参数空间(row,theta)矩阵，然后在原图image上描绘出直线。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max = <span class="number">180</span>, <span class="type">int</span> second_filter_threshold = <span class="number">100</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">PS_FinalFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                       <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PS_AfterFilter[i][j] &gt;= second_filter_threshold)</span><br><span class="line">                PS_FinalFilter[i][j] = PS_AfterFilter[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_FinalFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_FinalFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> rows = PS_FinalFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; cols; theta++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PS_FinalFilter[row][theta] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">double</span> this_theta_rad = theta * PI / <span class="number">180.0</span>;  </span><br><span class="line">                <span class="type">double</span> this_row = row - row_max;</span><br><span class="line"></span><br><span class="line">                Point pt1, pt2;</span><br><span class="line">                <span class="type">double</span> a = <span class="built_in">cos</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> b = <span class="built_in">sin</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> x0 = a * this_row;</span><br><span class="line">                <span class="type">double</span> y0 = b * this_row;</span><br><span class="line">                pt<span class="number">1.</span>x = <span class="built_in">cvRound</span>(x0 + <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">1.</span>y = <span class="built_in">cvRound</span>(y0 + <span class="number">1000</span> * (a));</span><br><span class="line">                pt<span class="number">2.</span>x = <span class="built_in">cvRound</span>(x0 - <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">2.</span>y = <span class="built_in">cvRound</span>(y0 - <span class="number">1000</span> * (a));</span><br><span class="line"></span><br><span class="line">                <span class="built_in">line</span>(Image, pt1, pt2, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, LINE_AA);</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Lines&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Lines&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/line-result/DetectedLinesImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>调试方法：</strong> 调整阈值second_filter_threshold直到合适。如果阈值太低，描绘的直线就会过多，图上一片混乱；如果阈值太高，则不会有检测结果。</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>输入测试图片，主函数调用LineDetection(Mat&amp; Image)即可。</p><ul><li>测试图像如下。</li></ul><img src="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png"/><ul><li>霍夫变换并初步阈值过滤(threshold&#x3D;10)后，检测出的直线二维参数空间(row,theta)图像。</li></ul><img src="https://s2.loli.net/2024/11/10/zdjCqyXa6QkMBp1.png"/><ul><li>二次深度阈值过滤(threshold&#x3D;500)后，检测出的直线二维参数空间(row,theta)图像。</li></ul><img src="https://s2.loli.net/2024/11/10/J4VF9xdLYpwrayU.png"/><ul><li>反变换到直角坐标，原图上描绘出检测到的直线。</li></ul><img src="https://s2.loli.net/2024/11/10/IBofUtDdhnNelWx.png"/><hr><h2 id="圆检测"><a href="#圆检测" class="headerlink" title="圆检测"></a>圆检测</h2><ul><li><strong>CircleDetection(Mat&amp; Image):</strong> 算法主流程。包括将图像转化到三维参数空间(a,b,r)，其中圆心坐标为(a,b)，圆的半径是r。对参数空间矩阵进行初次阈值过滤,以及调用ShowParameterSpace_Circle和DrawCircleDetectedImage方法。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    CircleDetection: ShowParameterSpace_Circle + DrawCircleDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="comment">//在霍夫变换中，我们通过三个参数来描述一个圆：圆心的坐标(a,b)和半径r.</span></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[b][a][r]   b---&gt;height---&gt;y | a---&gt;width---&gt;x</span></span><br><span class="line">    <span class="type">int</span> max_a = img_width;</span><br><span class="line">    <span class="type">int</span> max_b = img_height;</span><br><span class="line">    <span class="type">int</span> max_r = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.5</span>* <span class="built_in">min</span>(max_a,max_b));</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">ParameterSpace</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//遍历r，计算row，存入参数空间: min_r = 20 --&gt; max_r</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> r = <span class="number">20</span>; r &lt;= max_r; r++)&#123;</span><br><span class="line">                    <span class="comment">//遍历每个r情况下的theta(一周)，计算a&amp;b，存入参数空间</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; <span class="number">360</span>; theta++)&#123;</span><br><span class="line">                        <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                        <span class="type">int</span> a = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x - r * <span class="built_in">cos</span>(theta_rad));</span><br><span class="line">                        <span class="type">int</span> b = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y - r * <span class="built_in">sin</span>(theta_rad));</span><br><span class="line">                        <span class="keyword">if</span>(a &gt;= <span class="number">0</span> &amp;&amp; a &lt; max_a &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b &lt; max_b)&#123;</span><br><span class="line">                            ParameterSpace[b][a][r]++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_AfterFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ParameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; ParameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; ParameterSpace[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ParameterSpace[i][j][k] &gt;= threshold)</span><br><span class="line">                    PS_AfterFilter[i][j][k] = ParameterSpace[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_AfterFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_AfterFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> second_filter_threshold = <span class="number">300</span>;</span><br><span class="line">    <span class="built_in">DrawCircleDetectedImage</span>(Image,PS_AfterFilter,max_a,max_b,max_r,second_filter_threshold);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ShowParameterSpace_Circle(vector&lt;vector&lt;vector<int>&gt;&gt;&amp; PS_AfterFilter, string file_name, int thetaScale)：</strong> 传入三维参数矩阵PS_AfterFilter，描绘图像。其中file_name是图片保存地址；thetaScale将theta轴拉伸，以达到更好的可视化效果。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> height = PS_AfterFilter.<span class="built_in">size</span>();     <span class="comment">//row的范围</span></span><br><span class="line">    <span class="type">int</span> width = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();   <span class="comment">// theta的范围</span></span><br><span class="line">    <span class="type">int</span> num_r = PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">// 半径r的数量</span></span><br><span class="line">    <span class="function">Mat <span class="title">parameter_space_image</span><span class="params">(height, width, CV_8UC1, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> b = <span class="number">0</span>; b &lt; height; b++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">0</span>; a &lt; width; a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; num_r; r++) &#123;</span><br><span class="line">                <span class="type">int</span> accumulator_value = PS_AfterFilter[b][a][r];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 将累积值映射到0-255的范围（可以根据实际情况调整比例）</span></span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">255.0</span> * accumulator_value / <span class="number">255.0</span>); </span><br><span class="line">                parameter_space_image.<span class="built_in">at</span>&lt;uchar&gt;(b, a) = intensity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(parameter_space_image, enlargedHoughSpace, <span class="built_in">Size</span>(width * thetaScale, height), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>DrawCircleDetectedImage(Mat&amp; Image,vector&lt;vector&lt;vector<int>&gt;&gt;&amp; PS_AfterFilter, int max_a, int max_b, int max_r, int second_filter_threshold)：</strong> 传入三维参数空间PS_AfterFilter，利用second_filter_threshold进行二次阈值筛选后，反变换到直角坐标。由于是圆检测，只需要取出圆心(x,y)和半径r的值，然后进行描绘即可。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_FinalFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(PS_AfterFilter[i][j][k] &gt;= second_filter_threshold)</span><br><span class="line">                    PS_FinalFilter[i][j][k] = PS_AfterFilter[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_FinalFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_FinalFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_FinalFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_FinalFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="comment">//draw circle</span></span><br><span class="line">                <span class="keyword">if</span>(PS_FinalFilter[i][j][k] != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="function">Point <span class="title">center</span><span class="params">(j, i)</span></span>;</span><br><span class="line">                    <span class="built_in">circle</span>(Image, center, k, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>);  <span class="comment">//红色圆圈</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/circle-result/DrawCircleDetectedImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>调试方法：</strong> <ul><li>调整阈值second_filter_threshold直到合适。如果阈值太低，描绘的圆就会过多，图上一片混乱；如果阈值太高，则不会有检测结果。</li><li>调整参数计算时，半径的遍历上下限的r_min和r_max。r_max一般直接取图像height和width中的较小值。r_min如果取0，那么有宽度的直线也会被检测成一长串的迷你圆；r_min取得太小，可能会把交点也检测成小圆。</li></ul></li></ul><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><p>输入测试图片，主函数调用CircleDetection(Mat&amp; Image)即可。</p><ul><li>测试图像如下。</li></ul><img src="https://s2.loli.net/2024/11/10/tnT7CJQDNgLraUR.png"/><ul><li>霍夫变换并初步阈值(threshold&#x3D;10)过滤后，检测出的参数空间图像。</li></ul><img src="https://s2.loli.net/2024/11/10/PhSj2sOoIez7MfV.png"/><ul><li>二次深度阈值过滤(threshold&#x3D;300)后，检测出的圆参数空间图像。</li></ul><img src="https://s2.loli.net/2024/11/10/Ou8HU2AxKkST4bN.png"/><ul><li>反变换到直角坐标，原图上描绘出检测到的圆。</li></ul><img src="https://s2.loli.net/2024/11/10/B68dTPnk1OAIpMh.png"/><hr><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core.hpp&gt;</span>     <span class="comment">// Basic OpenCV structures (cv::Mat)</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/videoio.hpp&gt;</span>  <span class="comment">// Video write</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgcodecs.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/videoio.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/video.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="number">3.14159265358979323846</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ToughTransform</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">LineDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max , <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">    ShowParameterSpace:</span></span><br><span class="line"><span class="comment">        描绘(row,theta)参数空间的图像。此时的参数矩阵PS_AfterFilter只经历了初步的阈值筛选。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">15</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> rows = PS_AfterFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">houghSpaceImage</span><span class="params">(rows, cols, CV_8UC1, Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="type">int</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; row : PS_AfterFilter) &#123;</span><br><span class="line">        maxVal = <span class="built_in">max</span>(maxVal, *<span class="built_in">max_element</span>(row.<span class="built_in">begin</span>(), row.<span class="built_in">end</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</span><br><span class="line">            houghSpaceImage.<span class="built_in">at</span>&lt;uchar&gt;(i, j) = <span class="built_in">static_cast</span>&lt;uchar&gt;(<span class="number">255.0</span> * PS_AfterFilter[i][j] / maxVal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(houghSpaceImage, enlargedHoughSpace, <span class="built_in">Size</span>(cols * thetaScale, rows), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Enhanced Hough Space&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    DrawDetectedImage: </span></span><br><span class="line"><span class="comment">        二次过滤参数空间(row,theta)矩阵，然后在原图image上描绘出直线。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawLineDetectedImage</span><span class="params">(Mat&amp; Image, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> row_max, <span class="type">int</span> theta_max = <span class="number">180</span>, <span class="type">int</span> second_filter_threshold = <span class="number">100</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">PS_FinalFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                       <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PS_AfterFilter[i][j] &gt;= second_filter_threshold)</span><br><span class="line">                PS_FinalFilter[i][j] = PS_AfterFilter[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_FinalFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_FinalFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> rows = PS_FinalFilter.<span class="built_in">size</span>();</span><br><span class="line">    <span class="type">int</span> cols = PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> row = <span class="number">0</span>; row &lt; rows; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; cols; theta++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PS_FinalFilter[row][theta] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">double</span> this_theta_rad = theta * PI / <span class="number">180.0</span>;  </span><br><span class="line">                <span class="type">double</span> this_row = row - row_max;</span><br><span class="line"></span><br><span class="line">                Point pt1, pt2;</span><br><span class="line">                <span class="type">double</span> a = <span class="built_in">cos</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> b = <span class="built_in">sin</span>(this_theta_rad);</span><br><span class="line">                <span class="type">double</span> x0 = a * this_row;</span><br><span class="line">                <span class="type">double</span> y0 = b * this_row;</span><br><span class="line">                pt<span class="number">1.</span>x = <span class="built_in">cvRound</span>(x0 + <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">1.</span>y = <span class="built_in">cvRound</span>(y0 + <span class="number">1000</span> * (a));</span><br><span class="line">                pt<span class="number">2.</span>x = <span class="built_in">cvRound</span>(x0 - <span class="number">1000</span> * (-b));</span><br><span class="line">                pt<span class="number">2.</span>y = <span class="built_in">cvRound</span>(y0 - <span class="number">1000</span> * (a));</span><br><span class="line"></span><br><span class="line">                <span class="built_in">line</span>(Image, pt1, pt2, <span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>, LINE_AA);</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Lines&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Lines&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/line-result/DetectedLinesImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    LineDetection: ShowParameterSpace + DrawLineDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::LineDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[row][theta]</span></span><br><span class="line">    <span class="type">double</span> row_max = <span class="built_in">sqrt</span>(img_width * img_width + img_height * img_height);</span><br><span class="line">    <span class="type">int</span> theta_max = <span class="number">180</span>;   <span class="comment">//theta: step_length = 1</span></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PatameterSpace</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ImageSize:&quot;</span> &lt;&lt; img_height &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; img_width &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;PatameterSpace:&quot;</span> &lt;&lt; <span class="number">2</span>*row_max &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; <span class="string">&quot; --&gt; &quot;</span> &lt;&lt; <span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)) &lt;&lt; <span class="string">&quot;*&quot;</span> &lt;&lt; theta_max &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//!!!look through theta, calc row than write into parameter-space!!!</span></span><br><span class="line">                <span class="comment">//遍历theta，计算row，存入参数空间</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt;= theta_max; theta++)&#123;  </span><br><span class="line">                    <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                    <span class="type">double</span> row = x * <span class="built_in">cos</span>(theta_rad) + y * <span class="built_in">sin</span>(theta_rad);</span><br><span class="line">                    <span class="comment">//row可能是负的,row_max作为偏移量. 将偏移量row_max加到row上，转为非负索引</span></span><br><span class="line">                    <span class="comment">//cout &lt;&lt; &quot;row = &quot; &lt;&lt; row &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; row + row_max  &lt;&lt; &quot; ---&gt; &quot; &lt;&lt; ceil(row) + ceil(row_max) &lt;&lt; endl;</span></span><br><span class="line">                    PatameterSpace[<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row) + <span class="built_in">ceil</span>(row_max))][theta]++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;  <span class="built_in">PS_AfterFilter</span>(<span class="number">2</span> * <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),</span><br><span class="line">                                        <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(theta_max, <span class="number">0</span>));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PatameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PatameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(PatameterSpace[i][j] &gt;= threshold)</span><br><span class="line">                PS_AfterFilter[i][j] = PatameterSpace[i][j];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                PS_AfterFilter[i][j] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace</span>(PS_AfterFilter,<span class="string">&quot;source/line-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> second_filter_threshold = <span class="number">500</span>;</span><br><span class="line">    <span class="built_in">DrawLineDetectedImage</span>(Image,PS_AfterFilter,<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="built_in">ceil</span>(row_max)),theta_max,second_filter_threshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::ShowParameterSpace_Circle</span><span class="params">(vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, string file_name, <span class="type">int</span> thetaScale = <span class="number">1</span>)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> height = PS_AfterFilter.<span class="built_in">size</span>();     <span class="comment">//row的范围</span></span><br><span class="line">    <span class="type">int</span> width = PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>();   <span class="comment">// theta的范围</span></span><br><span class="line">    <span class="type">int</span> num_r = PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">// 半径r的数量</span></span><br><span class="line">    <span class="function">Mat <span class="title">parameter_space_image</span><span class="params">(height, width, CV_8UC1, cv::Scalar(<span class="number">0</span>))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> b = <span class="number">0</span>; b &lt; height; b++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> a = <span class="number">0</span>; a &lt; width; a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> r = <span class="number">0</span>; r &lt; num_r; r++) &#123;</span><br><span class="line">                <span class="type">int</span> accumulator_value = PS_AfterFilter[b][a][r];</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 将累积值映射到0-255的范围（可以根据实际情况调整比例）</span></span><br><span class="line">                <span class="type">int</span> intensity = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">255.0</span> * accumulator_value / <span class="number">255.0</span>); </span><br><span class="line">                parameter_space_image.<span class="built_in">at</span>&lt;uchar&gt;(b, a) = intensity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Mat enlargedHoughSpace;</span><br><span class="line">    <span class="built_in">resize</span>(parameter_space_image, enlargedHoughSpace, <span class="built_in">Size</span>(width * thetaScale, height), <span class="number">0</span>, <span class="number">0</span>, INTER_LINEAR);</span><br><span class="line">    Mat colorHoughSpace;</span><br><span class="line">    <span class="built_in">applyColorMap</span>(enlargedHoughSpace, colorHoughSpace, COLORMAP_JET);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, colorHoughSpace);</span><br><span class="line">    <span class="built_in">imwrite</span>(file_name, colorHoughSpace);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::DrawCircleDetectedImage</span><span class="params">(Mat&amp; Image,vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt;&amp; PS_AfterFilter, <span class="type">int</span> max_a, <span class="type">int</span> max_b, <span class="type">int</span> max_r, <span class="type">int</span> second_filter_threshold)</span></span>&#123;</span><br><span class="line">    <span class="comment">//threshold-filter-second</span></span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_FinalFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_AfterFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_AfterFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_AfterFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(PS_AfterFilter[i][j][k] &gt;= second_filter_threshold)</span><br><span class="line">                    PS_FinalFilter[i][j][k] = PS_AfterFilter[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_FinalFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_FinalFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FinalFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; PS_FinalFilter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; PS_FinalFilter[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; PS_FinalFilter[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="comment">//draw circle</span></span><br><span class="line">                <span class="keyword">if</span>(PS_FinalFilter[i][j][k] != <span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="function">Point <span class="title">center</span><span class="params">(j, i)</span></span>;</span><br><span class="line">                    <span class="built_in">circle</span>(Image, center, k, cv::<span class="built_in">Scalar</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>);  <span class="comment">//红色圆圈</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;Detected Circles&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">    <span class="built_in">imshow</span>(<span class="string">&quot;Detected Circles&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">imwrite</span>(<span class="string">&quot;source/circle-result/DrawCircleDetectedImage.png&quot;</span>, Image);</span><br><span class="line">    <span class="built_in">waitKey</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    CircleDetection: ShowParameterSpace_Circle + DrawCircleDetectedImage</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ToughTransform::CircleDetection</span><span class="params">(Mat&amp; Image)</span></span>&#123;</span><br><span class="line">    <span class="comment">//在霍夫变换中，我们通过三个参数来描述一个圆：圆心的坐标(a,b)和半径r.</span></span><br><span class="line">    <span class="type">int</span> img_width = Image.<span class="built_in">size</span>().width;</span><br><span class="line">    <span class="type">int</span> img_height = Image.<span class="built_in">size</span>().height;</span><br><span class="line">    <span class="comment">//ParameterSpace[b][a][r]   b---&gt;height---&gt;y | a---&gt;width---&gt;x</span></span><br><span class="line">    <span class="type">int</span> max_a = img_width;</span><br><span class="line">    <span class="type">int</span> max_b = img_height;</span><br><span class="line">    <span class="type">int</span> max_r = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(<span class="number">0.5</span>* <span class="built_in">min</span>(max_a,max_b));</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">ParameterSpace</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; img_height; y++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; img_width; x++)&#123;</span><br><span class="line">            <span class="type">int</span> B = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> G = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> R = Image.<span class="built_in">at</span>&lt;Vec3b&gt;(y,x)[<span class="number">2</span>]; </span><br><span class="line">            <span class="keyword">if</span>(B == <span class="number">0</span> &amp;&amp; G == <span class="number">0</span> &amp;&amp; R == <span class="number">0</span>)&#123;   <span class="comment">//Edge is black-pixel</span></span><br><span class="line">                <span class="comment">//遍历r，计算row，存入参数空间: min_r = 20 --&gt; max_r</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> r = <span class="number">20</span>; r &lt;= max_r; r++)&#123;</span><br><span class="line">                    <span class="comment">//遍历每个r情况下的theta(一周)，计算a&amp;b，存入参数空间</span></span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> theta = <span class="number">0</span>; theta &lt; <span class="number">360</span>; theta++)&#123;</span><br><span class="line">                        <span class="type">double</span> theta_rad = theta * PI / <span class="number">180.0</span>;</span><br><span class="line">                        <span class="type">int</span> a = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(x - r * <span class="built_in">cos</span>(theta_rad));</span><br><span class="line">                        <span class="type">int</span> b = <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(y - r * <span class="built_in">sin</span>(theta_rad));</span><br><span class="line">                        <span class="keyword">if</span>(a &gt;= <span class="number">0</span> &amp;&amp; a &lt; max_a &amp;&amp; b &gt;= <span class="number">0</span> &amp;&amp; b &lt; max_b)&#123;</span><br><span class="line">                            ParameterSpace[b][a][r]++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="type">int</span> threshold = <span class="number">10</span>;</span><br><span class="line">    vector&lt;vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">PS_AfterFilter</span>(max_b,</span><br><span class="line">                                               vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(max_a,</span><br><span class="line">                                               <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(max_r)</span><br><span class="line">                                               ));</span><br><span class="line">    <span class="comment">//threshold-filter</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ParameterSpace.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; ParameterSpace[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; ParameterSpace[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ParameterSpace[i][j][k] &gt;= threshold)</span><br><span class="line">                    PS_AfterFilter[i][j][k] = ParameterSpace[i][j][k];</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PS_AfterFilter[i][j][k] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">ShowParameterSpace_Circle</span>(PS_AfterFilter,<span class="string">&quot;source/circle-result/EnhancedHoughSpaceImage-FirstFilter.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> second_filter_threshold = <span class="number">300</span>;</span><br><span class="line">    <span class="built_in">DrawCircleDetectedImage</span>(Image,PS_AfterFilter,max_a,max_b,max_r,second_filter_threshold);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ToughTransform handle;</span><br><span class="line">    <span class="comment">//Mat img = imread(&quot;source/line.png&quot;);</span></span><br><span class="line">    <span class="comment">//LineDetection(img);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Mat img2 = imread(&quot;source/testline_cross.png&quot;);</span></span><br><span class="line">    <span class="comment">//LineDetection(img2);</span></span><br><span class="line"></span><br><span class="line">    Mat img3 = <span class="built_in">imread</span>(<span class="string">&quot;source/line_circle.png&quot;</span>);</span><br><span class="line">    <span class="comment">//handle.LineDetection(img3);</span></span><br><span class="line">    handle.<span class="built_in">CircleDetection</span>(img3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LAB EXERCISE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> Tough-Transform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>寄存器堆(RegisterFile)的设计和仿真验证</title>
      <link href="/2024/11/03/RegisterFile/"/>
      <url>/2024/11/03/RegisterFile/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="RF4x8模块硬件描述"><a href="#RF4x8模块硬件描述" class="headerlink" title="RF4x8模块硬件描述"></a>RF4x8模块硬件描述</h2><p>基本功能描述：</p><ul><li>读写全双工。<strong>写入数据</strong>需要①拉高一位使能信号en_wr并②给定地址Addr_wr和③数据Data_wr；<strong>读取数据</strong>需要给定地址Addr_rd_X，并支持两路读取(X&#x3D;A&#x2F;B)。</li><li>数据位宽：8bit；地址位宽：4bit，地址总数2^4&#x3D;16个。即<strong>本RF4x8中可以存放16个8bit数据</strong>。</li><li>时序：clk上升沿检测钟控；rst下降沿检测，异步复位。</li></ul><img src="https://s2.loli.net/2024/11/03/9FjlhLSgbz2spkI.jpg" width="400" height="800"><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> RF4x8 #( <span class="keyword">parameter</span></span><br><span class="line">    DATA_WIDTH = <span class="number">8</span>,</span><br><span class="line">    ADDR_WIDTH = <span class="number">4</span></span><br><span class="line">)(</span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>    clk,</span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>    rst,</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>    en_wr,</span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>]   Data_wr,    <span class="comment">//写数据：位宽为8bit</span></span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>[ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>]   Addr_wr,    <span class="comment">//写地址：地址位宽为4bit,因此总地址数量为2^4 = 16</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>[ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>]   Addr_rd_A,  <span class="comment">//读地址A</span></span><br><span class="line">    <span class="keyword">input</span>   <span class="keyword">wire</span>[ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>]   Addr_rd_B,  <span class="comment">//读地址B</span></span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>]    Data_rd_A,</span><br><span class="line">    <span class="keyword">output</span>  <span class="keyword">reg</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>]    Data_rd_B</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span>[<span class="number">2</span>**ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>]  addr;</span><br><span class="line"><span class="keyword">reg</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>]  data[<span class="number">0</span>:<span class="number">2</span>**ADDR_WIDTH-<span class="number">1</span>];   <span class="comment">//[7:0] data[0:15] -&gt; 16个地址，每个地址下存储一个8bit数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//reset:清空数据</span></span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!rst)    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">2</span>**ADDR_WIDTH; i=i+<span class="number">1</span>)    data[i] &lt;= <span class="number">8&#x27;b0000_0000</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//写数据</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(en_wr)           <span class="comment">//写使能en_wr==1&#x27;b1  </span></span><br><span class="line">        data[Addr_wr] &lt;= Data_wr;</span><br><span class="line">    <span class="keyword">else</span>    </span><br><span class="line">        data[Addr_wr] &lt;= data[Addr_wr];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//读数据</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Data_rd_A &lt;= data[Addr_rd_A];   <span class="comment">//A通道</span></span><br><span class="line">    Data_rd_B &lt;= data[Addr_rd_B];   <span class="comment">//B通道</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><hr><h2 id="RF4x8仿真分析"><a href="#RF4x8仿真分析" class="headerlink" title="RF4x8仿真分析"></a>RF4x8仿真分析</h2><h3 id="仿真模块RF4x8-tb"><a href="#仿真模块RF4x8-tb" class="headerlink" title="仿真模块RF4x8_tb"></a>仿真模块RF4x8_tb</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 10ps</span></span><br><span class="line"><span class="keyword">module</span> RF4x8_tb();</span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> DATA_WIDTH = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">parameter</span> ADDR_WIDTH = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">reg</span> clk,rst;</span><br><span class="line"><span class="keyword">reg</span> en_wr;</span><br><span class="line"><span class="keyword">reg</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>] Data_wr;</span><br><span class="line"><span class="keyword">reg</span>[ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>] Addr_wr;</span><br><span class="line"><span class="keyword">reg</span>[ADDR_WIDTH-<span class="number">1</span>:<span class="number">0</span>] Addr_rd_A,Addr_rd_B;</span><br><span class="line"><span class="keyword">wire</span>[DATA_WIDTH-<span class="number">1</span>:<span class="number">0</span>] Data_rd_A,Data_rd_B;</span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    clk &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    rst &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    en_wr &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">always</span> #<span class="number">10</span>  clk &lt;= ~clk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="built_in">$monitor</span>(<span class="string">&quot;%t Data_rd_A=%b Data_rd_B=%b&quot;</span>,<span class="built_in">$time</span>,Data_rd_A,Data_rd_B);</span><br><span class="line">    #<span class="number">10</span> rst &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    #<span class="number">10</span> rst &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="comment">//测试写入</span></span><br><span class="line">    #<span class="number">20</span> en_wr &lt;= <span class="number">1&#x27;b1</span>;  Addr_wr &lt;= <span class="number">4&#x27;b0000</span>;  Data_wr &lt;= <span class="number">8&#x27;b1001_0011</span>;</span><br><span class="line">    #<span class="number">20</span> en_wr &lt;= <span class="number">1&#x27;b1</span>;  Addr_wr &lt;= <span class="number">4&#x27;b0001</span>;  Data_wr &lt;= <span class="number">8&#x27;b1111_0000</span>;</span><br><span class="line">    #<span class="number">20</span> en_wr &lt;= <span class="number">1&#x27;b1</span>;  Addr_wr &lt;= <span class="number">4&#x27;b1100</span>;  Data_wr &lt;= <span class="number">8&#x27;b0000_1011</span>;</span><br><span class="line">    #<span class="number">20</span> en_wr &lt;= <span class="number">1&#x27;b1</span>;  Addr_wr &lt;= <span class="number">4&#x27;b1111</span>;  Data_wr &lt;= <span class="number">8&#x27;b0100_1111</span>;</span><br><span class="line">    <span class="comment">//测试读取</span></span><br><span class="line">    en_wr &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">    #<span class="number">20</span> Addr_rd_A &lt;= <span class="number">4&#x27;b0000</span>;   Addr_rd_B &lt;= <span class="number">4&#x27;b0000</span>;</span><br><span class="line">    #<span class="number">20</span> Addr_rd_A &lt;= <span class="number">4&#x27;b0000</span>;   Addr_rd_B &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">    #<span class="number">20</span> Addr_rd_A &lt;= <span class="number">4&#x27;b1111</span>;   Addr_rd_B &lt;= <span class="number">4&#x27;b1100</span>;</span><br><span class="line">    <span class="comment">//测试读写双全工</span></span><br><span class="line">    #<span class="number">20</span> en_wr &lt;= <span class="number">1&#x27;b1</span>;  Addr_wr &lt;= <span class="number">4&#x27;b0101</span>;  Data_wr &lt;= <span class="number">8&#x27;b1111_1111</span>;</span><br><span class="line">    #<span class="number">20</span> Addr_rd_A &lt;= <span class="number">4&#x27;b0101</span>;   Addr_rd_B &lt;= <span class="number">4&#x27;b0101</span>;</span><br><span class="line">    #<span class="number">50</span></span><br><span class="line">    <span class="comment">//测试复位</span></span><br><span class="line">    #<span class="number">10</span> rst &lt;= <span class="number">1&#x27;b0</span>;    en_wr &lt;= <span class="number">1&#x27;b0</span>;  Addr_wr &lt;= <span class="number">4&#x27;bx</span>;  Data_wr &lt;= <span class="number">8&#x27;bx</span>;</span><br><span class="line">    #<span class="number">10</span> rst &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">    #<span class="number">20</span> Addr_rd_A &lt;= <span class="number">4&#x27;b0101</span>;   Addr_rd_B &lt;= <span class="number">4&#x27;b0101</span>;</span><br><span class="line">    #<span class="number">20</span></span><br><span class="line">    <span class="built_in">$finish</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RF4x8 RF4x8_for_simultion(</span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.rst</span>(rst),</span><br><span class="line">    </span><br><span class="line">    <span class="variable">.en_wr</span>(en_wr),</span><br><span class="line">    <span class="variable">.Data_wr</span>(Data_wr),  </span><br><span class="line">    <span class="variable">.Addr_wr</span>(Addr_wr),  </span><br><span class="line">          </span><br><span class="line">    <span class="variable">.Addr_rd_A</span>(Addr_rd_A),</span><br><span class="line">    <span class="variable">.Addr_rd_B</span>(Addr_rd_B),</span><br><span class="line">    <span class="variable">.Data_rd_A</span>(Data_rd_A),</span><br><span class="line">    <span class="variable">.Data_rd_B</span>(Data_rd_B) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="仿真结果时序分析"><a href="#仿真结果时序分析" class="headerlink" title="仿真结果时序分析"></a>仿真结果时序分析</h3><ul><li><strong>40ns,60ns,80ns,100ns时写数据：</strong>拉高写使能信号en_wr,分别向地址0000,0001,1100和1111写入数据10010011,11110000,00001011和01001111。写地址和写数据信号分别在50ns,70ns,90ns和110ns时刻的clk上升沿被捕捉到。</li><li><strong>120ns时读数据：</strong>给出A&#x2F;B端口读数据地址0000和0000,并在130ns的clk上升沿被捕捉(图1中粉色虚线所在位置),Data_rd_A&#x2F;Data_rd_B分别读取到地址0000处的数据10010011。</li><li><strong>130ns时读数据：</strong>改变B端口读地址为0001,在140ns的clk上升沿被捕捉,Data_rd_B读取到地址0001处的数据11110000。</li><li><strong>260ns时发生复位：</strong>rst被拉低(图2中黄色实线所在位置)，此时再读地址0101的数据，发现被重置为00000000。</li></ul><img src="https://s2.loli.net/2024/11/03/qA7xGedVZCSsin6.jpg"><img src="https://s2.loli.net/2024/11/03/R4EmpAqacloZKdJ.jpg"><p><strong>注</strong>：</p><ul><li>本测试例中，读地址给出后需要等待半个时钟周期才能读出数据，这是因为读地址信号刚好和clk错开(读地址信号给出时正好是clk下降沿)，需要等待clk到达上升沿才能捕捉到读地址信号。如果读写信号再延时半个时钟周期，那么不会出现这样的情况。</li><li>关于写使能信号en_wr：虽然支持读写双工，但在<strong>读数据时最好要把en_wr拉低</strong>。否则当RF与其他模块级联时，可能会导致RF在被读的同时被写入不正确的数据，这在后面的RF_ALU级联测试中会提到。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Course Assignment </category>
          
          <category> System LSI Design </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Verilog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>有关日语中「と」和「という」文法的一些理解</title>
      <link href="/2024/10/28/hinongo01/"/>
      <url>/2024/10/28/hinongo01/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="日本人说话时句末的「と」是什么意思？"><a href="#日本人说话时句末的「と」是什么意思？" class="headerlink" title="日本人说话时句末的「と」是什么意思？"></a>日本人说话时句末的「と」是什么意思？</h2><p>这个问题是我在做JLPT-N2的完形填空时发现的，当时文章中有这么一句话：</p><blockquote><p>時には、「陰口」が聞こえてくるかもしれない。「彼は、わがままだよな」「あいつはいつも定時だね」など<strong>と</strong>。</p></blockquote><p>当时我就很不理解这个「など」后面的「と」是什么意思，导致整段理解吃力。后来我去问了实验室里一个日本语上手的学长，才明白了这个用法的实际含义。</p><p><strong>「と」放在句末：转述别人说的话，或者是引用别人说的话。可以理解成「と言います」的省略。</strong> </p><p>在N4语法中有这么一条，叫 <strong>「と言います」表示“传闻，听说…”。</strong> 而省略后的「と」<strong>更多地用在转述他人说的话的场合上</strong>。因此，「と言います」与句尾的「と」的含义还是有细微的区别，但可以连携记忆。下面举一个「と言います」表示“传闻，听说…”的例文，同样也是出现在N2考题中的：</p><blockquote><p>　最近はインタネットを通じて知り合った人と結婚することも多い<strong>という</strong>。<br> （翻译）<br>  (听说)进来通过网络认识并结婚的人也很多。</p></blockquote><p>理解了这一点，我们就知道了文章中这句话的意思：</p><blockquote><p>時には、「陰口」が聞こえてくるかもしれない。「彼は、わがままだよな」「あいつはいつも定時だね」など<strong>と</strong>。<br>很多时候，我们可能会听到别人在暗地里的议论之词，“他这个人可真是任性啊”“那个家伙每次可都准时(下班)呢”种种。</p></blockquote><p>因为「彼は、わがままだよな」「あいつはいつも定時だね」这两句话是从别人口中说出的，文章引用他们的话，所以最后加了个「と」，表示“别人说……”</p><p>我们可以再举几个简单的情景对话例子，来理解这个句末的「と」。</p><ul><li><p>由于上周太浪的缘故，导致你的科研毫无进展，这周组会上被教授严厉地批评了一通。组会结束后，你的同学和你交谈了起来：</p><blockquote><p>　ー　なんでそんなに元気がない様子？<br>　ー　だって、先生が「来週頑張らなければ学校辞めろう！」<strong>と</strong>。<br>（翻译）<br> —— 为什么看起来这么没精神？<br> —— 因为老师说“下周再不努力的话就退学吧！”</p></blockquote></li><li><p>你有个好哥们暗恋一个女生，想送她生日礼物，但是他太怂了不敢问她喜欢什么东西，因此拜托你去打听一下。打听结束后，你们在交谈：</p><blockquote><p>　ー　何が情報があるんだか？<br>　ー　「可愛いウサギのバックが好きだ」<strong>と</strong>。<br>(翻译)<br> —— 得到什么情报没有？<br> —— 她说她喜欢可爱兔兔的包包。</p></blockquote></li><li><p>在原神的角色PV：纳西妲「生日快乐」中，纳西妲念的诗歌也用到了这个「と」：</p><blockquote><p>花車が揺らぎ、ナヒーダは目を開ける。そして言う、夢を見ていた<strong>と</strong>。ナヒーダの誕生日は今日なのだ<strong>と</strong>。<br>(翻译)<br>花车摇呀摇，纳西妲睁开眼。她说：刚刚做了梦，梦见纳西妲的生日就是今天。</p></blockquote></li></ul><iframe     src="//player.bilibili.com/player.html?isOutside=true&aid=774457097&bvid=BV1e14y157yY&cid=1052688695&p=1"     width="900"     height="550"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     allowfullscreen="true"></iframe><p>这个文法(或许也不能称之为文法)大概率是不会出现在语法书上的，但是在日本人<strong>日常的对话中非常常见</strong>，来日本的这一个多月里也时常会听到身边的日本人说。</p><hr><h2 id="日本人的口癖：「というふうに」・「という感じで」"><a href="#日本人的口癖：「というふうに」・「という感じで」" class="headerlink" title="日本人的口癖：「というふうに」・「という感じで」"></a>日本人的口癖：「というふうに」・「という感じで」</h2><p>这几周每周三晚上我都会有一节Digital Circuit的课，我发现教授在上课时经常会说这样几个短语：</p><blockquote><p>（哔哩吧啦解释一大堆专业性概念后）…というふうになって…<br>（哔哩吧啦解释一大堆专业性概念后）…という感じで…</p></blockquote><p>于是我就去搜索了一下「というふうに」的意思，发现它是很多很多日本人说话时都会有的口癖。</p><p>首先，「ふう」的汉字是「風」，在字典里有解释是“样子；方法”。因此,<strong>「というふうに」就可以解释成 “就像说的这个样子一样…”，“就像这样…” 。</strong></p><p>其次，在文法层面 <strong>「ふうに」＝「ように」</strong>，「感じで」也有类似的感觉。因此可以用几个最常用的句型来记忆它。</p><blockquote><p>　こんな<strong>ふうに</strong>やってみます！<br>　こんな<strong>感じで</strong>やってみます！<br>　この<strong>ように</strong>やってみます！<br>   (翻译)<br>   就这样做做看吧！</p></blockquote><p>另外，「というふうに」虽然是口癖，给人一种非常口语化、不正式的感觉，但其实现在很多正式的场合也会用到「というふうに」。可能是语言也在慢慢地演化吧。</p><img src="https://s2.loli.net/2024/10/28/9WMIRrgQTlamADq.png" style="zoom:65%;" /><p>下面这个视频可以很好地进行解释： </p><iframe     src="//player.bilibili.com/player.html?isOutside=true&aid=113334019951909&bvid=BV1DDCdYtEL1&cid=26365005117&p=1"     width="900"     height="550"     scrolling="no"     border="0"     frameborder="no"     framespacing="0"     allowfullscreen="true"></iframe><hr><h2 id="「という」视作前置定语的引导词：概述前面，修饰后面"><a href="#「という」视作前置定语的引导词：概述前面，修饰后面" class="headerlink" title="「という」视作前置定语的引导词：概述前面，修饰后面"></a>「という」视作前置定语的引导词：概述前面，修饰后面</h2><p>在前两节，我们提到了由「といいます」简化而成的口语「と」，也总结了日本人的口癖用法「というふうに」。但他们归根结底的词根用法是「という」。研究过N2&#x2F;N1语法书的人都知道，由「という」引申出去的文法实在是多的可怕，比如「というより…」「~ということ」。这些复杂且需要额外区分的复杂文法总结，放在了这一节的最后部分。在这一节的主体部分，我只想讨论「という」最基础的含义。</p><p>「いう」写作汉字是「言う」，意思是“说”，只要是学过日语的人都知道。因此，不难理解 <strong>「という」的本意就是「叫做…」「称作…」。</strong> </p><p>与「という」组合而成的文法看似纷繁复杂，其实只要抓住一点就不难理解了，以下面这个句子为例：</p><blockquote><p>勝つのは難しいかもしれないが、まったく可能性がない<strong>というわけでもない</strong>。</p></blockquote><p>此处的「という」很显然是<strong>对前面「勝つ可能性がない」这个事情&#x2F;观点的总结，然后修饰后面的「わけ」</strong>。“没有赢的可能性”这样的“情况”，也并非如此。人话就是虽然难赢但还是可能赢的。当然，把「～というわけでもない」当做一个固定短语“并不是说…”记忆也可以，但重要的是要理解语法现象。</p><p><strong>「という」概述前面，修饰后面的名词。从前面的描述&#x2F;观点一直到「という」为止，都可以试做后面名词的前置定语。我们可以这样认为：「という」是一种前置定语的引导词。</strong> 从这一观点出发，再去思考上一节的「というふうに」，发现也是如此。类似的还可以举出很多例句：</p><blockquote><p>私の趣味は旅行<strong>ということ</strong>です。<br>彼が言ったことを信じるのは難しいが、それが真実だ<strong>という可能性</strong>もある<br>彼女が新しいプロジェクトのリーダーになる<strong>という話</strong>を聞いたが、具体的な詳細はまだ不明だ。</p></blockquote><hr><h2 id="「という」在口语中省略为「って」"><a href="#「という」在口语中省略为「って」" class="headerlink" title="「という」在口语中省略为「って」"></a>「という」在口语中省略为「って」</h2><p>另外，<strong>「という」在口语里常常会省略成「って」</strong>,这里的「という」则是「と言います」<strong>表示“传闻，听说…”。</strong>这是一个N4的语法，再此稍作复习，不做具体展开讨论。</p><blockquote><p>彼女は先月結婚した<strong>って</strong>知ってるか？  &#x2F;  彼女は先月結婚した<strong>という</strong>。<br>彼は本当にすごい人だ<strong>って</strong>。   &#x2F;  彼は本当にすごい人だ<strong>という</strong>。</p></blockquote><blockquote><p>私は字がきれいです<strong>って</strong>。きれいなもんですか。<br><strong>你说</strong>我的字写的好看？哪儿好看了。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 日本語 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日本語 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VOCALOID调教之十二大参数</title>
      <link href="/2024/10/27/VOCALOID%E8%B0%83%E6%95%99%E4%B9%8B%E5%8D%81%E4%BA%8C%E5%A4%A7%E5%8F%82%E6%95%B0/"/>
      <url>/2024/10/27/VOCALOID%E8%B0%83%E6%95%99%E4%B9%8B%E5%8D%81%E4%BA%8C%E5%A4%A7%E5%8F%82%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="VOCALOID调教之十二大参数"><a href="#VOCALOID调教之十二大参数" class="headerlink" title="VOCALOID调教之十二大参数"></a>VOCALOID调教之十二大参数</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​在钢琴窗口之下的调参区，左侧点击Edit，可以切换选择待调整的参数。</p><img src="https://s2.loli.net/2024/10/28/W3dYeKOXfVbmvth.png" style="zoom:50%;" /><h2 id="VEL：速度"><a href="#VEL：速度" class="headerlink" title="VEL：速度"></a>VEL：速度</h2><p>​VEL参数主要<strong>调整“辅音长度”，即咬字的清晰度</strong>。辅音往往先于整个字的音所在节拍而发出的。换句话讲，任何一个字在歌唱时，辅音先发声，并且辅音的发声要略早于整个音符的起点。</p><ul><li>VEL调高：咬字比较轻，基本听不到辅音的发声。</li><li>VEL调低：咬字很重，用于强调本音。</li></ul><p>​全曲的VEL参数建议<strong>错落有致地进行设置</strong>，最好不要连续地将VEL拉高或者拉低。如果VEL连续地拉高，那么这一段的每个字都听上去轻飘飘的，连续的咬字不清也会带来听不懂的问题；如果VEL连续地拉低，听上去像是一个字一个字顿着发出的声音，MIKU或者洛天依像是在咬牙切齿地唱。如果不是为了风格有意而为之，建议不要这样。</p><h2 id="DYN：动态"><a href="#DYN：动态" class="headerlink" title="DYN：动态"></a>DYN：动态</h2><p>​DYN参数最直观的影响是<strong>音符的响度</strong>，调教初期可以不调整这个参数。刻意地进行DYN的调整，某些歌姬可能会出现非常不好的效果。比如可能造成歌姬人声的响度忽高忽低，时而盖过伴奏时而又被伴奏淹没。这样听上去就非常的难受了。</p><p>​有时通过DYN的调整，也可以实现个人独特的风格。但难度较大。</p><h2 id="BRE：呼吸度"><a href="#BRE：呼吸度" class="headerlink" title="BRE：呼吸度"></a>BRE：呼吸度</h2><p>​BRE参数调整<strong>音色的“粗糙程度”</strong>。默认值为0。</p><ul><li>BRE调高：声音变得干涩，沙哑。</li><li>BRE调低：声音变得明亮一些。</li></ul><p>​一般而言，要求全段BRE保持一致。</p><h2 id="BRI：明亮度"><a href="#BRI：明亮度" class="headerlink" title="BRI：明亮度"></a>BRI：明亮度</h2><p>​BRI参数调整声音的<strong>“明亮度”</strong>。声音明暗的变化可以<strong>调整歌姬演唱情绪的起伏</strong>，要经常进行调教。</p><ul><li>BRI调高：声音变得明亮，像是张大嘴巴放声歌唱。</li><li>BRI调低：声音变得低沉，像是压在喉咙里放不开的声音。</li></ul><p>​在调整BRI时，一个音的响度和频率都发生了较大的变化。具体而言，声音调整的越明亮，频谱整体就会向高频偏移；反之亦然。另外，BRI的调整基本不会影响辅音，但是BRI太低可能会导致齿音较重的问题（尤其是洛天依）。</p><h2 id="CLE：清晰度"><a href="#CLE：清晰度" class="headerlink" title="CLE：清晰度"></a>CLE：清晰度</h2><p>​CLE调高后，声音会变得锋利。基本不作调整。</p><h2 id="OPE：开口度"><a href="#OPE：开口度" class="headerlink" title="OPE：开口度"></a>OPE：开口度</h2><p>​OPE默认拉满，只能向下降低调整。但是如果将一整个音的开口度都设置小，运用于某些长音就不适合，歌姬就像是含着东西在发声一样，听起来很奇怪。如果想要调整全曲歌姬演唱的口型，单纯设置OPE不能解决问题，只能拆音。</p><h2 id="GEN：性别值"><a href="#GEN：性别值" class="headerlink" title="GEN：性别值"></a>GEN：性别值</h2><p>​调整歌姬音色的共振峰，让声音<strong>更偏向于男声或者女声</strong>。这个参数通常全段一致处理，不对每个字进行单修。</p><ul><li>GEN调高：声音变粗，更像男声。但是鼻音增大，声音会变软一些。</li><li>GEN降低：声音变细，更像女声。</li></ul><h2 id="POR：滑音时间"><a href="#POR：滑音时间" class="headerlink" title="POR：滑音时间"></a>POR：滑音时间</h2><p>​在音符与音符之间的衔接处，会有衔接的滑音。比如从C3-do升高到mi，歌姬的音调并不是阶跃式的抬升，而是平滑地向上增加。调整POR前可以先开启“音高渲染”，将音高线显示在音符上，会更加直观。</p><img src="https://s2.loli.net/2024/10/28/9wcrpn1agUEP4hB.png" style="zoom:50%;" /><ul><li>POR调高：前一个音符会更慢地划向后一个。</li><li>POR调低：前一个音符会更快地划向后一个。</li></ul><p>​POR一般不需要大动，个别字精修就行了，整体调整会导致歌姬发声的不自然。</p><h2 id="XSY：交叉演奏参数"><a href="#XSY：交叉演奏参数" class="headerlink" title="XSY：交叉演奏参数"></a>XSY：交叉演奏参数</h2><p>​XSY参数用于混合两个歌姬的声线，其常规用法是<strong>混合同一个歌姬的不同声线</strong>。比如，用不同比例混合洛天依的meng和ning的音色。XSY主要用于解决一个歌姬的<strong>音域</strong>问题，比如洛天依可以在高音部分混合一些乐正绫进行改善。</p><p>​调整前首先需要设置“第二歌手”：【设置】–【当前歌手属性(A)】–【双击当前歌手】–【第二歌手】</p><img src="https://s2.loli.net/2024/10/28/jUJFMZL5iWytNI7.png" style="zoom:50%;" /><ul><li>XSY越大：第二歌手的影响就更大。</li></ul><p>​一个歌姬的第二歌手由官方给定并限制，如果我们想要混合其他同语种的歌姬，可以在V4编辑器的声库管理工具Vocaloid Voice Management中进行解锁。另外，这是V4编辑器特有的功能，在V5和V6编辑器中反而删除了这个功能。</p><h2 id="GWL：咆哮声"><a href="#GWL：咆哮声" class="headerlink" title="GWL：咆哮声"></a>GWL：咆哮声</h2><h2 id="PIT：滑音"><a href="#PIT：滑音" class="headerlink" title="PIT：滑音"></a>PIT：滑音</h2><p>​PIT参数用于<strong>调整“音高”</strong>，是最重要的参数。其直观效果是：</p><ul><li>从中线向下拉低一半：降低一个半音。</li><li>从中线向下拉低到底：降低两个半音。</li></ul><p>​PIT的调教是VOCALOID调教的核心，也是一个调教师水平和风格的最直观体现。PIT的变化对歌曲的情绪等方面都有着很大的影响。其它参数多如牛毛的微调，有时可能还没有PIT的一笔来得有效果。PIT还可以控制转音和颤音。</p><p>​另外，PIT的功能很强大，比如我们可以用PIT手绘颤音：</p><img src="https://s2.loli.net/2024/10/28/hUp6St9TmlMuBg8.png" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> VOCALOID </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vocaloid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPP实现蚁群算法(ACO)并解决TSP问题</title>
      <link href="/2024/10/22/TSP-CPP/"/>
      <url>/2024/10/22/TSP-CPP/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="问题简述"><a href="#问题简述" class="headerlink" title="问题简述"></a>问题简述</h2><p>Given a set of n nodes and distances for each pair of nodes, find aroundtrip of minimal total length visiting each node exactly once. The distance from node i to node j is the same as from node j to node i.</p><p>Berlin52 – 52 locations in Berlin (Germany)</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Super-Parameters</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> ITERATION_TIMES = <span class="number">200</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> ANT_NUMBER = <span class="number">100</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> CITY_NUMBER = <span class="number">50</span>;    <span class="comment">//DataSet: Berin52</span></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> ALPHA = <span class="number">2.0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> BETA = <span class="number">1.0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> ROW = <span class="number">0.4</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> information_init = <span class="number">1.14</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> vector&lt;vector&lt;<span class="type">double</span>&gt;&gt;  Matrix;   </span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Ant</span></span><br><span class="line">&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; route;           <span class="comment">//(目前为止)路径</span></span><br><span class="line">    <span class="type">double</span>  TotalRouteLength;    <span class="comment">//(目前为止)路径的总长度</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TSP</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">TSP</span>(Matrix DistancesMatrix) : <span class="built_in">DistancesMatrix</span>(DistancesMatrix)&#123;</span><br><span class="line">            city_number = DistancesMatrix.<span class="built_in">size</span>();   <span class="comment">//城市数量：通过距离矩阵获取</span></span><br><span class="line">            InformationMatrix = <span class="built_in">Matrix</span>(city_number,<span class="built_in">vector</span>&lt;<span class="type">double</span>&gt;(city_number,information_init));   <span class="comment">//初始化信息素矩阵</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="comment">//获取最佳情况</span></span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">GetBestRouteLength</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">GetBestRoute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="comment">//存储最佳情况</span></span><br><span class="line">        <span class="type">double</span> BestRouteLength = numeric_limits&lt;<span class="type">double</span>&gt;::<span class="built_in">max</span>();    <span class="comment">//初始值需要赋予一个很大的值</span></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; BestRoute;</span><br><span class="line">        <span class="comment">//一般参数</span></span><br><span class="line">        <span class="type">int</span> city_number;</span><br><span class="line">        <span class="comment">//距离矩阵，信息素矩阵</span></span><br><span class="line">        Matrix DistancesMatrix;</span><br><span class="line">        Matrix InformationMatrix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//三个核心方法</span></span><br><span class="line">        <span class="function"><span class="type">int</span> <span class="title">Select_NextCity</span><span class="params">(Ant&amp; this_ant)</span></span>;           <span class="comment">//传入Ant结构体的一个对象</span></span><br><span class="line">        <span class="function"><span class="type">double</span> <span class="title">Calculate_TotalLength</span><span class="params">(Ant&amp; this_ant)</span></span>;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">Update_Information</span><span class="params">(vector&lt;Ant&gt;&amp; ants)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    TSP的主要算法流程---------------------------------</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TSP::solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> iter=<span class="number">0</span>; iter&lt;ITERATION_TIMES; iter++)&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;------第&quot;</span> &lt;&lt; iter<span class="number">+1</span> &lt;&lt; <span class="string">&quot;次算法迭代&quot;</span> &lt;&lt; <span class="string">&quot;------&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="function">vector&lt;Ant&gt; <span class="title">ants</span><span class="params">(ANT_NUMBER)</span></span>;       <span class="comment">//####创建存放Ant结构体变量的数组，开辟的空间数量为ANT_NUMBER</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ANT_NUMBER; i++)&#123;        <span class="comment">//第i只蚂蚁</span></span><br><span class="line">            ants[i].route.<span class="built_in">push_back</span>(<span class="built_in">rand</span>() % city_number);   <span class="comment">//Step1:初始化蚂蚁所在节点（随机）</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;|||第&quot;</span> &lt;&lt; i<span class="number">+1</span> &lt;&lt; <span class="string">&quot;只蚂蚁：初始位置为&quot;</span> &lt;&lt; ants[i].route.<span class="built_in">back</span>() &lt;&lt; <span class="string">&quot;|||&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; city_number - <span class="number">1</span>; j++)&#123;   <span class="comment">//第j步移动</span></span><br><span class="line">                <span class="type">int</span> nextCity = <span class="built_in">Select_NextCity</span>(ants[i]);     <span class="comment">//Step2:选择下一个前往的节点,结果push到route集合中去。重复直到走遍所有节点。#核心：Select_NextCity()方法</span></span><br><span class="line">                ants[i].route.<span class="built_in">push_back</span>(nextCity);</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;!!!第&quot;</span> &lt;&lt; j<span class="number">+1</span> &lt;&lt; <span class="string">&quot;步:移动到&quot;</span> &lt;&lt; nextCity &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">            ants[i].TotalRouteLength = <span class="built_in">Calculate_TotalLength</span>(ants[i]);  <span class="comment">//Step3:计算该蚂蚁(i)当前路径下的总距离，然后看看是不是最佳情况。#核心：Calculate_TotalLength()方法</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;--&gt;路径长：&quot;</span> &lt;&lt; ants[i].TotalRouteLength &lt;&lt; endl;</span><br><span class="line">            <span class="keyword">if</span>(ants[i].TotalRouteLength &lt; BestRouteLength)</span><br><span class="line">            &#123;</span><br><span class="line">                BestRouteLength = ants[i].TotalRouteLength;</span><br><span class="line">                BestRoute = ants[i].route;</span><br><span class="line">            &#125;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;目前为止最佳的路径长：&quot;</span> &lt;&lt; BestRouteLength &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step4:所有蚂蚁的情况运行结束，现在开始根据ants所有成员存储的route信息，更新信息素矩阵。#核心：Update_Information()方法</span></span><br><span class="line">        <span class="built_in">Update_Information</span>(ants);</span><br><span class="line">        <span class="comment">//Step5:本次迭代结束，进入下一个迭代。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Select_NextCity:路径选择</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">TSP::Select_NextCity</span><span class="params">(Ant&amp; this_ant)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//this_ant.route存储了已经经过的结点，类型是vector&lt;int&gt;。在选择下一个目的节点时，需要跳过这些节点。</span></span><br><span class="line">    <span class="comment">//创建概率列表Probabilities：从当前节点i往其他节点走的概率p_k(i,j)</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">Probabilities</span><span class="params">(city_number,<span class="number">0.0</span>)</span></span>;   </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> NowCity = this_ant.route.<span class="built_in">back</span>();    <span class="comment">//NowCity：当前所在的节点，即route列表的最后一项</span></span><br><span class="line">    <span class="type">double</span> totalProbabilities = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">//Step1: 计算每个情况的概率(分子)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="comment">//需要跳过已经访问的节点,前往他们的概率保持为0.0</span></span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> information_goto_nextcity = InformationMatrix[NowCity][NextCity];</span><br><span class="line">        <span class="type">double</span> distance_goto_nextcity = DistancesMatrix[NowCity][NextCity];</span><br><span class="line">        Probabilities[NextCity] = <span class="built_in">pow</span>(information_goto_nextcity, ALPHA) * <span class="built_in">pow</span>(<span class="number">1.0</span>/distance_goto_nextcity, BETA);</span><br><span class="line">        totalProbabilities += Probabilities[NextCity];</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot;#Probabilities:[Before]&quot; &lt;&lt; Probabilities[NextCity] &lt;&lt; endl;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; &quot;#totalProbabilities:&quot; &lt;&lt; totalProbabilities &lt;&lt; endl;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step2:计算每个情况的条件概率p_k(i,j)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        Probabilities[NextCity] = Probabilities[NextCity] / totalProbabilities;</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot;#Probabilities:[After]&quot; &lt;&lt; Probabilities[NextCity] &lt;&lt; endl;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step3:轮盘赌选择去往的下一个节点</span></span><br><span class="line">    <span class="type">double</span>  randVal = (<span class="type">double</span>)<span class="built_in">rand</span>() / RAND_MAX * totalProbabilities;</span><br><span class="line">    <span class="comment">//cout &lt;&lt; &quot;#randVal:&quot; &lt;&lt; randVal &lt;&lt; endl;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        randVal -= Probabilities[NextCity] * totalProbabilities;</span><br><span class="line">        <span class="keyword">if</span> (randVal &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> NextCity;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;    <span class="comment">//ERROR</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Calculate_TotalLength:计算路径总长</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">TSP::Calculate_TotalLength</span><span class="params">(Ant&amp; this_ant)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> totalLength = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; this_ant.route.<span class="built_in">size</span>()<span class="number">-1</span>; i++)&#123;</span><br><span class="line">        totalLength += DistancesMatrix[this_ant.route[i]][this_ant.route[i<span class="number">+1</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">    totalLength += DistancesMatrix[this_ant.route.<span class="built_in">back</span>()][this_ant.route[<span class="number">0</span>]];  <span class="comment">//终点回到起点</span></span><br><span class="line">    <span class="keyword">return</span> totalLength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Update_Information:更新信息素矩阵</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TSP::Update_Information</span><span class="params">(vector&lt;Ant&gt;&amp; ants)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//Step1: 信息素蒸发</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; InformationMatrix[<span class="number">0</span>].<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; InformationMatrix[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            InformationMatrix[i][j] = InformationMatrix[i][j] * (<span class="number">1</span> - ROW);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step2: 信息素释放：每只蚂蚁经过的路径上，都会留下一定的信息素。留下信息素的量规定为距离的倒数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ants.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ants[i].route.<span class="built_in">size</span>() - <span class="number">1</span>; j++)&#123;</span><br><span class="line">            <span class="type">int</span> StartPoint = ants[i].route[j];</span><br><span class="line">            <span class="type">int</span> Destination = ants[i].route[j<span class="number">+1</span>];</span><br><span class="line">            InformationMatrix[StartPoint][Destination] += <span class="number">1.0</span> / ants[i].TotalRouteLength;</span><br><span class="line">        &#125;</span><br><span class="line">        InformationMatrix[ants[i].route.<span class="built_in">back</span>()][ants[i].route[<span class="number">0</span>]] += <span class="number">1.0</span> / ants[i].TotalRouteLength;   <span class="comment">//终点回到起点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">TSP::GetBestRoute</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BestRoute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">TSP::GetBestRouteLength</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BestRouteLength;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">static_cast</span>&lt;<span class="type">unsigned</span>&gt;(<span class="built_in">time</span>(<span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试集要求：主对角线全0，其他元素不能出现0（否则两点就重合了，必定报错）</span></span><br><span class="line">    <span class="comment">/* Test: 5-CITY</span></span><br><span class="line"><span class="comment">    Matrix distances = &#123;</span></span><br><span class="line"><span class="comment">        &#123;0, 2, 9, 10, 7&#125;,</span></span><br><span class="line"><span class="comment">        &#123;1, 0, 6, 4, 3&#125;,</span></span><br><span class="line"><span class="comment">        &#123;15, 7, 0, 8, 6&#125;,</span></span><br><span class="line"><span class="comment">        &#123;6, 3, 12, 0, 5&#125;,</span></span><br><span class="line"><span class="comment">        &#123;10, 4, 8, 7, 0&#125;</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    Matrix distances = &#123;</span><br><span class="line">        &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">9</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">9</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>&#125;,</span><br><span class="line">        &#123;<span class="number">10</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">        &#123;<span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">12</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">9</span>&#125;,</span><br><span class="line">        &#123;<span class="number">6</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">15</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">14</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>&#125;,</span><br><span class="line">        &#123;<span class="number">11</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">13</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>&#125;,</span><br><span class="line">        &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">7</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>&#125;,</span><br><span class="line">        &#123;<span class="number">6</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>&#125;,</span><br><span class="line">        &#123;<span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>&#125;,</span><br><span class="line">        &#123;<span class="number">9</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>&#125;,</span><br><span class="line">        &#123;<span class="number">7</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">6</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function">TSP <span class="title">tsp</span><span class="params">(distances)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> start = chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    tsp.<span class="built_in">solve</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Running the algorithm...\n&quot;</span> &lt;&lt; flush;</span><br><span class="line">    <span class="keyword">auto</span> end = chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    chrono::duration&lt;<span class="type">double</span>&gt; duration = end - start;   <span class="comment">//程序运行时间</span></span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; BestRoute = tsp.<span class="built_in">GetBestRoute</span>();</span><br><span class="line">    <span class="type">double</span>  BestRouteLength = tsp.<span class="built_in">GetBestRouteLength</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Test Ouput</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Algorithm completed!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n\n==============最终结果==============\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;最佳路径：&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; BestRoute.<span class="built_in">size</span>() - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; BestRoute[i] &lt;&lt; <span class="string">&quot; -&gt; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; BestRoute.<span class="built_in">back</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n最佳(最短)路径长：&quot;</span>;</span><br><span class="line">    cout &lt;&lt; BestRouteLength &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;============================||END.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(本次运行超参数：&quot;</span> &lt;&lt; <span class="string">&quot;--ITERATION_TIMES=&quot;</span> &lt;&lt; ITERATION_TIMES </span><br><span class="line">                               &lt;&lt; <span class="string">&quot;--ANT_NUMBER&quot;</span> &lt;&lt; ANT_NUMBER</span><br><span class="line">                               &lt;&lt; <span class="string">&quot;--ALPHA=&quot;</span> &lt;&lt; ALPHA</span><br><span class="line">                               &lt;&lt; <span class="string">&quot;--BETA=&quot;</span> &lt;&lt; BETA</span><br><span class="line">                               &lt;&lt; <span class="string">&quot;--ROW=&quot;</span> &lt;&lt; ROW</span><br><span class="line">                               &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(程序运行时长：&quot;</span> &lt;&lt; duration &lt;&lt; <span class="string">&quot; seconds)&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="代码逻辑和解析—-2024-10-25更新完毕"><a href="#代码逻辑和解析—-2024-10-25更新完毕" class="headerlink" title="代码逻辑和解析—-&gt;2024.10.25更新完毕"></a>代码逻辑和解析—-&gt;2024.10.25更新完毕</h2><h3 id="算法载体“蚂蚁”的结构体表征"><a href="#算法载体“蚂蚁”的结构体表征" class="headerlink" title="算法载体“蚂蚁”的结构体表征"></a>算法载体“蚂蚁”的结构体表征</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Ant</span></span><br><span class="line">&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; route;           <span class="comment">//(目前为止)路径</span></span><br><span class="line">    <span class="type">double</span>  TotalRouteLength;    <span class="comment">//(目前为止)路径的总长度</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>route</strong>: 路径，是一个存放int的一维vector。比如{3,2,1,4,5}，表示该蚂蚁的行走路径是3-&gt;2-&gt;1-&gt;4-&gt;5，蚂蚁当前正位于节点5。算法的运行过程中，在每只蚂蚁、每一次根据概率选择完毕下一个节点后，route需要在末尾实时存入(push_back)这个目的节点。</li><li><strong>TotalRouteLength</strong>：每一次迭代完成后(即一只蚂蚁走遍了所有节点)，存放route路径的总长度。</li></ul><h3 id="距离矩阵和信息素矩阵"><a href="#距离矩阵和信息素矩阵" class="headerlink" title="距离矩阵和信息素矩阵"></a>距离矩阵和信息素矩阵</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> vector&lt;vector&lt;<span class="type">double</span>&gt;&gt;  Matrix;</span><br><span class="line"><span class="comment">//距离矩阵，信息素矩阵</span></span><br><span class="line">Matrix DistancesMatrix;</span><br><span class="line">Matrix InformationMatrix;</span><br></pre></td></tr></table></figure><ul><li>矩阵的第i行第j列元素，表示从i节点到j节点“路径的距离”&#x2F;“路径上信息素的含量”。</li><li>DistancesMatrix是算法的输入，他反映了当前TSP问题的城市个数和它们之间的位置关系(彼此间的距离)；</li><li>i-&gt;j与j-&gt;i路径相同只是方向相反，同一条路径上的距离和信息素都应该相同。因此，DistancesMatrix和InformationMatrix都是主对角线全0的对称矩阵。</li></ul><h3 id="算法主逻辑solve"><a href="#算法主逻辑solve" class="headerlink" title="算法主逻辑solve()"></a>算法主逻辑solve()</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TSP::solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> iter=<span class="number">0</span>; iter&lt;ITERATION_TIMES; iter++)&#123;</span><br><span class="line">        <span class="function">vector&lt;Ant&gt; <span class="title">ants</span><span class="params">(ANT_NUMBER)</span></span>;       <span class="comment">//####创建存放Ant结构体变量的数组，开辟的空间数量为ANT_NUMBER</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ANT_NUMBER; i++)&#123;        <span class="comment">//第i只蚂蚁</span></span><br><span class="line">            ants[i].route.<span class="built_in">push_back</span>(<span class="built_in">rand</span>() % city_number);   <span class="comment">//Step1:初始化蚂蚁所在节点（随机）</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; city_number - <span class="number">1</span>; j++)&#123;   <span class="comment">//第j步移动</span></span><br><span class="line">                <span class="type">int</span> nextCity = <span class="built_in">Select_NextCity</span>(ants[i]);     <span class="comment">//Step2:选择下一个前往的节点,结果push到route集合中去。重复直到走遍所有节点。#核心：Select_NextCity()方法</span></span><br><span class="line">                ants[i].route.<span class="built_in">push_back</span>(nextCity);</span><br><span class="line">            &#125;</span><br><span class="line">            ants[i].TotalRouteLength = <span class="built_in">Calculate_TotalLength</span>(ants[i]);  <span class="comment">//Step3:计算该蚂蚁(i)当前路径下的总距离，然后看看是不是最佳情况。#核心：Calculate_TotalLength()方法</span></span><br><span class="line">            <span class="keyword">if</span>(ants[i].TotalRouteLength &lt; BestRouteLength)</span><br><span class="line">            &#123;</span><br><span class="line">                BestRouteLength = ants[i].TotalRouteLength;</span><br><span class="line">                BestRoute = ants[i].route;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Step4:所有蚂蚁的情况运行结束，现在开始根据ants所有成员存储的route信息，更新信息素矩阵。#核心：Update_Information()方法</span></span><br><span class="line">        <span class="built_in">Update_Information</span>(ants);</span><br><span class="line">        <span class="comment">//Step5:本次迭代结束，进入下一个迭代。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>三重循环：最外层循环控制算法总迭代次数；i循环遍历每只蚂蚁；j循环控制每只蚂蚁进行寻路。</li><li>核心方法调用：<ul><li><strong>Select_NextCity</strong>：传入当前蚂蚁(结构体)。因为结构体中包含了蚂蚁现在的位置信息now(route的末尾元素)，因此可以遍历计算概率p(now,next)，并通过轮盘赌选择下一步的节点编号next。</li><li><strong>Calculate_TotalLength</strong>：最内j循环运行完毕，即当前蚂蚁已经走遍所有节点，运算总路径长。随后确认是否是最佳情况。</li><li><strong>Update_Information</strong>：所有蚂蚁寻路完毕，本次迭代完成，根据每只蚂蚁的路径route更新信息素矩阵。</li></ul></li><li>另外：ants为所有蚂蚁的集合，数据类型是存放结构体对象的一维vector。</li></ul><p>*算法主逻辑手写版：<br><img src="https://s2.loli.net/2024/10/25/sdcKDOQLRIMgqbt.jpg" width="500" height="1200"></p><h3 id="核心方法·其一：Select-NextCity路径选择"><a href="#核心方法·其一：Select-NextCity路径选择" class="headerlink" title="核心方法·其一：Select_NextCity路径选择"></a>核心方法·其一：Select_NextCity路径选择</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">TSP::Select_NextCity</span><span class="params">(Ant&amp; this_ant)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//this_ant.route存储了已经经过的结点，类型是vector&lt;int&gt;。在选择下一个目的节点时，需要跳过这些节点。</span></span><br><span class="line">    <span class="comment">//创建概率列表Probabilities：从当前节点i往其他节点走的概率p_k(i,j)</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">Probabilities</span><span class="params">(city_number,<span class="number">0.0</span>)</span></span>;   </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> NowCity = this_ant.route.<span class="built_in">back</span>();    <span class="comment">//NowCity：当前所在的节点，即route列表的最后一项</span></span><br><span class="line">    <span class="type">double</span> totalProbabilities = <span class="number">0.0</span>;</span><br><span class="line">    <span class="comment">//Step1: 计算每个情况的概率(分子)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="comment">//需要跳过已经访问的节点,前往他们的概率保持为0.0</span></span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> information_goto_nextcity = InformationMatrix[NowCity][NextCity];</span><br><span class="line">        <span class="type">double</span> distance_goto_nextcity = DistancesMatrix[NowCity][NextCity];</span><br><span class="line">        Probabilities[NextCity] = <span class="built_in">pow</span>(information_goto_nextcity, ALPHA) * <span class="built_in">pow</span>(<span class="number">1.0</span>/distance_goto_nextcity, BETA);</span><br><span class="line">        totalProbabilities += Probabilities[NextCity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step2:计算每个情况的条件概率p_k(i,j)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        Probabilities[NextCity] = Probabilities[NextCity] / totalProbabilities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step3:轮盘赌选择去往的下一个节点</span></span><br><span class="line">    <span class="type">double</span>  randVal = (<span class="type">double</span>)<span class="built_in">rand</span>() / RAND_MAX * totalProbabilities;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> NextCity = <span class="number">0</span>; NextCity &lt; city_number; NextCity++)&#123;</span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">find</span>(this_ant.route.<span class="built_in">begin</span>(), this_ant.route.<span class="built_in">end</span>(), NextCity);  </span><br><span class="line">        <span class="keyword">if</span>(visited != this_ant.route.<span class="built_in">end</span>())     </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        randVal -= Probabilities[NextCity] * totalProbabilities;</span><br><span class="line">        <span class="keyword">if</span> (randVal &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> NextCity;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;    <span class="comment">//ERROR</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>计算每条路径的**概率p_k(i,j)**。注意需要事先排除已经走过的节点。</li><li><strong>轮盘赌</strong>选择去往的下一个节点。</li></ul><img src="https://s2.loli.net/2024/10/25/QaX1brEvRJWwD4y.jpg"><h3 id="核心方法·其二：Calculate-TotalLength计算总长"><a href="#核心方法·其二：Calculate-TotalLength计算总长" class="headerlink" title="核心方法·其二：Calculate_TotalLength计算总长"></a>核心方法·其二：Calculate_TotalLength计算总长</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">TSP::Calculate_TotalLength</span><span class="params">(Ant&amp; this_ant)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> totalLength = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; this_ant.route.<span class="built_in">size</span>()<span class="number">-1</span>; i++)&#123;</span><br><span class="line">        totalLength += DistancesMatrix[this_ant.route[i]][this_ant.route[i<span class="number">+1</span>]];</span><br><span class="line">    &#125;</span><br><span class="line">    totalLength += DistancesMatrix[this_ant.route.<span class="built_in">back</span>()][this_ant.route[<span class="number">0</span>]];  <span class="comment">//终点回到起点</span></span><br><span class="line">    <span class="keyword">return</span> totalLength;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为了简化代码，solve()在运行时不会让蚂蚁回到起点。但此处我们认为TSP问题仍需要走一个闭环，所以在运算路径总长时需要另外加上从终点(route最后一项)回到起点(route第一项)的距离。</p><h3 id="核心方法·其三：Update-Information信息素更新"><a href="#核心方法·其三：Update-Information信息素更新" class="headerlink" title="核心方法·其三：Update_Information信息素更新"></a>核心方法·其三：Update_Information信息素更新</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TSP::Update_Information</span><span class="params">(vector&lt;Ant&gt;&amp; ants)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//Step1: 信息素蒸发</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; InformationMatrix[<span class="number">0</span>].<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; InformationMatrix[<span class="number">0</span>].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            InformationMatrix[i][j] = InformationMatrix[i][j] * (<span class="number">1</span> - ROW);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Step2: 信息素释放：每只蚂蚁经过的路径上，都会留下一定的信息素。留下信息素的量规定为距离的倒数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; ants.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; ants[i].route.<span class="built_in">size</span>() - <span class="number">1</span>; j++)&#123;</span><br><span class="line">            <span class="type">int</span> StartPoint = ants[i].route[j];</span><br><span class="line">            <span class="type">int</span> Destination = ants[i].route[j<span class="number">+1</span>];</span><br><span class="line">            InformationMatrix[StartPoint][Destination] += <span class="number">1.0</span> / ants[i].TotalRouteLength;</span><br><span class="line">        &#125;</span><br><span class="line">        InformationMatrix[ants[i].route.<span class="built_in">back</span>()][ants[i].route[<span class="number">0</span>]] += <span class="number">1.0</span> / ants[i].TotalRouteLength;   <span class="comment">//终点回到起点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>信息素蒸发</strong>：根据超参数ROW，对上一次迭代后的信息素进行衰减操作。</li><li><strong>信息素释放</strong>：根据本轮迭代下每只蚂蚁的路径情况，为每条路径增加信息素。每次增加的信息素量是route总长的倒数(即1&#x2F;TotalRouteLength)。</li></ul><img src="https://s2.loli.net/2024/10/25/mZu5AzcKEdyIqOl.jpg" width="500" height="1200"><h2 id="读取-tsp数据文件—-稍后更新"><a href="#读取-tsp数据文件—-稍后更新" class="headerlink" title="读取.tsp数据文件—-&gt;稍后更新"></a>读取.tsp数据文件—-&gt;稍后更新</h2><h2 id="Berlin52数据集测试情况—-稍后更新"><a href="#Berlin52数据集测试情况—-稍后更新" class="headerlink" title="Berlin52数据集测试情况—-&gt;稍后更新"></a>Berlin52数据集测试情况—-&gt;稍后更新</h2>]]></content>
      
      
      <categories>
          
          <category> Course Assignment </category>
          
          <category> Computational Intelligence </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
            <tag> TSP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp实现矩阵操作</title>
      <link href="/2024/10/18/Matrix/"/>
      <url>/2024/10/18/Matrix/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="10bcc97a6d92a8da5eaf3955551c610a4dd1d08fea05c02e7bbbf211629512d0">216d342401ed8ac277dfe0d7fa75e03af0e81f0ec4547fb6a651e316897f9f1d73dc51ae3e888b0dcaab13ea7aafc266d94468dbddefdfb9b9b06a46c78013dd0e8918e4b8cb007916fe92ba17bffcf32a879f3863400af65bf72c5abd7a401e964ef83547b229db2604c3ea04c71ebbc93fa64f96ffa5cbb4f641bdf9617c34ed7ba0841c8b23e82c4b7fce0b03d004d66535f2bf532e0ecd3d586fcfb76f15142f5b2023ee29d00c6d3ae03bfe735973f5a08ccdd7282920a13d6ff26a2cacdca70b266215c18ba9474d000809f79d8549318fe16762af1d68c0d344e6191af1e9117b4ce55b48ff2eb5bab719f2307603cd58e5d8358c016a3459fcc8afe51c2e54c533080e39695fbcbfac8b31271b89878fd5b938ab72792b2e979eea46b0c42d6c2ee9d06719943c43213ba3f4317b01407529d102de2a635e44d524bca8ed113e46891d632fcbf03adaa944569fc79d40c33a8d836c9e4d11e389ff6344a9cf2510210524803eaafb17c0787d163beb220b93542276d445736e1a9792d7ddf9941290ebdacf5eb9898e8e736c2c90563bf938fc5213620fe45dfed787f50ce0ed71b5bbc41428e907de81f888a19c346aee3c1866292600220f0d9929e4126f103a7e3a840a3812b95a96adfcce82b17d3988cb73cd4fab7819ba5e9d50fc5a9b8f1fbf73fbceb41fd5c197cd9ae769dbb79cf697a2564ad535ecd6bac2dca825d7795ed8851b18782a5f6b51a1a56a60623151a66febc9426ebf48cfb3fae783d91182fa82b3f08a3e0ff91cb7ec0900bc8d0e71b70dcc688bba30ff1729da0ae428464af13a6bba9619a5f108a40f0330c450468af6d9c2984c178b5d04596e6de6ef0ba4f2a85858037c5ee429806e91084153a5f2bde0f228dff6889523b658b03720b6c44bfb20bdbfcdb0c4afc3fed70a71dda7fb682386808700b90715e494565c5fcc20b6b2935bcc38ca458513d7b68373b1f9933aac1192b9d1f40f0febec2a2f94b6a4b7a9bf7dee674ab8b90570a2344b5b82749127e6d86d87d7d10c4e0681b3dc258ada402194f52a234c2aaec1fc334c8fe181ca82915488b04117b790f848cc0f6b34de878dfc59c386ca08ed5b46f2bdadca40cc23f05191aee12f4f381803a879deb07aaa584ec67723a3222b1b87aa5867a1f6091ea7fa58e28083140615b455720fe5976d94ec0d87449dd83b6539ae962352e2420931ee431e19feb923099b4a523e7110feb706a8d74fafff64609dab42489b25425a49773c04fa4d089db9760e65e298b62912af1dc7df45169b3a163ef531092008d502f4ced82415a5f87c4887e180cc3146f6318a2e20bf53cb115dc9dc70a888cfda24564740b31ef7091f8cdf139e593ed5df0f104a45a97b3b386fdb3b7df6668a3e6d2737e1cd731ca2937c076b3c795b4a42db1a3c180396864e2b8a03bf9e3ec95611d4f08b4ff53eadfc63e9e29233f600b755262f1ea9b340ee609b8fb3514051352de6653d0be70ea280263e3461a2b02854f5c37586414a9efb62d521d19ad36b9424e585f3f71f2aec13d2dd74f80c4bbaefa33ddc9fd9527b02e5f5457796b4fad7980b9e3eac74087c14a3b1930f4521ad394aae9d6c3e2ea90b88d4206c50781d0ecb81b1942c3bf6ef8f2b73162ff74c9f3dccf7796070e21f64e8f633fde05d0511b97b3096594ae0e04f8c9405fd1ba640201fee13415d0b86e5f751bcac8f8ad5750d5bb59faabfbdede6e9bcc410519ce2481d08fd44d64e0e8736913dec73b508cdf14cc5523202b5e36d57357b65636d4238e4b4c5314f0645a486e1d39245172d85a0c0422fa59440a8240c758eaaaf3b21e778d6a4363ace59139a41ee53785f1508de4df5a5ee01c1b572854414db0d001b4570fcb4514d150f1846b67bc5b4515162ec7339508acb6123d128cd821cdbab07169f5930c2e5ec32bc75ab07fae3ec91a14d509b74223c1759f14e28f0ea1c7c9a72801a6b67d71c943b633e9f86565c7acf69640199a43f63dac1d6771e668a48e897b5f70478ae2311c35c997178fbef2b80aa8ef75b6a551169e6709097d3c007a2cd54773e838edc243fe264bdf401752f7936174566458d2547a493c8180d3ef166a817b95172968be911ba0bf0dc6fe671e88aef111317614526dbf1e570e99a1e303c39d9461716ba47444adc0ff351966fdbb1ee7dee9fbbd2d71e12748669892b0851bcbe89e84427392ec3dfde3ae09930c5e6a6f716711634d73c7101d7709914be2eef33e26cba2429253988f3bae03895eb372068b7e4bf3eb456f7d5b126de0170e6616ce6e2277525120dc5f4698f3f9df2a4bed59c18acc7a616e851f8dca483ab072380b6c285627623468732ad0f9ce55c1ac97843c1fc8beab6d5fadfadc8bc02562728ec240cb2a10da70577b1e6f10e6200bd0a935c81fc37183199b4f35c48aad30f364fb2e8b77730ac4a20c8b6ebd3281d308b791389c2e4423ca23f34415953bba724a920557f4bd65c684581550fbe52c3063de50731377bd641d4c74eabf0a0b169b3b096e1acc583af6a5c686542491afd4ac45e4926a19554fa063bf6ba455f0f0f5ef4b5f1c8984ee57e43cf20463c6b2e63d20b011b7106b4e0c92fb92afd0df8cb1ef9c68ea6d37f72493bd123ae43eea34a93d9a5955df33192a321751770d2a89ae4862fa8916592c2f8a022e0cb39d19fbaab257eeb252330af1af7ea5a89f526430b24d97303b2615e80ea0a2ecc9dda5dec484d67b8ffeaae1338119d13c741c2073e17a33ef968cb2591d02befdbb42f289fa26dd627b6a7efe35702d47bdeacbcc868cd919da03d4379d70b2cde40017b6b504fffc6f7570e7f68cdd53b3497dea2ebeb4a05e0aa307af137a7173b5af7d34a91770c09aebce1a90ffc19f88d128c562195e6e8f4442c68b4beaad67c66e49bf07d6759ea4e1b9fce4e1c1eed2cd73544346974874569de6b454845322075fb4333333708e5695ccdc432a309bd48a8e152a954919ce757ad06ab262e02001f39556111bddfcc97045cbed6195527c5b331602cfc05fc07fb8019ea94fb33dadbda4c6359cb0f5fd64189271c4f8c4799c35e60263cf66d1130bb7d8f9aa85a721a68f6b2129dfa2f0c94ab80270552d58bc6b6767cb677426ec53bf1a0ccee489f85eb7429bc53d734b48f8b2aafde8368e06d5baac5a3c4a220a2fb08d10059c19a2ba0e09c3022bf14b8b7f57f4df88f5405c2ff147a06221044f8b88a4db3ec825f107de53aee19f2dc5587fc43f237ce0550d5472023de4d09a6a48a892839f49ec0f3ff6badb9afa4062a907153c9c244bd6a24f03c07fc2d8c14cb10a72c209fe3e99acd46b7daae30cffeae06fb69d39ce284861a387fe9edf073d2d5e043e5ce05c4029944d28a94d36afb4d27c69c84334e6ccdee1e0e6b231afbcc5d0df6d069448f1a1c4cc81abf14c40fa757f82f24970e7803388d46b9afc1f795a05daa10888365ef1f7c36278abb39abc7dcf488f882a21f8214d993c85968c602140fc6b2a54bd6a8af0c9268d0449be3b3f6e574df6257126c35d0adafe6cea21dd668a16222f323b76076eb12673237521f93547d13c9dba267c1caaac1a752e3eedb1cce20bc2ac19c4a5320baea649295c3e8dad22c17bab12a89576792a4157f046c018336d5d2aa071cc6ff2fb2fedb9fa6cc770d4dc7708d3c3644fc6092f9ceec22059833feb4734068fa5c68378f618ea193a6c429832bee9541af456901ed67f1f900e66c07328ee8012dbd08c6d7d8da9d66eeeb2b73d2a38a25a6889422aa77670faff02580a018e69003141148b9c8cb41cd39dad03d13deb828ec000d0201c0ec5e9bdca00a63184622f05dc6b2b0b196116289a424f1c4739be1ba15faca88494be4ba490401f4d27ed5684c57780fba25acca1cb0fe33acd928021873ffafbf44f68e4f36814c6c4aef052438d3fa81677bfc37c9b6c9f4d85f0681e5b888a8c0ece3931e1681a327c41bd15bd63957a613ca34f64160e5464a99f6ae71e30b401405560359df87d3f034c761b8b0f46e9850546ca928051120ef87162987e449c9ab422b72e582bd2541ed06530fc895dbe9354ffc98cfd0bd75de21bad3bfe2d0a964626ed8595e913988ad25b1e89ae59ce2b0bb7c07510764301ac408caaab1a690a1e0525d262be2dec0035718a2d0d081b0a4cc8ff38214a22bcc29ce2676e61d617298f4cbe915f1c0d724b463b8c1ac0593e95d90da08d4fa8a2cd8b170f7170c6bb4bb90c4a7d4cecd7a561371c894d4df8ef61d5688ded1ab3bc65462dad5f90ae18db33351b1b234629f990b3938681b188c8faaf8bb7f4e6f7f7d512d5c3ac09443bc1c478c76760708834435c4afb357455641ab997b5e44c3daa2b97e1fe88df0216af99269dd3638021793f57fbaed2251d9d6e07152492509aaad95b9f8f1b843f9cc7f52c9cfa313ffe89fe594148d8e6f99b040e1ab3e5948b3ef05181c96a967969171f493eee0ab04cfe66532ce56864357fba19c806f20b6e87adf6df5eb4926dfe89de1098d4c64def777c31edfee0345655eb118543b678710d9935afb96af433a4199d348cd7a4bcbaadf3b225614b7c9bdc0ad72ce7178c07f55a47ca3c87c4d6b6c12b1d8256ca867cb23071aad5798a75f1e924814552df923a8071e2f3b3f9644b2a26ceb01b814be32e381ada9f7f0c4ab14982cd6935b7233f23fccd9eb1960382bb1927aa055ea29d35bf269ffcc822caacc51d642ca387be91a7fc7bed5af049796600a32f0250a5bcdbf0ffe370488c61cf24ad5a78c47537aae673f9c11654b53122a88d19f35011f35cd750805c7b6f3bea8030b6a2d214cdbfb694bd30d5a78d72991e79364d6bef0d009a45930dcb6bb3a36f470aaa83bac2c495d2e0984cf728bd9ac7d0fa1eee7aba36f6227beb73fea2c8f7287df93e915371ab2a8c64c4d76e0d336cb0ab2cb9bdadeada781f2b78b4adde31e2e7e4d1ee3d176cec238d4f76d4cf359292ca2ebffa3879ae28165bbf4bd5b22171ae67cefe0d62217cdf170995d8fe14f5b9046c038dee4ee6204aba731ed5389f6870d1252e44bc35ec33374f31e20748d7746446099bb50b7c5105f574a5ca5fd3366908b4241a1f930a8f3846309bc2bf1ffdaa21a27fdb188eb06e45637797eff68dc20e832f42d7d3e20feb9c784f8c8d35ddc6dfa8abc656eab4185404e28084b9d6d62a7693afefd6c649c2fa0c425967497243d62fc68410ee2045430caab77a9ea7e712350fcb2fe390c1e1083fad229069e3f22a5f9273eef20d0dde023504b7ded2a02803c6823d5a4ea3d6d8ca0b6b273b5d542e3819d79eab7a5671105154bf657007cfc64aefea7eb941bbbeb7d8855a078399f80813bd8a726f447a0fe013df65cfe1d761145040e4677a8bda11a43c1b501a4399075cf1b9e4611e9aa2bc24109fc5a0cc4704cc4eac47174530f87cbfff3f121988e737b5c6d89611f90c50f4f74762d87d542677f8eddf94a35f75d10e864e6c5cff1f47c9186feb7e0a897262df3a2cd05def3d38e08b1835d27fe82051dd44008eb22fda8f0b8b9235450c4cb247e1fb6f973938ff6db5ff73be539ccbbd496dcddcd224b2f55faa18c45347bd54bdee2dfe0a4d581d43f5ff2ff683ca40a996c3202d007cf551c9464b1676bd3dd0c8bffb7b830a13d5ee989ce38ca694b10713502962568ef667af4cc75fb3be26ae089a296059683f326ee579b64783ecb75474cd2536f60755f4f26d6bcda3c3a2bc36938d0c0889e48d14a68698defd28bef53818ec446ce98ff1ba7de9d31814746509962796adee5451719ac19971f2b55f9912a971fa10a1dc43b9e2c4f1e6a65ee1413b737d9e79d0397439f1a938a545338fe59ab4fc025ad44725cee18ed5e03a6b449b8cfa7fe20b4998d9c7be4f897f37f4d0b21aa10a38730b00348f3abce41e5aee5b02f6b410aff597e46825e42654346b3d76d2c30a1771b67a4f0aa8b84022efe19d1cb77fc11934798d5ef6c07f10518c48eec8c60e5e30e333c37e74cc1e52316caa3b32677042bfdcbcad87e1a0afb0c15ddff77a25f8f8f2734aa5e4c07172e1105c881444402b78fdf10634b9470fc4eb0b8e5bea578ab7bbb76c71d204f31a66f953f35ba5d3168e1d8dfbdbf12d218fbf3cc67cee6d2464339046376d9d2d444330788231017cd6d2efc7a098afa1b2940a31e4a25552aba5cd5292891a73a624e04f59cebd2a28ac2278eee2bf2cd101f3f5310133ddbbc330c02f0050c85e8666075d29c3da6e312c3a3da596a73679b28d6c80f6c373a5f98bbd104e181c66d254a02133ee957a8d52e842beb978da2da161480c0e6cabe9bb1e124791daf31a3dbc002c1ee799c356efc53814cffae2133ab153959ade71921d955c40b1f1eef30b45559565e49a3896c66e8ac8f47f0e314cc267b80add1c715bd3a05abb39a3876355c048a3d0c1473bea09984dbbbe6902581ff21bbe877fc2c644417c8d58ef3e23833ae7efdafb94c1e7dfca4a7db14dd48875388d3eaf912aefa3054597ca7d60104ded3053e8608dbb8efffa757e6fea99c11f74002f593e979bf0f51870703c2156d2c53ae8efe8d168d81dee2d5a16f2747b2bdf2eaefcca2c008f453660eb094943d948eb637efacebfe09c6b4f5c8f3a0e11e5be7684e1bb06984a88dc7835a0de0f8791976fba10fa30dc0de81cc388e1358d1d6803d8f896edf1a11bbe87228342fd74b436720608fb7aeead8b4d20ccf3e6cadc5a25792ab6fa298a9fee4ff74b20297603ff9331a2cc66330ef933ac103258c8b958d58dc99a33eeb1135d93bcf0b008f8252d98f1ba5ff4e90d22c5175c692b639f805593920a2aa7c9eb9cb186479caf5f2075d60c729a0ef00ee28a5584c5b99b52ca417924bd920811877e7a5c6c99471c8e11516fb4fd65f4a19802be3497939a385aad4dcfec2e574f04eab97cd389de6e44411506f7039a085147f47ec8f7f4d15fc3dd4fd619b52f4594aa7170863a83c2b503a04d21d192786e0bdd30dcb0d94bf7a9a90e0bb0ec2bc3a4e10e7c96eee577f1205a04d24a168dce63c5e04eb45964305b4ddd97eb1d8b4de60165a91edc82fa0a8a30357e7dfa92c7bc5c727cf8b3b0e3b34681e0944f252b7b66a09373db29c8a7df24d7f8a685f00acc80ace8ac19bed4b5c770ecda664953e0b618e91eda8f74465d74e6f0ec4ac10828d6946fb62aeb6fc401924cc9f6ebc53f46c190a41cdc3717febc1676a51532851331b2a0cce57cb3a1c86a8c4c2efbba1c4cdf19d32d132969646837edd3f15c7b4c51a8b7adfb428abf786b5d5525fd180ba2cf8e98bc9185665c105e6640b997b6bd8dca263044460c8ef149f739d63341ca2e421e4b3e37a3927c031731cc594b7842138308672da3cc032af671959c2d366645d61fd2259087e32a617c8f60bc469c954393771d401b390656541af49a81633c36d45842ced7e3d86333c07301bcf58395a3b8aadb34378a4c388f9fc885cf7a1125d4021b25adbec164316e1f6e47403ea31d4d19a92406072c4c3ad70cc870d417d1bfb42d7cfb54358440a360ce30e3042ec4090c012d6f20b770b2da458355321a06de8e550c417c55d3ae0baa8aeb7d8b821968f014603da71b7590960c6dbdb11f75fa93f7d443488d625406785329b4daa21bc2e8c779e114a783b9ea6b66d7c6ed41981f56f67ef724b3833481a41d70096b8ae6716be63bfe83b46db729c8a259727b4391a5d2dc3851285957a4e2d223b7a8c53e30bbc09eead9edec00cd311e2aeb0244adf9f3a2e81039375ac8ec3d29329f569f4c07e72a5a0a43a90214b4f1d7ed82ee2535a6c536288f28b3e7e3363c026d9a89505510aab971843449c3f572a1cb3dd5a40e2d3487d21a315c7fd90944b38103ea6c3f5a6866fc793c8f48de91bbf041573d5c3091697c6c3e235e97995d4f2affa8c3586686d8f30715953c7d6db4eccfa3ddebcda620f6dde89daae82af1add8d0603e7512b7b90a292e6941bab619f0cab5d07b6c58b8213b982cefa6225ec7fd993b802fcd0b24aa6b3509190d037c724bf5e948119f325365cb9980703a5b7d25eace32aed7a26a532e4ba7613628579ecfe35ea763bca7bc4e739995abddfc7c3da0b4a19f6662befd8f0354527916105233256708b18c9a852c84aa003be1efa92642e05597bb64e04308d57d373b7518d3e7d6ca1a295499f72b9bc0dc44d24bc9bec0be09d85e90e9ba4233629a222abd8e50538cbb924c190f0a8d0ffed7bde44a58910f24247bef96f98ae14b7efc1063022af179022619049c5215b7f642c3cc05e8c9c577ddb3fbe433db12e79a9cbe3d75a7a66daaf50d48b9b4a457ce377dfbea3f3efff98c8cf0cc5ad723df0bd225762ce034e66407f729d863c49956db814dbdf558ac61560112af8095a3d7ab59e307b762fd1bd81d7521482edede9a2d780e7c9eaf900ad544648a49c08a3225bd2362e6e10b15b5ca592687bf18eb957997e4376ef33ac5e6854f736a08df9bf3a7b44dc51d00eb49777f5107e454b2b33641c65cf953b89f402da4610d1aa9f749a1bf2067b49e181a70d6906893bdf1d51b960b98efa1180f856b6ecd97494e2da14a86382ee48f5f2146e9eb201ea60f09961151274ff8cd8aab72ba23299b9666ef058fedc39a305fb8a9604315a478404fbdf79b5b9c7420131dacd908abfda81ecb9be833431eb65ae6c69e83d09caed3064a942b81c64f78ff01b9194874e4409e3b2ae231e42904e049995acd23b469ab0802ac7e92ff03d51d5733806b837ded28a8f6edd93a0a22cb8ec8403d15c692abe40c3191f39ce8090d0458f577d801d5e1e630efa379ba3cf6af4cec92f46cdd406a9747cf8382c4db1eb44788421a4e5e412ec1dd24ea593115f894df9ba98bb47b9390df1847ecb412d61f19878dd5c476ccf9830edc90167d569f7c8c0e9edf09155d63c3d35ae349bf6fc5f6fc825e5774d41f43d111288cf28d2655906c209887122d3773a77c96d039cd8ced867bebb7afbac8941e2021f994a649d07455df26577d5f3566788afd984031ad031b3f65f5b367ad207a3f6130d9714106d7be123a8c6f4fb0c8c86ccb65a91912594bfa25475514a6260233d7f2a3d91daf1f76eaff9b2a69b713a9735a326fa641155b6995661abf78ddaf3f1c05ad3244880abcc9ada4b04b65d400909c692defb4a208d1c3e1bd73168147befc02091619130d6785df0c126488545fb9a4e803c11493fce1be74ae160947b384bd91f873ea4e08259472920e2b2f54f522b1023b5a02735ac2d11270879fae6e18e57b7680ce00a7c07eee367aa20bcf553eaafb3a39a7534ec8b1d98bc0afc78670cea7cb38eac06e5a432a0a8fc2a7a1b9cb27467b55e58ab910e1d114342ebdfb11e8c9adba6dd03d3b84f0f28177a98b171362b35e971181ea09858a2b0f5dcfefdb19c92e725c1a37995017974c5afe255c4beac49efa4a754a867edfa14f2e8745d0870779be2e14ac920ce486bce03d940c9f190f8b587d75233bb2b2ba19a9a2ffa2a19034bd10a7c27f8739138ddd3d6481a77ce9615077f6f122a9a99b0d1148570e6a8ca2b5d52882ced4ca3723e621ad606486d9c7cf6c3412d013963e6acdae343d4e639f47a8a9197fe3d316cfd5115e34546d9ad3be7b295ab542d4847cf55b0deba950fc3c5b285c83f1fce229f7ea3d5e68718705a4721049abc921f88422f9d17d8fa4a7d415ffd17fa9ef8b4e0813574722fee2df6e4a2d6761ab27da17bc75313e880ecf6d30b3d58252ecc31672a0b5c6e346bc872d6ccb13d9a0acde610147c20aeef62fff5e0754eb8a0fac0d1b162b2283f732f801d58b02239bc849ae38799eca922c1b14fa24c87c71b4ac78d33e5da2170cd2b5fd1cf227c492834c8364616ed8aaab5f9a65521f9e39810a75ab52ed313a726ce4c68932e489ee93e9ac15914964760dfe63055744a958f6d25bce045ee5bc0c05b186c0109d5598bf916ab4d4e6ee9a5ad7bde5d76de10f97ac98bede655841487f404affd80460c4809b6ac791accd30e29300d464f76c3cbd266b0b08ad88fdaa13e3cddb8ca46dfd2eb0bdbd90a2389a2d2c44a542b50c0607edeabcfbea4ecb93dc861b13ab94948c3569f97924bb64523650d2b5eb6658deb36efb2c78ae658f476abeb8182bfa5efd28aa8958d97ba9cc4db264b4f18bb6aed47fc3b66abe8439394787bc73943657b5d64ed92c70600c06bc20953538ef2009d387e4d86ec04186b3df4109e20bb0b77f6db3d7be188443ceaa955fb376e279b46c0862cc6736bd219fe8c9de2426a58e2378212c9921f7624e6053c8ebe46a4f43e234f8e8f481adee954679d9132dd02e3e6ae01fe342f6745a97cac278be4f820a891bda992f54b78e2229d414e5e23ec0b48958a160cbcc71f8f5c22c82e27c22bf529897a0ee3f2159916cda0c19f180d91b96b3687c2e4387e9bac9117fa37fa84ffe32e0ef01fa9103059081da341abc8925c41e3cd0bda79252d9212768535e329e83021204c0b0ca5e5f4b7f8b88ab7e1c5d54defe94622bce434d2f3a01bcc60d86b149c818519f200559219ff487747ab76143f687cb7bc6974cf633c727cf735ba050035ac8bba7362b96f36089dbaa9dee67228be530c591fa27d22273e439fc98f00577d94e2523341e328c853844d7238ec4fc74411940d6987a37af4abbc26a683ad1755ef474f58831614140f26a05a4e164fce2736b803479674fa716c5de5ef95caf0ec515a7dff89c134846af607cc233e491f563eeb44c014a0f2f2b4988b8549da299e116229d71bf01584bcd9cceb4239c2cf3a16de58edfda037dbfa560a7968c60e863729a0920403b16c501f21e2c2c7b96194b89ddde99f44854a9c13fae4fb4849e7763b42ca736f250a0e3ac2b72f81deffafde89e3064ed4a8a8d9af6276944a40381c487d6c39b8e16f7377316ec006dd5e4f1e885efd9cb124de071907bc8ff96336d8637aab792caa4de03c3c33340c60c48953c3faec187e68c1f003efb9dbe653d412ec216e149ede739d9c426eec96e2c466fee544443f9e7e263a10ec18faa640b86f216f078288a72369113aba7b5edaaa624199c0956b6feda9b6533cee276d8b4e80326bbc42bab204ad01022359d38998c25a45d3c685252e4db2325ee1ec628092ee2ef7182beba249ccdc82e5591c8b0ca7337ea22d4403aaabc59a0ba8c02d6b8c5f4801e7aab7a19b5f6f590b25b02f3643a244abf9438b5c7e6f6bbc221da3ba8b93e0514502c22ce39efff01233dcdcfacab3843f47c192310b3ac24ba3458b7017691e1b81a8f54465514a3791c692ac1759fab548d759877f26b070eec94de7253fc0f8650cecae9f906927792071bc349e74074bf3164c5218aa1c1cf2a91cdd55f967a7915461c7f5dfdfc8733c2e2746e959bcd26f2d6b3de268260da97912393d748d9fa4f31c465c632fb94293e526867bddff0a2a17d71e4372443bb2d4e012f04fa5ce27b7c022750ec1e6cdda6f58e0fb73c8a8c4624aef6601099e8f8f317e8b7b3d21f8b81e06cc67aae7a701581a06b170c6ed6614d231f361fd426fdb385e254edcb2e85794f5c81be41f61b20355843acd1be550b89edc1f1d4d6f3e109c4b8a95f19580f4039beaa6c69a3008b70b27d43b69dd8b5a0526cb5f2cc2044402a2120e4daaa5b808a95d6428974dc60027fbefd0a57148dd33053d6758e44082e86492cfaa40fdd5d781b5977d2afadf5721c655a905c1957a7711b9fa5b47ea4f1d1d964362a8df50c88887f81fc71dfb23a14d2f8f82d5e23132b8d8a11e228a653b1f4809882fb63f1a38c3888b72b7e594a402d8d7aeb48c4ab3c00eb226caa81a702885f02c97852902891d0a963d8df5d447842e15feecf0501733803601188b329a44b6b0f53b92a6c65212004cdfde736e4c5a9cc4a5bdfa456f95e9c6eb22fd2e0c08690146bce799281d755baf8f07a22d430aa57e0dff8fb0c5c0cb3663e7691986251d51ada1bb0a3ea545473c85abf54be7338711c09113e41b2c90987e6572bb9f855c88794370e5f6b14a7ead241b28f28a4924ce14c1fe01d52e2cf3be1db7b14db17f3b2906e7d645ee8c9401c1170fa7a9fe0856eebae9e4bf885eff701a84135b29b12122673f8ff3c94883c5815f67f323f9d0785309af9150471a227c4bf09e70eca0ef4447fadd2ff2de864f5b3ad2b2252f0f69f059be3e4259c12c59026ae9403a5547bc0d5f6ce156902875248495faec3ac2442931bd3a54232010d28071abf46a508a244bd93cb043ef5054dcc3c941e69e4db59259cbe3f902ff6493b19cf117caf96d58fbf5a8830537c3b7366038e56f18507400654adc954917de7f34ef992909eaa30c0044968131c5d8e1d053a690f399d7ef6abc5a275c28dd1305fdb13a5ac403f6b603e43615bba2eb8ec7bf38c606bc0577f1115780fa8ba18fe2d0269dbfe87972ea994754d031a4c4c3383b35fdfca10377dacc8cad9ef388ba0e7699426cd613afd4cf0d5784fade8f6743ea6e4a89d223939e7ebaa06836c08f743069615cd51f513dd72b4b8ad34212bfdca5cbf07535812d054369883773fc12c4694dc41df4cd222dd2f97a445d17d6211e1fb2d7f6acdec90c1a7f4a083a0dc45bea40686f50bbc6f18d3b59258d0ee702aecc05ba83a1cdf5157b5dd8be25ce58320cfb8e53bcb8fd2c69e7d1f8d3e2e7bcb2b4b7eb711206f284eb300c703aaa4ed5aaf6308b548d68aa036a2fbf5031cfc1999b6e2c50c570ad4b910e72060c00a4279926e600203290ce66eca85bab7715ac32e32643269b516d4cdbc82ab201765ed346c86a75190a1f4156f8c03977a817a952a015e48a5aad321a7022dcd7b71231eeadcf4da032652940152e4cff08ae94cf0a1af48e9a686d2467aceef4b934bd398625b7bae86d01f95a6c4765ff28b715d790ede65ea0cf2af4b24e3453bf666dd61b6c024a0e308dc21ad2cd7913205650693eb74ac9a4b98e8749a2986ee47c43c5a597da343c24067857cef9c7ade9bf66fc2e3efce3f94fbf497aca74e2a213f3d65cb502cc11814014a2b601df87a835508aae9f94d08cfde4909a7b3e83a83dc5022bf995c27e0c3e12de5beff452705688daa5421a92c577ebe63b3ccb5de692bd50d77c6d0184ce625d3185dd16d42fd7461b2cfd19e0ed42e1c7fc0692707010648279afa5b066fde1b9fb07b3487558e50a53cc059ddb0e9f9254f7b8d50d3d7b4eeb91b25fb6a4302982311867cf9dfdd742e669c9f7c00754761d30ba135afe76fee80dab2bc5b481f9040d88fc22768cb67bb41b85ee802afa03bca315786c95c108c7cfebb094eb75fe7b6942de7b5af1121cdd5b22c30285431e3feaf85ba00b66fa6eef8f76fb9b9dbff8a1a25f82ed8f17a405eb87a1d168ed6ec14ca9e35005a0090ab534bd6d404868ffdb76ba1f06fbf24a97340b243cbc78391a7ed1a40b904304022ae837bd0556eb4212fc4601a67246f5a5b4aeb8d1b6e8c016500006317306dd7fcf95462f8222020d0ed1516bad10c828335562b71754c3dc72b1daf95b8941f836663c1e0df334606e09df17d55ef09335e0c26d370ffe586e8d49a4c02f16b8e0adb74c705d6d2db2837dec10c1eb1708a45249250284f67eeb189a03e8e00af0f4db34aaa5d84d0335c613cdfabf368ba1d2cfef191f4041c6c23df5dc538ddf152f5770c14630b0b3c554c320eca4690f6b6522e8fde7e866ca264f91e59a5f7a438505658be413b0d78afc99720a9a8fca12af01474e58f4f88a2b38f86999d27f4075c2535a8ba206a8f007d101e7af2daa4541ab764d01f625b9058575d09c7302bc3644cc096c2a67afe02f17b9c6d185ebf44675b54ecea1b6370ce663dac0d3ab60ce4f656dbc019757abc27f781e88d3f7c9946dadd09581f6cbddc3ed2d31180f49e7e2598e0229c7758c468da98a1185f6f6062419e3925b3c99f14b19ca8644b5eb1e994ad631713fb7c5ab99f8436b717d4d9caeb8febefd352e181e887416d2b156e3b6250bc66aa4a8c29bc1c0d55e4b6f029e130e606cf9ffb75317b47a9191aafeccdfd2e55ce8d2bf2bee0d84d90ea9aab711f6b4b585a255ae921c6e3e15607961a412fa78bb2f5b507f4a653a424de49affceb39abca4bc23cd40419b6fc67978cda24c55e8ba836ffbada726de22553da2dd5bd1867dd1ddb8247c815a01c79c77d822bf62b4395d9517d623601cae5a27d89303cfdd9cd403514becaa0985a7315a4793097bb59619caed58d1ebc64693ae106ac3d001375b85a07dcf79f7bce2856104a9cc620aa6631d5175676276bc53384fc7bf5ac0ea4be8a6cc688c236d93d021c159b1d0b7810356f1b17fef53c635ad416513de676de6a54c71897526ddf99627f40376b0b2088f330dc39d608593989d8600326b312775cfe09edc6e1d8da2ac8f2b4df4879d18cf4fb53efe259b2a7b27698bc44e0273cdee6481cc270439c70528f93904489a94cd00bdb55b05be5e0850f8f7d728fb21e362331db9edac49282465fde83722875556af17a8d71af053a7fc09e1e69dd1386345a70636d47f45a94d742ff8a238b8dbcf965e91b1f151a3cf7c897e514a3fe65dde8920652eea53493cfe04047a21fd72eae871be9686d411cacb313f841df37467982007adcba5e294e4e4066184ae9f0afde8bfa5a99948050f076ddb29a737dd8e99d3e84c39271b57fa6a214df334a5bb7717a0d261105f10e6bd9aaf6faac05957c0f92bbd52961c7d01bfb5da7fe6fb58b5de020cf266452b01f905b57c779efe285ffb9cffbd491d2c25231fb50285c98a9c634f800def3dc192b6a33ae7048c6bf929f5cde5f6346a86367301de6f0e8d5aced621b1f58b2c063d29e14d872b1b5a338fe1b785f2341cd733a013cb4a646afc498d553d308021dc917e6fb842c4ee5180d05a4ec76701e857e31e62abb01c94daa9f2984183aa88c23072903a55507ac937217633cfe9fd4dcddc05509c51c4719516cb4711f316ba8d312d51794d794b54c749e88912e798a148bdb505d477a1221ada4efb51837e8c1cabe99d956c8daa09e8de9f53f3beef127c8d88d629ef9080716f7c685dbbfbc70923e71b70b98d78a5384ae08b51dc3545e690c1b09e9892f4c799199550a9912b6eae320d313bce66fc0a1cc20ad3848a74a35ede493d6a9e5ef9930a19b21f6c4b8c6c42d11b1b7a2aebce3d56d5ced7d0c09a55d06fa3eb64f29ccb446084675d38c434e8828b0a8d4cc816cd4c9351c8cb098e5b7cb04d5ac877f6c619045168459f3883496a9cf28912e75ab788e794545386397a8c6c55249fa7cf734c63cfe7749e8d1b3e9c13160f8e44ca3d33cd8c2b507ffbabade2acb915966b5fbfd17cb28730e9024afde02739e2e5b417e7a89ca775f27cd94e6e1f13e85493a87d2ce7e493289cb5aaae06ba8def0d95031c73c62cda12577df550746ee84b2f8726c80d78e4ee4144ec67d18edaff4613132366a0763ad5146a4bad14a42e74c16450e81f4e3db63642f0d647d8c726297f678b3f2b8a7ff733763ef83adb3e45075886c6f3c4af9f871d2c9a4cd81424f58919b693c41cc27f5ed929af08494480b6d2cbb0ad3074d22e9dc58dee4fa32eb4b49712f70f990c1f4d83c3122d0b3d03fbd7884f35d9417ab07f3fd05ff9ad4d7aa5491ee2b9536eba8655cd1bbb4d7c6caa1a0632ad419b0576dd67e2851c128f4c9a1d6cc4fee99f9292c07a249baf1b2ca352d1f24b816bcfd70eee4038aa0ab09d46ed53697b0712b4528bfe8916d8a1ab75eb8ebf3dc6dfbea3df5f78f2eace7d40bb47d494b241eb063efdad05ccfb30503a54b4cbd9a780a1d2d5186916f67474fdefa89900eac06bbc51fcc2c1ddd9e3dcd95dbe8ac2286689260d6289afd682db7c0dda0a1a05b8715b472b83c1129331015f5017d0355e4dc03a4de0d60187f83464f2ad202b20a660889cd742a5febc382ed2e1523b2c10994fae99b0148179948188a5101e93b45dde26d59307ed7a95233a1af8b325156ffb286217c6c9ddbf5036d56ff6036dd0d6d2e59e79298874c9ab93984a70c5b7fb367e2cc57b35f2ae08782bd9497fb6febac4b1c45b77f27885812e686aa8ef794c303cfe155d277cd0456597570e362b39750c3c13fe637b620fdf673dab85fb3fa62c8ad7d7d05344b3ad7985bd129b9c32ce485792a239b2766ce17d469f872dc2d1c6695c2070bc3c2f3dd0d81520589e51ef2fee191118fca5583f432203c34017476603aa9e16290ebbb8448279556214f751db9e3c3ad58f0663cc795fb15f0818b5a5123b18a3e7e5f3f0ec07f50516c9c37da7f0b0cff44aed867c44f56c73d4b70baa3c24880ebd180854835f5b440f7f01667e5bfaee80592b056146a1b55a0036c5712e57c70c3af2e813b06cf614d83a66d4983ad9fef025bc90361fb5d467181fff4a4c7c6435f5c08efa2ead1f98406ee9138295998398bd0929bf946e4958ac8b08c2b8bfd50dcb7859daf3cfa3694a92853f5439778e67735f1388c16211b3441ff48fe623bf8e5eba5b532b24488703298b1d7986b80d624006f4b9072bef7f1ad8e667c9f66a7851d798e2679d623ece11ea8e4cb773afe1af7110fe5c650745a087e2436860d01793c07f8b8a6a3ea50fadf796b1e7ba2cbf8fe5b8985ab2043df4754eb2fbeec95a8608296a9f9bb8ecc0372b1ab565cbe565200e13f95fd490882d0f589b76372a2c31a7ba58dfe6439c2d28b5367c462e44bed9acc7d46f61d611405b61fe59ebed6b150e200659c2c6ed54dad5b98e9470310310d27dbd7f78455f59ab5c986f8ca4d5a7ba38c87ddef867e7967b7351b4338c8c6397bf1e1b07495ea5d2a4fc05a6784a510d945609e354fe0a9c637f7d6eaa27c39227ba8721ac45477b8e89f03abf53cc1e458f7ba0a46ef05258422e6fe94863b0efa91cd8321fe63c27fbfa04a6cdbf1dd79ed38035d22e45e0b2d1d26187f2876562a9719f43808c11956ddcd779f9cd672e575a219f095a044accc64d996e407d9da56ea7c41e0eb8c760a173e8c6cd02c44917ad70fa63633a306d4042494c2b1ba67f2dcac8e3ad437a2f70c14e697176fcd8d20f38d9b2b8542b2c36f2b2b5eeb1e222d3c3eaf7d3e59921cdca0c80183c1861b94e6a42a561b253f46f5092023d795e61f981c540c3b1fbc93c977aeb12a87e37e8847bc85dbc77d338e35496ecb3d892a92e84509bc8e676c1ce98ed049f4e0d66dd5c641acb49b883f0178b84ac5784e54b6873e75ef10e7ff642a9b9ec00ab9a4e02084506a3e2e34f47e6278a20c3d00fea8abf63874c606f770b67c3439983a03445b6de65542467c3ae4a41cf3668d2f4549be187f4e2e286e24436d78261e95682759e837e124aad71930b416517b2e2bd11b55c7aa177aceee2362c097bd899df6fe808aaa705c26ad66e90651e8a466f802205232ab6d9ad9fbc8fcdab1566fbb10afad6e59b876138288fa59ed52dc7b43dcf2a2700c4ed78b8785fc69f92cf52d946193ce3ea9a45b3e9f2c78ac6b4baeba79ee7c57fbff40e65ec6d78277c98b6d14fe738b70c42139f592cd921a90d4a7e6887148f97d6d22fdfc932ef5dcf2e6cd49d407870df50f08b011b30f89cac5c29d2d74a2f20c9d1b9e6e2bc726d99199b9d1cc2fc42000571e319137cb6456f707596593fe65d384b869ce58eb0f7a05cd25eac3abc3f8e3da7ad3247dfab8a788635c744fa2438a22c849463b844b7433af05d3561c0cf099f9095eab0d89382d918879234f9c0692528afa81080c26a1d3d66e096035bcd642f6bbffc9fd7e5e56dc8c18a5e77c81f2e622164a46610287cd8f426566acb881895af8cb49f25ef29d9ba1c956022a787f1c465bd257356fd34d4662145e7c5058abb115299d38e9a8badb8a76b46ea380bc21d66f6ec1feffb2b691c7b59087331daf83731443bd25dd745861f0d98170067ceaabdbdf65cd790d1629d377b5e8b8fb02788cb07832b4f27da5fe53bae8675e2f00f397d08490983abadd5ff5fa4fcd975b8a37eb60beb14f6f7587b8b7d46e7340c54ad9296718856eef528058ede25dc45823c4d8689771ba72a55073a62191ad3268fdd4160b22f24623e13bedd6665a802c7582c26e7f760f8c37d8a33cc822477671b8b200071b816a7571f6cd378362fc53783fca0800b15ca40921e4ef9e9ba956c4dba8c6bbee1e4f8de9353a310f1649057b2aea3f6ad12f1b538cb556ac7de7e9d464abbe9e39d5b9cc5bcd6f320c8b0f91c32d1148c0547373a034dea84677dc84da1f01e2c37919b85423ef0d9eabfbd1e005b86642d57c305cc8e4b59b26a46d1ddb12b3857e95da5eb94623f909a1f3974b854796595eec91e4c40b052a40f53ffd889d76dcd0ea9cc8ff49d4984e80d7f40d87a87172e2932401584ce0a9456cfcbd3d109ee6657728a652dd916e55f4f4150478ae696c49628c5c8ad5a40e54c97e81b4c82cbac468c80cf18a4dfe7ed074ac2aa641dbb2bf13a1cb1211ebdbeba2ba4fa77ff340486b153c0b6374c4763f68d3f30680592141624d71cf0f6b16c1cd422e1c215b9550c4a914927f4b8f39b43a32d01404119f4762d7f5b6ea5912d8de78d98b34b0e2886006fa766f05011bd8b45574eb8e6b08cea283cb9bdfeed85e38c86ef695fb0c45f235f8e631c6baae924f4553eb0f9f256e572216c3c73b4b27d366182e7b4eec8f84f24b757453be862232d4733ed53088607ef7d7f1e7830c79bb53e75281d1a9aea11be0f1f2cba5d0f592fdc472e13319a51417ab2e46ab013fbd2da45772d9403ec562de90cfbf7cd8e31c1e3f441a0f52fd449237d348e103932beaa5464f20f251f69112fa67881152b633bca5e65daff35efc1ccdf1d622ae812da951d3ade4abe1598b37ce2a93aa0eb15ffe9b36133dfaad5df2351c11b0f255a6ffc8e30706acdbc7e9419b7e52ce5a5e10469b5c3ee7d5bf1b2c78967bd8ff3cda0b1a65dbf54976e445855414a9caea7072a9b1a345bb42e61e19613cd8d9ebfd21f2860d6416624a98b4af30f76bd5441d189645c5f447ae30610e39f45f456c74192ffb283442e839474c2b206a9f1f1931a45da541dfb10bb258bd2cac9b28ca50d8b8bb338dbd8039fb0e458954df2da77b93def4e21e8b15088771de79441d5d72576e2c1c771f5c38f23f4a43bb0144009ca13c3dbd2009715a9503c1a733e7b9db35c5f2bfea57cc593c1764f2c659945b8b9e1dbff904807fb3712e9e4a91047809b50390dd812deac3013d3ec942392269164ec83d2a067c602a2cc52e6c38c942d19790c800162f2157252ed9122aad36f2d7209ae599e9450e94304277438b6d09a2d4a6a24a363c32d48d9c4cbce9aaeb7d18cc28e76ef16ed67b86318178fc5804aeb363c802d1a94a9cc6106986194880df7b5fbce4662aa99a275bfd616bdec5fbc3346a4fb00227185c4bf9cad6edf7f04fda0de555adab72a17b762734cb19a8ec03b95664715e25be1f768bbceff904670451f5a282982caaf6ef493dd5c8384f3439c578a9029f3d4c77943582ab49df6cd80819b5cdb61327018f8c8b334667c730debe4e5cfc3c153035011784b2e2455b5cb3778165656b5b2595bbcac2f3be0261bd91d89c77ce76db39095943903522809c095804f6a26f8c3d4f1a405e16733e84078df9f999e5f1c8b3c14c98f114bc7b063ea5e2072c6ec29fc592ed769240bf8f3c91f7e3ea52ab4f26888ea1cb36d3fb59126fd02f80d268df93fc387538561d52c52e1f1f2408f3c34eaf9a23d385d73ab8e6ba16152fd37e33ab6265346b65254b45e7cf640fdd5421738879c06fdf2ead6c05c27eb4057609e91616527bf5ad8ce3b620114075ae0610431aa0e20c1c5c526aa9c65378dd0e8b003f6d1999b28ca4ca22d4f14d72ef9802430a09f464d0038028e63d8c5a78526fe42110c0b162f1f46fd269f1b4f753d343e88af1b20c0bc05b5604925f585ae4aecf5fefb12039c06e4005594ca37ba1971867e16e935def4e09a9b6f5c8b75fe8e6d59722b4e22bb294eb2369b99fb62b9cce0a75b16cdd9c2a724149330161fb775f8ac7f73b3d7818dd839169ebfd352eb404529cf17d48e24d577379d0c9643b6719b2f1a13b0077756c6a0ac10133bc036e8d05d7ad8d97ec08ac2fdc63dbd309e12c02a313adaf9aed43dcd0e12533701bf9e2b017f11651fa67387374038b192eb0a4ef33b04a2e101168561918b5c128fa9fc8dcc13113500e922d426b98be16c0a94f5d5e595bc99d0cf556dd0e8e892027b7ec07fcd40c25dc5a2730a22ff373586643ef431bc454fb83eaa8fb1520167c7e430f6fc6774a790abfa2f60f671e8343029e26a83f5e3f453288921fe900826c9cb5bff806e987dace2102e1beb86498a6b055f62f8c3e1eb5426108a640c5f904e62d31b12295c6df0237e5f0c09c9ae1596502b9e2d2f52d3d1e4cc9d82d148df5d35cb5e4e2d348a1c681a89d150bc6a78cd49939ff8e338769c9f191e6673672ba604bf78747e973a629b39eb249138904cf56c4ccbddc74b87b68950fd064b90d95d3ce74574767ab7373e8aec7ead39c830f7bc256c71d7ab1bbd4c85ce3f27ebf31f1f06675d15f5709cfd79ec8e14be8ded0390b40091b72e610ce4a022d5420bccd5d7404807c43006d849d973b8dec2bb557fc2b64a3475530dc24c4cf261ba93aa43a71276daa3dbbe394916bd078594531b5550815e17a49c0b77c8dcf8812718f2282cc3b5600ff6dd3bab398bfa3fd090a3b072ca2f44500dec42e40ce742c86d0f7007341982ebc21cf0cccfeaa11a25191618aba38c5ff253a7d78a38bc99695fa187217c34d6f34c4fbfec74ad49c0fc3f69b5f27b4df69406d725a8dac56dfa268119149ec366b1c79160b212d63dc9efae3b04dd941db647a4e32e03dd715ffbba3fe36a0143d9dd08cf27cd89cc80db20a1d91b58eca9ea331244b096a9cfaf872e81d6fa46e52e6c7587bcfdc4192c0763844a5ea15f50b09950adb4412827c6d3c032533d5ffea13f55ab03a0639b35c7b056fa540d34fdc576f1dc0da7b3adabd218356b9bbcf65151ddc32226b927925628603bb12dd09eb19c23cbd61b9b037ee57beda0b1b1591a810b4a58037f5c4fcaf5cea12360c9aebe7f2812453702d642f69254f9e93e04254b497508404594969b198fded4cc114f52f46e9c56d6f23be217378f9cdb39e8b7a2811bfc324db75e6a7038361a8cf048c65a3a04417ca180502e9ce0d1381b42c8f7d5218fcc9053fd1aeb76004830c0b9f03541cda7e27808a53e3de524d131c51e125551f0a13d2cae2eafcc49f39a692b095952b3cf65e049eb047949347315679c178308406d1c56c524c34dde39a455591c0d803112855a6b8a61308720f4bbfcab05ba0a7b87df7890188dced04a1a24a4cf49ea2fb6a461205dfa342f03c7df4260f732e88e954f5766a3f6e93f57777131ead286ca98aaecb8881fa014e230db195e200e0b776cf1235694072ee0b3a8ccf9d8452b824b7ce09652393293ccbb3fd5699f249149fd71bc70939b71165b2f51c849b2988802f6b99c85fcbb0aa75c6dc66f52816ad7192f0bd0d6063302bccdb3fa4fac8e41f1e78b7865398a0964f887a0d7ac72e17191ac23eb02c7c9ea27baa8769651f3fe0671639a84cce877df1bba37b0b25d5c80eeed68cab1bf7e6a2a56d1883e9ec7e19b736c93818ab493a15277fc923db5219a536ca02c1349400f3f0a886022c98f14949bd0930ee552502833bdbfa2943031c54881c95aba9cfd7c4984279503f27eeaa7ab81110712d6585fd19eb5652c5584d18ddb15e717c58917b28d85bb589400e483a1ed836398207078fc9d95bc75aa5d4d446d86831ecb2d6af5b5fd2c9534fb643fb805923dd9341d07d9ff914b2b60752743cd74274d104f01ac8d2d9da2475597ef3a26a7003a7450883a1c187eb6d935488482090aabac28d6ffc36a511ac9c76f4d6c10ea8749475e603f8a934eea1ccb39645aaec9400850fc69362b3dc1b3b42b3fc9d714505784856ef574193229d59bfe3e1a8d7cdf0d5bdb6ed332a8f10d45a30a6846f206f2176dbe6f1bbcb2003eac47f9653b946c135082323757b4252d35204bab3f559559697854075e9a23c25c0c3dee9d8e95fce086944c8a4f62581e606db3b4ac9d260bb3699394ef92631c1cde89670cf2b8dc057e486fffd56f1d72658cc0074b1cc392d1d1a12053c6bf997e6bbb94fbcfb6e77e296a99fc9a47a1410400eaa0aa69c8b91e9766724f41bd7def09ddaa552c06a0e635ba0b9e25ebfb9ab408dfa5f353a1964d364db1a4c1e76c7d4b6520929a145f3aa8c77e1290d0bb679ac840a5d509d6162dfbb3027b3815d19d21ea4242186a71a0638b935cbf7bef875a9a558d502cfeeb4945d1befd9ee2a6c4df07e3469cffd036b38ccdda3caf88bbe5667eda4b55c57f7c245fef11fdc3c0871e215031182ef53454319c1528be71fb8a44bfa7dcfd4f3436c26fd591f882d58c48e92e5700c0f2c8267da0c2699320995f338b1ec30fd383eee6c2b59f21ab69c1d5cddb93d3fffc50c3951a1530b9cffa41ddfe099c2a9e928728e29a7def3d422e405a874758a848da2f8ea803e1caa5ccfa830fdcef407f9a95bc576a1d00b4351fb24d84e2347b304780608faf6d7cdd898340bc200479717dfe3efef5ea1f1789454828d11e0bc3477772229ef52642b1e8780c73d53b3c2c8eb7ec1509e3f2f1896e5a2572622a09c5e5136d106cc0da40152965237875c01b8b4ea7a9a640ab3f3f2f166a347c04796b936f5088fc09b24085c16b83e753e62831c608af8386ad4af2b55c0bdcc97ce9ad0f94306bd783ce16b0b47dfe2ab59f09fab75d8788447ed4f577b553b13b1fc472c952e60fa84ddf423557faa96ae698f5ab8c9f7f88f17c882054ac579c2681e9ff1a79651caf23a5ea056eb9d0d6b0199f6c86e57cdaadd6e97e90f467897d04c7789c276023d85e00c99bcb4c4527d0140ac147201229fc0b26328942a00257ec72a56df41718b25767bd86fa085239d5d98aca6878f6ae50b34c332b282ff9bfad907bca3b8ae3efd9727f8c607b2f4537d3623a887d5fd9131b2972b81a03039ef763c2daee591cae4674583ff4be5fa167485d33c15b63b33f58adec201168370967427c3b8c8d4e4d35682fa9e86b803fa60f50c59e0ad61b18c9f93468430b2c224ccff1600192b0fd6b08d7b974ea1549fab9c924e757cbaf855522e41698b0f0c1a7b8695739631dabec8c997a6f54b7857c8482de7ec70218d6889e7c32a3c816fc7249143feda84a72f9fe6a0e5eef000350068f4c3421371995eb70fe4bec0910982e37a68624ebce2a8181d84cfe102ace0e998da9db21b2b34ffe658463369d29e2c8ad9071928113fc12b98cdbddf1b45ae744aeaf72f29f952d9ef091d164f10124b30b93633f91b60b4951443790e40f55112ae3c813dbfbc0eb1f3a6fe3ed7f9cce7116c4ad49d577db48a7c3b6af1c64b2c79a4f699ae43e00843cc4d7f35716b0502a706016d244ed3bfd7255caa18cfba24a53945b1a8746a1379ba1148c6c06a830a9e1c4b394f1f04a2174519605253b33d5cde5fe9a682ad84e317d718911bcacbb570098789e02d61a5b5d7be654157c40dc86b4f1799e65c8ef50ecde144c8dfa12d059953949c010db3c22cc36bc4da9265b02f05f4feb1ac33d4617e83893147f70a4e2e60b813da2ed46d1ed349d87a418245e5f91d16887806616efe21dedcc2ed3c2966b9a006126befdd184fc2702c7336919a221d442d05d76b9461aec369a1a72486a21c5896e1e6ef508a588654578ffc5eb022d0ff23cf62955bc3c6782e4f439829b577005e37e7d116236b9ba57e193c16dd98b70d60976d083a22a2495234a0fd27f8461b9659da1b9cbf3fbc77cfd2afd273f0f34b2293cd41b143c2cafbb940e9ae37c097f3185a5eb6ba784c639280dc297c5bf175df0d3a5b1801bd8c65c58c1c69a55986d585b6dfed34f74dd3c224003c9423cdd39b5dba94e56a298bf873f543709d1769c28744143c866c191c077065920c426dd274201e4c969ad15436f8a6e55e6404f745114040e26d12f88efa59613223af260dfd0d592b7e641809699decfb0cbda6b0a1a77c4bb0685378a991b9309ce21ce542d6287021c25fb45197656d5b9a08d665d46ffef3100e993f352b6d1ce517e4717351be87271cdb537ea172f166b518fedf5a31cb921354eff7852ed316d950768304456ae99c17acbf3c9374d0676b1a91c133de4494b3819b4cbd1460b1873eb7712448990187adde657148fdf528ab10082c138fc9bf8bca8f5f8ca07b7ce231fa8e3b355b41cce70315dc0767d859872d56302c255975906d51dc366bfe092935b5ae274d9c5b5851650e6bb17fec45207f251cd8341d0a7a507f8d39084c71b20228357029423d39de33eaaa80cd46b0c0d06fab25dc5d04da29fba9611a5ec0d48859fb4900aa2748c8c297b40d3fde9ae0d8abe21fc82f9dd5cab1bc3263690907f51607f38f6b54911c62f4eabc0759142a19dd57636efef6edaa4fa44b5f2932abcc9c49b04cd7fe54c0ec3bdbafc50b5511628d4c9e26da25949ebbcf1b749882ff6ad0b977d007a79fe1a835ab23cf0f91c4cc769e686c61f61d7cc19591316c27680926b90fe7c6a2d1290ee8e430d854b279a00240d0b6895386310a64bd4c5e44851cf591c738d266eeec7a38e7f6a01cb0b336f44d9f5fab2712790d78498625b2c9fc5dc36012464aae42b59932d48f8316e5363192fe5cc774ca7097c674ea6d2505bd2978e5e2bb7bdcda744bae656a5bddd311820487df74eaa9406bc739702ace4149f3523b974969f2797a7a59cdeb9b9a88a46f34175764040e7a57639153614cfcbd08bf24bee6902abdfaa14425f18e3d0522e3ebbaff7e22fa2abbdb4789781da985c00e4904ccd22cfe51ed5614d9d127a70213913a0b1f788ce87d66dc4cc16689dd8cf881a1c771f9279071548f763d1a3a112d3ef5a1aa772e0773a8c55a66bf8e510b43aac2ee486f4f086d2f24110c84f9abc88597258029a56322fff1f2b22242399e1f5ee2161ca0d3071bcc0b747a07bab93f3483166a8ff6e38ef010a82c81e53a5f9fb48d85b357bc93212dfdfa99e62fa91f7738a7ec13c59cfd239d6ad28953052eb8dc5d9f41bd8366d3cb2d9f55e757d38f74400fa2caad9081cec318939d56147a26a8685dfb32b15345c0985f11af237221f46ea82e201a47bd88e97033fd4691bfd604406c9a0e2ae414fedc47f27987d584dcc6359473bf4f5cfd5db2dce727505eb42954d8f9be9ceddbc885a69ec3505b8337e473a1a7b88b7325310b0c828e2073855c8e8d2d87876d7933dae7d958232539482f5b5a837b8f7adb45d09a99de834af49d7e24c69cc853b29823c048544ee27c44ab015f45ecf8e7b65eb8b9ddb3c3acd14e9b668839c3b2b09a38e15cc734e0799b1df03f88c8c182f9722aaea2bc98f88c553f51dd1b8ef74de278149bc5f6cda3c7f42364fcf281a392f6c0e2a2bba37c1106e460ac24944e2bd9bca4ff8b49677b7fed59f8cd86cd33ac80cc00d78da55a4751b74fd4e58c76089a320b1abfa982ab2d47d5058dae1cee5231ed57078d7923d497edd38e10b88f70bfedf299c2cd079c27a00b5ad344120532febba356c56db089b870262e75e53d6c359a0a68d4e96a1cf0ceeceb60fc8ebff3e983691502d3112510b56c8c3553883bce3fa6382566d72cffde01398ad8f35d9ae5e188a4383b4c41a707bebd3766d6acfe2a5d2536558b31b6d953402095216aa903eb1ff86d668484108593043de69464be6197a2e178eca73ca981434e358868beaf553fe9f295491af2a3ba0bfd5c4c0d191f22291a9b2e632f1ebe16ce10671823b72dc67345cce8634d7dbac9691c6bb56e84adcb6358b3605cd30f22617f714594262c9b65bc308c08bf44732ab84e0215732d2a2cc72c158d4fb899620a8e111c8d6633b324e7001c769f351edc3862dde7fcd0cc158ce62e1cef264d3107934da2e7538afb06c2c2f72076ffc935d9f84ecf4249cb2d7a22e81b18667272d16a68a2513200f6897d2e29f74f4814c44cd30ce939eec5808e8062ba0d6a43bef245d66a0a51b362f8d283f7c1bab7ca5224537943619bb134d14895258a5a91ba06d7ae3b99045ebf9b816cf9defc8cb6e3399188a557681f6bd97f1b93fb6b6bb6c675e40614d45400def88ae1b6742e608e0eaca4e99cbb77ea72111050415ad330fcc825e8e0c71dccb6ed1b1dc97be1562a7dc5b36f8e77ba451abfb3234d866cae910a08665a915d73e05c4492943cd19493561835ad03f72472777a4df039d6aa2c5bc2f04c6e63aa6fea950ab2030bba8da7529e6f16d798fd19bf884a375423d11e582497bfec75a95609e6f09ab8b101c59d1d7ff19f44e4e003109281f107e0de11c567b445bd630b95d816275752580e1470f6ff791fdbcdc7995c3fa2e4089f24aed8f412a9d6764270d881dafc0da39c82cd33986445a54696ec6bdc072b23163d4186f62b7d531c092f357c897563907df3117ac746122c411e9bb50b09d46cd5fe58929af64b213f598c4a027281d2def1d02447457a55628570065fe2b323d7a4fce86093f1282c4404cd1b101d0c19b2ef46524ede671419b988b5cf4d14254e377bdaca019aa80ea0a30202092fc88d7538ef3ec71e50ee890fc0f03383f9b10b04c4f6962d7038ad6418a58ed6031bf11150e60d4f618b308caea07151d680278e92f1a85baebb55dea9028c420b444aae4ec73db650c6a4821c0d9f0c1cdf50bf6a3fb581f1e0eaea7a98d97d8fe158b4ef22e10541f1610c70fee1d42b5fbd497a3efea648aceda93c768881dda79134327315ff0c555a2bd180870ac04ad02431e533c2e39df82f4506245b065384f1b1d526fe883ee9a3097d05abc79021eb3f52bafff83d1bd580797e8c45bd6a2cc8697e9608817166caa3ea70bbfaf7ffaf009627b88b21d4da9bb9d36e7464315944531b3c9adc1279cb8ec4698c4cd9f592ac9d7c876fb789e9a5824d20ec4836a72747ec678dad9795db11d83ada047237069af3597c8e83f03333d2eb8e00505e9d6a51e4842bec9504b2877f11eed5cbc2a6ce830dbf5092efd01fa6b7432b94a682df5e7298c12527e40952a60cdbed214db5f98b5ab70714c343b4cec623bee2c24e58993bea9ad5a3de7b9d19121c656d2b1dc3e7a78e6a4cec8222c02c602b4fb97b809341909f1d01dcd2ed5bebe5b840fd16088feca20efdb04d869869c3b317ba0ecc6da7d34c4aedecd4c73c847b6ae714c5402f201377a3ed62fc0d2ca312764c9d55fc60ded2d0b69620fe17167c2f3d1c6c02c01d42f777bf40d308d4be751f4189893a7eeeb57e6d75ac0df12577b0e68069738c566e98e0e09963a28418fdb446045f1f80c0ed9bccd8055d7b78a1dca0c4bfce2ec90c9eb937bafde6c54a4af1ea01f3c779c2c55b2ddd9db878419c4a2d17cfbf30355cf6cf5f008224ce4555191107c90b2fd8177f7990f8fa1e99c3500d9604d1a605987c576b5d09a399860f8c466d1c6b1bed9a7e334c8d6a40938c2c35fd739bd9a7cfd050803dbd36077ecd9d7a6f7e8eb0b024db863ab9667be69f38c20b76e79988ec17f907dfd4dede9714a2026963ed15f1588014c990fdbe09380025312c5b188180ef54af1db787e0d40799bfe7a885f33242031e2c38be8e87adec1b35f2fb514039b648d06a125e868107c5888c35318cfbd82b39b550c3f7022beddb1001f36f1001477ac1d36dff1fbd63106d3ecf703a0f0d54836a87f9779278115ec0fb244a1b5482357d191011948940fbc9f2ec65ec2229aaac5a186bc5731557e8d9f9200ea9e7d43bac275530b5f32ed706376f1aee75860af61ebf1cf70e9205d8100c1ba39c6f25dd35c96c3a56d7be291ef4a2b27712f642af3dbc7b72780a879dc83a2b1e8b95e4c43f00cdff264428018e413d10f713380dc092b99199f100f730b0ba515c48f43d0b79cb16ae708cd23da3200c7070eb201859b17a5346ec151d8ce19c235b576b51b7fd43be88646f7c280daf792bc482e888d8f8a454042e82bfcb86a4cfedf55d876948d6b3867ab4b5a03305b17bba93213f8cd258f274bb4b962ae9891bdfc4b4ed4317f66aa26b16ece626484d91d3cba47d16bbde095018bbfaea8b0607f823c16ef3ed0de4fe305c773c0f79db06f21bdfc47101085095b8350fa187173d198afab9ef4d085257609ab77f02e9e2e7df0c5abe79d285b895a1252b05161a8e15e27ca63d2727d30208e86c1f165405100b5ba67006dc38084872fb6f1701fa5cdf35e557ac8c6b21bc94652cdff62e807da122cd3de42d710808815991f6b2f71949b141817b310ffd653ae88b5fc2589b31bbd9d24e92a0609d2d79076f37ea484fe0b8f5580177e5f7f42641042dc9201f1517f659f89ff63573b51edc12d323b8ed45be8b307446ed7a86e36d15d8e69aeb79a5c112a9086446e173303b41e2b25a13bb43ef2e8a4e2d27f691e4aa66fb8530663cbd88aafc8544d66a0ed1a711ae773099462521e42dc3d4974e434020898420fb7adb21f479fb9f781c478d97eb093f939a90f53ac2bad35c65a4f1dd9cc15d63ced8d12409708b146f28861d8de2116ea67bd105b49cb8f2b622d66ec6df31d9f993f315fcf8643b21c70f36a5c555918417443f0fc9dbe988f4d1b82657ed98da9d52700e76246b73409916311a43695596fa896a89adb0aaad902599f322f0dd995bd58ee7f50b4fa4ad0846c9bc970136d270b9f5591c129bad3c6c0b026ac7aaf30d77f70d55a45895b4f13ed194b3bf76e63091af5ae98d49e8474e49bcc86f3ad9743cb126c3d49ce1140643ba9250ea2944e40a24f7c8d2411516c102a1144420d8a845b623ca69247bf0608fbf0a2f48842ec11a1d3d3d13765288e22d911be3ca4920346958697623537462b384427e9e7bbceee7a528f2019fc7cd37a498f70bb785a96ba01e12701007d094c0b7b8475590ce6e19f6e1b9ad247d8ef44d3889dcbf4fd377f9473d08576af21c45550cebc088023e64a04e7ff55de736a8aa5e513ccbf0996dce64da4d2d3cdbd47e069a5eaf235ed6a5b14722e7e6108d7f02c31545f18987f82bf4246e095136f1780935335eebbce458c2f2a40de5d2e60c6dd9f0a16a2c14d68c1fa7e95bd18d931732f9d3e35d1a8fa2e350dd10df08875730732621a45222161d244c89c216e2b793014f3dc1fbfd5d7ee895f3e1b45f9355e91e90b6372927a8365d67fd35324f746e1c93545b0f0557cdeffeb585535c708a2d96a827454abad6edf20fa439e126276693ac95516504bfcf638d93877aa2601f99a0bc7fd5abfb5b03e18e49b4337eb50bb4569f12f37ae2f409b4ab52cffb872b1c08dff445c103719b472f48f783c1bcc2815189349e1ead766b0e60af0e0390fb30dfeae693780fc214ad305d7a2470064c50a4ab4ee0c444c005af693cdc0603b8cb6744d024a57e1024bf551e2fbf1ceecdd2e7b26cd788fc592ca9b4142f1e7bfac1cbf323a10666dc3d1076f90a8e1a985c617f7f64ce0c423f45fa2bf90c935c2b1968d0a4fa9f615b46d053e6f731804572344af3d79b12bbd84018d9545f66ce696c926b2136197ff2278e35190bfa8e5b8810bae2fbcc400266f6d2f222a45f60b463661eb2d66c60171cc3c6693d9c5393396d5b9b722464593ce6d5c48249a003f4379b78b6358f3593de26b30a620e6489e5367e8a02fa0b7e2f43a511fe9d47df028413d2c0cc93f48733ddafb542a9dccb4e37db405785e5f0771175baf4a54c8fc44b4ed8c1109bec6edbaa42789cfc27df21e085ba6f65735e3197aba122d9fd7f0dcdb957a739e9b2baf16da1de179a46995e692062d9896e1fe3b9335955ffd6087914fdd725c3947643ed179c1761468c77e1df1c4e56a6dc7444193439092ee6ad61b186cdbf0a7e9cf00c0a5ee243313efc34740e7d61c486469c603ed62b913412073e20fae6090ef98e6d20b8f9d11613efeaac17eeb7912f17d8fd09808cce9ba7cd666a4ba0f8a726b7501e9bbf1284bc1d8b19077382907a2f12068a0c9278dbedec3300ba62f3e831f7b487ac225da93dfdf5a63600f50bc94fb9c98508480861b062a3a5c1dae71da6717f522609294e00121f133d918d62225893dcda81285891fc8033049a48b99e99fcacb6cf866623562b9978a1c8e13959f3c49689e8eed074ee3902a33769a0546bb3244611d5d3f60a678dfcf1fc4ab12bdd7c5b95c88377c8f10b25fef7131e025c88957590547ec46a00416a146b6277155ad0f22ded1159c2ef04a7ad24ed483d52cf7712f4ae6e97be022b68480d89321e7175b309feade3dd3800198dc4a6a457a010fafd959190b3af74303b60fa6ede40f464a9bf7dd5cb1d67faac8be996bab97ff3804bc56605ffda0afb6a8e62840d8a821c2b12302fa67e8b1507c6b3eb41693ba691c75b6fb7872c4a087e615c6482cb776559a89b3ef0f595c6d2536af50db3a008663724161e55875603180c88e107d1dc153099419846d85f7a6e24e117371de8624329cbe78491b4ca6e925f8b25027427e376e3baa46f273a3c78772620b706ae0f4719e0d943525e9fbe323842bf4c11d3e15745f58daf114eee47b114c4b0b1eaeea105e0836c0ca57285ec54fd9f482b2fbc2fad3d099c025c980f5c0b9ac240f147056d5194626305a4fe1abfbf746db2be529e69e982c80d95368f07c9e761dfd609b3fc37e963cc7c2707438f77a9e935c8b4c36c77239ef5c22a9bcd1c155aef1a83d4c34b190e04b7e31df70dc5182a3a47092ad387a850d1998c6389c82c2467cd12106a2db35642ba5f730377b78f72ec774355ed940472d73b89affb990e589429de7d7d6cd5b0009e2748482cf6f28a1030af4b6ac8a87c552dc8915e12ada35202e67e14da010dc6546211cfddb7b4f874a4a629cf5f636872f72b75b6f5b9ab5016be9c5549af5177a253726ecbea5b47e7b9496944223f70aa86bc5c642d52feaad15297c739a1f168a7188a157363561eaea3d7db7acaa6c5a2c8555077001f1c1f1f62dfe9baa02ecea597bbab86f0a9e8532af88cb9d4f0baa00e08074630f3605d688dcf48b66d19ef8291865cd7b4817ff932ea10c1c78061b9455b952c783c26f2fe9a820407b7f00d79542686e299f441ae297525d7fe1b6b108656cb37077498bcdaaed4ec64af01259283e80c55607004913ad7bb3f71ea4d233d82e624536372f92c8a4c8cd45f424ffc0fed2bcfc85b20bf4e011eba80752c07c1ac1ec1399bb3c1c40611a5ca4276c737c44d5c1cc3317f7069176a14f0a436e42bf1cbd5ecd06a18759c468eb5554db64871560670d6e85c6cd1bfdcd91966e91fa42db9d6fbe4270a6326787e1ae72147668a89895774e541da29f60de3d74632f1abf2a1c1be0bb3cf500662baadd60cb116d5a3ff2a7bc055ae14dec841b5c2e3d0e825a39d7fc158da8b0ed7511c26b28eb51885a8475b93514735558282960b083a3828554464808fbf0b08f255d1513d4c25175f212051f5d289bc2f81a428a053aaf7fd48975893532e22ed9200293d20d14891dc69dda2dab1d0bc561b120806371a30a30f6996cc3e8f618751a2b6abc90af1a7d38feee9a5cb6ab0ee8c0087843547e05e5211a68f4b8117c379d735a4f0683a6d2cff4b6d0210685e3cce37b3072ed3af732535d320ff6a108da6e61ea30d8f7bc3dcc72bddfaf82515371d8d8782b76d6a69790cbddf3d19f31bc63816e1584610fe05359ac8a586aca91349df23f1ea4973ddd08973de809be63df73544e89464f79a15a1ccf2f45633f2b5c438b7220099b391a5921260c5d7aeb56c697ee336008a71a6b5b3c18b966aa0d65d4fa7e527a35e5ecf5091a34a15e1d203b032d94db26276475ddf5645478b19b14bfb0f7cfe45973b204b56a2a2ba362ce42a54336dc38a170338006e752ccf606584ff0860c68fe737a1f402446b9026eb1ce6edb3784b1aa67c9f35a9ea776aadf6d846268fa78e76dead31fa60ce555aab9a93f9a1ed2f6593d17903834a8f1adacf7de0778fa82fb7056da8022bcf2d27aafbb41dd3c443c0d56effe1401fb382d9b6bab052edcefbcb7c8debb54aff7bed6db1751e2edaf33cfd180bd6e1dfa54e3aef5d9624c20ac85d5343520b564fb5355411f66eb19c208c9792c29803986e430b0ac7626b9afddd97c45c8cc16d8d90b589db7c0a2a84b167af412fa8e3c1f42d1217271e080264a631acc7ea4983bcaf42616be3018fe0c1c7fbcd5bac895f1ef3b254d2b406d5baf6fe32c831d6f7470068301e519326e27c3078717c5fd9c1d43d537fe72c7623a42096575379cbeceee38385e1e9ccc1c4669c01e388ad52e8c6cc46ab4d735eb0c20110c7ceb6f5e805d2a64882624403df0161871f951a0c23c56931fc08ded105eb785d8bc16698e1fc4deb2bf24f0853dfa5177f9bfe048232f483f7f4a1aa8f44cb790eab0bb1f62c86c0cd15cc460ef57441bd473f6dcd8c8a8517202e3fb9587651681a4e86f70c3997927dd4f33e5b956554db66a27b95aa23088e4c1146d12c66e69d5051be4602d22d49af71b9b0bfa46644c2e2dbfa446a1fec0c489328800a5defdc21bca4f9aa4e9b57308c4f61bcb9d8ee2ea0b1a68c7371be67178c16a48bbee798cc0c338a9f2d5cfea31fd047f5163d188724a5f8275f43c9b41e9cd6d7b66a191d5fb586aa4243a7db7b8269dfda50d52aae74b0fa0ca296a2da8d10a6851fa7389b08c9ddb1fe7c7b7f7df6b91cb9a7f69dcc7af65effad784a79c70a1e290db80a99f89418e36ee3f2d2b2a16db99c07403a02f484c46723f55e454cf4065506b3a68c802baa75cf7d704a04f7a13166c0898a488bd0dadf240aca1680b302221edaea4194c24476f80163b7130cc550f2d6136c1cb76236d61477bbb1258eec04341f3f4c3c1d7ddcb85d83466b2ef3b0405d499a554dbeed0f4eb17cf2ada0a93aa758a9b4fd8ad55f46679c1e40ccebbf710d138e363961543891a5a56658d3c79d9ae3f39361132bb4dc23f7018a8669c69dc84bbed23cc796ae8fdaa6d048499d7ff7ba550f25191cbe5bcf942c81c99667cc2037347666e3edb8e078ae04c07b0981a41e171a0a09e5880ff6b37a2271f53e7cd164086df75fdcb6a2a0848daf5a1a19bd187949d51a188338b033376937f0496570cb70bfa224c872bbb496b060249532b1995e0c2b44251a796aa3a1e21feef0486fe497d2062a9baa8de8a00a15fa9174861723c5d77c399983f89a48e660126ba99ab5d6f291e3e29895479717709710569cf955106c38bed1754aafd8108f5a2d80aa9b1ae38bb53efe396261ef4fbb80afb8130df3277ab3e917358548f4ccba7e209da72a3ea53b12c391bcacd143a59af2db46c8de6d5d8d4dde4767695f6ff5343c4ad0a8c470559c78867c6a9a0559152b913a0f3740051651064cf529ca3b4e0475fbeda8c12574dbda172a986e234b0ecad335e6d405affe121acd9cbce957bc6dc332a59e096bee22dfe8e7e8717adf85ab49f4608350729435bc2e9a031cf16f7adce2df69fe26ab414d7394acd35120fdf56e9d58f1feaa91a46a4c16338eef6fe761b375baef2af7a408c1928aaaa014732bec9c3639617c1049fe42e168979020938c3459005eef1703fcb1897d3e570013e1fa100df4a2b236e61374e09c03c05de5d490a0cb9624fa44fbe0f96f6f50e5ae4ab0d8c90b286e2a703adc5ce8f2478502df5614a2d925c6b3dc328b8ee214edf780f8444d4ba2bb7c3f25f3e1f4c6ccf044dabafb317820565acbeb76fb8c39641d93f0398f28a585dc210b33eaea4568d66150ddddd067bde4b5ce87454ae645ecb565ee1257d1b1dfc0bf02df60b3bc89713b70788a766a0e04d0514ae22a9534c6e829099ca029a2d73cd3b4e2f4c789fdd3ac8ba55cb506fe59172208762f86172a1b73c5cb49f232575427765567f389d1e6320bfe5c7dd64c96aa472e28db4b995079a5c1cb81a3be884eb13ccfaaa6399022ab3659d47a61d88d3b782d90a1b887a3bfcc061a3c26a043d88be284dc28e8721b1c43bc6bc57793b56946f386cf77549fb9f933628275d37057457f47357b00eaaa02f7eee84c43b96d6ba8588e8efacf57164475475a2e3f5df85389af3c797a78bd21a6e9efe0826dbe999ce8f3a937927f4a5f9c3afbb1399516d8d5d315cebed84166da7fc990694a99dcfe8e5575de4f748c60a4c44b1fa68979c4c3900ab372addac263147d1e3227712b2e1ae1a7111d417b81ee46f15f27bd7b07fc70a594cdfad98f3a06787ba4f3784e021f97a4ff2cab972246c8643d4f3e0070cfce6eff1b61761af139f779645f48a0f2303d84902cb09227fbe8300d57375b1d00e0b379e491295299f67c904136651ea151b58e9da46bf80b0272320f753dfdc797851d94871925c4a2df0a8037cba437cc728d935535176987544b76521781d1c03940bad5b08632d9d590790c55aef514a4884c5aa3dc10aada214bf78ee5bbe07204acd5a886333698b99e446c2e205e20e1dcd26617612f92170ee326447151c682e780bf60d0c72f7f89b91e7a5b4cbb14e30d2c3ef30d79d3430d463985aad68dc71f85d43b3da73dda3a23775c46159e0683e5ac513b6013101f6b041020027d32a5c2602aec706e4c956597f0a007a70af67829f41369048dee773d621727c69eb0fd28f9e8aba0c0fdfcdb70292421754c7c81e951b6ab282d4dfdf0da47a4b3ad3b7fd44b120aeae13ed803fbd971118b42bc57d691e75154f14592611b28ae2074e9e8b90588d257e3d8731c0cbf5df643a807f56eb118ae7dc693aa538c3deb93b713531be9a5553c9a8f3ce0413503f6dcf9f67f75fbcaf944bffa16779c359aa7b7d0e6568301e1b130142d3c827fd660406d1da9c5e76642a79c1792e71f0ad4a77ecb6bcb3db6d8ddd9cf813ea98843c22506a29d2f336d7038929c22e4363c9fa5622398bb3374eb8bf95bc0e2885b517a20908328130de6934a3c04b18049e73c2ec92fdb337ffc7cf19e5b37836aa8f8455a78c7a2bca102130c7d32b2c990e28487af12f9bd7b43e706a43df1f2b7759d7a11f96a89040d6f366b694418d7a2e33c58b45aab7b0a7c2faff48a34c6a7ab116d6275a3137a2244f221767093c5d3db2a4414beeb2ca222302cd036513e5c8fb1f5cabe127284c67e54d0c65fda26d49700c7c41813b661c8ce5a4ca8c38433f799d5581529b9f3d7a3427b97141d7ec6b9044c347b9a249c3aa3b52345f6d72ee352651081176f44f25f9b4b67514c57f66db1af0b19329e26418793cfa59e49680fc2476d09f26801c82b889c478e05b68e3e909d06d13068cb55e35483f9796cfcecd3605c50739c53eb515984cb89384bfa5c41e5049067c25f0b3d93e43b8de2f75b7cede7355a0c1627570a7e1c360280c0c6dff0d8945d77b6e80ba5544c5cf34370de4d419d0464409daee95d232d6b518de5bcd9a75d7a91b24f31a8b8281f2dd790038da74c7c49b7a2ef32103e7fcdb7e5f2cd1cd39b9f310df6c96f0eeb61ccd2467bded2bc36fe2ff8c0370be539caaae62235e9d46cc0e2071222791e2568e575b67b94760fa5b1fce6e9f6cf6a2eb54014a230f3473812380a86fda22504ae21b972c9d65b91073a0317d54cb384ce1bb1e59bbe29dd17951a73af6d4eb41e3a8751e20636daf5ceda078222ad92657629e2c10d3b400fde022b4bba3dc4b86392635569b648a3eea023e36cdd57eb973f862dd2bfb94ee3dfe383a50e1d4ea5d358fce9769d0daa07a27742d552d2403aad06c104d6c0a05d0c8c8747650753b1f0307e11f624b8b912c4f7cb921488784eace650001c95d83ac02866142b25e1b9762998196ffb18f96c0e6fbf8f214ec9ffbb674e582f3732514c90307960e35af88f35030a002b492102faf55719b09498fa9e76624b22d5cf1d6c24b6ef72902125054a2c7f23e8f5eb4ae60a2f8578b6ca9c3af2616ca658b4e57de9e97d5f548c76180d17782fd7f4d4324f61067587d3a1f56cfc89edd180959d7972c0a38331cf8fd2c570b35e811a6327dcb2c2337c2ed0aac77d9de41a62063192796d1b0c72e82be5bd4a0514dfb961a6c79b2cd0959872901756e44e09ab82d40d910a5fd40ddb7bc6ba0e66e8c785b8e3279e08c010f83245a14ab658a9582e3e37dffdaf88e26e1b9b4ade708d9b38549be658924c20ee30068ddc2739ae34f81d17dfefefc6d209e17f03bd2a811f98243813b74c829546523122ce718d35bf54e09ffeb18a7c3ae2d11c0880a12a9d8cbcbf3791fa43872c64121240851a150f875f1688931fd59de285a17d72280a7c385250685f1b6ec6804febfc20d0351182db54119323998a0e77e22906fcddc0a46076c6d494fbd4f96f5c82dd01706ca78d87ed14ba4cadae445a79d01cd244133823bbddd6510054a45606bce8bea4d98ae872a41d380b342395865e7685e79917f70aa0ba7cf0dbf548045fe7f6b952fb2ca72ce180de6861d894d73613b00cf54dd0c68ca87f24ad2d23720c2fbb1decad59d77436be12c78d8a7486b0f65363c44cc7c308f273e65c390ec6655dccb8199374bdb5272df73b5da39e3d28dd89a5af8324421c1c4deadebb7dc4cb8a97face82c19273eed2335b2800093379cbb4110e6532f56ee7bae32fdfca0fdfd6b90c66faa3c8fd2b79c5108cbaa92fb6b05d75754dad270b8cf8a1b6396d9f48c383fad4c12fb69e51c3440c99222758853c6b50a542941e3a2a5f206e3756f0d6409744c7dc5baadc1836fec5af091901b9b1c8c9d1c4d9fc46f6a05c4c3ca04e32bd5f3287364974c788a0908899fe045e3ea51165455a688d99f45f362e59a9ab3d70a19a26c3399a5cead9ebb542a49373d117116c0d188bc0c246058d7580c631e79a5db687ec6b0d42881431b7dd395e3270c542e70264de6248ec45dda02e61a41c4766bfe3b1a62a25d7c5e6bc02c7d2827115a2cdc585a1ff0282e53cc2b07c895cbd28c8fd2908277e02353b0d3fc862423f8f823e7a4122a38e5c19814e9dc3a019a7ed01c464e91bcc99718ac633ee12ade35c95c762a8e918c84ff37ddbb02578daf3fa3b8267a260bc3a081d43a3ad49b441815acbed6382c4041b4d2bd232e22a46aae2200caef442d3d28778a677ba26ceb7320195671f41f2750eeeaedee8ce34580c9e3637a92ef13198c9dad47d8c898eb8efb4ba51f4e269947c1ec6796afb9edbf31188b9a35da7b36e6bfdc6781a3fc9b97a402cc518893201d7c174f5da6894c2194b027d18691eb27d001a91d9ebd5e2d0d45738c7dfa1f4b6aa896b40c2bddb3907e61c1ddf780690aa47b4dfa33083e9e193b31206269f02284adae87309ceda3278bfa6ecd3c7ed7d92cb3b4081779917bc437ebf6e2c830e6052b0390e8234f683a6d6b93b899d301e9effcdd4d247e0bcee0c56e39fe2f8d7dd27bad62e903e645fc924884fce41fbacefec9bd1a818f08a77e776b501b9ba6892983fbf0a0b06383d6ee5638da8c1f43d55f93298779119cb9ecab53262fd9e0edfdd312993ac0e0be543a51547659d9c410878d13f9f3f8556b3e6dba280aa5209d48d3107d93b32e184a03af581ceff6a61a42db29db3b298c078408e97a90d20d02f12f326afed877f2a2c969c4584b7aab9643042e05fa10ec578d443343dcba57ac1bb611790d9a297ee44495c96425b8a18038ad1426ed3b8c98cf540e332b01d406c5cff493ec0c916482b008d4c61837a5067531d39ca2fd69b3157efd2cc9af3767e3e2720154ee6cb9a4b0f73f7fa431a8389d000201bd8dac69d0217615db4baae5c3d9b5a3ce135ec3ccab14975ae8d346bd0c5d0932d228d5a5c614eb5105b58e3e500caada1b35e6ec2ef31f26a7f32c545db485242ef95cb91cd9b3401020a2bb67e359ecb578e34185c1ec8553c516ffa5518054ef5c8c44263cf06e693d351ff01646107bc5e14441873b2082d7c4dec1a53d477e118a314ba6e5d28cbbc56bd1ac143eb476e3d65db2960d407853bc80d785735301e5f18691da01dde13e3cd143ef7521d6354b562768a962af51fe2085775f9c9633f94dffd33963cd06dc43e026e7b2bdfbf1bf0221e691c70ff694072c8a8b20575673c68c17441f39671203fee9a27f207dcc0d0d197d7199340723fbe2837d5b95acd9bab5eb266a9be643ee0950747ed2342e44d8ec4039f6529984a770db63e857eae0874d1ae661089201238a4bf7436e8bb78158c9f02b9094042131a1c2ec11c37156a2e49c75459e799b98cda3b22b1e3c5f22c7db660243c104b3357ecf319069a79961e367eb0bb5204f22f7e8122686ae28afd8d61ea1eafc001aeb2189c18122517345ac42061d8186b619d400c9be3d9fa6241ddd1508b7f930468b26a06ddcddff0d9a88a61e513996b83a302fc26f26c22c8b75ee47d56209fbd2ee544c64a6672186575ebf450a21e3c048ae4015ad8835d4b8d871706600a2075bccb0d8364441a1d2c8730a7bec9454bdd10f45cb4620685dca8feffc70d648c536922a2dda9ed191eec6cc2223e92a1912a2d1ae72b454f36e2eee9a13b359f54a99076449fa7b015684de170ad85c6f0929d460d9f9567cc61a6889ba4aa75d41ad9c8c46bc19def4ec987f5cc7a3db301c0105542b3ee4c0d72cd63359ec4ac19fe5b44bbfa88dcdf6090ec5839a7c1f94562c5d5379dca27136296ad64f6c5818a805bdc96a6989a7e98472c79f4ae9357e14c607d16690a43dbdc9d55bd91affc5cd2037d9eaffa454361dd96fdef1e0e0aaa9d7ecf9999e69df837c4a8ee8365fbff6af10dde328571482c995c14c156df4667e05cb11a9cbbbfe716271a4b13078294a06e761dbc5c82b03d950d738ed0e6ba0049407bf224c58f496f9bcc8f006c4d6d9c75e8c19bae47e4e7ebca6824c518c09ea0893886d13a796fa8a60f9870db43ac3c7dd66fab5c63b3c4d43e8bddf18d0de129090424ac3a2989fa0a830b84021cbd68e4cdbceec95a536af01ebc18a659acb4bc7eaaa669937cb2070e4a1ef6b507592b9f02a558a6b0d14d5a8e9f07d9533c18fa8058e102c598a23cc16d7c9019ad849e8c6e13c82992e6d569817ecc49cb61beeba0491bc6c5fae795d6ae0a62bed3efc1f0031d205e1befe99f693c7252c03b917b86eb850c9bdfe088f017e572eaf0bcb1988a6efb23e5be125ead88164a1ab2d803bc2593fbb48301bd3d1f90e88c1f9754e1d8269f73d9d3270b12d0a4945da9e97e4df5a63bd9ca76b911003f7779bf332e5141b6889eda10ec76d207fb50a915a0d392f436b74cf7a52bfcf7abc4a223b3500b18e35c08b13a00003fbe44b8c589bfc123d8751edf7e12e4df90a605ceb4f006f7d25eb91fa526c76682a63cc60f5c29ce562e9ae328eda14934af3a87e84a359c0afd75c6de626091f61db1d012a3158c67a19182cd99836a50423bb7af2f183b7ddb59f1ded4cf40e04a97a312e4a53647f15016d24dfb321f6c3d39c7b780277fb7b2e654944cd15e9e18faefb28aac3ec723073521aaa7e36dd4a9d8f43f19775765a51b2acafba85e0232d4b2b16c62b53fa1028c63c2c6879379f43b0136c1779ee853a06106e25f019c5a1f5c116d2257adf688fce5ed5fa955171a3e55a0825e23002f9e8a1d825e4e39fa7500748a2d0a2390042e001f637172e6ab49b4fb6850fdfefdad13e41686d9d1e082bf00059c5658ce9f35f99ed25a448cbb8b731ee8e0a23c05906ba017bcb75df4d9376f0b1864b428b1e694485bfe974ecf82682c164ea30adbdbb73ac4de38f98f7bcb452860dda09a634f55809c70fed0f846009f559ccf76c83c1f8894a1b2b88206b3853ef95718ce3f99e7d0da4edf54b36957fcf6ef5f89ecf7cf181658170304fe1905879697be1756580eea574aeed51fdfcb6088c570dbf4874e2a299a34a6a13393a37ce10f8187b0978e1f0a2c4ae4b2b4374a764d1b7793e52cbd8a9de7498f6376a3c7faed75d0150799002144c5eb18070331824bedf0b9e0706d885f33aaa782f9b0ce1126a85ed7ed473fcd4e59e0085ef491be7ef968156882e2c759a8c20c100bfecb2c96f78b3bfb720c50886f2cdad665a5dad479de3e5d0cd89accc6db422efa374a76b3400e99e46b7fab93988ae272ead9e06ff4f930c7383e68c22f46d0db387c35af29f5cfc8d32203709d88eeffc87dad54bdf957775edc9be3f8887e207ad43255b1a139ed32a4d9566516220c681d470c31238b0c3c264048d286a7b33905286b16d2f2a11a420bba8f2fed64064e008b6950e182eb685c7cb08c2b4200d8ac5fb1ff72242c53533c5ba5e3b3360c3f1fde33259f24cc068aab35325aea62c375742904b24670126198582c4401cb15ae86f9c0c0b9a7022bcfb25939d137ca4ae44476ab59d38e0d09c30d353c470c53fdf84a8bcec56a15099be293fef3550165b0650cf7b2f15e9450e8eebcc2384319220ff9e347a7eef647540853b4a6e8d1b4eab4fa6701ea978213650b2afce2de8849c9e120c55a233af19f6c1d5e6dfb16155cf1ac9306a2b5d614ae5d970f1b3d1bfe0a8618560d080435a6c6e5d50d5879dea761b5565dba3a757bff2df0e379ce69a4faa87e1b2c1b3a94ee5ca4f37968cab052acc75f7d655b67a003d36be96f001a411e9848b76e2df3a643e6ab9aa5fcfea034758480bbb2b1cd7fcac9f0080fedc24cc0563ce5f292471e3c1342f395bfac0fd6259579c9130db8d2e3cf6c11872a3359a7d64ece623054e6c49d9c5883c1a7b350563cdfd73256c1a21ef411b7edf2de6b7fea6d8c4754fbfe79b460ab3431933bd169fdaccdc2124f82fcf4a1363b02cdca7c8498a244f4671752d1b26e3b51e1728861de9ed091bb7401e10baa17759456b70849ae4f146ecea2b710dd184430f5f5350f7977f2262ffc42a4d4e2b79957eceb493d3a5befad6683e8afa5c6a6589cb95135f5fe7ad205351c3858706b2ab325ce45dd5196e8c6997c64d6e3b6a2c86e5d397b07885b5d4247b4ec4787c7c33dc06f5e276e013207a88c0bc21793811ca4c7c3837824a411689c6781561e27ac5555ac1282a42d998ef4c62079577464e343408889f88f85035897a0ac3e0559c3fcb3423b33fab765ff609d640c8d0be0082a9e77df2c35e3664f65ca69a2019e364a89ee523f934f789d0a16ff1c4fdb4b91e93b2f82a42e3d16b9c1b59c98ee92bbc4342f364fbfc2b3afa838c56ef568c885bd0c61268af6b6b68fea52cd13e5e27d280d37c30129f240eff597a5c7ca03b8ee6fbb7904f009952a4c1fc963f5d79b440755f3325ae91c0ce933f29bc1c0b3c98b5064a1ab97cfb1d12d2b16c5994c132b1322913b76d28ce6b69d7624d57386632a25f7a7597e8615c7e1e786f81bc0e9a5508fe3ce88fd49f77eee87ee5fdcb1e757f5a306b54c3e1cb6d54969b8b372742b59dfddac77ced037810e5a13d4925a4025e4dc212b589b063a1f49b278365d7d05fe2750942d00fad237bf842ed3b83ea40667da137b4f04191c76dcd0bac428f6fa4d24795fded1ad0b8a6591bc8463022fc91d1a8bfc1f8654e1948b00273f6b263facdda133fddb61a47c9819916abbfcf6df1ab61f6c9261208d5cf19f13cd0fdf1f671ad7e5c54e1ac59c6921964f2f3743b1299781696d538e8a3ad7f7482215b39caf562e7b44262bc098f1608c73dd52a54470488d30b2dd880f2729ea184b4b17fb6c45dbf66f58e60a408211bf30ff1477100561c6d670e204c73bd66bc08215def2347fb3e49cff3f24095154d20b7c270b31deb9c79eb2bd4f93b89bace2b65108dc4ab81c5ac5487bef352f2ad81da1cc59abcaa4b0b23ec7c8f1332a9b5a2cd3995ff8cbaf06122f42df5759ae849fbfa1755fe0145ab408fa5f47a1a63b30a5a8a804fb16eb0507793d656ee451098e3c20292ab2b8e0208f5a0aee6da73c062a0fb6ca20d7dcc6d0e3218b6c3660aaa757ce6bb44fdf5946d0434329a42a58e538f0531fe78583cf47a3628bcf081966b62975fbbb20529e03bd4c6f6834c5ffade754710991acb3d172420c68630ac485cd1e11601685bde8862b9bb5b51421400285ee3340ddd9b215354c7a1535fc047d970b83c1eb96ce026025360831bf930271e0b2e0a87007037dcd228fc175c771986b8fa25d662b44722fea9221833d99a4ece9d0213dcd7d90d4a1069866dc6da9de4aebf3df79d6e3e162a6bfab6322fc138a6d4df2cf367d340f3c7f36211f569d4aa2070c43a0872a7122760f943f681a797caf14251fc05edb957e79c64b720bb853f80215d279147670245b6d98f45fc0d298558c0a594342368b44a834219c44e7adcb7b6895d881d382f82741f93c43febe1c85603f2bdeb0db322522dee36bc8590d1d84d407766eff23bb4aa2ddbaf225c932f3c0315d92d6c1afa35771596857f3e263965510ae959f5013ce415e32904f1c6c04e0923d65445a86adc8c1f708f1ee6a3ce78b4653e9d2ef45c8d843b9e321d8c4a17af856f06707025d5b1dfba4c9984cd135e21052fcc1fb188f2c856a741193a52c0518a9a1aa1007cd8f62bd15b2d5be0dd9cc4e039d5893dedf2b5607cb62ae42bea9830c5acade841097c21fc0483dbdb337ac96d84cedfb995ee58f379a0c9e5e50441339b0739b6799d8dbfc70b570aedb36deb1fe01d487b0fed4bd6b37893843c05d58a84bdf8a27f2a531523dc1a6fdf54bc3020758a3d9799149a2a2c944cf3048dfd54680310276e7b73b24460320b4f017deeef5dc9dbdc0244447a37a999eb521f98aefbc0de84dc6fdae59abb213627e45137683aebd8436c0f95cfb3a8974080cedbf38bf5704d30b6ef8b9e7508036ab6cd4568095ddb86701a4d5db18de09f7304608867fd6ae0d7d9f9d792188ec7de7e613fa2b1b745e95241170894e3cda85816b6f9625718293d740ae65caf46759449eb246b38dc84525145ed8cb6dc9a956aecf5c708ee0452ec92ac4321ad72e21aed4b12933b4eae3f823608760a9206cac94c15bdf3ccbf84bb89666cee9c025d0ce50962d3d3f70385182125c9e5698fb7deebc2db532f7cb32455a5aee0e0b2b192141a6a7d7fe9ff5600d328bf2b62e5938b63324e0505818eed73478bc51163e7e681bb656d71a3e04b4565bc6788df4e3fcdbf0a551fe0c127ad258bb5816e0425bf0445d5494eb4f402ba048cba697684b90635e386f90be4b09d52a4ace442fe3f79e75bf206052561feb8886b3f9dbfb4cf6deaf790be03cede1d6031d2a04dbde45199ac1565161b524e9589c59bc5feabab0bc4b06c97566fc2256f22bb31545652def4ea7817972ae5d5b1b08b70f95128c34807a42ee7c3bced4d006fe21cedab5690b224395546980e5531722bdc5beb7a48f503e9ddb50a1071ae8d41fbc00fbc1095d6ba1bdd6ba0696d38eeabc718f5c2692b25ed2e09b0399610e6707f2e7d67a9ae8184d51ab0e3492dc6801f373234de220d743140da0ca47fcde48d8db09e86871cce83e88d952ed181adb0fbb1758d9182594debfd02621e5422560977901a08f058b655497e61f32bdc6fc88872daa9215b7f8fb0dae29eae2ae3726a665e9c1e08a824321c029aaf78e8588f6cafc0ed89409a5ec6a10c5e1805c141d6eb0462aa952cca410b32f383376ae1a0bc2e02ae926bf583ade77bd27e6d09352845df416a0040d05b69e951d06f6a4fdbbd3dae7ec9ce8fd2593ff0e4ac528d83ce4fdacc1eff807a225ddf67c993714e413f30ab64cb33240e4d9d55f81fa4a23f827bdf0243c423993105b419810e7211f949c51249a129bef0456f9aa2b91e3f05a80bbe96e09e383bdaf9f35cf6b9386eafffe2163d06790e606144199b01b2c7beb64ff6c4d2596513e3d56d73b4bdd654309b2bff39d179ac896a0e8b7fc97296f28cb57519692e098133b11b60c6afc6c8e03f7ea7852fa844d7e82a81b09f42ad19ee2300e3f516ca2c6736344bf26385a29adee12b02b489ec36934747e2730f1002d868b21fe541f3439d7dd5f19e43b4f6603f0b41a44bb7e3ef7ec6c17ed5099c9ca21ac5e3b4a4a907bb1c5ac356992aff56e3b2f1af6a61fb50d260a85e88c61bec535a25926f1547d065c3b9bf9d556c1be9a69e4c900020890231b63e3f7e44bc8d8dcaf5feb96a67268a3c4dc297cbc7a0421902c701ffb78d4a0eaeb65c1b1ed53a7c57d3dad71d07798b45b1d8af3782e023d6666dd34c98632cb0c309cf4443f47d82f5bad2d6cd375239a860060f828c81ad6164c9751d688cedf3cbb30be96ada95c9a6b1f5f70548f5c593cb049d4b5aa038ebaf5128eec08fd2a20d0e987ef1aa3233cfd4297b9142bd29f85e650240af926a767c37f6e273ec20331e3558f10728b285c11bb0f454d0bdf1354a0cb4bfd2dcfcd28593de735a52010e90007966ee9b3a38af0324c371b978beee6f992d86fa664f07db6ca5f28759bccfd935e4b2f9a21ff7a6742477e011f13eb13bc00c353e93b81ccd821fbf96d871226b49d4882211fc24939bb9587aab31e1c21ad2bbed5b3b3c85e820c6aca16d97e850181b43b02b6232173cdc41ebc7a3924d1dbe476164ca2b54dcc14de9097989d1b4ec7f42644ee9614f69c8984bf2b2fadbf77caab1aa3bb65ca74c8e6b9f42d800255f29884a74e95d53b8c0df466339efd1ad15188d8c47fef4d9ca46e853de88e026b0ca25032bbaedc4a05e33ed6f4d5dc25e637240ee981e4d47b4e8d74a70175494a27d820c597efcabb745985241d07ee5a5e6c63c94e9433afc59e3dd201f233902a3235fe3935ccf39a3ee00c19962fc3d550971043acc4331830ea6434d909930b965cef474c242bb2f20a03dbc6e2af710bfee7594fc00a83d4c0cec262f59175471f70e03cabab062c1e92e7350617148df0c54d209430038747e78f1babd48c1a48a77cb68bb36c92518e09e8d87e0ed661c1f2ddf36701e9dd71ca52a741249d317ab342430db834a5faaa49bd6cf91f443716a0d0d37311bb1c36f3ccefa73d186995818d5afb51d2adebcdfeef338db527ecc6ee47b5b0aa4ade3ca0375b8e58d6247252f2a9c463acb786391bf17ee2a67932eb4520f9a8a00b08de5ef05ba8dc4568b466198b12a98a23ee59fa07a2eaa23066937ad44934962031fe82f96e2b7af9646e765e1373f4f25cca9d1306bd1a6b08cdfc07e67886dc2e558b0bfe1c82bc9de287f1982b7126c9e45304f481ec440a80519e4db3600704b1d9c9c020df8f5eb7495c96e9b9c19579c7b23eb337018ebc9c003c26b3add9d3142e60cc1a1d6d52493fa3090f91d40c3b51c14d1106bbaf6e3a449f6d7df60e2f122106601addde608fb0fb853dd6e7788956626c12d600bd0e8248a1172e72699e28823bb1bf68f5403d10c544fa9ca00ae658c77cd3a5b452298bbbb18f99c099b88d9140ca0fab8b37e53315312c3d88fbbdd64f8fcc54ea9e3f0667d9fe8512cba3a35ec458df7d67224402e185926e2058253ed8d876a734e14e9c1e6c58bd8f2676738bf519bad5620895c4ad387e3c49c4de41cf7231f9f6b1de693a5061fa30eb97515e7f3ab43f311bed45b050e3876d9274fcbf8e1504cfbe02ba8f1e4dc3b782c3044b182e38f6dc5a1e7b353b8870a0cecc836f301e8e9533c869fbef29b23c92e4a65ab009bf2f609addcb082739e7ef628273acd10e8373a0229d34098d6058270f1472266dee09f9e2f6533ea95511abe2d7b583c36acbb48819ed3e56dad63bd34ea5b5cfca1441eb584566233c61168ae1b323ee50605fd939fb65bafeccfe0ef666bef0deda57085b85182843ffa7ec7dc9cd14b7c43fcad9bb321d18ff4ff689fe8cf03425a91216637e65caf1e374c9de2fe877e8588396b9cdb37a8e95a9f203690220799d93e8096d9200f141e2bfa86a2e7aad5fe6b7ba6ff8898724916171c475c6f0ed5599bc7e7c2fc2626ff24689d81590b12b2be044d2c0083986febe29ffa535774ff1c17a6e79de2fa9a5bac3ab1a170ba47be4aa7c66458382cbdd8225103b80f9cc31895965eb86c38e07dd6e2632c72042620aa498763e01dc70efb9ca0a0154b3f2677d21c3e924e4b30d7fec31fe25bff3b96cc27fd7f408a1a60f22c3c19ca1a5ab9d4fe5f42fe8a4e9c6c26480b32b804b456cca0524ab93664a3f722273ddeb7581ab12988fd3c8d0fb0766c387fc47ed25a2c2ce6e668685858e79871310766ca837d8da7548165e98cfa80ef9dfdc19e959af922bd3737d3465df46ba2da060230e10b4dd0e44f9a30ff24ff75d8066a72afdfbfe64e9cc9a01b6b0ec36a7ef07ea1178c6dee61cd1edab11daac791ce3b80e4e7cc406bae1b979edb34fd63385b553b0a164255de6e84e609e5a6bba3974241c883488d1a34c3cf28aa90262568f84286c899c68673413ccf1a1a1ed0d1fd22a5a053a0f48543b688fd4304b5d8c32f0e50255e2715aff437fa6a0ff88d6225c91e42e6132d5698781fa8ce7e4d8af4c03cfc6a9155c375d87e26e9b8e971b98d7eacd98bc8026563c223a48f8e48a70e3b04ee5b72832f37908ec39037c90722d7866fadfd0b44940748ccd69eb23895cf3a6fe1a0d524a4a9ecd5495e5580a05a04bcf61e327bfbc3123a09544bf0ae461a1a06affc8e871864800f2bc48784eeea02e8115c554fea31309f38fd96951840acde5c135d963812ed0fd6cfb325cc1b813d3a7a03306f90cc190a8255ad4c0f3cf5336cbaec75bce3a0ee2117de94511486ddfc472c94db196e3ea8c3972b50999831b7cb4bc8151e943e55274726acc0d5612ca0b532b46151a55c995411f404a580d925c67f78ad04142ecf3657c22de130a398bdb1f829e934b911baf2d941b8bf064cf65f61370e157685f0517cac7c3d2a0f452090f7248e4d03d6ae3fcfe94df5ce42505111e2f634e208329f5ddbd3c4b55ff142c57ca0f3e1fd882ac53e4688d0fc6659f99bddd20bb166d3af0d4feb8686b81130fe077c0acef58d41260cfea004de84b980fdd79a1b1f893b82ac8706b23401fc2c75165fe02c30676492d68e1f63ce70cb85e48497a95fcba0ca4e985682f133e0ca1620eb09b07d88e5bec44cac7253a773a0f9ff4ed341957c5937f23fcdf9f4e2d450cf8e99e18a42e796b3804fdeb0742b7f7f0fa76aeb19d814664dc2f5e8e477e2b51d44d180ddca3004ace52c51b01807bd97047627c5f621a500e8ddfa47dc951114319fbd26d7298b8f5760544d07b67c774752963ca07a6d5ab142b3c175d15ff3ebdcbc24cd38ecde549c503f1728ff750d8f24ade8cce993e105b84d161ad97696b95d217783d6cb79e3e59d5ba827b7f08bdecf06a3f6677b5c85c452ccbdda92463bca8922363cd55f0d0d0f66b7a4305727ca9baa5c2294f885c108572b6ddef12c1beab39f2d4a06dee9f5fdd333fad39bfeacc6fbfb1e1fbef9f8c2dd97778973ed569f4d23a04b1b1e93579ca85f8f7e446b160ac2cd9ab50eba35b1331ab468361d52c4a38cbfade060e7c8c16b6582dee0736f36a33e9ba30502d7efb2746cc3615484ca321a696e2d2fad2126175784ccc7bc45a2317013977584c76b730d1910e4a2774b05030f05ffe88e52f23c345c6e007d6f47dc9496b9da08101b54e3f3f998bd95050049c28be9801d4b61ff2fa6b21fd0e4d7eb14fc25b1f024b8486de2e73bbeeffbc270df59f8cc1d7dfd45737d4b054503e02973dd8508f6d126c698ac21259b3e1f7aa0b2c49aaef9c8b2ab28e3e69dc31aa4bdc1b047103cf0d2e52ce1b6f1270af5f1fcf2c6174aa9aaf39c62c0e96aa30ed653fc67b2e0398ea49103914146e7bbbf97da551118a75659ecaa88a0dfc1fafe88597a2ceaa04a4fb35e63afcece3fa324531000226137ce61c7e935909703a7811e92fe81aa0925db79082fec19ecc3018ce614215e6773452a632790943082e5f01ddc372596104d4d246011bc9b7b90112d53832cbe04c2db967bd6c9dbafacb16d6e79c5d516e4027fcb6906b82999d200b16796ccff26e8d270aec4a758708f378e15b431bfba53447b31a10ac5b3dfe871e458dca8a1c817f83a83f91f48665d2c3de7c0a642b1491503d873efe8b323d80ea7e36d4cfe34be9ad1608aedd9dd05f9a699c3e77f24059e6320f67702d3b375969421ae44987c546e5b20cddf4d674f1ca212ce7a92a02d238a871e884fea3671be47475058c6031774b93b74308332baf11d8f6a46e7cfe50c160764c3fb0769448090db7c739c6b2a08b06deefbfe62b057bb70ee1b65540973cdfe20cf67c071c7bdbe0fbaec1c44aed1ec870712775f8d66c61686d6723f0c253e38f02b844f8d54429b03430c03010832c100575fe0aff5341033fa8f396edea49f1c38fe4b6a65ee3b49010b2b825ae99dc2c145d7d4d54a83cc6ed178ba6e2e90eac91c3584711877c53964dc7d0902cea9b5f14c11fcd60cf5d79a6e992a1e5f2ee3aae96b049d0c86e2231c95e58d03700615d8fb2924c87467f58c5cd57ba8a8454fa84472967f5a8db877fb3574074822919e60f899d5d18937707f7790088eafde2b1c780bb8a67f1ca55b7498ea53d232a8e63222b87462c6a3e241b9560f7f682b3b2a2516d0b16d4f106fe6aeb1d2d057b8fa5352071f1f4d0ed3ce12def8fbb0714d95db41d80aac6476cebad8281b519099b91b731166cf17ccf3bf30b3fc2e996de7e4a4d2852639449b43aa51a5f8f0b4fe371c1e568469de4d09c1cdbb7a038ce8e868d8d305750483e6d10835155563976f50a8af8a53ab36337ad621f558e4f2eabc99b94ad44d61706e2098a40e38d40f7010b51e1e3ead14b22705038ec8f799f274337f48018094b8741949463e9168dc726f71ea4567257585cf0886c9062ecc23a331f409d43aca6e8f0f7989eb4eb36e381d16e0fec875f9e0d68e515a4421cedb6f6359e35674f428424e27361e3fa0e6e9e107c5e09af7dede247c681522b7ee12106163a8fa66984fd26cd36b369e3a948dc910815ad303baee45fe9f7cf81f5bbbae5be0215bb3f55792d68fa7f66792040849c18c918018026bc71bda88515a43f42e3ca6085dc1ab3634c67fb0a0c9c7504a96268fa12d837786dd5fffd5f6b4440c76651b2e2eb0a1cd3fb5f0089d5dbbee6bb450e274685285a75d9a93fd9d74276db17a86981894a5858871bb589c982f3d49d72d8d5ed00026925dbe92b9953b17e3528dc1821d96ecc2cfece0155fd8b9d43c839957a849977e07bc1ef092d40f0db0a7dd1a997926cf6d0b31f0907534c084f3d29ca74d77a35b96eb6c0958e0ea42b60e881bd1c080bad5d5ff8ca12062b1f74c21d258549ec14ab79a53f117832aefd9b2d5d249bc26f51464f73266658d900e8b73c57757fae9955c65879525229740ccaa246b911afaee80c1873e25b4f2b2546e92fbd643712dfd84f916516c5c858f652eb95a63b67b0558a55be0fd7690e270def4db82a9a354d431475669437f9a97ae1c3e5715b2589f4ef879a263024ea1ec2f4e81da20003ef043931ad89f83ed5fb6f2ba01db87219c7a99925be7946cad527dc6c9de42032e3edf0baadfae9c2822eaf8b5ce9227acdf9e3a0a08b233476c64c60b9402067d96997387d3c1ee72aee9df8bca9e6d189bd570f620752be6567cf33b5b56c5ab217f936eb1b7704181a7dcc390b943b6b94d91349b68052849c4948ed5e483f0d4da32048c47f8a1fcea7e221b5a7601eb96e6aa950d584736ab769b0cf2bde5412f3d2b2ac8d651455d8d988ac3ccbb6c0cd323fa947216b5401db24f6c7fd43c5fe277042661aa2f1ca74c618d69ad3f35af76da030f9c255bed2bf5c8011344da228aaba8fa10cb40e440fb58dfdcfb2c8413190b3c56d9e5f655a5e7def6954938dd24807d7ab751bf78eb4da347fbfaa1105b25e32c78951ef2d8c2c46eb00fed4063d361f2f658e85d7ea6f633e03443f7ffda333b72a39895d4f1128b63b8b4aa64aef9bb4f648a8c122b3a458dd896d28a3113c3bb3c0c2e94bf91756305864d27ddf987d380b9e48304932a2388adecceeb9010934b8f1fa585db7addaf7c005b6c4464981823a92762a15e7471ed13ab7231945e4d87902512250ce8311bbf6dae1ed8423583e38668ee3da6ee6a0ec516fd5952ddce5f476ee5ff575eff87ec1dca9a193ec9a808b9fbe183bb8ba398d261f17954d530e5bc8620c2b9d240e56c9bc9f96f523fb3648abed1c0b94624fee3af352f78023ab968e401aeb4cc1ddc2be528fd4e6451c7ef264562ec57a2246d98b3707ed071da5d02fa5414652776d862d36ee8faf9a6dc552dd65e1ae42f2cf220ff52742fc63573c7bbad224f168b752d957f6026980e31688218b3ae6bb39f509e22fbf93be61c1a30dc3d5e069b93596c0d77bb5866394c46378d77e17f366487831724519746a3874e405dd8fcc068d08cbb0c3ae57f2dcb512e4121d162db0069be8c757b0d9e8e80e7016fd13f7a61c28988b6249587adcbaa97d2ce38eec4a049e185f3502329deb63b0541662e3a521d2ac7dbebf370ca44b3149fb4aa00dd02d1b8b74a279bdf810009858090e4ce361fa0f7683d1fa641b0a2cb78ccffa33b90b2f18340fb0511796a70863e6ddd9d77e08033fd2a7537023ca0785eb550ad6de6a4aa714c772eabd2ee6a7e4e7478eb81d5cb0bda88adfc03308ae4c48d6c564f675678cf4849683bd4f1653b11294be79dc63c3b2b01ab29ede1812a97fc94a26aea4690538868e8ae2d8be9e0a0bb4b10fbcfc157ac15662590f81cd39a6b3b85fb7c1ad2c9a8a35330ce465f5865106874cfbae23ccc95f11b2fd103e3742410e0bda1b75fe4a3580ae156f559ade11c1f2077ffbaf795f607e5029bff9541a997d2c2f52f2a3fe80b74ac9c0d6fc852c16ce09ca587d31cb8b66e6bbe6876da69f5243747ef92aa16505da5c41b52e5e2cc15cfa862b0ed177567e22b0458ea731a9a2dd5189a617bceb862759efd922679aa79e1fa09e3d96f04754162a13843818d9737275a9a81a93d6e97b813011b74d241eb05b3374154806de044f3b1e9ec94ca325602764b5d6303ee522b0f9df4aeaf30942af10e4c7a75efe11e3938fb660817a70fc31315ef2232c36cb621385e68cfdb2e36d2af26d83c4b72c477cd055e6994ce060151d7eacc4752fe6de2f5e4c92ff7acaf447eaa997a7e7fa2789e38c0f7fe75a9568d48dcd93a3709e126d5e3dc07e8706f3c3c7468bfa558d4c15db6398871db75eed10db1f30276a7249bb16cc237078741968159a6856d82b297c1ca9a1496289b1eb0cad59c20f681ef5527d681c151db42f4df86cf1bfb82f9157f9dbd017f9d87d694b4fa8bfb310ea46ba2f6b69dff86eaa03ae122156a5297bf7800b16b50c875ad39dff6e8ec203b698e08ff44785598e12b2cbb111d622ccb77e23607c26f2d0691862b11093e631892fa9aa0c19246eb05077a334818ac22f67012182b659b80029075c46c6675093abc2a41eb523144fbb23360d7295a3d9b0991bf4fabddbf02e03d6adcf375ebd95f8e21d24c197ad9849b91d0f1c8e113b71ec89654d572d04aae1abee12d75b287e1c37fe58c6cd5887be5e9a19ac08bcff9b7a3363fbf795fd82e97719de7dab58f9ed360004ea1386811a69953b09146ee213f69b5f9fd97d1d650d866c65f4ba33bcd7e8f5140812e31bda5906d6b540b28579ffb91c61e4764f2459f258e9f3c2f47dc9e6e3394812658cfb6f9018e84d8a88db763cffc948105ebd74e2d8a7b03ce30b29158794b11ca24823d3b94dc006d2b780e1516dd629741b231ad34949fe55dc35f24b9aa4fe2b87fca0ecff9a53ad544296ff9a9629d494c0da141e49aaeda8e67d9595f807926227b595729ba3033108a3ecf83410f2775954a7cc5747adfc708a660fd754b8b34043404f8c0be89d681cf7e7f599b356ef2d66826f8dc2199efca1d8009062647ee3516909b1b2134392ccd3ac9acf388271801edf407ef80592a360740dab1c6b368c71952795e533d6f88c7ae1e48c6649da51a2ee50303a32a41a32b869d662056202909d2aa93db761659635c198b49c16be6b491d8b5b42881c80636260cc329a635270abdf4e35faf05d83ddf50c6274822e532fb9337a8d55c369b5c77548b98c6a13fe478b599cd1f2d5655b4638fdfe095f73e8945dcd0da2d95defa42ff7300f6da913654599a69f0664422b7538e13e2667bba713cf813ad836fd22b9a8cfc1e942c86dbe35b74be5610a7ba4641187762ae477ce4321275c6cf3df118826758414280ad93cc2c9b623be7a7129a11d8bf2e2a7e76e552526c68a6d70ee2baa110321eec5e0dcb267a8a440f6a1ee5dac9d4a5bf60e6c5e4ed6b5a0f4a0cbb6cd893752c227ddcaedac100670a1a17e20fef794617a75a4c087450292e097389394b7d9b802928027b015fab7efe1ddc8d8082b81df206a89002da92574c4626fd9e33f7e71e3ed4d476a5d23caa996171066aaf42686d36d93fd93dea5086c92818dafdb022c61777dd276711a18593308cf8e10be3d0eb970522a8e83113ec142e4ccc26c5af8f5e1197ca39dc892fc6429b52b8536087d5b8034b1b05e4781583fd32ee3fbee9f135d2ede747e4948ba47fab6d33a357bb0a3dc5fe94c3ab33a43ec7195c300978246bd7d0007144332d98b149066673df1e28da9b113400a50e77218425a9c4efd1d3402f9ea5157fc08c16404a1d2f81b0217f748ee1b0cbe6a218b75275c5607c4e3f8d078f58727a0e73108b59ab8a04c709bf5f4fd5a52bc99c0a1f9c28acc0aa73ebdeaaf0c24347344b421f26b3647c1f788fd9ec3223c4e335925e772afc5f089d4127c2e72b25933b9686c2d36cdc4237b8c64f98c54b8927965259cd875264c33e738df964c58a1b252b50a3ec7e988455c210649d29fc0a72f907592194f7ac418e3893c9d14899de9335bf8d94029278d12d422016707cf09fd0a75f17c5fe2ee4985a52295999d4fdcb1198567d55bb39cca81a1babb6ae4bb9f52205c225161b27d9b6baff1c4e614f6162fa4f3fb0bdc9f60216869c62fd692d54b055d50f662cc96ffb302bda9798eb393000e6728c8e25b9bfb53e088622589ad3d358f17f433d7d354b1299aa2e66f276ba3ae52709bc544953a46c0f01561fba1b3a76636b78403d0f601a4fdf3462d34f451aef52fb301de0fd5d9e0c5760ca2a4b48fae9cd2f6faa3bf33dbf37806c99ad0e33447a4e11e02bc1e2656d694dd27a342758c34c299de34c1a6deb16aed5bf10bf1eef35e62a915aadfc9d5df3122ae3e888c9268271b3c64514647386921d0919121f79beb8eb2cbbc7b03b20f5c5073cb20ab8dac643866e6c3eca4ad20fa050335cb54ecea2752407863fb57a1e43def9a3edac486d2126a85d23444da254b53ffc8f84997f3d4d8bf15e023ae11f35d4afe32bf1e16aa409295358334aaf14ca22697c55f0f869ab574ca945d16957e852ba9cad2ce706c89c8ba95dce1953243efc220474037771b1816cd3b127ff57e0a35e2c0cb5ed5c23898314fc08f01d033317779dfd208600fed265c08e3f58f8b2f7f3492cf194f9f8ef9e98d88bfefad8d33633ac5fea0dac1a06db1008a475ae9480bb997b0b4496c4297d1190bbce3a8d054c9711d9f1929d2f9747c044171ac1dea20c28faaff130af3e111d370c36c26fe649889b2ecfa12c0a78ca70a768f32bc5968b3bd1d15d2a2326183a44da654b7e6f5d45559278aa4a70c7ce5a1cc8b2bd8a173db8ff554ba11ab4ddc6455888b1783ffe49fedaeb5d9868b1ff888660b608aea9402791178774247dca1c51af9755c9c5f6c953bc6f0d18d2d331add2ddc1b10bb54ffe34388481ff653cbd8943605281c9fad2c86c6d9f66260bdc38c6c88e2cc0fe0172a39ab24964c37d8eb00c2d1daf136df8a0bcb41f629cf93b96a95ec22e9fe2d33fca47890a0878ad5f2180dc0afee95e91735b2e292b6af5af95c92f6def35421299b3fac2f79dd3d79a45f0ede6eeba664ad91024d4ebe407581216ebf72034bf61d3cd1d37e688408087586778900fa1092651e9644a6e3231fde74318e24d140b19ae1459872090ec1ee47859b28ac50b5c46c54425054f11d39ddec7f75c87931c203144f1e82130a2aa86d77e097c1482c7b0237f11c8d30ce71367833f230ab4bf8495b55418b02b8431c913fa34703889a7f933175f38acb8bffc8095c90449f729806374606253121aef099da0c6a6b97f962b90dd228fd76233ab8333a32f678b31e5e06f26a704de0ece7eed05169a3fb7bea4c12bada3520e01e58232fb44c4c2cfbe24d0c268a7bff23688bc8c4e4857dcf300363c44f6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">课程内代码不能无偿开源, 请输入密码查看.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> LAB EXERCISE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CPP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
